node.exe : (node:47168) [MODULE_TYPELESS_PACKAGE_JSON] Warning: 
Module type of 
file:///E:/DataCert/model-db/eslint.config.js?mtime=1768586791432 
is not specified and it doesn't parse as CommonJS.
At C:\Program Files\nodejs\npx.ps1:29 char:3
+   & $NODE_EXE $NPX_CLI_JS $args
+   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: ((node:47168) [M...se  
   as CommonJS.:String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
Reparsing as ES module because module syntax was detected. This 
incurs a performance overhead.
To eliminate this warning, add "type": "module" to 
E:\DataCert\model-db\package.json.
(Use `node --trace-warnings ...` to show where the warning was 
created)
[{"filePath":"E:\\DataCert\\model-db\\src\\AIModelDB.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\AddModelModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\AsyncErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\ComparisonView.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'attributes'. Either include it or remove the dependency array.","line":158,"column":8,"nodeType":"ArrayExpression","endLine":158,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [attributes]","fix":{"range":[7829,7831],"text":"[attributes]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { X, Check, Minus, ChevronDown, ChevronUp, Star, ArrowUpDown, Eye, EyeOff, FileText, Cpu, Zap, Scale, DollarSign, Tags as TagsIcon } from 'lucide-react';\r\nimport { Model } from '../types';\r\n\r\ninterface ComparisonViewProps {\r\n    models: Model[];\r\n    onClose: () => void;\r\n    theme: 'light' | 'dark';\r\n}\r\n\r\ntype AttributeCategory = 'basic' | 'capabilities' | 'licensing' | 'pricing' | 'technical';\r\n\r\ninterface Attribute {\r\n    label: string;\r\n    category: AttributeCategory;\r\n    render: (m: Model) => React.ReactNode;\r\n    getValue: (m: Model) => string | number | boolean | undefined;\r\n}\r\n\r\nexport function ComparisonView({ models, onClose, theme }: ComparisonViewProps) {\r\n    const { t } = useTranslation();\r\n    const [expandedCategories, setExpandedCategories] = useState<Set<AttributeCategory>>(\r\n        new Set(['basic', 'capabilities', 'licensing', 'pricing', 'technical'])\r\n    );\r\n    const [highlightDifferences, setHighlightDifferences] = useState(true);\r\n    const [pinnedModel, setPinnedModel] = useState<string | null>(null);\r\n\r\n    const bgCard = theme === 'dark' ? 'bg-zinc-950 border-zinc-800' : 'bg-white border-zinc-200';\r\n    const textBase = theme === 'dark' ? 'text-zinc-100' : 'text-zinc-900';\r\n    const textSubtle = theme === 'dark' ? 'text-zinc-400' : 'text-zinc-500';\r\n    const border = theme === 'dark' ? 'border-zinc-800' : 'border-zinc-200';\r\n    const headerBg = theme === 'dark' ? 'bg-zinc-900/50' : 'bg-zinc-50/50';\r\n    const categoryBg = theme === 'dark' ? 'bg-zinc-900' : 'bg-zinc-50';\r\n    const highlightBg = theme === 'dark' ? 'bg-amber-900/10' : 'bg-amber-50';\r\n    const bestBg = theme === 'dark' ? 'bg-emerald-900/10' : 'bg-emerald-50';\r\n\r\n    // Helper to render check/x for booleans\r\n    const renderBoolean = (val?: boolean) => {\r\n        if (val === true) return <Check className=\"w-5 h-5 text-emerald-500 mx-auto\" />;\r\n        if (val === false) return <X className=\"w-5 h-5 text-red-500 mx-auto\" />;\r\n        return <Minus className=\"w-5 h-5 text-zinc-300 dark:text-zinc-700 mx-auto\" />;\r\n    };\r\n\r\n    // Helper to format cost\r\n    const formatCost = (m: Model) => {\r\n        if (!m.pricing || m.pricing.length === 0) return 'ÔÇö';\r\n        const p = m.pricing[0];\r\n        if (p.input && p.output) return `$${p.input}/$${p.output}`;\r\n        if (p.flat) return `$${p.flat} ${p.unit}`;\r\n        return t('comparison.free');\r\n    };\r\n\r\n    // Helper to format downloads\r\n    const formatDownloads = (downloads?: number | null) => {\r\n        if (!downloads) return 'ÔÇö';\r\n        if (downloads >= 1000000) return `${(downloads / 1000000).toFixed(1)}M`;\r\n        if (downloads >= 1000) return `${(downloads / 1000).toFixed(1)}K`;\r\n        return downloads.toString();\r\n    };\r\n\r\n    const attributes: Attribute[] = [\r\n        // Basic Info\r\n        { label: t('comparison.attributes.provider'), category: 'basic', render: (m) => m.provider || 'ÔÇö', getValue: (m) => m.provider ?? undefined },\r\n        { label: t('comparison.attributes.domain'), category: 'basic', render: (m) => m.domain || 'ÔÇö', getValue: (m) => m.domain ?? undefined },\r\n        { label: t('comparison.attributes.source'), category: 'basic', render: (m) => m.source || 'ÔÇö', getValue: (m) => m.source ?? undefined },\r\n        { label: t('comparison.attributes.releaseDate'), category: 'basic', render: (m) => m.release_date || 'ÔÇö', getValue: (m) => m.release_date ?? undefined },\r\n        { label: t('comparison.attributes.downloads'), category: 'basic', render: (m) => formatDownloads(m.downloads), getValue: (m) => m.downloads ?? undefined },\r\n\r\n        // Technical\r\n        { label: t('comparison.attributes.parameters'), category: 'technical', render: (m) => m.parameters || 'ÔÇö', getValue: (m) => m.parameters ?? undefined },\r\n        { label: t('comparison.attributes.contextWindow'), category: 'technical', render: (m) => m.context_window ? `${m.context_window.toLocaleString()} ${t('comparison.tokens')}` : 'ÔÇö', getValue: (m) => m.context_window ?? undefined },\r\n        // Note: Architecture removed - field does not exist on Model type\r\n\r\n        // Capabilities\r\n        { label: t('comparison.attributes.apiAvailable'), category: 'capabilities', render: (m) => renderBoolean(m.hosting?.api_available), getValue: (m) => m.hosting?.api_available },\r\n        { label: t('comparison.attributes.openWeights'), category: 'capabilities', render: (m) => renderBoolean(m.hosting?.weights_available), getValue: (m) => m.hosting?.weights_available },\r\n        // Note: Fine-tunable removed - capabilities field does not exist on Model type\r\n\r\n        // Licensing\r\n        { label: t('comparison.attributes.license'), category: 'licensing', render: (m) => m.license?.name || 'ÔÇö', getValue: (m) => m.license?.name },\r\n        { label: t('comparison.attributes.commercialUse'), category: 'licensing', render: (m) => renderBoolean(m.license?.commercial_use), getValue: (m) => m.license?.commercial_use },\r\n        { label: t('comparison.attributes.attributionRequired'), category: 'licensing', render: (m) => renderBoolean(m.license?.attribution_required), getValue: (m) => m.license?.attribution_required },\r\n\r\n        // Pricing\r\n        { label: t('comparison.attributes.pricing'), category: 'pricing', render: (m) => formatCost(m), getValue: (m) => m.pricing?.[0]?.input ?? m.pricing?.[0]?.flat ?? undefined },\r\n    ];\r\n\r\n    // Mapping for category icons\r\n    const CategoryIcons = {\r\n        basic: FileText,\r\n        technical: Cpu,\r\n        capabilities: Zap,\r\n        licensing: Scale,\r\n        pricing: DollarSign,\r\n    };\r\n\r\n    const categoryLabels: Record<AttributeCategory, string> = {\r\n        basic: t('comparison.basicInfo'),\r\n        technical: t('comparison.technicalSpecs'),\r\n        capabilities: t('comparison.capabilities'),\r\n        licensing: t('comparison.licensing'),\r\n        pricing: t('comparison.pricing'),\r\n    };\r\n\r\n    const categoryOrder: AttributeCategory[] = ['basic', 'technical', 'capabilities', 'licensing', 'pricing'];\r\n\r\n    // Check if values differ across models\r\n    const valuesDiffer = (attr: Attribute): boolean => {\r\n        const values = models.map(m => {\r\n            const val = attr.getValue(m);\r\n            return val === undefined ? 'undefined' : String(val);\r\n        });\r\n        return new Set(values).size > 1;\r\n    };\r\n\r\n    // Find the \"best\" value for numeric comparisons\r\n    const getBestModelId = (attr: Attribute): string | null => {\r\n        // Only for numeric attributes where higher is better\r\n        const numericHigherBetter = [t('comparison.attributes.downloads'), t('comparison.attributes.contextWindow')];\r\n        if (!numericHigherBetter.includes(attr.label)) return null;\r\n\r\n        let bestId: string | null = null;\r\n        let bestVal = -Infinity;\r\n        models.forEach(m => {\r\n            const val = attr.getValue(m);\r\n            if (typeof val === 'number' && val > bestVal) {\r\n                bestVal = val;\r\n                bestId = m.id;\r\n            }\r\n        });\r\n        return bestId;\r\n    };\r\n\r\n    const toggleCategory = (cat: AttributeCategory) => {\r\n        const newSet = new Set(expandedCategories);\r\n        if (newSet.has(cat)) {\r\n            newSet.delete(cat);\r\n        } else {\r\n            newSet.add(cat);\r\n        }\r\n        setExpandedCategories(newSet);\r\n    };\r\n\r\n    // Group attributes by category\r\n    const groupedAttributes = useMemo(() => {\r\n        const groups: Record<AttributeCategory, Attribute[]> = {\r\n            basic: [],\r\n            technical: [],\r\n            capabilities: [],\r\n            licensing: [],\r\n            pricing: [],\r\n        };\r\n        attributes.forEach(attr => {\r\n            groups[attr.category].push(attr);\r\n        });\r\n        return groups;\r\n    }, []);\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md animate-in fade-in duration-200\">\r\n            <div className={`w-full max-w-6xl max-h-[90vh] overflow-hidden rounded-2xl border shadow-2xl flex flex-col ${bgCard} ${textBase}`}>\r\n\r\n                {/* Header */}\r\n                <div className={`flex items-center justify-between px-6 py-4 border-b ${border} ${headerBg}`}>\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"p-2 rounded-xl bg-violet-500/10 text-violet-500\">\r\n                            <ArrowUpDown className=\"size-5\" />\r\n                        </div>\r\n                        <div>\r\n                            <h2 className=\"text-xl font-bold\">{t('comparison.title')}</h2>\r\n                            <p className={`text-sm ${textSubtle}`}>\r\n                                {t('comparison.subtitle', { count: models.length })}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3\">\r\n                        {/* Toggle Highlight Differences */}\r\n                        <button\r\n                            onClick={() => setHighlightDifferences(!highlightDifferences)}\r\n                            className={`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm transition-colors ${highlightDifferences\r\n                                ? 'bg-amber-500/20 text-amber-500'\r\n                                : theme === 'dark' ? 'bg-zinc-800 text-zinc-400 hover:text-zinc-300' : 'bg-zinc-100 text-zinc-600 hover:text-zinc-800'\r\n                                }`}\r\n                        >\r\n                            {highlightDifferences ? <Eye className=\"size-4\" /> : <EyeOff className=\"size-4\" />}\r\n                            {t('comparison.highlightDifferences')}\r\n                        </button>\r\n                        <button\r\n                            onClick={onClose}\r\n                            className={`p-2 rounded-lg hover:bg-black/5 dark:hover:bg-white/5 transition-colors ${textSubtle}`}\r\n                        >\r\n                            <X className=\"size-5\" />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Model Headers (Sticky) */}\r\n                <div className={`flex border-b ${border} ${headerBg}`}>\r\n                    <div className={`w-48 flex-shrink-0 p-4 font-medium ${textSubtle}`}>\r\n                        {t('comparison.attribute')}\r\n                    </div>\r\n                    {models.map((m, idx) => (\r\n                        <div\r\n                            key={m.id}\r\n                            className={`flex-1 min-w-[180px] p-4 text-center border-l ${border} ${pinnedModel === m.id ? 'bg-violet-500/5' : ''\r\n                                }`}\r\n                        >\r\n                            <div className=\"flex flex-col items-center gap-2 w-full overflow-hidden\">\r\n                                <button\r\n                                    onClick={() => setPinnedModel(pinnedModel === m.id ? null : m.id)}\r\n                                    className={`p-1 rounded-full transition-colors ${pinnedModel === m.id\r\n                                        ? 'text-amber-500'\r\n                                        : textSubtle + ' hover:text-amber-500'\r\n                                        }`}\r\n                                    title={pinnedModel === m.id ? t('comparison.unpin') : t('comparison.pin')}\r\n                                >\r\n                                    <Star className=\"size-4\" fill={pinnedModel === m.id ? 'currentColor' : 'none'} />\r\n                                </button>\r\n                                <span className=\"font-bold text-sm line-clamp-2 w-full px-2 break-words\" title={m.name}>{m.name}</span>\r\n                                {m.provider && (\r\n                                    <span className={`text-xs ${textSubtle} truncate w-full px-2`} title={m.provider}>{m.provider}</span>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"overflow-auto flex-1\">\r\n                    {categoryOrder.map(category => {\r\n                        const attrs = groupedAttributes[category];\r\n                        if (attrs.length === 0) return null;\r\n                        const isExpanded = expandedCategories.has(category);\r\n                        const Icon = CategoryIcons[category];\r\n\r\n                        return (\r\n                            <div key={category}>\r\n                                {/* Category Header */}\r\n                                <button\r\n                                    onClick={() => toggleCategory(category)}\r\n                                    className={`w-full flex items-center justify-between px-6 py-3 border-b ${border} ${categoryBg} hover:bg-black/5 dark:hover:bg-white/5 transition-colors`}\r\n                                >\r\n                                    <div className=\"flex items-center gap-2 font-semibold\">\r\n                                        <Icon className=\"size-4 text-violet-500\" />\r\n                                        <span>{categoryLabels[category]}</span>\r\n                                    </div>\r\n                                    {isExpanded ? <ChevronUp className=\"size-4 text-zinc-400\" /> : <ChevronDown className=\"size-4 text-zinc-400\" />}\r\n                                </button>\r\n\r\n                                {/* Category Rows */}\r\n                                {isExpanded && attrs.map((attr, attrIdx) => {\r\n                                    const isDifferent = highlightDifferences && valuesDiffer(attr);\r\n\r\n                                    return (\r\n                                        <div\r\n                                            key={attr.label}\r\n                                            className={`flex border-b ${border} ${isDifferent ? highlightBg : ''\r\n                                                } ${theme === 'dark' ? 'hover:bg-zinc-800/30' : 'hover:bg-zinc-50'}`}\r\n                                        >\r\n                                            <div className={`w-48 flex-shrink-0 p-4 font-medium ${textSubtle} flex items-center gap-2 text-sm`}>\r\n                                                {attr.label}\r\n                                                {isDifferent && (\r\n                                                    <div className=\"w-1.5 h-1.5 rounded-full bg-amber-500\" title=\"Values differ\" />\r\n                                                )}\r\n                                            </div>\r\n                                            {models.map(m => {\r\n                                                const isPinned = pinnedModel === m.id;\r\n\r\n                                                return (\r\n                                                    <div\r\n                                                        key={m.id}\r\n                                                        className={`flex-1 min-w-[180px] p-4 text-center border-l ${border} ${isPinned ? 'bg-violet-500/5' : ''}`}\r\n                                                    >\r\n                                                        <div className=\"flex items-center justify-center gap-1\">\r\n                                                            {attr.render(m)}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                );\r\n                                            })}\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        );\r\n                    })}\r\n\r\n                    {/* Tags Section */}\r\n                    <div>\r\n                        <button\r\n                            onClick={() => toggleCategory('basic')} // Reusing 'basic' key for expansion logic is weird but functional if tags are separate? Wait, tags needs its own state? \r\n                            // Actually tags section logic below was separate from attributes list. \r\n                            // Let's check how it worked before. It reused 'basic' category toggle? No, it hardcoded toggleCategory('basic') which is probably a copy-paste error or intentional.\r\n                            // I'll make it properly collapsible if I can, or just leave it.\r\n                            // The original code: onClick={() => toggleCategory('basic')} \r\n                            // Maybe it was meant to be part of basic info? \r\n                            // I'll just change the styling to match categories.\r\n                            className={`w-full flex items-center justify-between px-6 py-3 border-b ${border} ${categoryBg} hover:bg-black/5 dark:hover:bg-white/5 transition-colors`}\r\n                        >\r\n                            <div className=\"flex items-center gap-2 font-semibold\">\r\n                                <TagsIcon className=\"size-4 text-violet-500\" />\r\n                                <span>{t('comparison.tags')}</span>\r\n                            </div>\r\n                        </button>\r\n                        <div className={`flex border-b ${border}`}>\r\n                            <div className={`w-48 flex-shrink-0 p-4 font-medium ${textSubtle} text-sm`}>\r\n                                {t('comparison.tags')}\r\n                            </div>\r\n                            {models.map(m => (\r\n                                <div key={m.id} className={`flex-1 min-w-[180px] p-4 border-l ${border}`}>\r\n                                    <div className=\"flex flex-wrap gap-1 justify-center\">\r\n                                        {m.tags && m.tags.length > 0 ? (\r\n                                            m.tags.slice(0, 5).map(tag => (\r\n                                                <span\r\n                                                    key={tag}\r\n                                                    className={`text-xs px-2 py-0.5 rounded-full ${theme === 'dark' ? 'bg-zinc-800 text-zinc-300' : 'bg-zinc-100 text-zinc-700'\r\n                                                        }`}\r\n                                                >\r\n                                                    {tag}\r\n                                                </span>\r\n                                            ))\r\n                                        ) : (\r\n                                            <span className={textSubtle}>ÔÇö</span>\r\n                                        )}\r\n                                        {m.tags && m.tags.length > 5 && (\r\n                                            <span className={`text-xs ${textSubtle} px-1`}>\r\n                                                +{m.tags.length - 5}\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div className={`flex items-center justify-between px-6 py-3 ${headerBg} border-t ${border}`}>\r\n                    <div className={`text-xs ${textSubtle} flex items-center gap-4`}>\r\n                        <span className=\"flex items-center gap-2\">\r\n                            <span className=\"w-2 h-2 rounded-full bg-amber-500\"></span>\r\n                            {t('comparison.legendDifferences')}\r\n                        </span>\r\n                    </div>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"px-6 py-2 rounded-lg font-medium bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 hover:bg-zinc-800 dark:hover:bg-zinc-200 transition-colors\"\r\n                    >\r\n                        {t('comparison.done')}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\ConfirmationToast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\DetailPanel.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'model'. Either include it or remove the dependency array.","line":90,"column":6,"nodeType":"ArrayExpression","endLine":90,"endColumn":44,"suggestions":[{"desc":"Update the dependencies array to be: [model, model.id, model.source, model.url]","fix":{"range":[3753,3791],"text":"[model, model.id, model.source, model.url]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createPortal } from 'react-dom';\r\nimport React, { useContext, useEffect, useState, useCallback, useMemo } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { FileText, DollarSign, Info, ExternalLink, Loader2, X, ChevronLeft, ChevronRight, Star, Flag, EyeOff, Download, Copy } from 'lucide-react';\r\nimport ThemeContext from '../context/ThemeContext';\r\nimport { Model } from '../types';\r\nimport { Badge, DomainIcon } from './UI';\r\nimport { fmtDate, kfmt } from '../utils/format';\r\nimport { handleExternalLink } from '../utils/external-links';\r\nimport { fetchCivitasBayDetails, CivitasBayDetails } from '../services/api/fetchers/image-platforms/civitas-bay-details';\r\nimport { fetchHuggingFaceDetails } from '../services/api/fetchers/huggingface-details';\r\nimport { GalleryImage } from './detail/GalleryImage';\r\nimport { LicenseHover } from './detail/LicenseHover';\r\nimport { useImageContextMenu } from '../hooks/useImageContextMenu';\r\n\r\n\r\nconst getPricingType = (pricing: any): string => {\r\n  if (pricing.input != null || pricing.output != null) {\r\n    return 'API';\r\n  }\r\n  if (pricing.flat != null) {\r\n    const unit = pricing.unit?.toLowerCase() || '';\r\n    const isSubscription = unit.includes('month') || unit.includes('year') ||\r\n      unit.includes('annual') || unit.includes('subscription') || unit.includes('plan');\r\n    return isSubscription ? 'Subscription' : 'API';\r\n  }\r\n  return 'Variable';\r\n};\r\n\r\ninterface DetailPanelProps {\r\n  model: Model | null;\r\n  onClose: () => void;\r\n  onDelete: (modelId: string) => void;\r\n  triggerElement?: HTMLElement | null;\r\n  onToggleFavorite?: (model: Model) => void;\r\n  onToggleNSFWFlag?: (model: Model) => void;\r\n  onToggleImageNSFW?: (model: Model, imageUrl: string) => void;\r\n  hideNSFW?: boolean;\r\n  className?: string; // Add optional className prop\r\n}\r\n\r\n\r\n\r\nexport function DetailPanel({ model, onClose, onDelete, triggerElement, onToggleFavorite, onToggleNSFWFlag, onToggleImageNSFW, hideNSFW = true, className = \"\" }: DetailPanelProps) {\r\n  const { theme } = useContext(ThemeContext);\r\n  const { t } = useTranslation();\r\n  const [isAnimating, setIsAnimating] = useState(false);\r\n  const [modelDetails, setModelDetails] = useState<CivitasBayDetails | null>(null);\r\n  const [loadingDetails, setLoadingDetails] = useState(false);\r\n  const [selectedImageIndex, setSelectedImageIndex] = useState<number | null>(null);\r\n  const { contextMenu, handleImageContextMenu, handleCopyImage, handleSaveImage, closeContextMenu } = useImageContextMenu();\r\n\r\n  // Debounce positioning calculations to prevent jankiness\r\n  const [debouncedTriggerElement, setDebouncedTriggerElement] = useState(triggerElement);\r\n\r\n  // Fetch details on-demand based on source\r\n  useEffect(() => {\r\n    if (!model) return;\r\n\r\n    // Reset details when model changes\r\n    setModelDetails(null);\r\n    setLoadingDetails(false);\r\n\r\n    const loadDetails = async () => {\r\n      setLoadingDetails(true);\r\n      try {\r\n        if (model.source === 'CivitasBay' && model.url) {\r\n          const details = await fetchCivitasBayDetails(model.url);\r\n          setModelDetails(details);\r\n        } else if (model.source === 'HuggingFace') {\r\n          const details = await fetchHuggingFaceDetails(model.id);\r\n          // Adapt to shared interface\r\n          if (details) {\r\n            setModelDetails({\r\n              images: details.images,\r\n              fullDescription: details.description\r\n            });\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.error('[DetailPanel] Failed to fetch details:', err);\r\n      } finally {\r\n        setLoadingDetails(false);\r\n      }\r\n    };\r\n\r\n    if (model.source === 'CivitasBay' || model.source === 'HuggingFace') {\r\n      loadDetails();\r\n    }\r\n  }, [model?.id, model?.source, model?.url]);\r\n\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      setDebouncedTriggerElement(triggerElement);\r\n    }, 50); // Small debounce to smooth out rapid changes\r\n\r\n    return () => clearTimeout(timer);\r\n  }, [triggerElement]);\r\n\r\n  // Simple sticky positioning - account for header height\r\n  const stickyStyle = useMemo((): React.CSSProperties => {\r\n    if (!debouncedTriggerElement) {\r\n      return {\r\n        height: '100%',\r\n      };\r\n    }\r\n\r\n    return {\r\n      position: 'sticky',\r\n      top: '80px', // Account for header height (header is ~60-80px)\r\n      height: 'calc(100vh - 100px)', // Account for header (80px) + small bottom padding (20px)\r\n      maxHeight: 'calc(100vh - 100px)', // Ensure it doesn't exceed available space\r\n    };\r\n  }, [debouncedTriggerElement]);\r\n\r\n  // Handle animation state for smoother transitions\r\n  useEffect(() => {\r\n    if (debouncedTriggerElement) {\r\n      setIsAnimating(true);\r\n      const timer = setTimeout(() => setIsAnimating(false), 400); // Match transition duration\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [debouncedTriggerElement]);\r\n\r\n  // Keyboard navigation for lightbox\r\n  useEffect(() => {\r\n    if (selectedImageIndex === null) return;\r\n\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (!modelDetails?.images) return;\r\n\r\n      if (e.key === 'Escape') {\r\n        setSelectedImageIndex(null);\r\n      } else if (e.key === 'ArrowRight') {\r\n        setSelectedImageIndex((prev) =>\r\n          prev === null ? null : (prev + 1) % modelDetails.images!.length\r\n        );\r\n      } else if (e.key === 'ArrowLeft') {\r\n        setSelectedImageIndex((prev) =>\r\n          prev === null ? null : (prev - 1 + modelDetails.images!.length) % modelDetails.images!.length\r\n        );\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [selectedImageIndex, modelDetails?.images]);\r\n\r\n  if (!model) return null;\r\n\r\n  const textSubtle = theme === 'dark' ? 'text-zinc-400' : 'text-zinc-600';\r\n  const bgInput = theme === 'dark' ? 'border-zinc-800 bg-zinc-900/60' : 'border-zinc-300 bg-white';\r\n\r\n  const handleNextImage = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    if (modelDetails?.images && selectedImageIndex !== null) {\r\n      setSelectedImageIndex((selectedImageIndex + 1) % modelDetails.images.length);\r\n    }\r\n  };\r\n\r\n  const handlePrevImage = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    if (modelDetails?.images && selectedImageIndex !== null) {\r\n      setSelectedImageIndex((selectedImageIndex - 1 + modelDetails.images.length) % modelDetails.images.length);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      id=\"model-detail-panel\"\r\n      className={`\r\n        h-full flex flex-col rounded-2xl border backdrop-blur-sm\r\n        ${theme === 'dark' ? 'border-zinc-800 bg-zinc-950/95' : 'border-zinc-200 bg-white/95'} \r\n        ${!debouncedTriggerElement ? '' : 'shadow-2xl'} \r\n        ${debouncedTriggerElement && !isAnimating ? 'shadow-2xl' : ''}\r\n        ${isAnimating ? 'shadow-xl' : ''}\r\n        ${className}\r\n      `}\r\n    >\r\n      <div className=\"flex-1 overflow-y-auto p-5\">\r\n        <div className=\"flex items-start justify-between\">\r\n          <div className=\"max-w-[85%] min-w-0\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <h2 className=\"text-lg font-semibold truncate\" title={model.name}>{model.name}</h2>\r\n            </div>\r\n            <div className={`mt-1 flex items-center gap-2 text-sm ${textSubtle} flex-wrap`}>\r\n              <DomainIcon d={model.domain} />\r\n              <span>{model.domain}</span>\r\n              <span>┬À {kfmt(model.downloads || 0)} downloads</span>\r\n            </div>\r\n            {model.description && (\r\n              <p className={`mt-2 text-sm ${textSubtle} whitespace-pre-wrap`}>{model.description}</p>\r\n            )}\r\n\r\n            {/* Extended Details (CivitasBay/HF) */}\r\n            {(model.source === 'CivitasBay' || model.source === 'HuggingFace') && (\r\n              <div className=\"mt-3\">\r\n                {loadingDetails && (\r\n                  <div className=\"flex items-center gap-2 text-sm text-blue-500\">\r\n                    <Loader2 className=\"size-4 animate-spin\" />\r\n                    <span>{t('detailPanel.loadingDetails')}</span>\r\n                  </div>\r\n                )}\r\n                {modelDetails?.civitaiUrl && (\r\n                  <a\r\n                    href={modelDetails.civitaiUrl}\r\n                    onClick={(e) => handleExternalLink(e, modelDetails.civitaiUrl!)}\r\n                    className=\"mt-2 inline-flex items-center gap-1 text-sm text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300\"\r\n                  >\r\n                    {t('detailPanel.viewOnCivitAI')} <ExternalLink className=\"size-3\" />\r\n                  </a>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            {onToggleFavorite && (\r\n              <button\r\n                onClick={() => onToggleFavorite(model)}\r\n                className={`flex items-center gap-1 rounded-xl ${bgInput} px-3 py-1 text-xs whitespace-nowrap transition-all duration-150 active:scale-90 ${model.isFavorite ? 'text-amber-500 bg-amber-50 dark:bg-amber-900/30 ring-1 ring-amber-500/30' : 'hover:bg-amber-50 dark:hover:bg-amber-900/20'}`}\r\n                title={model.isFavorite ? t('common.removeFromFavorites') : t('common.addToFavorites')}\r\n              >\r\n                <Star className={`size-3 transition-transform duration-150 ${model.isFavorite ? 'fill-current scale-110' : ''}`} />\r\n                {model.isFavorite ? t('common.favorited') : t('common.favorite')}\r\n              </button>\r\n            )}\r\n            {onToggleNSFWFlag && (\r\n              <button\r\n                onClick={() => onToggleNSFWFlag(model)}\r\n                className={`flex items-center gap-1 rounded-xl ${bgInput} px-3 py-1 text-xs whitespace-nowrap transition-all duration-150 active:scale-90 ${model.isNSFWFlagged ? 'text-red-500 bg-red-50 dark:bg-red-900/30 ring-1 ring-red-500/30' : 'hover:bg-red-50 dark:hover:bg-red-900/20'}`}\r\n                title={model.isNSFWFlagged ? t('common.unflag') : t('common.flag')}\r\n              >\r\n                <Flag className={`size-3 transition-transform duration-150 ${model.isNSFWFlagged ? 'fill-current scale-110' : ''}`} />\r\n                {model.isNSFWFlagged ? t('common.flagged') : t('common.flag')}\r\n              </button>\r\n            )}\r\n            <button\r\n              onClick={() => window.dispatchEvent(new CustomEvent('edit-model', { detail: model }))}\r\n              className={`rounded-xl ${bgInput} px-3 py-1 text-xs whitespace-nowrap`}\r\n            >\r\n              {t('common.edit')}\r\n            </button>\r\n            <button\r\n              onClick={() => {\r\n                if (!model?.id) return;\r\n                window.dispatchEvent(new CustomEvent('show-confirmation', {\r\n                  detail: {\r\n                    title: t('detailPanel.deleteTitle'),\r\n                    message: t('detailPanel.deleteMessage', { name: model.name }),\r\n                    onConfirm: () => {\r\n                      onDelete(model.id);\r\n                      onClose();\r\n                    }\r\n                  }\r\n                }));\r\n              }}\r\n              className={`rounded-xl ${bgInput} px-3 py-1 text-xs whitespace-nowrap`}\r\n            >\r\n              {t('common.delete')}\r\n            </button>\r\n            <button\r\n              onClick={onClose}\r\n              className={`rounded-xl ${bgInput} px-3 py-1 text-xs whitespace-nowrap`}\r\n            >\r\n              {t('common.close')}\r\n            </button>\r\n          </div>\r\n        </div>        <section className={`mt-4 rounded-xl border p-4`}\r\n          style={{ borderColor: theme === 'dark' ? '#27272a' : '#e4e4e7' }}>\r\n          <div className=\"mb-2 flex items-center gap-2\">\r\n            <FileText className=\"size-4\" />\r\n            <strong className=\"text-sm\">{t('detailPanel.licenseIP')}</strong>\r\n          </div>\r\n          <div className=\"grid grid-cols-2 gap-3 text-sm\">\r\n            <div>\r\n              <span className={textSubtle}>{t('detailPanel.license')}</span>\r\n              <div>\r\n                <LicenseHover name={model.license.name} />\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <span className={textSubtle}>{t('detailPanel.type')}</span>\r\n              <div>{model.license.type}</div>\r\n            </div>\r\n            <div>\r\n              <span className={textSubtle}>{t('detailPanel.commercial')}</span>\r\n              <div>{model.license.commercial_use ? t('detailPanel.allowed') : t('detailPanel.notAllowed')}</div>\r\n            </div>\r\n            <div>\r\n              <span className={textSubtle}>{t('detailPanel.attribution')}</span>\r\n              <div>{model.license.attribution_required ? t('detailPanel.required') : t('detailPanel.notRequired')}</div>\r\n            </div>\r\n            <div>\r\n              <span className={textSubtle}>{t('detailPanel.copyleft')}</span>\r\n              <div>{model.license.copyleft ? t('common.yes') : t('common.no')}</div>\r\n            </div>\r\n            <div>\r\n              <span className={textSubtle}>{t('detailPanel.indemnity')}</span>\r\n              <div>{model.indemnity || t('common.none')}</div>\r\n            </div>\r\n            {model.provider && (\r\n              <div>\r\n                <span className={textSubtle}>{t('detailPanel.author')}</span>\r\n                <div>{model.provider}</div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n        </section>\r\n\r\n        {model.pricing?.length ? (\r\n          <section className={`mt-4 rounded-xl border p-4`}\r\n            style={{ borderColor: theme === 'dark' ? '#27272a' : '#e4e4e7' }}>\r\n            <div className=\"mb-2 flex items-center gap-2\">\r\n              <DollarSign className=\"size-4\" />\r\n              <strong className=\"text-sm\">{t('detailPanel.pricing.title')}</strong>\r\n            </div>\r\n            <div className=\"grid grid-cols-1 gap-3 text-sm\">\r\n              {/* Group pricing by type */}\r\n              {(() => {\r\n                const apiPricing = model.pricing?.filter(p => getPricingType(p) === 'API') || [];\r\n                const subPricing = model.pricing?.filter(p => getPricingType(p) === 'Subscription') || [];\r\n                const otherPricing = model.pricing?.filter(p => !['API', 'Subscription'].includes(getPricingType(p))) || [];\r\n\r\n                return (\r\n                  <>\r\n                    {/* API Pricing */}\r\n                    {apiPricing.length > 0 && (\r\n                      <div>\r\n                        <div className={`text-xs font-medium mb-1 ${textSubtle}`}>{t('detailPanel.pricing.apiUsage')}</div>\r\n                        {apiPricing.map((p, i) => (\r\n                          <div\r\n                            key={`api-${i}`}\r\n                            className={`flex items-center justify-between gap-2 rounded-lg border px-3 py-2 mb-1`}\r\n                            style={{\r\n                              borderColor: theme === 'dark' ? '#7c2d12' : '#fb923c',\r\n                              background: theme === 'dark' ? 'rgba(249,115,22,0.12)' : 'rgba(249,115,22,0.08)'\r\n                            }}\r\n                          >\r\n                            <div className=\"min-w-0\">\r\n                              <div className=\"truncate font-medium\">{p.model || 'API Access'}</div>\r\n                              <div className={`truncate text-xs ${textSubtle}`}>\r\n                                {(() => {\r\n                                  // Enterprise-friendly format\r\n                                  const currency = p.currency || '$';\r\n                                  if (p.flat != null) {\r\n                                    const per1K = Number(p.flat) / 1000;\r\n                                    return `~${currency}${per1K.toFixed(3)} ${t('detailPanel.pricing.per1k')}`;\r\n                                  } else if (p.input != null && p.output != null) {\r\n                                    const inputPer1K = Number(p.input) / 1000;\r\n                                    const outputPer1K = Number(p.output) / 1000;\r\n                                    const blended = (inputPer1K * 3 + outputPer1K) / 4;\r\n                                    return `~${currency}${blended.toFixed(3)} ${t('detailPanel.pricing.per1kBlended')}`;\r\n                                  }\r\n                                  return t('detailPanel.pricing.apiPricing');\r\n                                })()}{p.notes ? ` ÔÇó ${p.notes}` : ''}\r\n                              </div>\r\n                            </div>\r\n                            <div className=\"text-right text-xs opacity-60\">\r\n                              {p.flat != null\r\n                                ? `${p.currency || '$'}${p.flat}/1M`\r\n                                : (p.input != null || p.output != null)\r\n                                  ? `${p.currency || '$'}${p.input ?? '?'}/${p.output ?? '?'} per 1M`\r\n                                  : 'ÔÇö'}\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* Subscription Pricing */}\r\n                    {subPricing.length > 0 && (\r\n                      <div>\r\n                        <div className={`text-xs font-medium mb-1 ${textSubtle}`}>{t('detailPanel.pricing.subscription')}</div>\r\n                        {subPricing.map((p, i) => (\r\n                          <div\r\n                            key={`sub-${i}`}\r\n                            className={`flex items-center justify-between gap-2 rounded-lg border px-3 py-2 mb-1`}\r\n                            style={{\r\n                              borderColor: theme === 'dark' ? '#7c2d12' : '#fb923c',\r\n                              background: theme === 'dark' ? 'rgba(249,115,22,0.12)' : 'rgba(249,115,22,0.08)'\r\n                            }}\r\n                          >\r\n                            <div className=\"min-w-0\">\r\n                              <div className=\"truncate font-medium\">{p.model || 'Subscription'}</div>\r\n                              <div className={`truncate text-xs ${textSubtle}`}>\r\n                                {p.unit || t('detailPanel.pricing.monthly')}{p.notes ? ` ÔÇó ${p.notes}` : ''}\r\n                              </div>\r\n                            </div>\r\n                            <div className=\"text-right\">\r\n                              {p.flat != null ? `${p.currency || '$'}${p.flat}` : 'ÔÇö'}\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* Other Pricing */}\r\n                    {otherPricing.length > 0 && (\r\n                      <div>\r\n                        <div className={`text-xs font-medium mb-1 ${textSubtle}`}>{t('detailPanel.pricing.other')}</div>\r\n                        {otherPricing.map((p, i) => (\r\n                          <div\r\n                            key={`other-${i}`}\r\n                            className={`flex items-center justify-between gap-2 rounded-lg border px-3 py-2 mb-1`}\r\n                            style={{\r\n                              borderColor: theme === 'dark' ? '#27272a' : '#e4e4e7',\r\n                              background: theme === 'dark' ? 'rgba(24,24,27,0.4)' : 'rgba(244,244,245,0.6)'\r\n                            }}\r\n                          >\r\n                            <div className=\"min-w-0\">\r\n                              <div className=\"truncate\">{p.model || model.name}</div>\r\n                              <div className={`truncate text-xs ${textSubtle}`}>\r\n                                {getPricingType(p)} ÔÇó {p.unit || 'License'}{p.notes ? ` ÔÇó ${p.notes}` : ''}\r\n                              </div>\r\n                            </div>\r\n                            <div className=\"text-right\">\r\n                              {p.flat != null\r\n                                ? `${p.currency || '$'}${p.flat}`\r\n                                : (p.input != null || p.output != null)\r\n                                  ? `${p.currency || '$'}${p.input ?? '?'} in ÔåÆ ${p.output ?? '?'} out`\r\n                                  : 'ÔÇö'}\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                  </>\r\n                );\r\n              })()}\r\n            </div>\r\n          </section>\r\n        ) : null}\r\n\r\n        <section className={`mt-4 rounded-xl border p-4 text-sm`}\r\n          style={{ borderColor: theme === 'dark' ? '#27272a' : '#e4e4e7' }}>\r\n          <div className=\"mb-2 flex items-center gap-2\">\r\n            <Info className=\"size-4\" />\r\n            <strong className=\"text-sm\">{t('detailPanel.meta.title')}</strong>\r\n          </div>\r\n          <div className=\"grid grid-cols-2 gap-3\">\r\n            <div>\r\n              <span className={textSubtle}>{t('detailPanel.meta.updated')}</span>\r\n              <div>{fmtDate(model.updated_at)}</div>\r\n            </div>\r\n            <div>\r\n              <span className={textSubtle}>{t('detailPanel.meta.released')}</span>\r\n              <div>{fmtDate(model.release_date)}</div>\r\n            </div>\r\n            <div>\r\n              <span className={textSubtle}>{t('detailPanel.meta.parameters')}</span>\r\n              <div>{model.parameters || \"ÔÇö\"}</div>\r\n            </div>\r\n            <div>\r\n              <span className={textSubtle}>{t('detailPanel.meta.context')}</span>\r\n              <div>{model.context_window || \"ÔÇö\"}</div>\r\n            </div>\r\n          </div>\r\n\r\n          {model.benchmarks && model.benchmarks.length > 0 && (\r\n            <div className=\"mt-3\">\r\n              <div className={`text-xs font-medium mb-1 ${textSubtle}`}>{t('detailPanel.meta.benchmarks')}</div>\r\n              <div className=\"space-y-1\">\r\n                {model.benchmarks.slice(0, 6).map((b, i) => (\r\n                  <div key={i} className={`flex justify-between rounded-md px-2 py-1 border ${theme === 'dark' ? 'border-zinc-800' : 'border-zinc-200'}`}>\r\n                    <div className=\"truncate pr-2\">{b.name}</div>\r\n                    <div className=\"text-right text-xs opacity-80\">{b.score}{b.unit ? ` ${b.unit}` : ''}{b.source ? ` ÔÇó ${b.source}` : ''}</div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {model.analytics && Object.keys(model.analytics).length > 0 && (\r\n            <div className=\"mt-3\">\r\n              <div className={`text-xs font-medium mb-1 ${textSubtle}`}>Analytics</div>\r\n              <div className=\"grid grid-cols-2 gap-2\">\r\n                {Object.entries(model.analytics).slice(0, 6).map(([k, v]) => (\r\n                  <div key={k} className={`rounded-md px-2 py-1 border ${theme === 'dark' ? 'border-zinc-800' : 'border-zinc-200'}`}>\r\n                    <div className=\"text-[11px] opacity-70\">{k}</div>\r\n                    <div className=\"text-sm\">{String(v)}</div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {model.tags?.length ? (\r\n            <div className=\"mt-3 max-h-28 overflow-y-auto pr-1\">\r\n              <div className=\"flex flex-wrap gap-1.5\">\r\n                {model.tags.map(t => <Badge key={t}>{t}</Badge>)}\r\n              </div>\r\n            </div>\r\n          ) : null}\r\n\r\n          <div className=\"mt-3 flex gap-2 flex-wrap\">\r\n            {/* Show \"Use on HuggingFace\" if URL is from HuggingFace */}\r\n            {model.url && model.url.includes('huggingface.co') && (\r\n              <a\r\n                href={model.url}\r\n                onClick={(e) => handleExternalLink(e, model.url!)}\r\n                className={`inline-flex items-center gap-1 rounded-lg ${bgInput} px-3 py-1.5 text-xs cursor-pointer hover:opacity-80 transition-opacity`}\r\n              >\r\n                HuggingFace <ExternalLink className=\"size-3\" />\r\n              </a>\r\n            )}\r\n\r\n            {/* Show \"Repo\" if repo is GitHub */}\r\n            {model.repo && model.repo.includes('github.com') && (\r\n              <a\r\n                href={model.repo}\r\n                onClick={(e) => handleExternalLink(e, model.repo!)}\r\n                className={`inline-flex items-center gap-1 rounded-lg ${bgInput} px-3 py-1.5 text-xs cursor-pointer hover:opacity-80 transition-opacity`}\r\n              >\r\n                GitHub <ExternalLink className=\"size-3\" />\r\n              </a>\r\n            )}\r\n\r\n            {/* Show \"Artificial Analysis\" if URL is from artificialanalysis.ai */}\r\n            {model.url && model.url.includes('artificialanalysis.ai') && (\r\n              <a\r\n                href={model.url}\r\n                onClick={(e) => handleExternalLink(e, model.url!)}\r\n                className={`inline-flex items-center gap-1 rounded-lg ${bgInput} px-3 py-1.5 text-xs cursor-pointer hover:opacity-80 transition-opacity`}\r\n              >\r\n                Artificial Analysis <ExternalLink className=\"size-3\" />\r\n              </a>\r\n            )}\r\n\r\n            {/* Show \"Model Page\" if URL exists and is NOT HuggingFace, GitHub, or Artificial Analysis */}\r\n            {model.url && !model.url.includes('huggingface.co') && !model.url.includes('github.com') && !model.url.includes('artificialanalysis.ai') && (\r\n              <a\r\n                href={model.url}\r\n                onClick={(e) => handleExternalLink(e, model.url!)}\r\n                className={`inline-flex items-center gap-1 rounded-lg ${bgInput} px-3 py-1.5 text-xs cursor-pointer hover:opacity-80 transition-opacity`}\r\n              >\r\n                {t('detailPanel.links.modelPage')} <ExternalLink className=\"size-3\" />\r\n              </a>\r\n            )}\r\n          </div>\r\n        </section>\r\n\r\n        {/* Image Gallery */}\r\n        {modelDetails?.images && modelDetails.images.length > 0 && (\r\n          <section className={`mt-4 rounded-xl border p-4`}\r\n            style={{ borderColor: theme === 'dark' ? '#27272a' : '#e4e4e7' }}>\r\n            <div className=\"mb-2 flex items-center gap-2\">\r\n              <strong className=\"text-sm\">{t('detailPanel.gallery', 'Gallery')}</strong>\r\n              <span className={`text-xs ${textSubtle}`}>({modelDetails.images.length})</span>\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-2\">\r\n              {modelDetails.images.map((imgUrl, i) => (\r\n                <div key={i} className=\"relative aspect-square overflow-hidden rounded-lg group empty:hidden\">\r\n                  <GalleryImage\r\n                    src={imgUrl}\r\n                    alt={`Preview ${i + 1}`}\r\n                    onClick={() => setSelectedImageIndex(i)}\r\n                    onContextMenu={(e) => handleImageContextMenu(e, imgUrl)}\r\n                    isFlagged={model.flaggedImageUrls?.includes(imgUrl)}\r\n                    hideNSFW={hideNSFW}\r\n                  />\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </section>\r\n        )}\r\n      </div>\r\n\r\n      {/* Lightbox Overlay */}\r\n      {selectedImageIndex !== null && modelDetails?.images && createPortal(\r\n        <div\r\n          className=\"fixed inset-0 z-[100] flex flex-col items-center justify-center bg-black/45 backdrop-blur-md animate-in fade-in duration-200\"\r\n          onClick={() => setSelectedImageIndex(null)}\r\n        >\r\n          {/* Close Button */}\r\n          <button\r\n            className=\"absolute top-4 right-4 z-50 p-2 text-white/50 hover:text-white hover:bg-white/10 rounded-full transition-all\"\r\n            onClick={(e) => {\r\n              e.stopPropagation();\r\n              setSelectedImageIndex(null);\r\n            }}\r\n          >\r\n            <X className=\"size-8\" />\r\n          </button>\r\n\r\n          {/* Main Image View Area */}\r\n          <div className=\"relative flex-1 w-full flex items-center justify-center p-8 min-h-0 overflow-hidden\">\r\n            {/* Previous Button */}\r\n            {modelDetails.images.length > 1 && (\r\n              <button\r\n                className=\"absolute left-4 top-1/2 -translate-y-1/2 p-3 text-white/50 hover:text-white hover:bg-white/10 rounded-full transition-all z-10\"\r\n                onClick={handlePrevImage}\r\n              >\r\n                <ChevronLeft className=\"size-10\" />\r\n              </button>\r\n            )}\r\n\r\n            {/* Image/Video View */}\r\n            {(() => {\r\n              const currentSrc = modelDetails.images[selectedImageIndex];\r\n              const isVideo = currentSrc.endsWith('.mp4') || currentSrc.endsWith('.webm') || currentSrc.endsWith('.mov');\r\n\r\n              if (isVideo) {\r\n                const videoIsFlagged = model.flaggedImageUrls?.includes(currentSrc);\r\n                return (\r\n                  <div className=\"relative\">\r\n                    <video\r\n                      key={selectedImageIndex}\r\n                      src={currentSrc}\r\n                      className=\"max-h-full max-w-full rounded-lg shadow-2xl object-contain animate-in zoom-in-95 duration-200 select-none\"\r\n                      onClick={(e) => e.stopPropagation()}\r\n                      onContextMenu={(e) => handleImageContextMenu(e, currentSrc)}\r\n                      controls\r\n                      autoPlay\r\n                      loop\r\n                    />\r\n                    {videoIsFlagged && hideNSFW && (\r\n                      <div className=\"absolute inset-0 z-10 flex items-center justify-center bg-zinc-900/95 rounded-lg\">\r\n                        <EyeOff className=\"size-24 text-zinc-500\" />\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              }\r\n\r\n              const imgIsFlagged = model.flaggedImageUrls?.includes(currentSrc);\r\n              return (\r\n                <div className=\"relative\" onClick={(e) => e.stopPropagation()}>\r\n                  <img\r\n                    key={selectedImageIndex}\r\n                    src={currentSrc}\r\n                    alt={`Full preview ${selectedImageIndex + 1}`}\r\n                    className=\"max-h-full max-w-full rounded-lg shadow-2xl object-contain animate-in zoom-in-95 duration-200 select-none\"\r\n                    onContextMenu={(e) => handleImageContextMenu(e, currentSrc)}\r\n                  />\r\n                  {imgIsFlagged && hideNSFW && (\r\n                    <div className=\"absolute inset-0 flex items-center justify-center z-20 bg-zinc-900/95 rounded-lg\">\r\n                      <EyeOff className=\"size-24 text-zinc-500\" />\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              );\r\n            })()}\r\n\r\n            {/* Flagged Overlay for Lightbox */}\r\n            {(() => {\r\n              const currentSrc = modelDetails.images[selectedImageIndex];\r\n              if (hideNSFW && model.flaggedImageUrls?.includes(currentSrc)) {\r\n                return (\r\n                  <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none z-20\">\r\n                    <EyeOff className=\"size-32 text-white/80 drop-shadow-2xl\" />\r\n                  </div>\r\n                );\r\n              }\r\n              return null;\r\n            })()}\r\n\r\n            {/* Next Button */}\r\n            {modelDetails.images.length > 1 && (\r\n              <button\r\n                className=\"absolute right-4 top-1/2 -translate-y-1/2 p-3 text-white/50 hover:text-white hover:bg-white/10 rounded-full transition-all z-10\"\r\n                onClick={handleNextImage}\r\n              >\r\n                <ChevronRight className=\"size-10\" />\r\n              </button>\r\n            )}\r\n          </div>\r\n\r\n          {/* Carousel thumbnails */}\r\n          <div className=\"h-24 w-full bg-black/40 backdrop-blur-sm border-t border-white/10 flex items-center justify-center gap-2 p-4 overflow-x-auto scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent shrink-0\"\r\n            onClick={(e) => e.stopPropagation()}>\r\n            {modelDetails.images.map((img, idx) => (\r\n              <button\r\n                key={idx}\r\n                onClick={() => setSelectedImageIndex(idx)}\r\n                className={`relative h-16 w-16 min-w-[4rem] rounded-md overflow-hidden transition-all duration-200 border-2 ${selectedImageIndex === idx ? 'border-white scale-105 opacity-100 ring-2 ring-white/20' : 'border-transparent opacity-50 hover:opacity-80'\r\n                  }`}\r\n              >\r\n                {(() => {\r\n                  const isVideo = img.endsWith('.mp4') || img.endsWith('.webm') || img.endsWith('.mov');\r\n                  if (isVideo) {\r\n                    return <video src={img} className=\"w-full h-full object-cover\" muted />;\r\n                  }\r\n                  return <img src={img} alt={`Thumb ${idx}`} className=\"w-full h-full object-cover\" />;\r\n                })()}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>,\r\n        document.body\r\n      )}\r\n\r\n      {/* Context Menu */}\r\n      {contextMenu && createPortal(\r\n        <div\r\n          className=\"fixed z-[9999] min-w-[160px] overflow-hidden rounded-lg border bg-white p-1 text-sm shadow-xl dark:border-zinc-800 dark:bg-zinc-900\"\r\n          style={{ top: contextMenu.y, left: contextMenu.x }}\r\n          onClick={(e) => e.stopPropagation()}\r\n        >\r\n          <button\r\n            onClick={() => handleCopyImage(contextMenu.imageUrl)}\r\n            className=\"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left hover:bg-zinc-100 dark:hover:bg-zinc-800\"\r\n          >\r\n            <Copy className=\"size-4 opacity-70\" />\r\n            <span>\r\n              {(contextMenu.imageUrl.endsWith('.mp4') || contextMenu.imageUrl.endsWith('.webm'))\r\n                ? 'Copy Video URL'\r\n                : 'Copy Image'}\r\n            </span>\r\n          </button>\r\n          <button\r\n            onClick={() => handleSaveImage(contextMenu.imageUrl)}\r\n            className=\"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left hover:bg-zinc-100 dark:hover:bg-zinc-800\"\r\n          >\r\n            <Download className=\"size-4 opacity-70\" />\r\n            <span>\r\n              {(contextMenu.imageUrl.endsWith('.mp4') || contextMenu.imageUrl.endsWith('.webm'))\r\n                ? 'Save Video'\r\n                : 'Save Image'}\r\n            </span>\r\n          </button>\r\n          {onToggleImageNSFW && (\r\n            <>\r\n              <div className=\"my-1 h-px bg-zinc-200 dark:bg-zinc-800\" />\r\n              <button\r\n                onClick={() => {\r\n                  if (model) onToggleImageNSFW(model, contextMenu.imageUrl);\r\n                  closeContextMenu();\r\n                }}\r\n                className={`flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left hover:bg-zinc-100 dark:hover:bg-zinc-800 ${model.flaggedImageUrls?.includes(contextMenu.imageUrl) ? 'text-red-500' : ''\r\n                  }`}\r\n              >\r\n                <EyeOff className=\"size-4 opacity-70\" />\r\n                <span>{model.flaggedImageUrls?.includes(contextMenu.imageUrl) ? 'Unflag NSFW' : 'Flag as NSFW'}</span>\r\n              </button>\r\n            </>\r\n          )}\r\n        </div>,\r\n        document.body\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\DownloadDropdown.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\EmptyState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\ExportModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\FlagReasonModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\FlaggedModelsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\GlobalErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\ImportModal.tsx","messages":[{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":102,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":102,"endColumn":18,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3758,3759],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useContext, useState } from \"react\";\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Model } from \"../types\";\r\nimport { parseCSV, safeJsonFromText, parseTSV } from \"../utils/format\";\r\nimport { X, Upload, AlertTriangle, Download, FileText, Globe, Clipboard } from \"lucide-react\";\r\nimport ThemeContext from \"../context/ThemeContext\";\r\nimport * as XLSX from \"xlsx\";\r\nimport { useBodyScrollLock } from \"../hooks/useBodyScrollLock\";\r\n\r\ninterface ImportModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onImport: (models: Model[]) => void;\r\n  addConsoleLog: (msg: string) => void;\r\n}\r\n\r\nexport function ImportModal({ isOpen, onClose, onImport, addConsoleLog }: ImportModalProps) {\r\n  const { t } = useTranslation();\r\n  const { theme } = useContext(ThemeContext);\r\n\r\n  // Lock body scroll when modal is open\r\n  useBodyScrollLock(isOpen);\r\n\r\n  const [file, setFile] = useState<File | null>(null);\r\n  const [url, setUrl] = useState(\"\");\r\n  const [pasteText, setPasteText] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const [preview, setPreview] = useState<any[] | null>(null);\r\n  const [activeTab, setActiveTab] = useState<\"file\" | \"url\" | \"paste\">(\"file\");\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const parseWorkbookToRows = (wb: XLSX.WorkBook) => {\r\n    const all: any[] = [];\r\n    wb.SheetNames.forEach((sheetName) => {\r\n      const ws = wb.Sheets[sheetName];\r\n      if (!ws) return;\r\n      const rows = XLSX.utils.sheet_to_json(ws, { defval: \"\" }) as any[];\r\n      rows.forEach(r => all.push({ ...r, __sheetName: sheetName }));\r\n    });\r\n    return all;\r\n  };\r\n\r\n  // Handle file upload\r\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    if (e.target.files && e.target.files[0]) {\r\n      setFile(e.target.files[0]);\r\n      setError(\"\");\r\n\r\n      const f = e.target.files[0];\r\n      const isBinary = /\\.(xlsx|ods)$/i.test(f.name);\r\n      const reader = new FileReader();\r\n      reader.onload = (evt) => {\r\n        try {\r\n          if (!evt.target) return;\r\n          let data: any[] = [];\r\n          if (isBinary) {\r\n            const buf = evt.target.result as ArrayBuffer;\r\n            const wb = XLSX.read(buf, { type: 'array' });\r\n            data = parseWorkbookToRows(wb);\r\n          } else if (typeof evt.target.result === 'string') {\r\n            const text = evt.target.result as string;\r\n            if (f.name.endsWith('.csv')) {\r\n              data = parseCSV(text);\r\n            } else if (f.name.endsWith('.tsv')) {\r\n              data = parseTSV(text);\r\n            } else if (f.name.endsWith('.json')) {\r\n              data = JSON.parse(text);\r\n            } else {\r\n              try { data = JSON.parse(text); } catch { data = parseCSV(text); }\r\n            }\r\n          }\r\n          setPreview(Array.isArray(data) ? data : []);\r\n        } catch (err) {\r\n          setError(t('errors.parseFile', { error: (err as Error).message }));\r\n        }\r\n      };\r\n      if (isBinary) reader.readAsArrayBuffer(f); else reader.readAsText(f);\r\n    }\r\n  };\r\n\r\n  // Handle URL import\r\n  const handleUrlImport = async () => {\r\n    if (!url.trim()) {\r\n      setError(t('errors.emptyUrl'));\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setError(\"\");\r\n      let effectiveUrl = url;\r\n      // Support Google Sheets multi-tab by exporting the entire workbook as XLSX\r\n      try {\r\n        const u = new URL(url);\r\n        if (u.hostname.includes('docs.google.com') && u.pathname.includes('/spreadsheets/')) {\r\n          const idMatch = u.pathname.match(/\\/spreadsheets\\/d\\/([^/]+)/);\r\n          const sheetId = idMatch?.[1];\r\n          if (sheetId) {\r\n            effectiveUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=xlsx`;\r\n          }\r\n        }\r\n      } catch { }\r\n\r\n      if (/\\.(xlsx|ods)$/i.test(effectiveUrl) || effectiveUrl.includes('/export?format=xlsx')) {\r\n        const resp = await fetch(effectiveUrl);\r\n        const buf = await resp.arrayBuffer();\r\n        const wb = XLSX.read(buf, { type: 'array' });\r\n        const rows = parseWorkbookToRows(wb);\r\n        setPreview(rows);\r\n        return;\r\n      }\r\n\r\n      const response = await fetch(effectiveUrl);\r\n      const text = await response.text();\r\n      let data;\r\n      if (effectiveUrl.endsWith('.csv')) {\r\n        data = parseCSV(text);\r\n      } else if (effectiveUrl.endsWith('.tsv')) {\r\n        data = parseTSV(text);\r\n      } else if (effectiveUrl.endsWith('.json')) {\r\n        data = JSON.parse(text);\r\n      } else {\r\n        try { data = JSON.parse(text); } catch { data = parseCSV(text); }\r\n      }\r\n      setPreview(Array.isArray(data) ? data : []);\r\n    } catch (err) {\r\n      setError(t('errors.fetchError', { error: (err as Error).message }));\r\n    }\r\n  };\r\n\r\n  // Handle paste\r\n  const handlePasteImport = () => {\r\n    if (!pasteText.trim()) {\r\n      setError(t('errors.emptyPaste'));\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setError(\"\");\r\n      let data;\r\n\r\n      // Try JSON first\r\n      try {\r\n        data = safeJsonFromText(pasteText);\r\n      } catch (e) {\r\n        // Try CSV\r\n        data = parseCSV(pasteText);\r\n      }\r\n\r\n      setPreview(Array.isArray(data) ? data : []);\r\n    } catch (err) {\r\n      setError(t('errors.parsePaste', { error: (err as Error).message }));\r\n    }\r\n  };\r\n\r\n  // Confirm import\r\n  const handleConfirmImport = () => {\r\n    if (preview && preview.length > 0) {\r\n      addConsoleLog(`ImportModal: Imported ${preview.length} models`);\r\n      onImport(preview as Model[]);\r\n      onClose();\r\n    } else {\r\n      addConsoleLog('ImportModal: No valid data to import');\r\n      setError(t('errors.noDataToImport'));\r\n    }\r\n  };\r\n\r\n  // Styling - forced dark mode with visible borders\r\n  const bgInput = \"border border-border bg-input text-text\";\r\n  const tabStyle = theme === \"dark\"\r\n    ? \"px-4 py-2 hover:bg-zinc-800 cursor-pointer\"\r\n    : \"px-4 py-2 hover:bg-gray-100 cursor-pointer\";\r\n  const tabActiveStyle = \"border-b-2 border-violet-500 font-medium\";\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-2 sm:p-4\" onClick={onClose}>\r\n      <div className=\"w-full max-w-3xl max-h-[85vh] overflow-y-auto rounded-2xl border p-4 border-border bg-bg text-text\" onClick={(e) => e.stopPropagation()}>\r\n        <div className=\"mb-3 flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <Download size={18} />\r\n            <h3 className=\"text-base font-semibold\">{t('import.title')}</h3>\r\n          </div>\r\n          <button onClick={onClose} className={`rounded-xl ${bgInput} px-3 py-1 text-xs`}>{t('common.close')}</button>\r\n        </div>\r\n\r\n        <div className=\"space-y-4\">\r\n          <p className=\"mb-4 text-sm text-gray-600 dark:text-gray-400\">\r\n            {t('import.description')}\r\n          </p>\r\n\r\n          {/* Tab navigation */}\r\n          <div className=\"flex border-b mb-4 border-border\">\r\n            <button\r\n              className={`${tabStyle} ${activeTab === \"file\" ? tabActiveStyle : \"\"} flex items-center gap-1`}\r\n              onClick={() => setActiveTab(\"file\")}\r\n            >\r\n              <FileText size={16} />\r\n              {t('import.tabs.file')}\r\n            </button>\r\n            <button\r\n              className={`${tabStyle} ${activeTab === \"url\" ? tabActiveStyle : \"\"} flex items-center gap-1`}\r\n              onClick={() => setActiveTab(\"url\")}\r\n            >\r\n              <Globe size={16} />\r\n              {t('import.tabs.url')}\r\n            </button>\r\n            <button\r\n              className={`${tabStyle} ${activeTab === \"paste\" ? tabActiveStyle : \"\"} flex items-center gap-1`}\r\n              onClick={() => setActiveTab(\"paste\")}\r\n            >\r\n              <Clipboard size={16} />\r\n              {t('import.tabs.paste')}\r\n            </button>\r\n          </div>\r\n\r\n          {/* File Upload Tab */}\r\n          {activeTab === \"file\" && (\r\n            <div className=\"rounded-xl border p-4 border-border bg-card\">\r\n              <div className=\"flex items-center gap-2 mb-3\">\r\n                <input\r\n                  type=\"file\"\r\n                  id=\"file-upload\"\r\n                  accept=\".csv,.tsv,.json,.xlsx\"\r\n                  onChange={handleFileChange}\r\n                  className=\"hidden\"\r\n                />\r\n                <div className=\"flex-1\">\r\n                  {file ? (\r\n                    <div className={`rounded-lg ${bgInput} p-2 flex items-center justify-between`}>\r\n                      <span>{file.name}</span>\r\n                      <button onClick={() => setFile(null)} className=\"text-red-500 hover:text-red-600\">\r\n                        <X size={16} />\r\n                      </button>\r\n                    </div>\r\n                  ) : (\r\n                    <div className={`rounded-lg ${bgInput} p-4 text-center`}>\r\n                      <p className=\"mb-2\">{t('import.dropzone')}</p>\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">{t('import.supportedFormats')}</p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                <button\r\n                  className={`rounded-xl ${bgInput} px-3 py-2 flex items-center gap-1 whitespace-nowrap hover:bg-zinc-800`}\r\n                  onClick={() => document.getElementById('file-upload')?.click()}\r\n                >\r\n                  <Upload size={16} />\r\n                  {t('import.browse')}\r\n                </button>\r\n              </div>\r\n\r\n              {file && (\r\n                <button\r\n                  className={`rounded-xl ${bgInput} px-4 py-2 w-full flex items-center justify-center gap-1 hover:bg-zinc-800`}\r\n                  onClick={() => {\r\n                    if (file) {\r\n                      const reader = new FileReader();\r\n                      reader.onload = (evt) => {\r\n                        if (evt.target && typeof evt.target.result === 'string') {\r\n                          try {\r\n                            const text = evt.target.result;\r\n                            let data;\r\n\r\n                            if (file.name.endsWith('.csv')) {\r\n                              data = parseCSV(text);\r\n                            } else if (file.name.endsWith('.tsv')) {\r\n                              data = parseTSV(text);\r\n                            } else if (file.name.endsWith('.json')) {\r\n                              data = JSON.parse(text);\r\n                            } else {\r\n                              // Try to auto-detect format\r\n                              try {\r\n                                data = JSON.parse(text);\r\n                              } catch (e) {\r\n                                data = parseCSV(text);\r\n                              }\r\n                            }\r\n\r\n                            setPreview(Array.isArray(data) ? data : []);\r\n                            setError(\"\");\r\n                          } catch (err) {\r\n                            setError(\"Failed to parse file: \" + (err as Error).message);\r\n                          }\r\n                        }\r\n                      };\r\n                      reader.readAsText(file);\r\n                    }\r\n                  }}\r\n                >\r\n                  <Upload size={16} />\r\n                  {t('import.process')}\r\n                </button>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* URL Tab */}\r\n          {activeTab === \"url\" && (\r\n            <div className=\"rounded-xl border p-4 border-border bg-card\">\r\n              <div className=\"mb-2\">\r\n                <label className=\"block text-xs mb-1\">{t('import.enterUrl')}</label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={url}\r\n                  onChange={(e) => setUrl(e.target.value)}\r\n                  placeholder=\"https://example.com/models.json\"\r\n                  className={`w-full rounded-lg ${bgInput} px-2 py-1.5 text-sm`}\r\n                />\r\n              </div>\r\n              <p className=\"text-xs mb-3 text-gray-500 dark:text-gray-400\">\r\n                {t('import.supportedFormats')}\r\n              </p>\r\n              <button\r\n                className={`rounded-xl ${bgInput} px-4 py-2 w-full flex items-center justify-center gap-1 hover:bg-zinc-800 disabled:opacity-50`}\r\n                onClick={handleUrlImport}\r\n                disabled={!url.trim()}\r\n              >\r\n                <Globe size={16} />\r\n                {t('import.fetch')}\r\n              </button>\r\n            </div>\r\n          )}\r\n\r\n          {/* Paste Tab */}\r\n          {activeTab === \"paste\" && (\r\n            <div className=\"rounded-xl border p-4 border-border bg-card\">\r\n              <div className=\"mb-3\">\r\n                <label className=\"block text-xs mb-1\">{t('import.pasteData')}</label>\r\n                <textarea\r\n                  value={pasteText}\r\n                  onChange={(e) => setPasteText(e.target.value)}\r\n                  placeholder={t('import.pastePlaceholder')}\r\n                  className={`w-full rounded-lg ${bgInput} px-2 py-1.5 text-sm h-40 font-mono`}\r\n                />\r\n              </div>\r\n              <button\r\n                className={`rounded-xl ${bgInput} px-4 py-2 w-full flex items-center justify-center gap-1 hover:bg-zinc-800 disabled:opacity-50`}\r\n                onClick={handlePasteImport}\r\n                disabled={!pasteText.trim()}\r\n              >\r\n                <Clipboard size={16} />\r\n                {t('import.process')}\r\n              </button>\r\n            </div>\r\n          )}\r\n\r\n          {error && (\r\n            <div className=\"p-3 rounded-lg flex items-center gap-2\" style={{\r\n              backgroundColor: theme === \"dark\" ? \"rgba(220, 38, 38, 0.1)\" : \"#fee2e2\",\r\n              color: theme === \"dark\" ? \"#f87171\" : \"#b91c1c\"\r\n            }}>\r\n              <AlertTriangle size={18} />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {preview && (\r\n            <div className=\"rounded-xl border p-4 border-border bg-card\">\r\n              <h4 className=\"mb-3 font-medium flex items-center gap-2\">\r\n                <FileText size={18} />\r\n                {t('import.preview', { count: preview.length })}\r\n              </h4>\r\n\r\n              <div className={`max-h-40 overflow-y-auto rounded-lg ${bgInput} p-2 mb-3`}>\r\n                {preview.slice(0, 5).map((item, i) => (\r\n                  <div key={i} className=\"text-xs font-mono mb-1 overflow-hidden text-ellipsis\">\r\n                    {JSON.stringify(item)}\r\n                  </div>\r\n                ))}\r\n                {preview.length > 5 && <div className=\"text-xs text-gray-500 dark:text-gray-400\">...and {preview.length - 5} more</div>}\r\n              </div>\r\n\r\n              <div className=\"flex justify-end\">\r\n                <button\r\n                  className={`rounded-xl ${bgInput} px-4 py-2 disabled:opacity-50 flex items-center gap-1 hover:bg-zinc-800`}\r\n                  disabled={preview.length === 0}\r\n                  onClick={handleConfirmImport}\r\n                >\r\n                  <Download size={16} />\r\n                  {t('import.importButton')} {preview.length} {t('toolbar.models')}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"border-t pt-4 mt-4 flex justify-between border-border\">\r\n          <div className=\"text-sm\">\r\n            <span className=\"opacity-70\">{t('import.supportedFormats')}</span>\r\n          </div>\r\n          <button\r\n            className={`rounded-xl ${bgInput} px-4 py-2 text-sm`}\r\n            onClick={onClose}\r\n          >\r\n            {t('common.cancel')}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\KeyboardShortcutsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\LoadingScreen.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\ModalManager.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":352,"column":29,"nodeType":"MemberExpression","messageId":"limited","endLine":352,"endColumn":40,"suggestions":[{"fix":{"range":[14787,14870],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Modal Manager Component\r\n * \r\n * Manages the rendering of all global modals for the application.\r\n * Centralizes modal declarations to keep the main component clean.\r\n */\r\n\r\nimport { useModal } from '../context/ModalContext';\r\n\r\nimport React from 'react';\r\nimport { Model } from '../types';\r\nimport { Settings } from '../context/SettingsContext';\r\nimport { ModalState } from '../hooks/useModalState';\r\nimport { UIState } from '../hooks/useUIState';\r\nimport { ConsoleLogging } from '../hooks/useConsoleLogging';\r\nimport { ValidationState } from '../hooks/useValidationState';\r\nimport { ValidationSummary } from '../hooks/useModelValidation';\r\nimport { filterModels, FilterOptions } from '../utils/filterLogic';\r\nimport { exportModels } from '../services/exportService';\r\nimport { dedupe } from '../utils/format';\r\n\r\n// Modal Component Imports\r\nimport { AddModelModal } from './AddModelModal';\r\nimport { ImportModal } from './ImportModal';\r\nimport { SettingsModal } from './SettingsModal';\r\nimport { FlaggedModelsModal } from './FlaggedModelsModal';\r\nimport { TerminalConsole } from './TerminalConsole';\r\nimport { OnboardingWizard } from './OnboardingWizard';\r\nimport { ValidationProgress } from './ValidationProgress';\r\nimport { ModelEditor } from './ModelEditor';\r\nimport { SimpleValidationModal } from './SimpleValidationModal';\r\nimport { ValidationResultsModal } from './ValidationResultsModal';\r\nimport { FlagReasonModal } from './FlagReasonModal';\r\nimport { ExportModal } from './ExportModal';\r\nimport { ConfirmationToast } from './ConfirmationToast';\r\nimport { ToastContainer } from './toasts/ToastContainer';\r\nimport { UndoToast } from './toasts/UndoToast';\r\nimport { ConsoleButton } from './console/ConsoleButton';\r\nimport { KeyboardShortcutsModal } from './KeyboardShortcutsModal';\r\n\r\ninterface ModalManagerProps {\r\n    // Global State\r\n    models: Model[];\r\n    setModels: React.Dispatch<React.SetStateAction<Model[]>>;\r\n    theme: 'dark' | 'light';\r\n    settings: Settings;\r\n    saveSettings: (settings: Partial<Settings>) => void;\r\n\r\n    // Hooks state\r\n    uiState: UIState;\r\n    consoleLogging: ConsoleLogging;\r\n    validationState: ValidationState;\r\n\r\n    // Validation specifics\r\n    validationSummary: ValidationSummary | null;\r\n    setValidationSummary: (summary: ValidationSummary | null) => void;\r\n    showComponentValidationResults: boolean;\r\n    setShowComponentValidationResults: (show: boolean) => void;\r\n    showValidationModal: boolean;\r\n    closeValidationModal: () => void;\r\n    validateEntireDatabase: (options?: { batchSize?: number; pauseMs?: number; maxBatches?: number; apiConfig?: any; preferredModelProvider?: string | null; modelsOverride?: Model[] }) => Promise<{ success: boolean; updatedModels?: Model[]; error?: string; summary?: ValidationSummary }>;\r\n    validationJobs: any[]; // ValidationJob[] (need to import ValidationJob if available, otherwise leave any or use simple object)\r\n    isValidating: boolean;\r\n    stopValidation: () => void;\r\n    clearFinishedValidationJobs: () => void;\r\n    pauseValidation: () => void;\r\n    resumeValidation: () => void;\r\n    validationProgress: { current: number; total: number } | null;\r\n    setValidationToast: (toast: { completed: number; failed: number; summary?: ValidationSummary } | null) => void;\r\n\r\n    // Flagging Logic (Custom local state in main app)\r\n    flagModalOpen: boolean;\r\n    setFlagModalOpen: (open: boolean) => void;\r\n    modelToFlag: Model | null;\r\n    setModelToFlag: (model: Model | null) => void;\r\n\r\n    // Handlers\r\n    onAddModel: (model: Model) => void;\r\n    onImport: (models: Model[]) => void;\r\n    onLiveSync: (options: any) => Promise<void>;\r\n    syncAll: (showSpinner?: boolean) => Promise<void>;\r\n\r\n    // Model Editor\r\n    selectedModelForEdit: Model | null;\r\n    showModelEditor: boolean;\r\n    onCloseModelEditor: () => void;\r\n    onSaveModelEdit: (model: Model) => void;\r\n\r\n    // API State\r\n    hasApiProvider: boolean;\r\n\r\n    // Shortcuts\r\n    showShortcutsModal: boolean;\r\n    setShowShortcutsModal: (show: boolean) => void;\r\n\r\n    // Callbacks\r\n    handleViewValidationDetails: () => void;\r\n}\r\n\r\nexport function ModalManager({\r\n    models,\r\n    setModels,\r\n    theme,\r\n    settings,\r\n    saveSettings,\r\n    uiState,\r\n    consoleLogging,\r\n    validationState,\r\n    validationSummary,\r\n    showComponentValidationResults,\r\n    setShowComponentValidationResults,\r\n    showValidationModal,\r\n    closeValidationModal,\r\n    validateEntireDatabase,\r\n    validationJobs,\r\n    isValidating,\r\n    stopValidation,\r\n    clearFinishedValidationJobs,\r\n    pauseValidation,\r\n    resumeValidation,\r\n    validationProgress,\r\n    setValidationToast,\r\n    flagModalOpen,\r\n    setFlagModalOpen,\r\n    modelToFlag,\r\n    setModelToFlag,\r\n    onAddModel,\r\n    onImport,\r\n    onLiveSync,\r\n    syncAll,\r\n    selectedModelForEdit,\r\n    showModelEditor,\r\n    onCloseModelEditor,\r\n    onSaveModelEdit,\r\n    hasApiProvider,\r\n    showShortcutsModal,\r\n    setShowShortcutsModal,\r\n    handleViewValidationDetails\r\n}: ModalManagerProps) {\r\n    const modalState = useModal();\r\n\r\n    // Internal Handlers for Flagged Models\r\n    const onApproveFlagged = (model: Model) => {\r\n        setModels((prev: Model[]) => dedupe([...prev, model]));\r\n        modalState.setFlaggedModels(modalState.flaggedModels.filter((m: Model) => m.id !== model.id));\r\n    };\r\n    const onDenyFlagged = (model: Model) => {\r\n        modalState.setFlaggedModels(modalState.flaggedModels.filter((m: Model) => m.id !== model.id));\r\n    };\r\n    const onEditFlagged = (model: Model) => {\r\n        modalState.setFlaggedModels(modalState.flaggedModels.map((m: Model) => m.id === model.id ? model : m));\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <OnboardingWizard\r\n                isOpen={modalState.showOnboarding}\r\n                onClose={() => modalState.setShowOnboarding(false)}\r\n                onComplete={() => {\r\n                    modalState.setShowOnboarding(false);\r\n                    syncAll(true);\r\n                }}\r\n                initialStep={modalState.onboardingStartStep}\r\n            />\r\n\r\n            <AddModelModal\r\n                isOpen={modalState.showAddModel}\r\n                onClose={() => modalState.setShowAddModel(false)}\r\n                onAddModel={onAddModel}\r\n                domains={[\"All\", \"LLM\", \"VLM\", \"ImageGen\", \"VideoGen\", \"Audio\", \"ASR\", \"TTS\", \"3D\", \"World/Sim\", \"LoRA\", \"FineTune\", \"BackgroundRemoval\", \"Upscaler\", \"Other\"] as const}\r\n                addConsoleLog={consoleLogging.addConsoleLog}\r\n            />\r\n\r\n            <ImportModal\r\n                isOpen={modalState.showImport}\r\n                onClose={() => modalState.setShowImport(false)}\r\n                onImport={onImport}\r\n                addConsoleLog={consoleLogging.addConsoleLog}\r\n            />\r\n\r\n            <SettingsModal\r\n                isOpen={modalState.showSync}\r\n                onClose={() => modalState.setShowSync(false)}\r\n                onSync={onLiveSync}\r\n                addConsoleLog={consoleLogging.addConsoleLog}\r\n                currentModels={models}\r\n                onRestore={(restored) => {\r\n                    setModels(restored);\r\n                    consoleLogging.addConsoleLog(`Restored ${restored.length} models from snapshot`);\r\n                }}\r\n            />\r\n\r\n            <FlaggedModelsModal\r\n                flagged={modalState.flaggedModels}\r\n                isOpen={modalState.showFlaggedModal}\r\n                onApprove={onApproveFlagged}\r\n                onDeny={onDenyFlagged}\r\n                onEdit={onEditFlagged}\r\n                onClose={() => modalState.setShowFlaggedModal(false)}\r\n                addConsoleLog={consoleLogging.addConsoleLog}\r\n            />\r\n\r\n            <ModelEditor\r\n                model={selectedModelForEdit}\r\n                isOpen={showModelEditor}\r\n                onClose={onCloseModelEditor}\r\n                onSave={onSaveModelEdit}\r\n            />\r\n\r\n            <ExportModal\r\n                isOpen={modalState.showExportModal}\r\n                onClose={() => modalState.setShowExportModal(false)}\r\n                onExport={(format, scope, customCriteria) => {\r\n                    if (scope === 'custom' && customCriteria) {\r\n                        const fullCriteria: FilterOptions = {\r\n                            query: '',\r\n                            domainPick: 'All',\r\n                            sortKey: 'recent',\r\n                            sortDirection: 'asc',\r\n                            minDownloads: 0,\r\n                            pageSize: null,\r\n                            ...customCriteria\r\n                        };\r\n\r\n                        const customFiltered = filterModels(models, fullCriteria);\r\n                        exportModels({ format, models: customFiltered });\r\n                        consoleLogging.addConsoleLog(`Exported ${customFiltered.length} models (Custom Filter).`);\r\n                    } else {\r\n                        exportModels({ format, models: models });\r\n                        consoleLogging.addConsoleLog(`Exported ${models.length} models (Entire DB).`);\r\n                    }\r\n                }}\r\n                totalModels={models.length}\r\n                currentFilters={{\r\n                    domainPick: uiState.domainPick,\r\n                    favoritesOnly: uiState.favoritesOnly,\r\n                    minDownloads: uiState.minDownloads,\r\n                    licenseTypes: uiState.licenseTypes,\r\n                    commercialAllowed: uiState.commercialAllowed,\r\n                    includeTags: uiState.includeTags,\r\n                    excludeTags: uiState.excludeTags\r\n                }}\r\n                theme={theme}\r\n            />\r\n\r\n            <ValidationResultsModal\r\n                isOpen={showComponentValidationResults}\r\n                onClose={() => setShowComponentValidationResults(false)}\r\n                summary={validationSummary}\r\n            />\r\n\r\n            <SimpleValidationModal\r\n                isOpen={showValidationModal}\r\n                onClose={closeValidationModal}\r\n                onValidateAll={async (opts?: any) => {\r\n                    const result = await validateEntireDatabase({\r\n                        batchSize: opts?.batchSize ?? 50,\r\n                        pauseMs: opts?.pauseMs ?? 60000,\r\n                        maxBatches: opts?.maxBatches ?? 0,\r\n                        apiConfig: settings.apiConfig,\r\n                        preferredModelProvider: settings.preferredModelProvider,\r\n                        modelsOverride: opts?.modelsOverride\r\n                    });\r\n                    if (result.success && result.updatedModels) {\r\n                        // Merge validated models with existing, preserving user flags\r\n                        setModels(prev => {\r\n                            const validatedMap = new Map(result.updatedModels!.map((m: Model) => [m.id, m]));\r\n                            return prev.map(existing => {\r\n                                const validated = validatedMap.get(existing.id);\r\n                                if (validated) {\r\n                                    // Merge: use validated data but PRESERVE user flags from existing\r\n                                    return {\r\n                                        ...validated,\r\n                                        isFavorite: existing.isFavorite,\r\n                                        isNSFWFlagged: existing.isNSFWFlagged,\r\n                                        flaggedImageUrls: existing.flaggedImageUrls\r\n                                    } as Model;\r\n                                }\r\n                                return existing;\r\n                            });\r\n                        });\r\n                        if (result.summary) {\r\n                            setValidationToast({\r\n                                completed: result.summary.modelsUpdated,\r\n                                failed: result.summary.errors,\r\n                                summary: result.summary\r\n                            });\r\n                        }\r\n                    }\r\n                    return result;\r\n                }}\r\n                models={models}\r\n                hasApiProvider={hasApiProvider}\r\n            />\r\n\r\n            {consoleLogging.showConsole && (\r\n                <TerminalConsole\r\n                    logs={consoleLogging.consoleLogs}\r\n                    onClose={() => consoleLogging.setShowConsole(false)}\r\n                    onClear={consoleLogging.clearConsoleLogs}\r\n                />\r\n            )}\r\n\r\n            <ToastContainer\r\n                importToast={modalState.importToast}\r\n                onDismissImport={() => modalState.setImportToast(null)}\r\n                validationToast={validationState.validationToast}\r\n                onDismissValidation={() => setValidationToast(null)}\r\n                onViewDetailsValidation={handleViewValidationDetails}\r\n                theme={theme}\r\n            />\r\n\r\n            <UndoToast\r\n                data={modalState.undoToast}\r\n                onClose={() => modalState.setUndoToast(null)}\r\n            />\r\n\r\n            <ConfirmationToast\r\n                isOpen={!!modalState.confirmationToast}\r\n                title={modalState.confirmationToast?.title || ''}\r\n                message={modalState.confirmationToast?.message}\r\n                type={modalState.confirmationToast?.type}\r\n                confirmText={modalState.confirmationToast?.confirmText}\r\n                cancelText={modalState.confirmationToast?.cancelText}\r\n                onConfirm={() => {\r\n                    modalState.confirmationToast?.onConfirm();\r\n                    modalState.setConfirmationToast(null);\r\n                }}\r\n                onCancel={() => {\r\n                    if (modalState.confirmationToast?.onCancel) {\r\n                        modalState.confirmationToast.onCancel();\r\n                    } else {\r\n                        modalState.setConfirmationToast(null);\r\n                    }\r\n                }}\r\n            />\r\n\r\n            <FlagReasonModal\r\n                isOpen={flagModalOpen}\r\n                onClose={() => {\r\n                    setFlagModalOpen(false);\r\n                    setModelToFlag(null);\r\n                }}\r\n                modelName={modelToFlag?.name || ''}\r\n                onConfirm={(reason) => {\r\n                    if (modelToFlag) {\r\n                        setModels(prev => prev.map(m => m.id === modelToFlag.id ? { ...m, isNSFWFlagged: true } : m));\r\n                        consoleLogging.addConsoleLog(`Flagged model: ${modelToFlag.name}. Reason: ${reason}`);\r\n\r\n                        if (reason.trim()) {\r\n                            const keyword = reason.trim().toLowerCase();\r\n                            console.log(`[User Feedback] NSFW Flag Reason for ${modelToFlag.name}: ${reason}`);\r\n\r\n                            // Add to custom blocklist in settings\r\n                            const currentKeywords = settings.customNSFWKeywords || [];\r\n                            if (!currentKeywords.includes(keyword)) {\r\n                                // Save to settings\r\n                                saveSettings({\r\n                                    customNSFWKeywords: [...currentKeywords, keyword]\r\n                                });\r\n                                consoleLogging.addConsoleLog(`Added \"${keyword}\" to custom blocklist`);\r\n                            }\r\n                        }\r\n                    }\r\n                    setFlagModalOpen(false);\r\n                    setModelToFlag(null);\r\n                }}\r\n            />\r\n\r\n            {(isValidating || validationJobs.length > 0) && (\r\n                <ValidationProgress\r\n                    jobs={validationJobs}\r\n                    onClear={clearFinishedValidationJobs}\r\n                    onPause={pauseValidation}\r\n                    onResume={resumeValidation}\r\n                    onCancelAll={stopValidation}\r\n                    isPaused={validationState.validationPaused}\r\n                />\r\n            )}\r\n\r\n            {validationProgress && (\r\n                <div className={`fixed bottom-6 left-1/2 -translate-x-1/2 z-40 rounded-lg border px-3 py-2 shadow-lg ${theme === 'dark' ? 'border-zinc-800 bg-black text-zinc-100' : 'border-zinc-200 bg-white text-zinc-900'}`}>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <div className=\"w-48 h-1.5 bg-zinc-800 rounded-full overflow-hidden\">\r\n                            <div className=\"h-full bg-violet-500 transition-all\" style={{ width: `${(validationProgress.current / validationProgress.total) * 100}%` }} />\r\n                        </div>\r\n                        <span className=\"text-[11px] opacity-70 whitespace-nowrap\">{validationProgress.current}/{validationProgress.total}</span>\r\n                    </div>\r\n                    <div className=\"mt-2 flex items-center justify-end gap-1\">\r\n                        <button\r\n                            className={`text-[10px] px-2 py-0.5 rounded transition-colors ${theme === 'dark' ? 'bg-zinc-800 text-zinc-200 hover:bg-zinc-700' : 'bg-zinc-100 text-zinc-800 hover:bg-zinc-200'}`}\r\n                            onClick={() => window.dispatchEvent(new CustomEvent('open-validation-progress'))}\r\n                            title=\"Show validation details\"\r\n                        >\r\n                            Details\r\n                        </button>\r\n                        <button\r\n                            className={`text-[10px] px-2 py-0.5 rounded transition-colors ${theme === 'dark' ? 'bg-red-600 text-white hover:bg-red-700' : 'bg-red-600 text-white hover:bg-red-700'}`}\r\n                            onClick={stopValidation}\r\n                            title=\"Cancel all validation jobs\"\r\n                        >\r\n                            Cancel\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <KeyboardShortcutsModal\r\n                isOpen={showShortcutsModal}\r\n                onClose={() => setShowShortcutsModal(false)}\r\n            />\r\n\r\n            <ConsoleButton\r\n                showConsole={consoleLogging.showConsole}\r\n                onShowConsole={() => consoleLogging.setShowConsole(true)}\r\n                theme={theme}\r\n            />\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\ModelEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\ModelRow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\OnboardingWizard.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkOllamaStatus'. Either include it or remove the dependency array.","line":97,"column":8,"nodeType":"ArrayExpression","endLine":97,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [step, isOpen, checkOllamaStatus]","fix":{"range":[3828,3842],"text":"[step, isOpen, checkOllamaStatus]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useContext, useEffect, useMemo } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Database, Key, CheckCircle, ArrowRight, ArrowLeft, X, Cpu, RefreshCw, AlertCircle } from 'lucide-react';\r\nimport ThemeContext from '../context/ThemeContext';\r\nimport { useSettings } from '../context/SettingsContext';\r\nimport { useBodyScrollLock } from '../hooks/useBodyScrollLock';\r\nimport { ThemedSelect } from './ThemedSelect';\r\nimport { handleExternalLink } from '../utils/external-links';\r\n\r\ninterface OnboardingWizardProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onComplete: () => void;\r\n    initialStep?: number;\r\n}\r\n\r\nexport function OnboardingWizard({ isOpen, onClose, onComplete, initialStep = 1 }: OnboardingWizardProps) {\r\n    const { theme } = useContext(ThemeContext);\r\n    const { t } = useTranslation();\r\n    const { settings, saveSettings } = useSettings();\r\n    const [step, setStep] = useState(initialStep);\r\n\r\n    // Reset step when modal re-opens with a new initialStep\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            setStep(initialStep);\r\n        }\r\n    }, [isOpen, initialStep]);\r\n\r\n    const [selectedSources, setSelectedSources] = useState<Record<string, boolean>>({\r\n        huggingface: true,\r\n        github: true,\r\n        artificialanalysis: true,\r\n        civitai: true,\r\n        openmodeldb: true,\r\n        civitasbay: true,\r\n        llmDiscovery: true,\r\n        ollamaLibrary: true,\r\n    });\r\n\r\n    // ... (rest of state initialization)\r\n    const [apiKeys, setApiKeys] = useState({\r\n        artificialAnalysisApiKey: settings?.artificialAnalysisApiKey || '',\r\n        gitHubToken: settings?.gitHubToken || '',\r\n    });\r\n    const [llmApiKeys, setLlmApiKeys] = useState<Record<string, string>>(() => {\r\n        const initialKeys: Record<string, string> = {};\r\n        if (settings?.apiConfig) {\r\n            Object.entries(settings.apiConfig).forEach(([key, cfg]: [string, any]) => {\r\n                if (cfg && cfg.apiKey) {\r\n                    initialKeys[key] = cfg.apiKey;\r\n                }\r\n            });\r\n        }\r\n        return initialKeys;\r\n    });\r\n    const [availableLLMProviders, setAvailableLLMProviders] = useState<Array<{ key: string; name: string; model: string }>>([]);\r\n    const [selectedLLMProvider, setSelectedLLMProvider] = useState<string>('');\r\n\r\n    // Ollama State for Wizard\r\n    const [ollamaStatus, setOllamaStatus] = useState<'unknown' | 'checking' | 'running' | 'down'>('unknown');\r\n    const [ollamaModelCount, setOllamaModelCount] = useState<number>(0);\r\n    const [ollamaModels, setOllamaModels] = useState<any[]>([]);\r\n    const [selectedOllamaModel, setSelectedOllamaModel] = useState<string>('');\r\n    const [enableOllama, setEnableOllama] = useState(true);\r\n\r\n    const checkOllamaStatus = async () => {\r\n        setOllamaStatus('checking');\r\n        try {\r\n            const result = await window.electronAPI?.proxyRequest?.({\r\n                url: 'http://127.0.0.1:11434/api/tags',\r\n                method: 'GET'\r\n            });\r\n\r\n            if (result?.success) {\r\n                setOllamaStatus('running');\r\n                const models = result.data.models || [];\r\n                setOllamaModelCount(models.length);\r\n                setOllamaModels(models);\r\n                if (models.length > 0 && !selectedOllamaModel) {\r\n                    setSelectedOllamaModel(models[0].name);\r\n                }\r\n            } else {\r\n                setOllamaStatus('down');\r\n            }\r\n        } catch (e) {\r\n            console.error('Ollama check failed:', e);\r\n            setOllamaStatus('down');\r\n        }\r\n    };\r\n\r\n    // Auto-check Ollama when reaching the step\r\n    useEffect(() => {\r\n        if (step === 2 && isOpen) {\r\n            checkOllamaStatus();\r\n        }\r\n    }, [step, isOpen]);\r\n\r\n    useBodyScrollLock(isOpen);\r\n\r\n    const steps = useMemo(() => [\r\n        { num: 1, label: t('onboarding.steps.sources') },\r\n        { num: 2, label: t('onboarding.steps.localAI') },\r\n        { num: 3, label: t('onboarding.steps.apiKeys') },\r\n        { num: 4, label: t('onboarding.steps.discovery') },\r\n        { num: 5, label: t('onboarding.steps.done') }\r\n    ], [t]);\r\n\r\n    const bgModal = 'border-border bg-bg text-text';\r\n    const bgCard = 'border-border bg-card text-text';\r\n    const bgInput = 'border-border bg-input text-text';\r\n\r\n    const dataSources = useMemo(() => [\r\n        { key: 'huggingface', label: 'HuggingFace', description: t('onboarding.sourceDescs.huggingface'), requiresKey: false },\r\n        { key: 'github', label: 'GitHub', description: t('onboarding.sourceDescs.github'), requiresKey: true, keyUrl: 'https://github.com/settings/tokens' },\r\n        { key: 'artificialanalysis', label: 'Artificial Analysis', description: t('onboarding.sourceDescs.artificialanalysis'), requiresKey: true, keyUrl: 'https://artificialanalysis.ai/documentation' },\r\n        { key: 'civitai', label: 'Civitai', description: t('onboarding.sourceDescs.civitai'), requiresKey: false },\r\n        { key: 'openmodeldb', label: 'OpenModelDB', description: t('onboarding.sourceDescs.openmodeldb'), requiresKey: false },\r\n        { key: 'civitasbay', label: 'CivitasBay', description: t('onboarding.sourceDescs.civitasbay'), requiresKey: false },\r\n        { key: 'ollamaLibrary', label: 'Ollama Library', description: t('onboarding.sourceDescs.ollamaLibrary'), requiresKey: false },\r\n    ], [t]);\r\n\r\n    // Don't render if not open\r\n    if (!isOpen) return null;\r\n\r\n    const sourcesRequiringKeys = dataSources.filter(s => s.requiresKey && selectedSources[s.key]);\r\n\r\n    const handleComplete = () => {\r\n        try {\r\n            // Build updated apiConfig\r\n            const updatedApiConfig = {\r\n                ...settings.apiConfig,\r\n                ollama: {\r\n                    ...settings.apiConfig?.ollama,\r\n                    enabled: enableOllama,\r\n                    isLocal: true,\r\n                    baseUrl: 'http://127.0.0.1:11434',\r\n                    model: selectedOllamaModel,\r\n                    protocol: 'ollama' as const,\r\n                    name: 'Ollama (Local)'\r\n                }\r\n            };\r\n\r\n            Object.entries(llmApiKeys).forEach(([provider, apiKey]) => {\r\n                if (apiKey) {\r\n                    const existing = updatedApiConfig[provider as keyof typeof updatedApiConfig] || {};\r\n                    (updatedApiConfig as any)[provider] = {\r\n                        ...existing,\r\n                        apiKey,\r\n                        enabled: true,\r\n                    };\r\n                }\r\n            });\r\n\r\n            // Save selected data sources and API keys with VERSION UPGRADE\r\n            saveSettings({\r\n                dataSources: selectedSources as any,\r\n                artificialAnalysisApiKey: apiKeys.artificialAnalysisApiKey,\r\n                gitHubToken: apiKeys.gitHubToken,\r\n                apiConfig: updatedApiConfig,\r\n                configVersion: 2 // Mark as updated to latest version\r\n            });\r\n        } catch (err) {\r\n            console.error(\"Error completing onboarding:\", err);\r\n        } finally {\r\n            onComplete();\r\n        }\r\n    };\r\n\r\n    const toggleSource = (key: string) => {\r\n        setSelectedSources(prev => ({ ...prev, [key]: !prev[key] }));\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4\" onClick={onClose}>\r\n            <div className={`w-full max-w-3xl max-h-[90vh] overflow-hidden rounded-2xl border ${bgModal} shadow-2xl`} onClick={(e) => e.stopPropagation()}>\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between p-6 border-b border-border\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <Database size={24} className=\"text-accent\" />\r\n                        <div>\r\n                            <h2 className=\"text-xl font-semibold\">{t('onboarding.welcome')}</h2>\r\n                            <p className=\"text-sm text-zinc-500\">{t('onboarding.subtitle')}</p>\r\n                        </div>\r\n                    </div>\r\n                    <button onClick={onClose} className=\"rounded-lg p-2 hover:bg-zinc-800 transition-colors\">\r\n                        <X size={18} />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Progress Indicator */}\r\n                <div className=\"px-6 pt-4\">\r\n                    <div className=\"flex items-center justify-center\">\r\n                        {steps.map((s, idx) => (\r\n                            <React.Fragment key={s.num}>\r\n                                <div className=\"flex flex-col items-center\">\r\n                                    <div className={`flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium transition-colors ${step >= s.num ? 'bg-accent text-white' : 'bg-zinc-800 text-zinc-500'}`}>\r\n                                        {s.num}\r\n                                    </div>\r\n                                    <span className=\"text-xs text-zinc-500 mt-2\">{s.label}</span>\r\n                                </div>\r\n                                {idx < steps.length - 1 && (\r\n                                    <div className={`h-1 w-8 mx-2 ${step > s.num ? 'bg-accent' : 'bg-zinc-800'}`} />\r\n                                )}\r\n                            </React.Fragment>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"p-6 overflow-y-auto max-h-[calc(90vh-240px)]\">\r\n                    {/* Step 1: Sources */}\r\n                    {step === 1 && (\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <h3 className=\"text-lg font-semibold mb-2\">{t('onboarding.sourcesTitle')}</h3>\r\n                                <p className=\"text-sm text-zinc-500 mb-4\">{t('onboarding.sourcesDesc')}</p>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n                                {dataSources.map((source) => {\r\n                                    const isSelected = selectedSources[source.key];\r\n                                    return (\r\n                                        <button\r\n                                            key={source.key}\r\n                                            onClick={() => toggleSource(source.key)}\r\n                                            className={`p-4 rounded-lg border-2 text-left transition-all duration-200 ${isSelected ? 'border-accent bg-accent/10' : 'border-zinc-700 hover:border-zinc-500 bg-zinc-900/50'}`}\r\n                                        >\r\n                                            <div className=\"flex items-start justify-between\">\r\n                                                <div className=\"flex-1 min-w-0\">\r\n                                                    <div className={`font-semibold text-sm flex items-center gap-2 ${isSelected ? 'text-white' : 'text-zinc-200'}`}>\r\n                                                        {source.label}\r\n                                                    </div>\r\n                                                    <div className={`text-xs mt-1 ${isSelected ? 'text-zinc-300' : 'text-zinc-500'}`}>{source.description}</div>\r\n                                                </div>\r\n                                                {isSelected && <CheckCircle size={16} className=\"text-accent\" />}\r\n                                            </div>\r\n                                        </button>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Step 2: Local AI (Ollama) */}\r\n                    {step === 2 && (\r\n                        <div className=\"space-y-6\">\r\n                            <div>\r\n                                <h3 className=\"text-lg font-semibold mb-2 flex items-center gap-2\">\r\n                                    <Cpu size={20} className=\"text-amber-500\" />\r\n                                    {t('onboarding.localAITitle')}\r\n                                </h3>\r\n                                <div className=\"text-sm text-zinc-500 space-y-2\">\r\n                                    <p>\r\n                                        {t('onboarding.localAIDesc')}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className={`rounded-xl border p-4 ${bgCard}`}>\r\n                                <div className=\"flex items-center justify-between mb-4\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"relative flex items-center justify-center\">\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                checked={enableOllama}\r\n                                                onChange={(e) => setEnableOllama(e.target.checked)}\r\n                                                className=\"sr-only\"\r\n                                            />\r\n                                            <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${enableOllama ? 'bg-accent border-accent' : 'border-zinc-600'}`}>\r\n                                                {enableOllama && <CheckCircle size={14} className=\"text-white\" />}\r\n                                            </div>\r\n                                        </div>\r\n                                        <div>\r\n                                            <h4 className=\"font-medium text-lg\">{t('onboarding.enableOllama')}</h4>\r\n                                            <p className=\"text-xs text-zinc-500\">Connect to local Ollama instance (127.0.0.1:11434)</p>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {enableOllama && (\r\n                                    <div className=\"bg-zinc-900/50 rounded-lg p-4 border border-zinc-800 ml-9\">\r\n                                        <div className=\"flex items-center justify-between mb-3\">\r\n                                            <span className=\"text-sm font-medium text-zinc-300\">{t('onboarding.ollamaStatus')}</span>\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                {ollamaStatus === 'checking' && <span className=\"text-xs text-yellow-500 animate-pulse\">{t('onboarding.ollamaChecking')}</span>}\r\n                                                {ollamaStatus === 'running' && <span className=\"flex items-center gap-1 text-xs text-green-400\"><CheckCircle size={12} /> {t('onboarding.ollamaRunning')}</span>}\r\n                                                {ollamaStatus === 'down' && <span className=\"flex items-center gap-1 text-xs text-red-400\"><AlertCircle size={12} /> {t('onboarding.ollamaDown')}</span>}\r\n                                                <button onClick={checkOllamaStatus} className=\"p-1 hover:bg-zinc-700 rounded text-zinc-400\">\r\n                                                    <RefreshCw size={14} className={ollamaStatus === 'checking' ? 'animate-spin' : ''} />\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {ollamaStatus === 'running' && ollamaModelCount > 0 && (\r\n                                            <div className=\"mb-4\">\r\n                                                <label className=\"block text-xs font-medium text-zinc-400 mb-1\">Select Model for Validation</label>\r\n                                                <select\r\n                                                    value={selectedOllamaModel}\r\n                                                    onChange={(e) => setSelectedOllamaModel(e.target.value)}\r\n                                                    className=\"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-200 focus:outline-none focus:border-accent\"\r\n                                                >\r\n                                                    {ollamaModels.map((m: any) => (\r\n                                                        <option key={m.name} value={m.name}>\r\n                                                            {m.name} ({m.details?.parameter_size || 'Unknown'})\r\n                                                        </option>\r\n                                                    ))}\r\n                                                </select>\r\n                                                <p className=\"text-[10px] text-zinc-500 mt-1\">\r\n                                                    This model will be used for local translation and metadata validation.\r\n                                                </p>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {ollamaStatus === 'down' && (\r\n                                            <div className=\"text-sm text-zinc-400 mb-2 p-3 bg-red-900/10 border border-red-900/30 rounded\">\r\n                                                <p className=\"mb-2 font-medium text-red-400\">Ollama is not running or installed.</p>\r\n                                                <div className=\"flex gap-2\">\r\n                                                    <button\r\n                                                        onClick={() => window.electronAPI?.openExternal('https://ollama.com/download')}\r\n                                                        className=\"text-xs bg-white text-black font-semibold px-4 py-2 rounded hover:bg-gray-200 transition-colors\"\r\n                                                    >\r\n                                                        Download Installer\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={checkOllamaStatus}\r\n                                                        className=\"text-xs bg-zinc-800 text-white px-4 py-2 rounded hover:bg-zinc-700 transition-colors\"\r\n                                                    >\r\n                                                        Run & Check Again\r\n                                                    </button>\r\n                                                </div>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {ollamaStatus === 'running' && ollamaModelCount === 0 && (\r\n                                            <div className=\"text-sm mb-2 p-3 bg-yellow-900/10 border border-yellow-900/30 rounded text-yellow-200\">\r\n                                                <p className=\"mb-2 font-medium\">Service running, but no models found.</p>\r\n                                                <div className=\"bg-black/50 p-2 rounded border border-yellow-900/30 font-mono text-xs select-all text-zinc-300 mb-2\">\r\n                                                    ollama pull llama3\r\n                                                </div>\r\n                                                <p className=\"text-xs opacity-70\">Run this in your terminal to get the recommended model.</p>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {ollamaStatus === 'running' && ollamaModelCount > 0 && (\r\n                                            <div className=\"p-3 bg-green-900/10 border border-green-900/30 rounded\">\r\n                                                <div className=\"text-sm text-green-400 font-medium flex items-center gap-2\">\r\n                                                    <CheckCircle size={16} />\r\n                                                    {t('onboarding.ollamaReady')}\r\n                                                </div>\r\n                                                <p className=\"text-xs text-green-500/70 mt-1\">{t('onboarding.ollamaFoundModels', { count: ollamaModelCount })}</p>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Step 3: API Keys (Optional) */}\r\n                    {step === 3 && (\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <h3 className=\"text-lg font-semibold mb-2\">{t('onboarding.apiKeysTitle')}</h3>\r\n                                <p className=\"text-sm text-zinc-500 mb-4\">\r\n                                    {sourcesRequiringKeys.length > 0\r\n                                        ? t('onboarding.apiKeysDesc')\r\n                                        : t('onboarding.apiKeys.noneNeeded')}\r\n                                </p>\r\n                            </div>\r\n\r\n                            {sourcesRequiringKeys.length > 0 ? (\r\n                                <div className=\"space-y-4\">\r\n                                    {sourcesRequiringKeys.map((source) => (\r\n                                        <div key={source.key} className={`rounded-xl border p-4 ${bgCard}`}>\r\n                                            <div className=\"flex items-start gap-3 mb-3\">\r\n                                                <Key size={20} className=\"text-accent mt-0.5\" />\r\n                                                <div className=\"flex-1\">\r\n                                                    <h4 className=\"font-medium\">{source.label}</h4>\r\n                                                    <p className=\"text-sm text-zinc-500 mt-1\">\r\n                                                        {source.description}\r\n                                                    </p>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            {source.key === 'github' && (\r\n                                                <>\r\n                                                    <input\r\n                                                        type=\"password\"\r\n                                                        value={apiKeys.gitHubToken}\r\n                                                        onChange={(e) => setApiKeys({ ...apiKeys, gitHubToken: e.target.value })}\r\n                                                        placeholder=\"ghp_...\"\r\n                                                        className={`w-full rounded-lg border ${bgInput} px-3 py-2 text-sm font-mono mb-2`}\r\n                                                    />\r\n                                                    <p className=\"text-xs text-zinc-500\">\r\n                                                        {t('onboarding.apiKeys.githubHint')}{' '}\r\n                                                        <a\r\n                                                            href={source.keyUrl}\r\n                                                            onClick={(e) => handleExternalLink(e, source.keyUrl!)}\r\n                                                            className=\"text-accent hover:underline cursor-pointer\"\r\n                                                        >\r\n                                                            {t('onboarding.apiKeys.getToken')}\r\n                                                        </a>\r\n                                                    </p>\r\n                                                </>\r\n                                            )}\r\n\r\n                                            {source.key === 'artificialanalysis' && (\r\n                                                <>\r\n                                                    <input\r\n                                                        type=\"password\"\r\n                                                        value={apiKeys.artificialAnalysisApiKey}\r\n                                                        onChange={(e) => setApiKeys({ ...apiKeys, artificialAnalysisApiKey: e.target.value })}\r\n                                                        placeholder=\"aa_...\"\r\n                                                        className={`w-full rounded-lg border ${bgInput} px-3 py-2 text-sm font-mono mb-2`}\r\n                                                    />\r\n                                                    <p className=\"text-xs text-zinc-500\">\r\n                                                        {t('onboarding.apiKeys.aaHint')}{' '}\r\n                                                        <a\r\n                                                            href={source.keyUrl}\r\n                                                            onClick={(e) => handleExternalLink(e, source.keyUrl!)}\r\n                                                            className=\"text-accent hover:underline cursor-pointer\"\r\n                                                        >\r\n                                                            {t('onboarding.apiKeys.getFreeKey')}\r\n                                                        </a>\r\n                                                    </p>\r\n                                                </>\r\n                                            )}\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            ) : (\r\n                                <div className={`rounded-xl border p-6 ${bgCard} text-center`}>\r\n                                    <CheckCircle size={48} className=\"text-green-500 mx-auto mb-3\" />\r\n                                    <p className=\"text-sm text-zinc-500\">\r\n                                        {t('onboarding.apiKeys.allReady')}\r\n                                    </p>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Step 4: AI Validation - LLM API Keys */}\r\n                    {step === 4 && (\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <h3 className=\"text-lg font-semibold mb-2 flex items-center gap-2\">\r\n                                    {t('onboarding.discovery.title')}\r\n                                    <span className=\"px-2 py-0.5 text-[10px] font-bold bg-amber-500/20 text-amber-400 rounded-full uppercase\">{t('onboarding.discovery.alpha')}</span>\r\n                                </h3>\r\n                                <p className=\"text-sm text-zinc-500 mb-4\">\r\n                                    {t('onboarding.discovery.desc')}\r\n                                </p>\r\n\r\n                                <div className={`p-4 rounded-lg border border-zinc-700 bg-zinc-900/30 mb-4`}>\r\n                                    <label className=\"flex items-start gap-3 cursor-pointer\">\r\n                                        <div className=\"relative flex items-center mt-0.5\">\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                checked={selectedSources.llmDiscovery}\r\n                                                onChange={() => toggleSource('llmDiscovery')}\r\n                                                className=\"sr-only\"\r\n                                            />\r\n                                            <div className={`w-5 h-5 rounded border flex items-center justify-center transition-colors ${selectedSources.llmDiscovery\r\n                                                ? 'bg-accent border-accent'\r\n                                                : 'border-zinc-600 bg-zinc-800'\r\n                                                }`}>\r\n                                                {selectedSources.llmDiscovery && <CheckCircle size={12} className=\"text-white\" />}\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"flex-1\">\r\n                                            <div className={`text-sm font-medium ${selectedSources.llmDiscovery ? 'text-white' : 'text-zinc-300'}`}>\r\n                                                {t('onboarding.discovery.enableDiscovery')}\r\n                                            </div>\r\n                                            <div className=\"text-xs text-zinc-500 mt-0.5\">\r\n                                                {t('onboarding.discovery.enableDiscoveryDesc')}\r\n                                            </div>\r\n                                        </div>\r\n                                    </label>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n                                {[\r\n                                    { key: 'anthropic', name: 'Anthropic', placeholder: 'sk-ant-...', model: 'Claude' },\r\n                                    { key: 'openai', name: 'OpenAI', placeholder: 'sk-...', model: 'GPT-4' },\r\n                                    { key: 'google', name: 'Google', placeholder: 'AIza...', model: 'Gemini' },\r\n                                    { key: 'deepseek', name: 'DeepSeek', placeholder: 'sk-...', model: 'DeepSeek' },\r\n                                ].map((provider) => {\r\n                                    const hasKey = !!(llmApiKeys[provider.key] || settings.apiConfig?.[provider.key as keyof typeof settings.apiConfig]?.apiKey);\r\n                                    return (\r\n                                        <div\r\n                                            key={provider.key}\r\n                                            className={`p-4 rounded-lg border-2 transition-all duration-200 ${hasKey\r\n                                                ? 'border-accent bg-accent/10'\r\n                                                : 'border-zinc-700 bg-zinc-900/50'\r\n                                                }`}\r\n                                        >\r\n                                            <div className=\"flex items-center justify-between mb-2\">\r\n                                                <div className={`font-semibold text-sm ${hasKey ? 'text-white' : 'text-zinc-200'}`}>\r\n                                                    {provider.name}\r\n                                                </div>\r\n                                                {hasKey && (\r\n                                                    <CheckCircle size={16} className=\"text-green-500\" />\r\n                                                )}\r\n                                            </div>\r\n                                            <div className={`text-xs mb-2 ${hasKey ? 'text-zinc-300' : 'text-zinc-500'}`}>\r\n                                                {provider.model}\r\n                                            </div>\r\n                                            <input\r\n                                                type=\"password\"\r\n                                                value={llmApiKeys[provider.key] || ''}\r\n                                                onChange={(e) => setLlmApiKeys(prev => ({ ...prev, [provider.key]: e.target.value }))}\r\n                                                placeholder={provider.placeholder}\r\n                                                className={`w-full rounded border ${bgInput} px-2 py-1.5 text-xs font-mono`}\r\n                                            />\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n\r\n                            <p className=\"text-xs text-zinc-600 text-center mt-4\">\r\n                                {t('onboarding.discovery.skip')}\r\n                            </p>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Step 5: Complete */}\r\n                    {step === 5 && (\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"text-center py-8\">\r\n                                <CheckCircle size={64} className=\"text-green-500 mx-auto mb-4\" />\r\n                                <h3 className=\"text-xl font-semibold mb-2\">{t('onboarding.completionTitle')}</h3>\r\n                                <p className=\"text-sm text-zinc-500 mb-6\">\r\n                                    {t('onboarding.completionDesc')}\r\n                                </p>\r\n\r\n                                <div className={`rounded-xl border p-4 ${bgCard} text-left max-w-md mx-auto`}>\r\n                                    <h4 className=\"font-medium mb-2\">{t('onboarding.selectedSources')}</h4>\r\n                                    <ul className=\"text-sm text-zinc-500 space-y-1\">\r\n                                        {Object.entries(selectedSources)\r\n                                            .filter(([key, enabled]) => enabled && key !== 'llmDiscovery') // Exclude LLM toggle from sources list\r\n                                            .map(([key]) => {\r\n                                                const source = dataSources.find(s => s.key === key);\r\n                                                if (!source) return null; // Skip if no matching source definition\r\n                                                return (\r\n                                                    <li key={key} className=\"flex items-center gap-2\">\r\n                                                        <CheckCircle size={14} className=\"text-green-500\" />\r\n                                                        {source.label} <span className=\"text-xs opacity-70\">({t('onboarding.status.readyToSync')})</span>\r\n                                                    </li>\r\n                                                );\r\n                                            })}\r\n                                    </ul>\r\n                                    {enableOllama && (\r\n                                        <>\r\n                                            <h4 className=\"font-medium mb-2 mt-4\">{t('onboarding.localAIStatus')}</h4>\r\n                                            <div className=\"text-sm text-zinc-500 flex items-center gap-2\">\r\n                                                {ollamaStatus === 'running' ? (\r\n                                                    <CheckCircle size={14} className=\"text-green-500\" />\r\n                                                ) : (\r\n                                                    <AlertCircle size={14} className=\"text-amber-500\" />\r\n                                                )}\r\n                                                Ollama ({ollamaStatus === 'running' ? t('onboarding.status.connected') : t('onboarding.status.notConnected')})\r\n                                            </div>\r\n                                        </>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div className=\"flex items-center justify-between p-6 border-t border-border\">\r\n                    <button\r\n                        onClick={() => setStep(Math.max(1, step - 1))}\r\n                        disabled={step === 1}\r\n                        className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${step === 1\r\n                            ? 'opacity-40 cursor-not-allowed'\r\n                            : 'hover:bg-zinc-800'\r\n                            }`}\r\n                    >\r\n                        <ArrowLeft size={16} />\r\n                        {t('onboarding.back')}\r\n                    </button>\r\n\r\n                    <div className=\"flex gap-2\">\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"px-4 py-2 rounded-lg font-medium hover:bg-zinc-800 transition-colors\"\r\n                        >\r\n                            {t('onboarding.skip')}\r\n                        </button>\r\n\r\n                        {step < 5 ? (\r\n                            <button\r\n                                onClick={() => setStep(step + 1)}\r\n                                className=\"flex items-center gap-2 px-4 py-2 rounded-lg font-medium bg-accent hover:bg-accent-dark text-white transition-colors\"\r\n                            >\r\n                                {t('onboarding.next')}\r\n                                <ArrowRight size={16} />\r\n                            </button>\r\n                        ) : (\r\n                            <button\r\n                                onClick={handleComplete}\r\n                                className=\"flex items-center gap-2 px-4 py-2 rounded-lg font-medium bg-accent hover:bg-accent-dark text-white transition-colors\"\r\n                            >\r\n                                <CheckCircle size={16} />\r\n                                {t('onboarding.startSyncing')}\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div >\r\n    );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\RiskBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\RoundCheckbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\SettingsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\SimpleValidationModal.tsx","messages":[{"ruleId":"prefer-const","severity":1,"message":"'result' is never reassigned. Use 'const' instead.","line":128,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":128,"endColumn":15,"fix":{"range":[5108,5145],"text":"const result = [...filteredCandidates];"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import React, { useState, useContext, useMemo, useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { X, CheckCircle, AlertTriangle, Settings, Clock, Coins, Filter, Search } from 'lucide-react';\r\nimport ThemeContext from '../context/ThemeContext';\r\nimport { Model } from '../types';\r\nimport { useSettings } from '../context/SettingsContext';\r\nimport { formatCurrency, CurrencyCode } from '../utils/currency';\r\nimport { convertModelsToCSV } from '../services/validation';\r\nimport { ValidationSummary } from '../hooks/useModelValidation';\r\nimport { callProvider } from '../services/api/providers/provider-calls';\r\n\r\ninterface SimpleValidationModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onValidateAll: (opts?: { batchSize?: number; pauseMs?: number; maxBatches?: number; modelsOverride?: Model[] }) => Promise<{ success: boolean; updatedModels?: Model[]; error?: string; summary?: ValidationSummary }>;\r\n  models: Model[];\r\n  hasApiProvider: boolean;\r\n  onCancel?: () => void;\r\n  isBusy?: boolean;\r\n}\r\n\r\nexport function SimpleValidationModal({\r\n  isOpen,\r\n  onClose,\r\n  onValidateAll,\r\n  models,\r\n  hasApiProvider,\r\n  onCancel,\r\n  isBusy\r\n}: SimpleValidationModalProps) {\r\n  const { theme } = useContext(ThemeContext);\r\n  const { t } = useTranslation();\r\n  const { settings } = useSettings();\r\n  const [isValidating, setIsValidating] = useState(false);\r\n  const [result, setResult] = useState<{ success: boolean; message: string; summary?: ValidationSummary } | null>(null);\r\n\r\n  // Batch Configuration State\r\n  const [isManualConfig, setIsManualConfig] = useState(false);\r\n  const [batchSize, setBatchSize] = useState<number>(50);\r\n  const [pauseMs, setPauseMs] = useState<number>(10000);\r\n  const [maxBatches, setMaxBatches] = useState<number>(0);\r\n\r\n  // Filter State\r\n  const [providerSearch, setProviderSearch] = useState('');\r\n  const [filterProvider, setFilterProvider] = useState<string>('all');\r\n  const [filterMissingFields, setFilterMissingFields] = useState<string[]>([]);\r\n\r\n  // Limit Mode\r\n  const [scopeMode, setScopeMode] = useState<'all' | 'limit'>('all');\r\n  const [limitCount, setLimitCount] = useState<number>(50);\r\n  const [ordering, setOrdering] = useState<'recent' | 'oldest' | 'incomplete'>('incomplete');\r\n\r\n  // Dynamic Pricing State\r\n  const [dynamicPrice, setDynamicPrice] = useState<{ in: number; out: number } | null>(null);\r\n\r\n  type PricingTier = 'standard' | 'batch' | 'flex' | 'priority';\r\n\r\n  const bgModal = 'bg-bg border-border text-text';\r\n  const textPrimary = 'text-text';\r\n  const textSecondary = 'text-text-secondary';\r\n  const bgInput = 'border border-border bg-input text-text';\r\n  const cardBg = 'bg-card border-border';\r\n\r\n  // Reset state when modal opens\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setResult(null);\r\n      setIsValidating(false);\r\n      setScopeMode('all');\r\n      setFilterProvider('all');\r\n      setFilterMissingFields([]);\r\n      setProviderSearch('');\r\n    }\r\n  }, [isOpen]);\r\n\r\n  // Derived: Unique Providers\r\n  const uniqueProviders = useMemo(() => {\r\n    const providers = Array.from(new Set(models.map(m => m.provider || 'Unknown'))).sort();\r\n    return providers;\r\n  }, [models]);\r\n\r\n  // Derived: Filtered Providers for Dropdown\r\n  const availableProviders = useMemo(() => {\r\n    if (!providerSearch) return uniqueProviders;\r\n    return uniqueProviders.filter(p => p.toLowerCase().includes(providerSearch.toLowerCase()));\r\n  }, [uniqueProviders, providerSearch]);\r\n\r\n  // Derived: Base \"Incomplete\" Models (models that need validation at all)\r\n  const baseIncompleteModels = useMemo(() => {\r\n    return models.filter(model =>\r\n      !model.provider ||\r\n      !model.description ||\r\n      !model.parameters ||\r\n      !model.license?.name ||\r\n      model.license?.name === 'Unknown' ||\r\n      !model.release_date\r\n    );\r\n  }, [models]);\r\n\r\n  // Step 1: Apply User Filters to the Base list\r\n  const filteredCandidates = useMemo(() => {\r\n    return baseIncompleteModels.filter(model => {\r\n      // Provider Filter\r\n      if (filterProvider !== 'all' && (model.provider || 'Unknown') !== filterProvider) return false;\r\n\r\n      // Missing Fields Filter (OR logic: match any selected)\r\n      if (filterMissingFields.length > 0) {\r\n        const missingParams = !model.parameters;\r\n        const missingLicense = !model.license?.name || model.license?.name === 'Unknown';\r\n        const missingDate = !model.release_date;\r\n        const missingDesc = !model.description;\r\n\r\n        let matches = false;\r\n        if (filterMissingFields.includes('parameters') && missingParams) matches = true;\r\n        if (filterMissingFields.includes('license') && missingLicense) matches = true;\r\n        if (filterMissingFields.includes('release_date') && missingDate) matches = true;\r\n        if (filterMissingFields.includes('description') && missingDesc) matches = true;\r\n\r\n        if (!matches) return false;\r\n      }\r\n\r\n      return true;\r\n    });\r\n  }, [baseIncompleteModels, filterProvider, filterMissingFields]);\r\n\r\n  // Step 2: Apply Limit and Ordering\r\n  const targetModels = useMemo(() => {\r\n    let result = [...filteredCandidates];\r\n\r\n    // Apply Sorting when limiting to ensure we get the \"top\" N according to criteria\r\n    // (If scope is 'all', order doesn't strictly matter for the batch content, but 'incomplete' first is good practice)\r\n    if (ordering === 'recent') {\r\n      result.sort((a, b) => new Date(b.release_date || b.updated_at || 0).getTime() - new Date(a.release_date || a.updated_at || 0).getTime());\r\n    } else if (ordering === 'oldest') {\r\n      result.sort((a, b) => new Date(a.release_date || a.updated_at || 0).getTime() - new Date(b.release_date || b.updated_at || 0).getTime());\r\n    } else if (ordering === 'incomplete') {\r\n      const score = (m: Model) => {\r\n        let s = 0;\r\n        if (!m.description) s++;\r\n        if (!m.parameters) s++;\r\n        if (!m.license?.name || m.license?.name === 'Unknown') s++;\r\n        if (!m.tags || m.tags.length === 0) s++;\r\n        return s;\r\n      };\r\n      result.sort((a, b) => score(b) - score(a));\r\n    }\r\n\r\n    if (scopeMode === 'limit') {\r\n      return result.slice(0, Math.min(limitCount, result.length));\r\n    }\r\n    return result;\r\n  }, [filteredCandidates, scopeMode, limitCount, ordering]);\r\n\r\n  // Toggle helper for missing fields\r\n  const toggleMissingField = (field: string) => {\r\n    setFilterMissingFields(prev =>\r\n      prev.includes(field) ? prev.filter(f => f !== field) : [...prev, field]\r\n    );\r\n  };\r\n\r\n  const targetCount = targetModels.length; // Effective count being validated\r\n  const totalCandidateCount = filteredCandidates.length; // Count matching filters (before limit)\r\n\r\n  // Calculations for display\r\n  const fullCsv = convertModelsToCSV(targetModels);\r\n  const estimatedTokensFull = Math.ceil(fullCsv.length / 4);\r\n  const tokenSoftLimit = 180000;\r\n  const modelCountSoftLimit = 250;\r\n  const autoHybridMode: 'single' | 'batch' = (estimatedTokensFull > tokenSoftLimit || targetModels.length > modelCountSoftLimit) ? 'batch' : 'single';\r\n\r\n  const suggestedBatchSize = Math.min(100, Math.max(20, Math.round(targetCount / 8) || 20));\r\n  const autoPauseMs = 10000;\r\n\r\n  const effectiveBatchSize = isManualConfig ? batchSize : suggestedBatchSize;\r\n  const effectivePauseMs = isManualConfig ? pauseMs : autoPauseMs;\r\n  const effectiveMaxBatches = (isManualConfig && maxBatches > 0) ? maxBatches : 0;\r\n\r\n  // Determine effective provider configuration\r\n  const providerPriority = ['perplexity', settings.preferredModelProvider, 'anthropic', 'openai', 'google', 'deepseek', 'cohere', 'openrouter'].filter(Boolean);\r\n  const effectiveEntry = providerPriority\r\n    .map(key => key ? [key, settings.apiConfig?.[key]] : undefined)\r\n    .find((entry: any) => entry && entry[1]?.enabled && (entry[1]?.apiKey || entry[0] === 'ollama'));\r\n\r\n  const providerKey: string = (effectiveEntry as any)?.[0] || 'unknown';\r\n  const providerCfg: any = effectiveEntry?.[1];\r\n  const modelName: string = providerCfg?.model || 'unknown';\r\n  const currency: CurrencyCode = settings.currency || 'USD';\r\n\r\n  // Dynamic Pricing fetch effect\r\n  useEffect(() => {\r\n    // If using OpenRouter, try to fetch real-time pricing\r\n    if (providerKey === 'openrouter' && providerCfg) {\r\n      callProvider('openrouter', providerCfg, '', '')\r\n        .then(models => {\r\n          const match = models.find(m => m.id === modelName);\r\n          if (match?.pricing && match.pricing.length > 0) {\r\n            const p = match.pricing[0];\r\n            if (p.input && p.output) {\r\n              setDynamicPrice({ in: Number(p.input), out: Number(p.output) });\r\n            }\r\n          }\r\n        })\r\n        .catch(err => console.error('Failed to fetch pricing:', err));\r\n    } else {\r\n      setDynamicPrice(null); // Reset for others to use static default\r\n    }\r\n  }, [providerKey, modelName, providerCfg, isOpen]); // Rerun when modal opens or provider changes\r\n\r\n\r\n  const tokensInPerModel = 1500;\r\n  const tokensOutPerModel = 800;\r\n\r\n  const priceTable: Record<string, { in: number; out: number }> = {\r\n    'openai:gpt-4o-mini': { in: 0.00015, out: 0.0006 },\r\n    'openai:gpt-4o': { in: 0.0025, out: 0.01 },\r\n    'openai:gpt-3.5-turbo': { in: 0.0005, out: 0.0015 },\r\n    'anthropic:claude-3-5-sonnet': { in: 0.003, out: 0.015 },\r\n    'anthropic:claude-3-haiku': { in: 0.00025, out: 0.00125 },\r\n    'google:gemini-1.5-flash': { in: 0.000075, out: 0.0003 },\r\n    'google:gemini-1.5-pro': { in: 0.0035, out: 0.0105 },\r\n    'perplexity:sonar': { in: 0.001, out: 0.001 },\r\n    'perplexity:sonar-pro': { in: 0.003, out: 0.015 },\r\n  };\r\n  const providerDefaults: Record<string, { in: number; out: number }> = {\r\n    'openai': { in: 0.0025, out: 0.01 },\r\n    'anthropic': { in: 0.003, out: 0.015 },\r\n    'google': { in: 0.00035, out: 0.0105 },\r\n    'perplexity': { in: 0.001, out: 0.005 },\r\n    'deepseek': { in: 0.0005, out: 0.0005 },\r\n    'cohere': { in: 0.0001, out: 0.002 },\r\n    'openrouter': { in: 0.001, out: 0.001 },\r\n    'unknown': { in: 0, out: 0 }\r\n  };\r\n\r\n  const fullModelKey = `${providerKey}:${modelName}`.toLowerCase();\r\n\r\n  // Use dynamic price if available, else static table, else defaults\r\n  const unitPrice = dynamicPrice || priceTable[fullModelKey] || providerDefaults[providerKey] || { in: 0, out: 0 };\r\n\r\n  const tierMultipliers: Record<PricingTier, number> = { standard: 1, batch: 0.5, flex: 0.5, priority: 1.2 };\r\n  const autoSelectTier = (): PricingTier => {\r\n    if (autoHybridMode === 'batch') return (targetCount >= 200 || effectivePauseMs >= 5000) ? 'batch' : 'flex';\r\n    return 'standard';\r\n  };\r\n  const pricingTier = autoSelectTier();\r\n  const priceMultiplier = tierMultipliers[pricingTier] ?? 1;\r\n\r\n  const totalInTokens = targetCount * tokensInPerModel;\r\n  const totalOutTokens = targetCount * tokensOutPerModel;\r\n\r\n  const estCostUsd = (((totalInTokens / 1000) * unitPrice.in) + ((totalOutTokens / 1000) * unitPrice.out)) * priceMultiplier;\r\n  const batches = Math.ceil(targetCount / (effectiveBatchSize || 1));\r\n  const etaSeconds = (targetCount * 2) + (Math.max(0, batches - 1) * Math.round(effectivePauseMs / 1000));\r\n\r\n  const formatEta = (s: number) => s < 60 ? `${Math.ceil(s)}s` : s < 3600 ? `${Math.ceil(s / 60)}m` : `${Math.floor(s / 3600)}h${Math.ceil((s % 3600) / 60)}m`;\r\n\r\n  const handleValidate = async () => {\r\n    if (!hasApiProvider) {\r\n      setResult({ success: false, message: t('simpleValidation.configureProvider') });\r\n      return;\r\n    }\r\n    setIsValidating(true);\r\n    setResult(null);\r\n    try {\r\n      const validationResult = await onValidateAll({\r\n        batchSize: effectiveBatchSize,\r\n        pauseMs: effectivePauseMs,\r\n        maxBatches: effectiveMaxBatches || undefined,\r\n        modelsOverride: targetModels\r\n      });\r\n\r\n      if (validationResult.success && validationResult.updatedModels) {\r\n        setResult({\r\n          success: true,\r\n          message: t('simpleValidation.successMessage', { count: validationResult.updatedModels.length }),\r\n          summary: validationResult.summary\r\n        });\r\n        setTimeout(() => { onClose(); setResult(null); }, 5000);\r\n      } else {\r\n        setResult({ success: false, message: validationResult.error || t('simpleValidation.failedMessage') });\r\n      }\r\n    } catch (error) {\r\n      setResult({ success: false, message: String(error) });\r\n    } finally {\r\n      setIsValidating(false);\r\n    }\r\n  };\r\n\r\n  const isCostSignificant = estCostUsd > 0.01;\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200\">\r\n      <div className={`w-full max-w-3xl rounded-2xl border ${bgModal} shadow-2xl flex flex-col max-h-[90vh]`}>\r\n\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between p-6 border-b border-border bg-card/30\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"size-10 rounded-full bg-violet-500/10 flex items-center justify-center border border-violet-500/20\">\r\n              <CheckCircle className=\"size-6 text-violet-500\" />\r\n            </div>\r\n            <div>\r\n              <h2 className={`text-xl font-bold ${textPrimary}`}>{t('simpleValidation.title')}</h2>\r\n              <div className={`text-sm ${textSecondary} mt-0.5`}>{t('simpleValidation.description', { provider: providerKey, model: modelName })}</div>\r\n            </div>\r\n          </div>\r\n          <button onClick={onClose} className={`rounded-xl ${bgInput} p-2.5 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors`}>\r\n            <X className=\"size-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Scrollable Content */}\r\n        <div className=\"flex-1 overflow-y-auto p-6\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 h-full\">\r\n\r\n            {/* LEFT COLUMN: Filters & Scope */}\r\n            <div className=\"flex flex-col gap-4\">\r\n              <div className=\"flex items-center gap-2 mb-1\">\r\n                <Filter className=\"size-4 text-violet-500\" />\r\n                <h3 className=\"text-sm font-semibold uppercase tracking-wide opacity-80\">{t('simpleValidation.filtersScope')}</h3>\r\n              </div>\r\n\r\n              <div className={`flex-1 p-4 rounded-xl border ${cardBg} shadow-sm space-y-5`}>\r\n\r\n                {/* 1. Filters */}\r\n                <div className=\"space-y-3\">\r\n                  <label className=\"text-xs font-bold opacity-60 uppercase tracking-wider\">{t('simpleValidation.filterCandidates')}</label>\r\n\r\n                  {/* Provider Filter with Search */}\r\n                  <div>\r\n                    <div className=\"text-[10px] uppercase opacity-50 mb-1.5 flex justify-between\">\r\n                      <span>{t('table.provider')}</span>\r\n                      {filterProvider !== 'all' && (\r\n                        <button onClick={() => { setFilterProvider('all'); setProviderSearch(''); }} className=\"text-violet-500 hover:underline\">{t('common.clear') || 'Clear'}</button>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"relative\">\r\n                      <span className=\"absolute left-3 top-2.5 text-zinc-500\"><Search className=\"size-3.5\" /></span>\r\n\r\n                      {filterProvider === 'all' ? (\r\n                        <div className=\"relative\">\r\n                          <input\r\n                            type=\"text\"\r\n                            placeholder={t('table.search') + \"...\"}\r\n                            value={providerSearch}\r\n                            onChange={e => setProviderSearch(e.target.value)}\r\n                            className={`w-full ${bgInput} rounded-lg py-2 pl-9 pr-3 text-xs`}\r\n                          />\r\n                          {providerSearch && availableProviders.length > 0 && (\r\n                            <div className=\"absolute z-10 w-full mt-1 max-h-40 overflow-auto rounded-lg border border-border bg-card shadow-lg\">\r\n                              {availableProviders.map(p => (\r\n                                <button\r\n                                  key={p}\r\n                                  onClick={() => { setFilterProvider(p); setProviderSearch(''); }}\r\n                                  className=\"w-full text-left px-3 py-2 text-xs hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors\"\r\n                                >\r\n                                  {p}\r\n                                </button>\r\n                              ))}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      ) : (\r\n                        <div\r\n                          onClick={() => setFilterProvider('all')}\r\n                          className={`w-full ${bgInput} rounded-lg py-2 pl-9 pr-3 text-xs flex items-center justify-between cursor-pointer hover:opacity-80`}\r\n                        >\r\n                          <span className=\"font-medium text-violet-500\">{filterProvider}</span>\r\n                          <X className=\"size-3 opacity-50\" />\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Missing Fields Filter */}\r\n                  <div className=\"flex flex-wrap gap-2 mt-4\">\r\n                    {[\r\n                      { id: 'parameters', label: t('simpleValidation.missingFields.parameters') },\r\n                      { id: 'license', label: t('simpleValidation.missingFields.license') },\r\n                      { id: 'release_date', label: t('simpleValidation.missingFields.date') },\r\n                      { id: 'description', label: t('simpleValidation.missingFields.description') },\r\n                    ].map(f => (\r\n                      <button\r\n                        key={f.id}\r\n                        onClick={() => toggleMissingField(f.id)}\r\n                        className={`text-[10px] px-2.5 py-1 rounded-full border transition-all ${filterMissingFields.includes(f.id)\r\n                          ? 'bg-violet-500 text-white border-violet-600'\r\n                          : 'bg-transparent border-zinc-300 dark:border-zinc-700 opacity-60 hover:opacity-100'\r\n                          }`}\r\n                      >\r\n                        {t('simpleValidation.missing')} {f.label}\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"h-px bg-zinc-200 dark:bg-zinc-800\" />\r\n\r\n                {/* 2. Scope & Limit (No Sorting) */}\r\n                <div className=\"space-y-3\">\r\n                  <div className=\"flex justify-between items-center\">\r\n                    <label className=\"text-xs font-bold opacity-60 uppercase tracking-wider\">{t('simpleValidation.validationScope')}</label>\r\n                    <span className=\"text-[10px] opacity-50\">{t('simpleValidation.matchingFilters', { count: totalCandidateCount })}</span>\r\n                  </div>\r\n\r\n                  <div className=\"grid grid-cols-2 gap-2 p-1 bg-zinc-100 dark:bg-zinc-900/50 rounded-lg\">\r\n                    <button\r\n                      onClick={() => setScopeMode('all')}\r\n                      className={`text-xs font-medium py-1.5 px-3 rounded-md transition-all ${scopeMode === 'all' ? 'bg-white dark:bg-zinc-800 shadow-sm text-violet-600' : 'opacity-60 hover:opacity-100'}`}\r\n                    >\r\n                      {t('simpleValidation.allMatches')}\r\n                    </button>\r\n                    <button\r\n                      onClick={() => setScopeMode('limit')}\r\n                      className={`text-xs font-medium py-1.5 px-3 rounded-md transition-all ${scopeMode === 'limit' ? 'bg-white dark:bg-zinc-800 shadow-sm text-violet-600' : 'opacity-60 hover:opacity-100'}`}\r\n                    >\r\n                      {t('simpleValidation.limitCount')}\r\n                    </button>\r\n                  </div>\r\n\r\n                  {scopeMode === 'limit' && (\r\n                    <div className=\"pt-2 animate-in fade-in slide-in-from-top-1 space-y-3\">\r\n                      {/* Limit Slider */}\r\n                      <div>\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <input\r\n                            type=\"range\" min={1} max={Math.min(200, totalCandidateCount)}\r\n                            value={limitCount} onChange={e => setLimitCount(parseInt(e.target.value))}\r\n                            className=\"flex-1 accent-violet-500 h-1.5 bg-zinc-200 dark:bg-zinc-700 rounded-lg appearance-none cursor-pointer\"\r\n                          />\r\n                          <div className={`w-12 text-center text-xs font-mono font-bold`}>{limitCount}</div>\r\n                        </div>\r\n                        <div className=\"text-[10px] text-center opacity-40 mt-1\">{t('simpleValidation.limitApplied')}</div>\r\n                      </div>\r\n\r\n                      {/* Ordering Selection */}\r\n                      <div className=\"space-y-1.5\">\r\n                        <label className=\"text-[10px] uppercase font-bold opacity-60\">{t('simpleValidation.prioritizeBy')}</label>\r\n                        <select\r\n                          value={ordering}\r\n                          onChange={(e) => setOrdering(e.target.value as any)}\r\n                          className={`w-full ${bgInput} text-xs rounded-lg p-2 outline-none focus:ring-1 focus:ring-violet-500`}\r\n                        >\r\n                          <option value=\"incomplete\">{t('simpleValidation.ordering.incomplete')}</option>\r\n                          <option value=\"recent\">{t('simpleValidation.ordering.recent')}</option>\r\n                          <option value=\"oldest\">{t('simpleValidation.ordering.oldest')}</option>\r\n                        </select>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* RIGHT COLUMN: Execution & Cost */}\r\n            <div className=\"flex flex-col gap-4\">\r\n              <div className=\"flex items-center justify-between mb-1\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Settings className=\"size-4 text-violet-500\" />\r\n                  <h3 className=\"text-sm font-semibold uppercase tracking-wide opacity-80\">{t('simpleValidation.execution')}</h3>\r\n                </div>\r\n                <button onClick={() => setIsManualConfig(!isManualConfig)} className=\"text-[10px] text-violet-500 underline decoration-dotted\">\r\n                  {isManualConfig ? t('simpleValidation.defaultSettings') : t('simpleValidation.advanced')}\r\n                </button>\r\n              </div>\r\n\r\n              <div className=\"flex-1 space-y-4\">\r\n                {/* COST CARD */}\r\n                <div className={`rounded-xl border ${cardBg} p-5 shadow-sm relative overflow-hidden group`}>\r\n                  <div className=\"relative z-10\">\r\n                    <div className=\"flex justify-between items-start mb-2\">\r\n                      <div className=\"text-[10px] font-bold opacity-70 uppercase tracking-wide flex items-center gap-1.5\">\r\n                        <Coins className=\"size-3 text-violet-500\" /> {t('simpleValidation.estimatedCost')}\r\n                      </div>\r\n                      {dynamicPrice && (\r\n                        <span className=\"text-[9px] bg-violet-500/10 text-violet-600 px-1.5 py-0.5 rounded border border-violet-500/20\">\r\n                          {t('simpleValidation.livePricing')}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n\r\n                    <div className=\"flex items-baseline gap-1 mb-1\">\r\n                      <span className={`text-3xl font-bold ${isCostSignificant ? 'text-text' : 'text-zinc-500'}`}>\r\n                        {estCostUsd > 0 ? formatCurrency(estCostUsd, currency) : t('simpleValidation.free')}\r\n                      </span>\r\n                      {estCostUsd > 0 && estCostUsd < 0.01 && <span className=\"text-xs text-zinc-400\">(&lt;$0.01)</span>}\r\n                    </div>\r\n                    <div className=\"text-[11px] opacity-60 mb-3\">{t('simpleValidation.modelsVia', { count: targetCount, provider: providerKey })}</div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-3 text-xs border-t border-border pt-3\">\r\n                      <div>\r\n                        <div className=\"opacity-50 text-[10px]\">{t('simpleValidation.eta')}</div>\r\n                        <div className=\"font-semibold flex items-center gap-1\"><Clock className=\"size-3 text-violet-500\" />{formatEta(etaSeconds)}</div>\r\n                      </div>\r\n                      <div>\r\n                        <div className=\"opacity-50 text-[10px]\">{t('simpleValidation.tokens')}</div>\r\n                        <div className=\"font-semibold\">~{Math.round((totalInTokens + totalOutTokens) / 1000)}k</div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Batch Settings */}\r\n                <div className={`rounded-xl border ${cardBg} p-4 text-xs`}>\r\n                  {isManualConfig ? (\r\n                    <div className=\"space-y-4\">\r\n                      <div>\r\n                        <div className=\"flex justify-between mb-1\"><label>{t('simpleValidation.batchSize')}</label><span className=\"font-mono\">{batchSize}</span></div>\r\n                        <input type=\"range\" min={1} max={200} value={batchSize} onChange={e => setBatchSize(Number(e.target.value))} className=\"w-full h-1.5 bg-zinc-200 dark:bg-zinc-700 rounded-lg appearance-none\" />\r\n                      </div>\r\n                      <div>\r\n                        <div className=\"flex justify-between mb-1\"><label>{t('simpleValidation.pauseMs')}</label><span className=\"font-mono\">{pauseMs}</span></div>\r\n                        <input type=\"range\" min={0} max={60000} step={1000} value={pauseMs} onChange={e => setPauseMs(Number(e.target.value))} className=\"w-full h-1.5 bg-zinc-200 dark:bg-zinc-700 rounded-lg appearance-none\" />\r\n                        <div className=\"text-[9px] opacity-40 mt-1\">{t('simpleValidation.manualDelay')}</div>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"flex items-center justify-between opacity-80\">\r\n                      <span>{t('simpleValidation.autoOptimization')}</span>\r\n                      <span className=\"bg-green-100 dark:bg-green-900/30 text-green-700 px-2 py-0.5 rounded text-[10px]\">{t('simpleValidation.enabled')}</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {result && (\r\n            <div className={`mt-4 rounded-lg border p-3 ${result.success ? 'bg-green-50/50 border-green-200' : 'bg-red-50/50 border-red-200'} animate-in slide-in-from-bottom-2`}>\r\n              <div className=\"flex gap-2\">\r\n                {result.success ? <CheckCircle className=\"size-4 text-green-600\" /> : <AlertTriangle className=\"size-4 text-red-600\" />}\r\n                <div className=\"text-sm font-medium\">{result.message}</div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"p-5 border-t border-border bg-card/30 flex justify-end gap-3\">\r\n          <button onClick={onClose} className={`px-4 py-2 rounded-xl border text-sm font-medium hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors`}>{t('simpleValidation.cancel')}</button>\r\n          <button onClick={handleValidate} disabled={isValidating || !hasApiProvider} className=\"px-6 py-2 rounded-xl bg-violet-600 text-white text-sm font-medium hover:bg-violet-700 shadow-md shadow-violet-500/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2\">\r\n            {isValidating && <div className=\"size-3.5 border-2 border-white border-t-transparent rounded-full animate-spin\" />}\r\n            {isValidating ? t('simpleValidation.running') : t('simpleValidation.validateModels', { count: targetCount })}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\TerminalConsole.tsx","messages":[{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":35,"column":78,"nodeType":"BlockStatement","messageId":"unexpected","endLine":35,"endColumn":81,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1286,1287],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":102,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":102,"endColumn":18,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3843,3844],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useContext } from \"react\";\r\nimport ThemeContext from \"../context/ThemeContext\";\r\n\r\nexport interface TerminalConsoleProps {\r\n  logs: string[];\r\n  onClose: () => void;\r\n  onClear?: () => void;\r\n}\r\n\r\ntype ParsedKind = 'REQ' | 'RES' | 'ERR' | 'APP' | 'RAW';\r\ntype ParsedEntry = {\r\n  id: string;\r\n  kind: ParsedKind;\r\n  level?: 'LOG' | 'INFO' | 'WARN' | 'ERROR' | 'WEBHOOK';\r\n  url?: string;\r\n  method?: string;\r\n  status?: number;\r\n  statusText?: string;\r\n  headers?: any;\r\n  body?: string;\r\n  raw: string;\r\n};\r\n\r\nfunction parseLogLine(line: string): ParsedEntry {\r\n  // [REQ ab12cd] url METHOD\\nHeaders: {...}\\nBody: ...\r\n  if (line.startsWith(\"[REQ \")) {\r\n    const id = line.slice(5, 11);\r\n    const urlMatch = line.match(/\\] (.+?) (GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)/);\r\n    const methodMatch = line.match(/ (GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)/);\r\n    const headersIdx = line.indexOf(\"Headers:\");\r\n    const bodyIdx = line.indexOf(\"Body:\");\r\n    const headersRaw = headersIdx >= 0 ? line.slice(headersIdx + 8, bodyIdx >= 0 ? bodyIdx : undefined).trim() : undefined;\r\n    const bodyRaw = bodyIdx >= 0 ? line.slice(bodyIdx + 5).trim() : undefined;\r\n    let headers: any = undefined;\r\n    try { headers = headersRaw ? JSON.parse(headersRaw) : undefined; } catch { }\r\n    return {\r\n      id,\r\n      kind: 'REQ',\r\n      url: urlMatch ? urlMatch[1] : undefined,\r\n      method: methodMatch ? methodMatch[1] : undefined,\r\n      headers,\r\n      body: bodyRaw,\r\n      raw: line\r\n    };\r\n  }\r\n  // [RES ab12cd] 200 OK url\\n<text>\r\n  if (line.startsWith(\"[RES \")) {\r\n    const id = line.slice(5, 11);\r\n    const afterBracket = line.slice(line.indexOf(\"]\") + 1).trim();\r\n    const statusMatch = afterBracket.match(/^(\\d{3})\\s+([A-ZA-z]+)/);\r\n    const urlMatch = afterBracket.match(/\\d{3}\\s+[A-Za-z]+\\s+(\\S+)/);\r\n    const bodyStart = afterBracket.indexOf(\"\\n\");\r\n    const body = bodyStart >= 0 ? afterBracket.slice(bodyStart + 1) : '';\r\n    return {\r\n      id,\r\n      kind: 'RES',\r\n      status: statusMatch ? Number(statusMatch[1]) : undefined,\r\n      statusText: statusMatch ? statusMatch[2] : undefined,\r\n      url: urlMatch ? urlMatch[1] : undefined,\r\n      body,\r\n      raw: line\r\n    };\r\n  }\r\n  // [ERR ab12cd] url\\nmessage\r\n  if (line.startsWith(\"[ERR \")) {\r\n    const id = line.slice(5, 11);\r\n    const afterBracket = line.slice(line.indexOf(\"]\") + 1).trim();\r\n    const firstNl = afterBracket.indexOf(\"\\n\");\r\n    const url = firstNl >= 0 ? afterBracket.slice(0, firstNl) : afterBracket;\r\n    const body = firstNl >= 0 ? afterBracket.slice(firstNl + 1) : '';\r\n    return { id, kind: 'ERR', url, body, raw: line };\r\n  }\r\n  // [LOG|INFO|WARN|ERROR timestamp] message ...\r\n  if (/^\\[(LOG|INFO|WARN|ERROR)\\s/.test(line)) {\r\n    const m = line.match(/^\\[(LOG|INFO|WARN|ERROR)\\s[^\\]]*\\]\\s*([\\s\\S]*)$/);\r\n    const level = (m?.[1] as any) || 'LOG';\r\n    const body = m?.[2] || '';\r\n    return { id: Math.random().toString(36).slice(2, 8), kind: 'APP', level, body, raw: line };\r\n  }\r\n  // [WEBHOOK] ...\r\n  if (line.startsWith('[WEBHOOK]')) {\r\n    const body = line.replace(/^\\[WEBHOOK\\]\\s*/, '');\r\n    return { id: Math.random().toString(36).slice(2, 8), kind: 'APP', level: 'WEBHOOK', body, raw: line };\r\n  }\r\n  return { id: Math.random().toString(36).slice(2, 8), kind: 'RAW', raw: line };\r\n}\r\n\r\nfunction tryPrettyJson(text?: string): string | undefined {\r\n  if (!text) return undefined;\r\n  const trimmed = text.trim();\r\n  try {\r\n    const json = JSON.parse(trimmed);\r\n    return JSON.stringify(json, null, 2);\r\n  } catch {\r\n    // Try to extract JSON substring\r\n    const start = trimmed.indexOf('{');\r\n    const end = trimmed.lastIndexOf('}');\r\n    if (start >= 0 && end > start) {\r\n      try {\r\n        const json = JSON.parse(trimmed.slice(start, end + 1));\r\n        return JSON.stringify(json, null, 2);\r\n      } catch { }\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n\r\nexport const TerminalConsole: React.FC<TerminalConsoleProps> = ({ logs, onClose, onClear }) => {\r\n  const { theme } = useContext(ThemeContext);\r\n  const parsed = React.useMemo(() => logs.map(parseLogLine), [logs]);\r\n  // Group by id\r\n  const groups = React.useMemo(() => {\r\n    const map = new Map<string, ParsedEntry[]>();\r\n    parsed.forEach(p => {\r\n      const arr = map.get(p.id) || [];\r\n      arr.push(p);\r\n      map.set(p.id, arr);\r\n    });\r\n    return Array.from(map.entries()).map(([id, items]) => ({ id, items }));\r\n  }, [parsed]);\r\n\r\n  // Auto-scroll to bottom when new logs arrive\r\n  const containerRef = React.useRef<HTMLDivElement | null>(null);\r\n  React.useEffect(() => {\r\n    const el = containerRef.current;\r\n    if (!el) return;\r\n    el.scrollTop = el.scrollHeight;\r\n  }, [logs]);\r\n\r\n  const statusColor = (status?: number) => {\r\n    if (status === undefined) return 'text-zinc-300';\r\n    if (status >= 200 && status < 300) return 'text-green-400';\r\n    if (status >= 300 && status < 400) return 'text-yellow-400';\r\n    return 'text-red-400';\r\n  };\r\n\r\n  const levelBadge = (level?: ParsedEntry['level']) => {\r\n    const base = 'px-1.5 py-0.5 rounded text-[10px]';\r\n    switch (level) {\r\n      case 'INFO': return <span className={`${base} ${theme === 'dark' ? 'bg-blue-900/20 text-blue-400' : 'text-blue-700'}`}>INFO</span>;\r\n      case 'WARN': return <span className={`${base} ${theme === 'dark' ? 'bg-yellow-900/20 text-yellow-400' : 'text-yellow-700'}`}>WARN</span>;\r\n      case 'ERROR': return <span className={`${base} ${theme === 'dark' ? 'bg-red-900/20 text-red-400' : 'text-red-700'}`}>ERROR</span>;\r\n      case 'WEBHOOK': return <span className={`${base} ${theme === 'dark' ? 'bg-emerald-900/20 text-emerald-400' : 'text-emerald-700'}`}>WEBHOOK</span>;\r\n      default: return <span className={`${base} bg-zinc-800 text-zinc-300`}>LOG</span>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed bottom-4 left-4 z-40 w-[720px] max-h-[75vh] bg-black text-zinc-100 border border-zinc-800 rounded-xl shadow-2xl flex flex-col\">\r\n      <div className=\"flex items-center justify-between px-4 py-2 border-b border-zinc-800 bg-black rounded-t-xl\">\r\n        <span className=\"font-bold text-accent flex items-center gap-2\">\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><text x=\"3\" y=\"17\" fontSize=\"16\" fontFamily=\"monospace\" fill=\"currentColor\">&gt;_</text></svg>\r\n          Console\r\n        </span>\r\n        <div className=\"flex items-center gap-2\">\r\n          <button className=\"text-xs px-2 py-1 bg-zinc-800 rounded hover:bg-zinc-700\" onClick={onClear}>Clear</button>\r\n          <button className=\"text-xs px-2 py-1 bg-zinc-800 rounded hover:bg-accent\" onClick={onClose}>Close</button>\r\n        </div>\r\n      </div>\r\n      <div ref={containerRef} className=\"flex-1 overflow-y-auto p-3 font-mono text-[11px]\">\r\n        {logs.length === 0 ? (\r\n          <div className=\"text-zinc-400\">No logs yet.</div>\r\n        ) : (\r\n          <div className=\"space-y-2\">\r\n            {groups.map(({ id, items }) => {\r\n              const req = items.find(i => i.kind === 'REQ');\r\n              const res = items.find(i => i.kind === 'RES');\r\n              const err = items.find(i => i.kind === 'ERR');\r\n              const isNetwork = !!(req || res || err);\r\n              if (isNetwork) {\r\n                const prettyReqBody = tryPrettyJson(req?.body);\r\n                const prettyResBody = tryPrettyJson(res?.body);\r\n                const prettyHeaders = req?.headers ? JSON.stringify(req.headers, null, 2) : undefined;\r\n                return (\r\n                  <div key={id} className=\"border border-zinc-800 rounded-lg overflow-hidden\">\r\n                    <div className=\"px-3 py-2 bg-black flex items-center gap-2\">\r\n                      <span className=\"text-[10px] text-zinc-400\">{id}</span>\r\n                      {req?.method && <span className=\"px-1.5 py-0.5 rounded bg-zinc-800 text-zinc-200 text-[10px]\">{req.method}</span>}\r\n                      <span className=\"truncate text-xs\">{req?.url || res?.url || err?.url}</span>\r\n                      {res?.status !== undefined && (\r\n                        <span className={`ml-auto text-xs ${statusColor(res.status)}`}>{res.status} {res.statusText}</span>\r\n                      )}\r\n                      {err && !res && <span className=\"ml-auto text-xs text-red-400\">Error</span>}\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 gap-0\">\r\n                      <div className=\"p-2 border-r border-zinc-800\">\r\n                        <div className=\"text-[10px] text-zinc-400 mb-1\">Request</div>\r\n                        {prettyHeaders && (\r\n                          <details>\r\n                            <summary className=\"cursor-pointer text-[10px] text-zinc-500\">Headers</summary>\r\n                            <pre className=\"whitespace-pre-wrap text-[10px] text-zinc-300\">{prettyHeaders}</pre>\r\n                          </details>\r\n                        )}\r\n                        {req?.body && (\r\n                          <details>\r\n                            <summary className=\"cursor-pointer text-[10px] text-zinc-500\">Body</summary>\r\n                            <pre className=\"whitespace-pre-wrap text-[10px] text-zinc-300\">{prettyReqBody || req.body}</pre>\r\n                          </details>\r\n                        )}\r\n                        {!req?.body && !prettyHeaders && <div className=\"text-[10px] text-zinc-500\">ÔÇö</div>}\r\n                      </div>\r\n                      <div className=\"p-2\">\r\n                        <div className=\"text-[10px] text-zinc-400 mb-1\">Response</div>\r\n                        {res?.body && (\r\n                          <details>\r\n                            <summary className=\"cursor-pointer text-[10px] text-zinc-500\">Body</summary>\r\n                            <pre className=\"whitespace-pre-wrap text-[10px] text-zinc-300\">{prettyResBody || (res.body?.slice(0, 4000) || '')}</pre>\r\n                          </details>\r\n                        )}\r\n                        {err?.body && (\r\n                          <div className=\"text-red-400 text-[10px] whitespace-pre-wrap\">{err.body}</div>\r\n                        )}\r\n                        {!res?.body && !err?.body && <div className=\"text-[10px] text-zinc-500\">ÔÇö</div>}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              }\r\n              // App/RAW log: single-column compact card\r\n              const entry = items[0];\r\n              return (\r\n                <div key={id} className=\"border border-zinc-800 rounded-lg overflow-hidden\">\r\n                  <div className=\"px-3 py-2 bg-black flex items-center gap-2\">\r\n                    <span className=\"text-[10px] text-zinc-400\">{id}</span>\r\n                    {entry.kind === 'APP' ? levelBadge(entry.level) : <span className=\"px-1.5 py-0.5 rounded bg-zinc-800 text-zinc-300 text-[10px]\">LOG</span>}\r\n                    <span className=\"text-xs truncate flex-1\">{(entry.body && entry.body.split('\\n')[0]) || entry.raw}</span>\r\n                  </div>\r\n                  {entry.body && entry.body.includes('\\n') && (\r\n                    <div className=\"p-2\">\r\n                      <details>\r\n                        <summary className=\"cursor-pointer text-[10px] text-zinc-500\">Details</summary>\r\n                        <pre className=\"whitespace-pre-wrap text-[10px] text-zinc-300\">{entry.body}</pre>\r\n                      </details>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\ThemedSelect.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\TitleBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\UI.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\UpdateProgress.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'lastProgress' and 'lastTime'. Either include them or remove the dependency array.","line":73,"column":8,"nodeType":"ArrayExpression","endLine":73,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [downloadProgress, lastProgress, lastTime]","fix":{"range":[2603,2621],"text":"[downloadProgress, lastProgress, lastTime]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'isDownloading'. Either include it or remove the dependency array.","line":84,"column":8,"nodeType":"ArrayExpression","endLine":84,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [isDownloading, status]","fix":{"range":[2958,2966],"text":"[isDownloading, status]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Update Progress Component\r\n * \r\n * Floating toast-like component that displays app update progress.\r\n * Shows different states: checking, available, downloading, downloaded, error.\r\n * Integrates with UpdateContext for real update state.\r\n * \r\n * @module UpdateProgress\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Download, RefreshCw, CheckCircle, AlertCircle, X, Loader2, Sparkles } from 'lucide-react';\r\nimport { useUpdate } from '../context/UpdateContext';\r\n\r\ninterface UpdateProgressProps {\r\n    /** Whether to show the component */\r\n    show: boolean;\r\n    /** Callback when user dismisses the notification */\r\n    onDismiss: () => void;\r\n}\r\n\r\ntype UpdateStatus = 'idle' | 'checking' | 'available' | 'downloading' | 'downloaded' | 'error';\r\n\r\nexport function UpdateProgress({ show, onDismiss }: UpdateProgressProps) {\r\n    const {\r\n        checking,\r\n        updateAvailable,\r\n        updateVersion,\r\n        downloadProgress,\r\n        updateDownloaded,\r\n        error,\r\n        downloadUpdate,\r\n        installUpdate,\r\n    } = useUpdate();\r\n\r\n    const [isDownloading, setIsDownloading] = useState(false);\r\n    const [downloadSpeed, setDownloadSpeed] = useState<string | null>(null);\r\n    const [lastProgress, setLastProgress] = useState(0);\r\n    const [lastTime, setLastTime] = useState(Date.now());\r\n\r\n    // Determine current status\r\n    const getStatus = (): UpdateStatus => {\r\n        if (error) return 'error';\r\n        if (updateDownloaded) return 'downloaded';\r\n        if (downloadProgress !== null && downloadProgress > 0) return 'downloading';\r\n        if (updateAvailable) return 'available';\r\n        if (checking) return 'checking';\r\n        return 'idle';\r\n    };\r\n\r\n    const status = getStatus();\r\n\r\n    // Calculate download speed\r\n    useEffect(() => {\r\n        if (downloadProgress !== null && downloadProgress > lastProgress) {\r\n            const now = Date.now();\r\n            const timeDiff = (now - lastTime) / 1000; // seconds\r\n            const progressDiff = downloadProgress - lastProgress;\r\n\r\n            if (timeDiff > 0 && progressDiff > 0) {\r\n                // Rough estimate: assume ~100MB update\r\n                const mbPerSecond = (progressDiff / 100) * 100 / timeDiff;\r\n                if (mbPerSecond >= 1) {\r\n                    setDownloadSpeed(`${mbPerSecond.toFixed(1)} MB/s`);\r\n                } else {\r\n                    setDownloadSpeed(`${(mbPerSecond * 1024).toFixed(0)} KB/s`);\r\n                }\r\n            }\r\n\r\n            setLastProgress(downloadProgress);\r\n            setLastTime(now);\r\n        }\r\n    }, [downloadProgress]);\r\n\r\n    // Reset when starting download\r\n    useEffect(() => {\r\n        if (status === 'downloading' && !isDownloading) {\r\n            setIsDownloading(true);\r\n            setLastProgress(0);\r\n            setLastTime(Date.now());\r\n        } else if (status !== 'downloading') {\r\n            setIsDownloading(false);\r\n        }\r\n    }, [status]);\r\n\r\n    if (!show || status === 'idle') return null;\r\n\r\n    const handleDownload = () => {\r\n        downloadUpdate();\r\n    };\r\n\r\n    const handleInstall = () => {\r\n        installUpdate();\r\n    };\r\n\r\n    // Status-specific content\r\n    const renderContent = () => {\r\n        switch (status) {\r\n            case 'checking':\r\n                return (\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"p-2 rounded-full bg-blue-500/20\">\r\n                            <Loader2 className=\"w-5 h-5 text-blue-400 animate-spin\" />\r\n                        </div>\r\n                        <div className=\"flex-1\">\r\n                            <p className=\"font-medium text-sm\">Checking for updates...</p>\r\n                            <p className=\"text-xs text-zinc-400\">Please wait</p>\r\n                        </div>\r\n                    </div>\r\n                );\r\n\r\n            case 'available':\r\n                return (\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"p-2 rounded-full bg-emerald-500/20\">\r\n                            <Sparkles className=\"w-5 h-5 text-emerald-400\" />\r\n                        </div>\r\n                        <div className=\"flex-1\">\r\n                            <p className=\"font-medium text-sm\">Update available!</p>\r\n                            <p className=\"text-xs text-zinc-400\">Version {updateVersion} is ready to download</p>\r\n                        </div>\r\n                        <button\r\n                            onClick={handleDownload}\r\n                            className=\"px-3 py-1.5 rounded-lg text-xs font-medium bg-emerald-500 hover:bg-emerald-600 text-white transition-colors flex items-center gap-1.5\"\r\n                        >\r\n                            <Download className=\"w-3.5 h-3.5\" />\r\n                            Download\r\n                        </button>\r\n                    </div>\r\n                );\r\n\r\n            case 'downloading':\r\n                return (\r\n                    <div className=\"space-y-2\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"p-2 rounded-full bg-blue-500/20\">\r\n                                <Download className=\"w-5 h-5 text-blue-400 animate-pulse\" />\r\n                            </div>\r\n                            <div className=\"flex-1\">\r\n                                <p className=\"font-medium text-sm\">Downloading update...</p>\r\n                                <p className=\"text-xs text-zinc-400\">\r\n                                    {Math.round(downloadProgress || 0)}% complete\r\n                                    {downloadSpeed && ` ÔÇó ${downloadSpeed}`}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"h-1.5 bg-zinc-700 rounded-full overflow-hidden\">\r\n                            <div\r\n                                className=\"h-full bg-gradient-to-r from-blue-500 to-cyan-400 rounded-full transition-all duration-300 ease-out\"\r\n                                style={{ width: `${downloadProgress || 0}%` }}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                );\r\n\r\n            case 'downloaded':\r\n                return (\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"p-2 rounded-full bg-emerald-500/20\">\r\n                            <CheckCircle className=\"w-5 h-5 text-emerald-400\" />\r\n                        </div>\r\n                        <div className=\"flex-1\">\r\n                            <p className=\"font-medium text-sm\">Update ready!</p>\r\n                            <p className=\"text-xs text-zinc-400\">Restart to complete the installation</p>\r\n                        </div>\r\n                        <button\r\n                            onClick={handleInstall}\r\n                            className=\"px-3 py-1.5 rounded-lg text-xs font-medium bg-emerald-500 hover:bg-emerald-600 text-white transition-colors flex items-center gap-1.5\"\r\n                        >\r\n                            <RefreshCw className=\"w-3.5 h-3.5\" />\r\n                            Restart Now\r\n                        </button>\r\n                    </div>\r\n                );\r\n\r\n            case 'error':\r\n                // Check for signature errors which require manual update\r\n                const isSignatureError = error && (\r\n                    error.includes('signed') ||\r\n                    error.includes('signature') ||\r\n                    error.includes('Code signature')\r\n                );\r\n\r\n                if (isSignatureError) {\r\n                    return (\r\n                        <div className=\"flex flex-col gap-3\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className=\"p-2 rounded-full bg-amber-500/20\">\r\n                                    <AlertCircle className=\"w-5 h-5 text-amber-400\" />\r\n                                </div>\r\n                                <div className=\"flex-1\">\r\n                                    <p className=\"font-medium text-sm\">Action Required</p>\r\n                                    <p className=\"text-xs text-zinc-400\">\r\n                                        Signature change detected. You must update manually this one time.\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                            <button\r\n                                onClick={() => {\r\n                                    window.electronAPI?.openExternal('https://github.com/Jeremy8776/AIModelDB/releases/latest');\r\n                                }}\r\n                                className=\"w-full px-3 py-2 rounded-lg text-xs font-medium bg-amber-500 hover:bg-amber-600 text-black transition-colors flex items-center justify-center gap-2\"\r\n                            >\r\n                                <Download className=\"w-3.5 h-3.5\" />\r\n                                Download Installer Manually\r\n                            </button>\r\n                        </div>\r\n                    );\r\n                }\r\n\r\n                return (\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"p-2 rounded-full bg-red-500/20\">\r\n                            <AlertCircle className=\"w-5 h-5 text-red-400\" />\r\n                        </div>\r\n                        <div className=\"flex-1\">\r\n                            <p className=\"font-medium text-sm\">Update failed</p>\r\n                            <p className=\"text-xs text-zinc-400 truncate max-w-[200px]\" title={error || undefined}>\r\n                                {error || 'An error occurred'}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                );\r\n\r\n            default:\r\n                return null;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed bottom-20 right-4 z-50 animate-in slide-in-from-right-5 fade-in duration-300\">\r\n            <div className=\"relative bg-zinc-900/95 backdrop-blur-xl border border-zinc-700 rounded-2xl shadow-2xl p-4 min-w-[320px] max-w-[400px]\">\r\n                {/* Close button */}\r\n                <button\r\n                    onClick={onDismiss}\r\n                    className=\"absolute top-2 right-2 p-1 rounded-full hover:bg-zinc-700/50 transition-colors text-zinc-400 hover:text-zinc-200\"\r\n                >\r\n                    <X className=\"w-4 h-4\" />\r\n                </button>\r\n\r\n                {renderContent()}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\ValidationModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\ValidationProgress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\ValidationResultsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\console\\ConsoleButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\detail\\GalleryImage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\detail\\LicenseHover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\detail\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\layout\\FiltersSidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\layout\\FloatingToolbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\layout\\Header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\layout\\MainLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\layout\\Toolbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\layout\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\settings\\APIConfigSection.tsx","messages":[{"ruleId":"prefer-const","severity":1,"message":"'headers' is never reassigned. Use 'const' instead.","line":251,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":251,"endColumn":42,"fix":{"range":[8833,8962],"text":"const headers: Record<string, string> = {\r\n        'Content-Type': 'application/json',\r\n        ...(config.headers || {})\r\n      };"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":353,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":353,"endColumn":20,"suggestions":[{"fix":{"range":[13084,13183],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'checkOllamaStatus' and 'settings.apiConfig.ollama.baseUrl'. Either include them or remove the dependency array.","line":428,"column":6,"nodeType":"ArrayExpression","endLine":428,"endColumn":43,"suggestions":[{"desc":"Update the dependencies array to be: [checkOllamaStatus, settings.apiConfig.ollama.baseUrl, settings.apiConfig.ollama?.enabled]","fix":{"range":[15952,15989],"text":"[checkOllamaStatus, settings.apiConfig.ollama.baseUrl, settings.apiConfig.ollama?.enabled]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import React, { useContext, useState, useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Server, Eye, EyeOff, RefreshCw, CheckCircle, AlertCircle, Check, Download, Plus } from 'lucide-react';\r\nimport ThemeContext from '../../context/ThemeContext';\r\nimport { useSettings } from '../../context/SettingsContext';\r\nimport { ThemedSelect } from '../ThemedSelect';\r\n\r\nexport function APIConfigSection() {\r\n  const { t } = useTranslation();\r\n  const { theme } = useContext(ThemeContext);\r\n  const { settings, saveSettings } = useSettings();\r\n\r\n  const apiProviders = [\r\n    {\r\n      key: 'ollama',\r\n      name: 'Ollama (Local)',\r\n      models: [],\r\n      showBaseUrl: true,\r\n      defaultBaseUrl: 'http://127.0.0.1:11434',\r\n      isLocal: true\r\n    },\r\n    {\r\n      key: 'anthropic',\r\n      name: 'Anthropic',\r\n      models: [\r\n        { value: 'claude-3-5-sonnet-20240620', label: 'Claude 3.5 Sonnet' },\r\n        { value: 'claude-3-opus-20240229', label: 'Claude 3 Opus' },\r\n        { value: 'claude-3-sonnet-20240229', label: 'Claude 3 Sonnet' },\r\n        { value: 'claude-3-haiku-20240307', label: 'Claude 3 Haiku' },\r\n      ],\r\n      showBaseUrl: false,\r\n      defaultBaseUrl: 'https://api.anthropic.com/v1'\r\n    },\r\n    {\r\n      key: 'openai',\r\n      name: 'OpenAI',\r\n      models: [\r\n        { value: 'gpt-4o', label: 'GPT-4o (Multimodal)' },\r\n        { value: 'gpt-4o-mini', label: 'GPT-4o Mini' },\r\n        { value: 'gpt-4-turbo', label: 'GPT-4 Turbo' },\r\n        { value: 'gpt-4', label: 'GPT-4' },\r\n      ],\r\n      showBaseUrl: true,\r\n      defaultBaseUrl: 'https://api.openai.com/v1'\r\n    },\r\n    {\r\n      key: 'google',\r\n      name: 'Google',\r\n      models: [\r\n        { value: 'gemini-1.5-pro', label: 'Gemini 1.5 Pro' },\r\n        { value: 'gemini-1.5-flash', label: 'Gemini 1.5 Flash' },\r\n        { value: 'gemini-1.0-pro', label: 'Gemini 1.0 Pro' },\r\n      ],\r\n      showBaseUrl: false,\r\n      defaultBaseUrl: 'https://generativelanguage.googleapis.com/v1beta'\r\n    },\r\n    {\r\n      key: 'deepseek',\r\n      name: 'DeepSeek',\r\n      models: [\r\n        { value: 'deepseek-chat', label: 'DeepSeek Chat' },\r\n        { value: 'deepseek-coder', label: 'DeepSeek Coder' },\r\n      ],\r\n      showBaseUrl: true,\r\n      defaultBaseUrl: 'https://api.deepseek.com/v1'\r\n    },\r\n    {\r\n      key: 'perplexity',\r\n      name: 'Perplexity',\r\n      models: [\r\n        { value: 'sonar-pro', label: 'Sonar Pro' },\r\n        { value: 'sonar', label: 'Sonar' },\r\n        { value: 'sonar-reasoning-pro', label: 'Sonar Reasoning Pro' },\r\n        { value: 'sonar-deep-research', label: 'Sonar Deep Research' },\r\n      ],\r\n      showBaseUrl: true,\r\n      defaultBaseUrl: 'https://api.perplexity.ai'\r\n    },\r\n    {\r\n      key: 'openrouter',\r\n      name: 'OpenRouter',\r\n      models: [\r\n        { value: 'openai/gpt-4o', label: 'OpenAI GPT-4o' },\r\n        { value: 'anthropic/claude-3.5-sonnet', label: 'Anthropic Claude 3.5 Sonnet' },\r\n        { value: 'meta-llama/llama-3-70b-instruct', label: 'Meta Llama 3 70B' },\r\n      ],\r\n      showBaseUrl: true,\r\n      defaultBaseUrl: 'https://openrouter.ai/api/v1'\r\n    },\r\n    {\r\n      key: 'cohere',\r\n      name: 'Cohere',\r\n      models: [\r\n        { value: 'command-r-plus', label: 'Command R+' },\r\n        { value: 'command-r', label: 'Command R' },\r\n        { value: 'command', label: 'Command' },\r\n      ],\r\n      showBaseUrl: false, // Cohere has specific endpoints but usually fixed\r\n      defaultBaseUrl: 'https://api.cohere.com/v1'\r\n    }\r\n  ];\r\n\r\n\r\n  const [showApiKeys, setShowApiKeys] = useState<Record<string, boolean>>({});\r\n  const [fetchingModels, setFetchingModels] = useState<Record<string, boolean>>({});\r\n  const [fetchError, setFetchError] = useState<Record<string, string>>({});\r\n  const [fetchedModels, setFetchedModels] = useState<Record<string, { value: string; label: string }[]>>({});\r\n  const [customProviderName, setCustomProviderName] = useState('');\r\n  const [customProviderBaseUrl, setCustomProviderBaseUrl] = useState('');\r\n  const [customProviderProtocol, setCustomProviderProtocol] = useState<'openai' | 'anthropic' | 'google' | 'ollama'>('openai');\r\n  const [customProviderHeaders, setCustomProviderHeaders] = useState('');\r\n\r\n  // Local state for API keys (buffered before save)\r\n  const [localApiKeys, setLocalApiKeys] = useState<Record<string, string>>({});\r\n\r\n  // Merge static and custom providers\r\n  const allProviders = [...apiProviders];\r\n  if (settings.apiConfig) {\r\n    Object.entries(settings.apiConfig).forEach(([key, config]) => {\r\n      if ((config as any).isCustom && !apiProviders.find(p => p.key === key)) {\r\n        allProviders.push({\r\n          key,\r\n          name: (config as any).name || key,\r\n          models: [],\r\n          showBaseUrl: true,\r\n          defaultBaseUrl: (config as any).baseUrl || ''\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  const handleAddCustomProvider = () => {\r\n    if (!customProviderName) return;\r\n    const key = customProviderName.toLowerCase().replace(/\\s+/g, '_');\r\n\r\n    if (settings.apiConfig?.[key]) {\r\n      alert(t('settings.apiConfig.custom.existsError'));\r\n      return;\r\n    }\r\n\r\n    let parsedHeaders = {};\r\n    try {\r\n      if (customProviderHeaders) {\r\n        parsedHeaders = JSON.parse(customProviderHeaders);\r\n      }\r\n    } catch (e) {\r\n      alert(t('settings.apiConfig.custom.jsonError'));\r\n      return;\r\n    }\r\n\r\n    saveSettings({\r\n      apiConfig: {\r\n        ...settings.apiConfig,\r\n        [key]: {\r\n          enabled: true,\r\n          name: customProviderName,\r\n          baseUrl: customProviderBaseUrl,\r\n          isCustom: true,\r\n          protocol: customProviderProtocol,\r\n          headers: parsedHeaders,\r\n          apiKey: '',\r\n          model: '',\r\n          cachedModels: []\r\n        }\r\n      }\r\n    });\r\n    setCustomProviderName('');\r\n    setCustomProviderBaseUrl('');\r\n    setCustomProviderProtocol('openai');\r\n    setCustomProviderHeaders('');\r\n  };\r\n\r\n  const handleDeleteCustomProvider = (key: string) => {\r\n    const newConfig = { ...settings.apiConfig };\r\n    delete newConfig[key];\r\n    saveSettings({ apiConfig: newConfig });\r\n  };\r\n\r\n  const bgCard = 'border-border bg-card text-text';\r\n  const bgInput = 'border-border bg-input text-text';\r\n\r\n\r\n\r\n  const toggleApiKeyVisibility = (provider: string) => {\r\n    setShowApiKeys(prev => ({\r\n      ...prev,\r\n      [provider]: !prev[provider]\r\n    }));\r\n  };\r\n\r\n  const updateApiConfig = (provider: string, field: string, value: any) => {\r\n    saveSettings({\r\n      apiConfig: {\r\n        ...settings.apiConfig,\r\n        [provider]: {\r\n          ...settings.apiConfig?.[provider as keyof typeof settings.apiConfig],\r\n          [field]: value\r\n        }\r\n      }\r\n    });\r\n  };\r\n\r\n  // Initialize fetched models from settings\r\n  useEffect(() => {\r\n    if (settings.apiConfig) {\r\n      const initialModels: Record<string, { value: string; label: string }[]> = {};\r\n      Object.entries(settings.apiConfig).forEach(([key, config]) => {\r\n        if ((config as any).cachedModels) {\r\n          initialModels[key] = (config as any).cachedModels;\r\n        }\r\n      });\r\n      setFetchedModels(prev => ({ ...prev, ...initialModels }));\r\n    }\r\n  }, [settings.apiConfig]);\r\n\r\n  const hasLocalKey = (provider: string) => {\r\n    const config = settings.apiConfig?.[provider as keyof typeof settings.apiConfig];\r\n    // Ollama doesn't strictly need a key, so we can relax this for 'ollama' protocol\r\n    if (config?.protocol === 'ollama') return true;\r\n    return !!(config?.apiKey && config.apiKey.trim() !== '');\r\n  };\r\n\r\n  // Get list of providers with valid API keys (or no key needed)\r\n  const availableProviders = allProviders.filter(provider => {\r\n    const config = settings.apiConfig?.[provider.key as keyof typeof settings.apiConfig];\r\n    return config?.enabled && hasLocalKey(provider.key);\r\n  });\r\n\r\n  const fetchModels = async (providerKey: string, newApiKey?: string) => {\r\n    const config = settings.apiConfig?.[providerKey as keyof typeof settings.apiConfig];\r\n    if (!config) return;\r\n\r\n    // Use provided key or stored key\r\n    const apiKeyToUse = newApiKey !== undefined ? newApiKey : config.apiKey;\r\n\r\n    // Check key unless protocol allows none\r\n    if (!apiKeyToUse && config.protocol !== 'ollama' && providerKey !== 'ollama') {\r\n      setFetchError(prev => ({ ...prev, [providerKey]: t('settings.apiConfig.errors.apiKeyRequired') }));\r\n      return;\r\n    }\r\n\r\n    setFetchingModels(prev => ({ ...prev, [providerKey]: true }));\r\n    setFetchError(prev => ({ ...prev, [providerKey]: '' }));\r\n\r\n    try {\r\n      const providerInfo = apiProviders.find(p => p.key === providerKey);\r\n      let baseUrl = config.baseUrl || providerInfo?.defaultBaseUrl || '';\r\n      // Ensure no trailing slash for consistent appending\r\n      if (baseUrl.endsWith('/')) baseUrl = baseUrl.slice(0, -1);\r\n\r\n      let headers: Record<string, string> = {\r\n        'Content-Type': 'application/json',\r\n        ...(config.headers || {})\r\n      };\r\n\r\n      // Determine protocol\r\n      // Default to 'openai' if 'other' is selected, as it's the most common \"custom\" format\r\n      let protocol = config.protocol || (['anthropic', 'google', 'ollama'].includes(providerKey) ? providerKey : 'openai');\r\n      if (protocol === 'other') protocol = 'openai';\r\n\r\n      let allModels: any[] = [];\r\n\r\n      if (protocol === 'anthropic') {\r\n        headers['x-api-key'] = apiKeyToUse || '';\r\n        headers['anthropic-version'] = '2023-06-01';\r\n        const params = new URLSearchParams();\r\n        params.append('limit', '100');\r\n\r\n        const url = `${baseUrl}/models?${params.toString()}`;\r\n        const result = await window.electronAPI?.proxyRequest?.({ url, method: 'GET', headers });\r\n        if (!result?.success) throw new Error(result?.error || t('settings.apiConfig.errors.fetchFailed'));\r\n        if (result.data.data) allModels = result.data.data;\r\n\r\n      } else if (protocol === 'google') {\r\n        const params = new URLSearchParams();\r\n        if (apiKeyToUse) params.append('key', apiKeyToUse);\r\n        params.append('pageSize', '100');\r\n\r\n        const url = `${baseUrl}/models?${params.toString()}`;\r\n        const googleHeaders = { ...headers }; // Ensure no auth header from other protocols\r\n        const result = await window.electronAPI?.proxyRequest?.({ url, method: 'GET', headers: googleHeaders });\r\n        if (!result?.success) throw new Error(result?.error || t('settings.apiConfig.errors.fetchFailed'));\r\n        if (result.data.models) allModels = result.data.models;\r\n\r\n\r\n      } else if (protocol === 'ollama') {\r\n        // Ollama native API\r\n        const url = `${baseUrl}/api/tags`; // Standard Ollama endpoint\r\n        const result = await window.electronAPI?.proxyRequest?.({ url, method: 'GET', headers });\r\n        if (!result?.success) throw new Error(result?.error || t('settings.apiConfig.errors.fetchFailed'));\r\n        // Response: { models: [ { name: 'llama2', ... } ] }\r\n        if (result.data.models) allModels = result.data.models;\r\n\r\n      } else {\r\n\r\n        // OpenAI Compatible (default)\r\n        if (apiKeyToUse) headers['Authorization'] = `Bearer ${apiKeyToUse}`;\r\n        const url = `${baseUrl}/models`;\r\n        const result = await window.electronAPI?.proxyRequest?.({ url, method: 'GET', headers });\r\n        if (!result?.success) throw new Error(result?.error || t('settings.apiConfig.errors.fetchFailed'));\r\n\r\n        if (Array.isArray(result.data)) {\r\n          allModels = result.data;\r\n        } else if (result.data.data && Array.isArray(result.data.data)) {\r\n          allModels = result.data.data;\r\n        } else {\r\n          // Fallback for some proxies that might return { models: [...] }\r\n          allModels = result.data.models || [];\r\n          console.warn('Unexpected response format:', result.data);\r\n        }\r\n      }\r\n\r\n      // Normalize to { value, label }\r\n      let modelList = allModels.map(m => {\r\n        // Anthropic: id, display_name\r\n        // Google: name (models/...), display_name\r\n        // OpenAI: id\r\n        // Ollama: name\r\n        let id = m.id || m.name;\r\n        // Clean Google ids\r\n        if (id && id.startsWith('models/')) id = id.replace('models/', '');\r\n\r\n        return {\r\n          value: id,\r\n          label: m.display_name || m.displayName || id // Fallback to ID if no name\r\n        };\r\n      });\r\n\r\n      // Filter out empty IDs\r\n      modelList = modelList.filter(m => m.value);\r\n\r\n      // Unique by value\r\n      modelList = Array.from(new Map(modelList.map(item => [item.value, item])).values());\r\n\r\n      // Sort\r\n      modelList.sort((a, b) => a.label.localeCompare(b.label));\r\n\r\n      if (modelList.length > 0) {\r\n        setFetchedModels(prev => ({ ...prev, [providerKey]: modelList }));\r\n\r\n        // Save to settings for persistence\r\n        saveSettings({\r\n          apiConfig: {\r\n            ...settings.apiConfig,\r\n            [providerKey]: {\r\n              ...config,\r\n              cachedModels: modelList,\r\n              apiKey: apiKeyToUse // Save the key if verification succeeded\r\n            }\r\n          }\r\n        });\r\n\r\n        console.log(`[API] Successfully fetched and cached ${modelList.length} models for ${providerKey}`);\r\n      } else {\r\n        throw new Error(t('settings.apiConfig.errors.noModelsFound'));\r\n      }\r\n\r\n    } catch (err: any) {\r\n      console.error(`Error fetching models for ${providerKey}:`, err);\r\n      setFetchError(prev => ({ ...prev, [providerKey]: err.message || t('settings.apiConfig.errors.genericFetchError') }));\r\n    } finally {\r\n      setFetchingModels(prev => ({ ...prev, [providerKey]: false }));\r\n      // Clear local key state if successful (it's now in settings) \r\n      // or keep it if failed? Actually, keep it so user can edit. \r\n      // If success, we sync from settings, so local state is redundant if we clear it.\r\n      // But we need to know whether to show local or settings.\r\n      // If we clear local, UI reverts to settings. Perfect.\r\n      if (newApiKey !== undefined) {\r\n        // Only clear if no error?\r\n        // We can't easily know here if we threw, because catch block handles it.\r\n        // But saveSettings happened inside try.\r\n        // Let's rely on the fact that if we saved, settings updated.\r\n      }\r\n    }\r\n  };\r\n\r\n  // Specific handler for Ollama status check\r\n  const [ollamaStatus, setOllamaStatus] = useState<'unknown' | 'checking' | 'running' | 'down'>('unknown');\r\n  const [ollamaModelCount, setOllamaModelCount] = useState<number>(0);\r\n\r\n  const checkOllamaStatus = async (baseUrl: string) => {\r\n    setOllamaStatus('checking');\r\n    try {\r\n      // Clean URL\r\n      const cleanUrl = baseUrl.replace(/\\/$/, '');\r\n      const result = await window.electronAPI?.proxyRequest?.({\r\n        url: `${cleanUrl}/api/tags`,\r\n        method: 'GET'\r\n      });\r\n\r\n      if (result?.success) {\r\n        setOllamaStatus('running');\r\n        setOllamaModelCount(result.data.models?.length || 0);\r\n        // Also update cached models list\r\n        if (result.data.models) {\r\n          const modelList = result.data.models.map((m: any) => ({\r\n            value: m.name,\r\n            label: m.name\r\n          }));\r\n          setFetchedModels(prev => ({ ...prev, ollama: modelList }));\r\n\r\n          // Update settings cache too\r\n          const oldConfig = settings.apiConfig?.ollama || {};\r\n          saveSettings({\r\n            apiConfig: {\r\n              ...settings.apiConfig,\r\n              ollama: {\r\n                ...oldConfig,\r\n                cachedModels: modelList\r\n              }\r\n            }\r\n          });\r\n        }\r\n      } else {\r\n        setOllamaStatus('down');\r\n      }\r\n    } catch (e) {\r\n      console.error('Ollama check failed:', e);\r\n      setOllamaStatus('down');\r\n    }\r\n  };\r\n\r\n  // Effect to auto-check Ollama if enabled\r\n  useEffect(() => {\r\n    if (settings.apiConfig?.ollama?.enabled) {\r\n      checkOllamaStatus(settings.apiConfig.ollama.baseUrl || 'http://127.0.0.1:11434');\r\n    }\r\n  }, [settings.apiConfig?.ollama?.enabled]);\r\n\r\n  const handleApiKeyChange = (key: string, value: string) => {\r\n    setLocalApiKeys(prev => ({ ...prev, [key]: value }));\r\n    // Clear error when typing\r\n    if (fetchError[key]) setFetchError(prev => ({ ...prev, [key]: '' }));\r\n  };\r\n\r\n  const handleSaveApiKey = (key: string) => {\r\n    const val = localApiKeys[key];\r\n    if (val === undefined) return;\r\n    fetchModels(key, val)\r\n      .then(() => {\r\n        // On success, clear local state so input falls back to saved settings\r\n        setLocalApiKeys(prev => {\r\n          const next = { ...prev };\r\n          delete next[key];\r\n          return next;\r\n        });\r\n      })\r\n      .catch(() => { }); // Error handled in fetchModels\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div>\r\n        <h3 className=\"text-lg font-semibold mb-2 flex items-center gap-2\">\r\n          <Server size={20} className=\"text-zinc-500\" />\r\n          {t('settings.apiConfig.title')}\r\n          <span className=\"px-2 py-0.5 text-[10px] font-bold bg-amber-500/20 text-amber-400 rounded-full uppercase\">{t('settings.apiConfig.alpha')}</span>\r\n        </h3>\r\n        <p className=\"text-sm text-zinc-700 dark:text-zinc-400\">\r\n          {t('settings.apiConfig.subtitle')}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Discovery Configuration */}\r\n      <div className={`rounded-xl border p-4 ${bgCard}`}>\r\n        <label className=\"flex items-center justify-between cursor-pointer group\">\r\n          <div>\r\n            <h4 className=\"font-medium text-base\">{t('settings.apiConfig.discovery.title')}</h4>\r\n            <p className=\"text-sm text-zinc-500 mt-1\">\r\n              {t('settings.apiConfig.discovery.description')}\r\n            </p>\r\n          </div>\r\n          <div className=\"relative flex items-center justify-center\">\r\n            <input\r\n              type=\"checkbox\"\r\n              checked={settings.dataSources?.llmDiscovery ?? false}\r\n              onChange={(e) => saveSettings({\r\n                dataSources: {\r\n                  ...settings.dataSources,\r\n                  llmDiscovery: e.target.checked\r\n                }\r\n              })}\r\n              className=\"sr-only\"\r\n            />\r\n            <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${settings.dataSources?.llmDiscovery\r\n              ? 'bg-accent border-accent'\r\n              : 'border-zinc-600 group-hover:border-zinc-500'\r\n              }`}>\r\n              {settings.dataSources?.llmDiscovery && <Check size={14} strokeWidth={3} className=\"text-white\" />}\r\n            </div>\r\n          </div>\r\n        </label>\r\n      </div>\r\n\r\n      {/* Preferred Provider Selection - only show if multiple providers are available */}\r\n      {availableProviders.length > 1 && (\r\n        <div className={`rounded-xl border p-4 ${bgCard}`}>\r\n          <div className=\"mb-3\">\r\n            <h4 className=\"font-medium mb-1\">{t('settings.apiConfig.preferredProvider.title')}</h4>\r\n            <div className=\"text-xs text-zinc-500 mb-2\">\r\n              {t('settings.apiConfig.preferredProvider.description')}\r\n            </div>\r\n            <ThemedSelect\r\n              value={settings.preferredModelProvider || availableProviders[0]?.key || ''}\r\n              onChange={(value) => saveSettings({ preferredModelProvider: value })}\r\n              options={availableProviders.map(p => ({\r\n                value: p.key,\r\n                label: p.name\r\n              }))}\r\n              ariaLabel={t('settings.apiConfig.preferredProvider.title')}\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n\r\n      {allProviders.map((provider) => {\r\n        const config = settings.apiConfig?.[provider.key as keyof typeof settings.apiConfig];\r\n        const isEnabled = config?.enabled ?? false;\r\n        const showKey = showApiKeys[provider.key] ?? false;\r\n        const modelsList = fetchedModels[provider.key] || provider.models;\r\n        const isCustom = (config as any)?.isCustom;\r\n        const protocol = (config as any)?.protocol || 'openai';\r\n\r\n        return (\r\n          <div key={provider.key} className={`rounded-xl border p-4 ${bgCard}`}>\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <label\r\n                htmlFor={`enable-${provider.key}`}\r\n                className=\"flex items-center gap-3 cursor-pointer flex-1 select-none group\"\r\n              >\r\n                <div className=\"relative flex items-center justify-center\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    id={`enable-${provider.key}`}\r\n                    checked={isEnabled}\r\n                    onChange={(e) => updateApiConfig(provider.key, 'enabled', e.target.checked)}\r\n                    className=\"sr-only\"\r\n                  />\r\n                  <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${isEnabled\r\n                    ? 'bg-accent border-accent'\r\n                    : 'border-zinc-600 group-hover:border-zinc-500'\r\n                    }`}>\r\n                    {isEnabled && <Check size={14} strokeWidth={3} className=\"text-white\" />}\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <h4 className={`font-medium text-lg transition-colors ${isEnabled ? 'text-white' : 'text-zinc-400'}`}>\r\n                    {provider.name}\r\n                    {isCustom && <span className=\"ml-2 text-xs bg-zinc-800 text-zinc-400 px-2 py-0.5 rounded\">{t('settings.apiConfig.provider.custom')}</span>}\r\n                    {(provider as any).isLocal && <span className=\"ml-2 text-xs bg-green-900/40 text-green-400 border border-green-800 px-2 py-0.5 rounded font-mono\">{t('settings.apiConfig.provider.runLocally')}</span>}\r\n                  </h4>\r\n                  {isCustom && <div className=\"text-xs text-zinc-500 uppercase tracking-wider font-bold mt-0.5\">{protocol}</div>}\r\n                </div>\r\n              </label>\r\n              {isCustom && (\r\n                <button\r\n                  onClick={() => handleDeleteCustomProvider(provider.key)}\r\n                  className=\"text-red-500 hover:text-red-400 text-sm px-3 py-1\"\r\n                >\r\n                  {t('settings.apiConfig.provider.delete')}\r\n                </button>\r\n              )}\r\n            </div>\r\n\r\n            {isEnabled && (\r\n              <div className=\"space-y-4\">\r\n\r\n                {/* Special Hand-Holding for Ollama Setup */}\r\n                {/* Special Hand-Holding for Ollama Setup */}\r\n                {(provider as any).isLocal && (\r\n                  <div className=\"bg-zinc-900/50 rounded-lg p-3 border border-zinc-800\">\r\n                    <div className=\"flex items-center justify-between mb-2\">\r\n                      <span className=\"text-sm font-medium text-zinc-300\">{t('settings.apiConfig.ollama.serviceStatus')}</span>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        {ollamaStatus === 'checking' && <span className=\"text-xs text-yellow-500 animate-pulse\">{t('settings.apiConfig.ollama.checking')}</span>}\r\n                        {ollamaStatus === 'running' && <span className=\"flex items-center gap-1 text-xs text-green-400\"><CheckCircle size={12} /> {t('settings.apiConfig.ollama.running')}</span>}\r\n                        {ollamaStatus === 'down' && <span className=\"flex items-center gap-1 text-xs text-red-400\"><AlertCircle size={12} /> {t('settings.apiConfig.ollama.down')}</span>}\r\n                        <button\r\n                          onClick={() => checkOllamaStatus(config?.baseUrl || 'http://127.0.0.1:11434')}\r\n                          className=\"p-1 hover:bg-zinc-700 rounded text-zinc-400\"\r\n                          title={t('settings.apiConfig.ollama.checkAgain')}\r\n                        >\r\n                          <RefreshCw size={12} className={ollamaStatus === 'checking' ? 'animate-spin' : ''} />\r\n                        </button>\r\n                        {/* Debug / verification tools */}\r\n                        <div className=\"flex border-l border-zinc-700 pl-2 ml-1 gap-1\">\r\n                          <button\r\n                            onClick={() => setOllamaStatus('down')}\r\n                            className=\"text-[10px] px-1.5 py-0.5 bg-zinc-800 text-zinc-500 hover:text-zinc-300 rounded\"\r\n                            title=\"Debug: Simulate 'Not Installed' state\"\r\n                          >\r\n                            {t('settings.apiConfig.ollama.debug.simMissing')}\r\n                          </button>\r\n                          <button\r\n                            onClick={() => { setOllamaStatus('running'); setOllamaModelCount(0); }}\r\n                            className=\"text-[10px] px-1.5 py-0.5 bg-zinc-800 text-zinc-500 hover:text-zinc-300 rounded\"\r\n                            title=\"Debug: Simulate 'No Models' state\"\r\n                          >\r\n                            {t('settings.apiConfig.ollama.debug.simEmpty')}\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {ollamaStatus === 'down' && (\r\n                      <div className=\"text-sm text-zinc-400 mb-2 p-2 bg-red-900/10 border border-red-900/30 rounded\">\r\n                        <p className=\"mb-2\">{t('settings.apiConfig.ollama.notRunning')}</p>\r\n                        <button\r\n                          onClick={() => window.electronAPI?.openExternal('https://ollama.com/download')}\r\n                          className=\"text-xs bg-red-600 hover:bg-red-500 text-white px-3 py-1.5 rounded transition-colors inline-flex items-center gap-1\"\r\n                        >\r\n                          {t('settings.apiConfig.ollama.downloadInstaller')} <Download size={12} />\r\n                        </button>\r\n                        <p className=\"mt-2 text-xs opacity-70\">{t('settings.apiConfig.ollama.installHint')}</p>\r\n                      </div>\r\n                    )}\r\n\r\n                    {ollamaStatus === 'running' && ollamaModelCount === 0 && (\r\n                      <div className=\"text-sm text-zinc-400 mb-2 p-2 bg-yellow-900/10 border border-yellow-900/30 rounded\">\r\n                        <p className=\"mb-2 text-yellow-500\">{t('settings.apiConfig.ollama.noModels')}</p>\r\n                        <p className=\"text-xs mb-2\">{t('settings.apiConfig.ollama.noModelsHint')}</p>\r\n                        <div className=\"bg-black/50 p-2 rounded border border-zinc-700 font-mono text-xs select-all text-zinc-300 mb-2\">\r\n                          ollama pull llama3\r\n                        </div>\r\n                        <p className=\"text-xs opacity-70\">{t('settings.apiConfig.ollama.copyCommandHint')}</p>\r\n                      </div>\r\n                    )}\r\n\r\n                    {ollamaStatus === 'running' && ollamaModelCount > 0 && (\r\n                      <div className=\"text-xs text-green-500/80 mb-2\">\r\n                        Ô£à {t('settings.apiConfig.ollama.connected', { count: ollamaModelCount })}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n\r\n                {/* ... API Key input ... */}\r\n                <div>\r\n                  <label className=\"block text-sm font-medium mb-2\">\r\n                    {t('settings.apiConfig.fields.apiKey')}\r\n                    {protocol === 'ollama' && <span className=\"text-zinc-500 font-normal ml-2\">{t('settings.apiConfig.fields.optionalForOllama')}</span>}\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <input\r\n                      type={showKey ? 'text' : 'password'}\r\n                      value={localApiKeys[provider.key] !== undefined ? localApiKeys[provider.key] : (config?.apiKey || '')}\r\n                      onChange={(e) => handleApiKeyChange(provider.key, e.target.value)}\r\n                      onKeyDown={(e) => {\r\n                        if (e.key === 'Enter') handleSaveApiKey(provider.key);\r\n                      }}\r\n                      placeholder={t('settings.apiConfig.fields.enterApiKey', { name: provider.name })}\r\n                      className={`w-full rounded-lg border ${bgInput} px-3 py-2 pr-24 text-sm ${localApiKeys[provider.key] !== undefined ? 'border-violet-500 ring-1 ring-violet-500' : ''}`}\r\n                    />\r\n                    <div className=\"absolute right-1 top-1/2 -translate-y-1/2 flex items-center gap-1\">\r\n                      {localApiKeys[provider.key] !== undefined && (\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => handleSaveApiKey(provider.key)}\r\n                          disabled={fetchingModels[provider.key]}\r\n                          className=\"px-2 py-1 text-xs bg-violet-600 hover:bg-violet-700 text-white rounded shadow-sm mr-1 disabled:opacity-50\"\r\n                        >\r\n                          {fetchingModels[provider.key] ? t('settings.apiConfig.fields.verifying') : t('settings.apiConfig.fields.save')}\r\n                        </button>\r\n                      )}\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => toggleApiKeyVisibility(provider.key)}\r\n                        className=\"text-zinc-500 hover:text-zinc-300 transition-colors p-1\"\r\n                      >\r\n                        {showKey ? <EyeOff size={16} /> : <Eye size={16} />}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* ... Model input ... */}\r\n                <div>\r\n                  <label className=\"block text-sm font-medium mb-2\">{t('settings.apiConfig.fields.model')}</label>\r\n                  <div className=\"flex gap-2\">\r\n                    <div className=\"relative flex-1\">\r\n                      <ThemedSelect\r\n                        value={config?.model || ''}\r\n                        onChange={(val) => updateApiConfig(provider.key, 'model', val)}\r\n                        options={modelsList?.length > 0 ? modelsList : [{ value: '', label: t('settings.apiConfig.fields.noModelsFetched') }]}\r\n                        placeholder={t('settings.apiConfig.fields.selectModel')}\r\n                        ariaLabel=\"Model selection\"\r\n                      />\r\n                    </div>\r\n                    <button\r\n                      onClick={() => {\r\n                        // This effectively validates and saves the key if a new one is typed\r\n                        const localKey = localApiKeys[provider.key];\r\n                        if (localKey !== undefined) {\r\n                          handleSaveApiKey(provider.key);\r\n                        } else {\r\n                          fetchModels(provider.key);\r\n                          // Also refresh status for Ollama\r\n                          if ((provider as any).isLocal) checkOllamaStatus(config?.baseUrl || 'http://127.0.0.1:11434');\r\n                        }\r\n                      }}\r\n                      disabled={fetchingModels[provider.key] || ((!config?.apiKey && !localApiKeys[provider.key]) && protocol !== 'ollama')}\r\n                      className={`px-3 rounded-lg border flex items-center gap-2 transition-colors ${fetchingModels[provider.key]\r\n                        ? 'bg-zinc-800 text-zinc-500 border-zinc-800'\r\n                        : 'bg-zinc-800 hover:bg-zinc-700 text-zinc-300 border-zinc-700'\r\n                        }`}\r\n                      title={t('settings.apiConfig.fields.fetchModelsTooltip')}\r\n                    >\r\n                      <RefreshCw size={16} className={fetchingModels[provider.key] ? 'animate-spin' : ''} />\r\n                    </button>\r\n                  </div>\r\n                  {/* ... Fetch status ... */}\r\n                  {fetchError[provider.key] && (\r\n                    <div className=\"mt-1 flex items-center gap-1 text-red-500 text-xs\">\r\n                      <AlertCircle size={12} />\r\n                      <span>{fetchError[provider.key]}</span>\r\n                    </div>\r\n                  )}\r\n                  {fetchedModels[provider.key] && !fetchError[provider.key] && (\r\n                    <div className=\"mt-1 flex items-center gap-1 text-green-500 text-xs\">\r\n                      <CheckCircle size={12} />\r\n                      <span>{t('settings.apiConfig.fields.fetchedModels', { count: fetchedModels[provider.key].length })}</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* ... Base URL input ... */}\r\n                {((provider as any).showBaseUrl || isCustom) && (\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">{t('settings.apiConfig.fields.baseUrl')}</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={config?.baseUrl || (provider as any).defaultBaseUrl}\r\n                      onChange={(e) => updateApiConfig(provider.key, 'baseUrl', e.target.value)}\r\n                      placeholder={(provider as any).defaultBaseUrl || \"https://api.example.com/v1\"}\r\n                      className={`w-full rounded-lg border ${bgInput} px-3 py-2 text-sm`}\r\n                    />\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        );\r\n      })}\r\n\r\n      {/* Add Custom Provider Form */}\r\n      <div className={`rounded-xl border p-4 ${bgCard} border-dashed border-zinc-700`}>\r\n        <div className=\"mb-4\">\r\n          <h4 className=\"font-medium flex items-center gap-2 mb-1\">\r\n            <Plus size={16} /> {t('settings.apiConfig.custom.title')}\r\n          </h4>\r\n          <p className=\"text-xs text-zinc-500\">\r\n            {t('settings.apiConfig.custom.description')}\r\n          </p>\r\n        </div>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium mb-1\">{t('settings.apiConfig.fields.providerName')}</label>\r\n            <input\r\n              type=\"text\"\r\n              value={customProviderName}\r\n              onChange={(e) => setCustomProviderName(e.target.value)}\r\n              placeholder={t('settings.apiConfig.fields.providerNamePlaceholder')}\r\n              className={`w-full rounded-lg border ${bgInput} px-3 py-2 text-sm`}\r\n            />\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium mb-1\">{t('settings.apiConfig.fields.protocol')}</label>\r\n            <ThemedSelect\r\n              value={customProviderProtocol}\r\n              onChange={(val) => setCustomProviderProtocol(val as any)}\r\n              options={[\r\n                { value: 'openai', label: 'Standard / OpenAI Compatible' },\r\n                { value: 'anthropic', label: 'Anthropic Compatible' },\r\n                { value: 'ollama', label: 'Ollama Native' },\r\n                { value: 'google', label: 'Google Gemini' },\r\n                { value: 'other', label: 'Other / Custom (Generic)' }\r\n              ]}\r\n              ariaLabel=\"Protocol\"\r\n            />\r\n          </div>\r\n          <div className=\"md:col-span-2\">\r\n            <label className=\"block text-sm font-medium mb-1\">{t('settings.apiConfig.fields.baseUrl')}</label>\r\n            <input\r\n              type=\"text\"\r\n              value={customProviderBaseUrl}\r\n              onChange={(e) => setCustomProviderBaseUrl(e.target.value)}\r\n              placeholder=\"https://api.example.com/v1\"\r\n              className={`w-full rounded-lg border ${bgInput} px-3 py-2 text-sm`}\r\n            />\r\n          </div>\r\n          <div className=\"md:col-span-2\">\r\n            <label className=\"block text-sm font-medium mb-1\">\r\n              {t('settings.apiConfig.fields.customHeaders')} <span className=\"text-zinc-500 font-normal text-xs\">{t('settings.apiConfig.fields.optionalJson')}</span>\r\n            </label>\r\n            <textarea\r\n              value={customProviderHeaders}\r\n              onChange={(e) => setCustomProviderHeaders(e.target.value)}\r\n              placeholder={t('settings.apiConfig.fields.headersPlaceholder')}\r\n              className={`w-full rounded-lg border ${bgInput} px-3 py-2 text-sm font-mono h-16`}\r\n            />\r\n          </div>\r\n        </div>\r\n        <button\r\n          onClick={handleAddCustomProvider}\r\n          disabled={!customProviderName}\r\n          className=\"w-full py-2 bg-zinc-800 hover:bg-zinc-700 disabled:opacity-50 text-white rounded-lg transition-colors font-medium border border-zinc-700\"\r\n        >\r\n          {t('settings.apiConfig.custom.addProvider')}\r\n        </button>\r\n      </div>\r\n\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\settings\\DataSourcesSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\settings\\DisplaySection.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'allPresets', 'setCustomColors', 'setCustomCss', and 'setTheme'. Either include them or remove the dependency array.","line":71,"column":6,"nodeType":"ArrayExpression","endLine":71,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [activePresetId, allPresets, setCustomColors, setCustomCss, setTheme]","fix":{"range":[2860,2876],"text":"[activePresetId, allPresets, setCustomColors, setCustomCss, setTheme]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useContext, useRef, useState, useMemo, useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Palette, Check, Upload, RotateCcw, Trash2, Edit2, Save, Download, AlertTriangle, Globe } from 'lucide-react';\r\nimport ThemeContext, { ThemePreset } from '../../context/ThemeContext';\r\nimport { useSettings } from '../../context/SettingsContext';\r\nimport { RoundCheckbox } from '../RoundCheckbox';\r\nimport { ThemedSelect } from '../ThemedSelect';\r\nimport { CURRENCY_NAMES, CurrencyCode } from '../../utils/currency';\r\nimport { LanguageSelector } from './LanguageSelector';\r\n\r\nimport { SYSTEM_PRESETS, TEMPLATE_CSS } from '../../data/themePresets';\r\n\r\n\r\nexport function DisplaySection() {\r\n  const { t } = useTranslation();\r\n  const {\r\n    theme, toggleTheme, setTheme,\r\n    customColors, setCustomColors, resetColors,\r\n    customCss, setCustomCss,\r\n    savedPresets, addPreset, deletePreset, updatePreset,\r\n    activePresetId, applyPreset\r\n  } = useContext(ThemeContext);\r\n\r\n  const { settings, saveSettings } = useSettings();\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const [isRenaming, setIsRenaming] = useState(false);\r\n  const [renameValue, setRenameValue] = useState('');\r\n  const [uploadFeedback, setUploadFeedback] = useState<{ type: 'success' | 'warning'; message: string } | null>(null);\r\n\r\n  const bgCard = 'border-zinc-800 bg-black';\r\n\r\n  const allPresets = useMemo(() => [...SYSTEM_PRESETS, ...savedPresets], [savedPresets]);\r\n\r\n  const activePreset = allPresets.find(p => p.id === displayPresetId()) || SYSTEM_PRESETS[0];\r\n\r\n  function displayPresetId() {\r\n    if (activePresetId) return activePresetId;\r\n    return 'none';\r\n  }\r\n\r\n  // Sync preset colors/CSS only when user explicitly changes preset, not on mount\r\n  // Using refs to track state changes vs initial mount\r\n  const prevPresetIdRef = useRef<string | null>(activePresetId);\r\n  const isInitialMountRef = useRef(true);\r\n\r\n  useEffect(() => {\r\n    // Skip applying preset on initial mount - colors are already loaded from localStorage\r\n    if (isInitialMountRef.current) {\r\n      isInitialMountRef.current = false;\r\n      prevPresetIdRef.current = activePresetId;\r\n      return;\r\n    }\r\n\r\n    // Only run when activePresetId actually changes to a new value\r\n    if (activePresetId && activePresetId !== prevPresetIdRef.current) {\r\n      const preset = allPresets.find(p => p.id === activePresetId);\r\n      if (preset) {\r\n        // Apply the preset's CSS\r\n        setCustomCss(preset.css);\r\n        // Apply the preset's colors (this populates the color pickers)\r\n        if (preset.colors) {\r\n          setCustomColors(preset.colors);\r\n        }\r\n        // Apply the preset's mode (light/dark)\r\n        if (preset.mode) {\r\n          setTheme(preset.mode);\r\n        }\r\n      }\r\n    }\r\n    prevPresetIdRef.current = activePresetId;\r\n  }, [activePresetId]); // Only depend on activePresetId\r\n\r\n  const handleDownloadTemplate = () => {\r\n    const blob = new Blob([TEMPLATE_CSS], { type: 'text/css' });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = 'theme-template.css';\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(url);\r\n  };\r\n\r\n  const handlePresetChange = (id: string) => {\r\n    const preset = allPresets.find(p => p.id === id);\r\n    if (!preset) return;\r\n    applyPreset(id);\r\n    setCustomCss(preset.css);\r\n    if (preset.colors) setCustomColors(preset.colors);\r\n    if (preset.mode) setTheme(preset.mode);\r\n  };\r\n\r\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n    const reader = new FileReader();\r\n    reader.onload = (ev) => {\r\n      const content = ev.target?.result as string;\r\n      if (content) {\r\n        // Check if CSS uses variable references\r\n        const usesVariables = content.includes('var(--');\r\n        const hasAccent = content.includes('--accent');\r\n        const hasBg = content.includes('--bg');\r\n        const hasText = content.includes('--text');\r\n\r\n        const newPreset: ThemePreset = {\r\n          id: `custom-${Date.now()}`,\r\n          name: file.name.replace('.css', '') || 'Custom Preset',\r\n          css: content,\r\n          colors: customColors,\r\n          isSystem: false\r\n        };\r\n        addPreset(newPreset);\r\n        handlePresetChange(newPreset.id);\r\n\r\n        // Show appropriate feedback\r\n        if (usesVariables && (hasAccent || hasBg || hasText)) {\r\n          setUploadFeedback({\r\n            type: 'success',\r\n            message: 'Ô£ô Theme uploaded! Use the color pickers above to customize colors.'\r\n          });\r\n        } else {\r\n          setUploadFeedback({\r\n            type: 'warning',\r\n            message: 'ÔÜá Theme uploaded, but no CSS variables detected. Colors may not be customizable. Download the template for guidance.'\r\n          });\r\n        }\r\n\r\n        // Auto-hide feedback after 8 seconds\r\n        setTimeout(() => setUploadFeedback(null), 8000);\r\n      }\r\n    };\r\n    reader.readAsText(file);\r\n    if (fileInputRef.current) fileInputRef.current.value = '';\r\n  };\r\n\r\n\r\n  const handleRename = () => {\r\n    if (activePreset.isSystem) return;\r\n    updatePreset(activePreset.id, { name: renameValue });\r\n    setIsRenaming(false);\r\n  };\r\n\r\n  const startRename = () => {\r\n    setRenameValue(activePreset.name);\r\n    setIsRenaming(true);\r\n  };\r\n\r\n  const updateColor = (key: keyof typeof customColors, value: string) => {\r\n    setCustomColors({ ...customColors, [key]: value });\r\n    if (activePresetId && !activePreset.isSystem) {\r\n      updatePreset(activePresetId, {\r\n        colors: { ...customColors, [key]: value }\r\n      });\r\n    }\r\n  };\r\n\r\n  const displayOptions = [\r\n    {\r\n      key: 'showConsoleButton',\r\n      label: t('settings.display.showConsoleButton'),\r\n      description: t('settings.display.showConsoleButtonDesc')\r\n    },\r\n    {\r\n      key: 'autoExpandSections',\r\n      label: t('settings.display.autoExpandSections'),\r\n      description: t('settings.display.autoExpandSectionsDesc')\r\n    }\r\n  ];\r\n\r\n  const currencyOptions = Object.entries(CURRENCY_NAMES).map(([code, name]) => ({\r\n    value: code,\r\n    label: `${code} - ${name} `\r\n  }));\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div>\r\n        <h3 className=\"text-lg font-semibold mb-2 flex items-center gap-2\">\r\n          <Palette size={20} className=\"text-zinc-500\" />\r\n          {t('settings.display.title')}\r\n        </h3>\r\n        <p className=\"text-sm text-zinc-600 dark:text-zinc-400\">\r\n          {t('settings.display.description')}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Language Settings */}\r\n      <div className={`rounded-xl border p-4 ${bgCard}`}>\r\n        <h4 className=\"font-medium mb-4 flex items-center gap-2\">\r\n          <Globe size={16} className=\"text-zinc-500\" />\r\n          {t('settings.display.language')}\r\n        </h4>\r\n        <LanguageSelector />\r\n      </div>\r\n\r\n      {/* UI Customization */}\r\n      <div className={`rounded-xl border p-4 ${bgCard}`}>\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h4 className=\"font-medium\">{t('settings.display.customColors')}</h4>\r\n          <div className=\"flex items-center gap-2\">\r\n            {activePresetId && !activePreset.isSystem && (\r\n              <span className=\"text-[10px] text-zinc-500 bg-zinc-900 px-2 py-1 rounded border border-zinc-800\">\r\n                {t('settings.display.autoSaving')}\r\n              </span>\r\n            )}\r\n            <button\r\n              onClick={() => {\r\n                // Reset to the active preset's colors, not global defaults\r\n                if (activePreset?.colors) {\r\n                  setCustomColors(activePreset.colors);\r\n                } else {\r\n                  resetColors();\r\n                }\r\n              }}\r\n              className=\"text-xs flex items-center gap-1 px-3 py-1.5 rounded border border-zinc-700 text-zinc-500 hover:text-zinc-300 transition-colors\"\r\n              title={`${t('common.reset')} ${activePreset?.name || 'default'}`}\r\n            >\r\n              <RotateCcw size={12} /> {t('common.reset')}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Color Pickers Grid */}\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-6\">\r\n          {[\r\n            { label: t('settings.display.accentColor'), key: 'accent', desc: t('settings.display.accentColorDesc') },\r\n            { label: t('settings.display.background'), key: 'background', desc: t('settings.display.backgroundDesc') },\r\n            { label: t('settings.display.cardBackground'), key: 'card', desc: t('settings.display.cardBackgroundDesc') },\r\n            { label: t('settings.display.textColor'), key: 'text', desc: t('settings.display.textColorDesc') },\r\n            { label: t('settings.display.borderColor'), key: 'border', desc: t('settings.display.borderColorDesc') }\r\n          ].map(({ label, key, desc }) => (\r\n            <div key={key} className=\"flex items-start gap-3 p-3 rounded-lg border border-zinc-800/50 bg-zinc-900/20\">\r\n              <input\r\n                type=\"color\"\r\n                value={customColors[key as keyof typeof customColors] || '#000000'}\r\n                onChange={(e) => updateColor(key as keyof typeof customColors, e.target.value)}\r\n                className=\"rounded-lg border border-zinc-700 cursor-pointer shrink-0 shadow-sm transition-transform hover:scale-105\"\r\n                style={{\r\n                  width: '48px',\r\n                  height: '48px',\r\n                  padding: 0,\r\n                  appearance: 'none',\r\n                  WebkitAppearance: 'none',\r\n                  border: 'none'\r\n                }}\r\n                title={`Choose ${label} `}\r\n              />\r\n              <div className=\"flex-1 min-w-0\">\r\n                <label className=\"block text-sm font-medium mb-0.5\">{label}</label>\r\n                <p className=\"text-[10px] text-zinc-500 mb-2 truncate\">{desc}</p>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span className=\"text-zinc-500 text-xs font-mono select-none\">#</span>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={(customColors[key as keyof typeof customColors] || '#000000').replace('#', '')}\r\n                    onChange={(e) => updateColor(key as keyof typeof customColors, `#${e.target.value.replace('#', '')} `)}\r\n                    className=\"flex-1 bg-transparent text-xs font-mono text-zinc-300 focus:ring-0 focus:outline-none\"\r\n                    spellCheck={false}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Style Presets & Custom CSS */}\r\n      <div className={`rounded-xl border p-4 ${bgCard}`}>\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h4 className=\"font-medium\">{t('settings.display.interfaceStyle')}</h4>\r\n          {/* Custom Preset Management Actions */}\r\n          {!activePreset.isSystem && (\r\n            <div className=\"flex items-center gap-2\">\r\n              {isRenaming ? (\r\n                <div className=\"flex items-center gap-1\">\r\n                  <input\r\n                    type=\"text\"\r\n                    value={renameValue}\r\n                    onChange={(e) => setRenameValue(e.target.value)}\r\n                    className=\"bg-zinc-900 border border-zinc-700 px-2 py-1 rounded text-xs\"\r\n                    autoFocus\r\n                    onKeyDown={(e) => e.key === 'Enter' && handleRename()}\r\n                  />\r\n                  <button onClick={handleRename} className=\"p-1 hover:text-green-400\"><Save size={14} /></button>\r\n                </div>\r\n              ) : (\r\n                <button onClick={startRename} className=\"p-1 text-zinc-500 hover:text-zinc-300\" title=\"Rename Preset\"><Edit2 size={14} /></button>\r\n              )}\r\n              <button onClick={() => deletePreset(activePreset.id)} className=\"p-1 text-zinc-500 hover:text-red-400\" title=\"Delete Preset\"><Trash2 size={14} /></button>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"space-y-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium mb-2\">{t('settings.display.stylePreset')}</label>\r\n            <ThemedSelect\r\n              value={activePreset.id}\r\n              onChange={handlePresetChange}\r\n              options={allPresets.map(p => ({\r\n                value: p.id,\r\n                label: (p.isSystem ? t(`settings.display.presets.${p.id === 'none' ? 'default' : p.id}`) : p.name) + (p.isSystem ? '' : t('settings.display.customSuffix'))\r\n              }))}\r\n              ariaLabel={t('settings.display.stylePreset')}\r\n            />\r\n            <p className=\"text-xs text-zinc-500 mt-2\">\r\n              {t('settings.display.stylePresetHint')}\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"pt-2 border-t border-zinc-800/50\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <h5 className=\"text-sm font-medium mb-1\">{t('settings.display.uploadNewStyle')}</h5>\r\n                <p className=\"text-xs text-zinc-500\">{t('settings.display.uploadNewStyleHint')}</p>\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <button\r\n                  onClick={handleDownloadTemplate}\r\n                  className=\"text-xs flex items-center gap-2 text-zinc-400 hover:text-zinc-200 px-3 py-2 rounded-lg transition-all hover:bg-zinc-800\"\r\n                  title=\"Download formatting template\"\r\n                >\r\n                  <Download size={14} />\r\n                  {t('settings.display.template')}\r\n                </button>\r\n                <input\r\n                  type=\"file\"\r\n                  ref={fileInputRef}\r\n                  className=\"hidden\"\r\n                  accept=\".css\"\r\n                  onChange={handleFileUpload}\r\n                />\r\n                <button\r\n                  onClick={() => fileInputRef.current?.click()}\r\n                  className=\"text-xs flex items-center gap-2 bg-zinc-800 hover:bg-zinc-700 border border-zinc-700 hover:border-zinc-600 px-3 py-2 rounded-lg transition-all\"\r\n                >\r\n                  <Upload size={14} />\r\n                  {t('settings.display.uploadCSS')}\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Upload Feedback Message */}\r\n            {uploadFeedback && (\r\n              <div className={`mt-3 p-3 rounded-lg text-sm flex items-start gap-2 ${uploadFeedback.type === 'success'\r\n                ? 'bg-green-900/30 border border-green-700/50 text-green-300'\r\n                : 'bg-amber-900/30 border border-amber-700/50 text-amber-300'\r\n                }`}>\r\n                {uploadFeedback.type === 'warning' && <AlertTriangle size={16} className=\"shrink-0 mt-0.5\" />}\r\n                <span>{uploadFeedback.message}</span>\r\n                <button\r\n                  onClick={() => setUploadFeedback(null)}\r\n                  className=\"ml-auto text-xs opacity-60 hover:opacity-100\"\r\n                >\r\n                  Ô£ò\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Currency Settings */}\r\n      <div className={`rounded-xl border p-4 ${bgCard}`}>\r\n        <h4 className=\"font-medium mb-4\">{t('settings.display.currencyAndCosts')}</h4>\r\n        <div className=\"space-y-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium mb-2\">{t('settings.display.defaultCurrency')}</label>\r\n            <ThemedSelect\r\n              value={settings.currency || 'USD'}\r\n              onChange={(value) => saveSettings({ currency: value as CurrencyCode })}\r\n              options={currencyOptions}\r\n              ariaLabel=\"Default currency\"\r\n            />\r\n          </div>\r\n\r\n          <label htmlFor=\"showCostValidation\" className=\"flex items-center gap-3 cursor-pointer group select-none\">\r\n            <RoundCheckbox\r\n              checked={settings.showCostValidation ?? true}\r\n              onChange={(checked) => saveSettings({ showCostValidation: checked })}\r\n              size=\"lg\"\r\n              ariaLabel={t('settings.display.showCostValidation')}\r\n            />\r\n            <span className=\"text-sm\">\r\n              {t('settings.display.showCostValidation')}\r\n            </span>\r\n          </label>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Display Options */}\r\n      <div className={`rounded-xl border p-4 ${bgCard}`}>\r\n        <h4 className=\"font-medium mb-4\">{t('settings.display.interfaceOptions')}</h4>\r\n        <div className=\"space-y-4\">\r\n          {displayOptions.map((option) => (\r\n            <label key={option.key} htmlFor={option.key} className=\"flex items-start gap-3 cursor-pointer group select-none\">\r\n              <div className=\"relative mt-0.5\">\r\n                <RoundCheckbox\r\n                  checked={Boolean(settings[option.key as keyof typeof settings]) ?? true}\r\n                  onChange={(checked) => saveSettings({ [option.key]: checked })}\r\n                  size=\"lg\"\r\n                  ariaLabel={option.label}\r\n                />\r\n              </div>\r\n              <div className=\"flex-1\">\r\n                <div className=\"font-medium text-sm\">\r\n                  {option.label}\r\n                </div>\r\n                <p className=\"text-xs text-zinc-600 dark:text-zinc-400 mt-1\">\r\n                  {option.description}\r\n                </p>\r\n              </div>\r\n            </label>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Page Size Settings */}\r\n      <div className={`rounded-xl border p-4 ${bgCard}`}>\r\n        <h4 className=\"font-medium mb-4\">{t('settings.display.pagination')}</h4>\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-2\">{t('settings.display.defaultPageSize')}</label>\r\n          <ThemedSelect\r\n            value={String(settings.defaultPageSize || 50)}\r\n            onChange={(value) => saveSettings({ defaultPageSize: parseInt(value) })}\r\n            options={[\r\n              { value: '50', label: '50 items per page' },\r\n              { value: '100', label: '100 items per page' },\r\n              { value: '500', label: '500 items per page' },\r\n              { value: '0', label: 'Show all items' }\r\n            ]}\r\n            ariaLabel=\"Default page size\"\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\settings\\HistorySection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\settings\\LanguageSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\settings\\ProviderCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\settings\\SecuritySection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\settings\\SystemHealthSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\settings\\SystemSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\settings\\ValidationSection.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 't'. Either include it or remove the dependency array.","line":28,"column":6,"nodeType":"ArrayExpression","endLine":28,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [settings.apiConfig, t]","fix":{"range":[1019,1039],"text":"[settings.apiConfig, t]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useContext, useMemo } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Shield, CheckCircle, Check } from 'lucide-react';\r\nimport ThemeContext from '../../context/ThemeContext';\r\nimport { useSettings } from '../../context/SettingsContext';\r\nimport { ThemedSelect } from '../ThemedSelect';\r\n\r\nexport function ValidationSection() {\r\n  const { t } = useTranslation();\r\n  const { theme } = useContext(ThemeContext);\r\n  const { settings, saveSettings } = useSettings();\r\n\r\n  const bgCard = 'border-border bg-card text-text';\r\n\r\n  const providerOptions = useMemo(() => {\r\n    const opts = [{ value: '', label: t('settings.validation.autoDetect') }];\r\n    if (settings.apiConfig) {\r\n      Object.entries(settings.apiConfig).forEach(([key, cfg]) => {\r\n        if ((cfg as any).enabled) {\r\n          opts.push({\r\n            value: key,\r\n            label: (cfg as any).name || key.charAt(0).toUpperCase() + key.slice(1)\r\n          });\r\n        }\r\n      });\r\n    }\r\n    return opts;\r\n  }, [settings.apiConfig]);\r\n\r\n  const validationOptions = [\r\n    {\r\n      key: 'showCostValidation',\r\n      label: t('settings.validation.options.showCostValidation'),\r\n      description: t('settings.validation.options.showCostValidationDesc')\r\n    },\r\n    {\r\n      key: 'autoMergeDuplicates',\r\n      label: t('settings.validation.options.autoMergeDuplicates'),\r\n      description: t('settings.validation.options.autoMergeDuplicatesDesc')\r\n    },\r\n    {\r\n      key: 'showImportToast',\r\n      label: t('settings.validation.options.showImportToast'),\r\n      description: t('settings.validation.options.showImportToastDesc')\r\n    }\r\n  ];\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div>\r\n        <h3 className=\"text-lg font-semibold mb-2 flex items-center gap-2\">\r\n          <Shield size={20} className=\"text-zinc-500\" />\r\n          {t('settings.validation.title')}\r\n          <span className=\"px-2 py-0.5 text-[10px] font-bold bg-amber-500/20 text-amber-400 rounded-full uppercase\">{t('settings.apiConfig.alpha')}</span>\r\n        </h3>\r\n        <p className=\"text-sm text-zinc-700 dark:text-zinc-400\">\r\n          {t('settings.validation.description')}\r\n        </p>\r\n      </div>\r\n\r\n      <div className={`rounded-xl border p-4 ${bgCard}`}>\r\n        <h4 className=\"font-medium mb-4\">{t('settings.validation.preferredProvider')}</h4>\r\n        <p className=\"text-xs text-zinc-500 mb-3\">\r\n          {t('settings.validation.preferredProviderDesc')}\r\n        </p>\r\n        <ThemedSelect\r\n          value={settings.preferredModelProvider || ''}\r\n          onChange={(val: string) => saveSettings({ preferredModelProvider: val })}\r\n          options={providerOptions}\r\n          ariaLabel=\"Preferred Provider\"\r\n        />\r\n      </div>\r\n\r\n      <div className={`rounded-xl border p-4 ${bgCard}`}>\r\n        <h4 className=\"font-medium mb-4\">{t('settings.validation.optionsTitle')}</h4>\r\n        <div className=\"space-y-4\">\r\n          {validationOptions.map((option) => (\r\n            <label key={option.key} htmlFor={option.key} className=\"flex items-start gap-3 cursor-pointer group select-none\">\r\n              <div className=\"relative mt-1\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  id={option.key}\r\n                  checked={Boolean(settings[option.key as keyof typeof settings]) ?? true}\r\n                  onChange={(e) => saveSettings({ [option.key]: e.target.checked })}\r\n                  className=\"sr-only\"\r\n                />\r\n                <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${(Boolean(settings[option.key as keyof typeof settings]) ?? true)\r\n                  ? 'bg-accent border-accent'\r\n                  : 'border-zinc-600 group-hover:border-zinc-500'\r\n                  }`}>\r\n                  {(Boolean(settings[option.key as keyof typeof settings]) ?? true) && <Check size={14} strokeWidth={3} className=\"text-white\" />}\r\n                </div>\r\n              </div>\r\n              <div className=\"flex-1\">\r\n                <div className=\"font-medium text-sm\">\r\n                  {option.label}\r\n                </div>\r\n                <p className=\"text-xs text-zinc-700 dark:text-zinc-400 mt-1\">\r\n                  {option.description}\r\n                </p>\r\n              </div>\r\n            </label>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      <div className={`rounded-xl border p-4 ${bgCard}`}>\r\n        <h4 className=\"font-medium mb-4\">{t('settings.validation.batchProcessing')}</h4>\r\n        <div className=\"space-y-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium mb-2\">{t('settings.validation.batchSize')}</label>\r\n            <input\r\n              type=\"number\"\r\n              value={settings.validationBatchSize || 50}\r\n              onChange={(e) => saveSettings({ validationBatchSize: parseInt(e.target.value) || 50 })}\r\n              className=\"w-full rounded-lg border px-3 py-2 text-sm border-border bg-input text-text\"\r\n              min=\"1\"\r\n              max=\"200\"\r\n            />\r\n            <p className=\"text-xs text-zinc-700 dark:text-zinc-400 mt-1\">\r\n              Number of models to validate in each batch (1-200)\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className={`rounded-xl border p-4 ${bgCard}`}>\r\n        <div className=\"flex items-center gap-2 mb-3\">\r\n          <CheckCircle size={16} className=\"text-accent\" />\r\n          <h4 className=\"font-medium\">{t('settings.validation.statusTitle')}</h4>\r\n        </div>\r\n        <p className=\"text-sm text-zinc-700 dark:text-zinc-400\">\r\n          {t('settings.validation.statusDesc')}\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\settings\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\table\\LazyLoadSentinel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\table\\ModelTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\table\\TableHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\toasts\\ImportToast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\toasts\\ToastContainer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\toasts\\UndoToast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\toasts\\ValidationToast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\components\\toasts\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\constants\\apiProviders.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\constants\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\constants\\prompts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\context\\ModalContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\context\\SettingsContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\context\\ThemeContext.tsx","messages":[{"ruleId":"prefer-const","severity":1,"message":"'r' is never reassigned. Use 'const' instead.","line":28,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":28,"endColumn":8,"fix":{"range":[827,856],"text":"const r = (num >> 16) + amount;"}},{"ruleId":"prefer-const","severity":1,"message":"'g' is never reassigned. Use 'const' instead.","line":29,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":29,"endColumn":8,"fix":{"range":[860,899],"text":"const g = ((num >> 8) & 0x00FF) + amount;"}},{"ruleId":"prefer-const","severity":1,"message":"'b' is never reassigned. Use 'const' instead.","line":30,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":30,"endColumn":8,"fix":{"range":[903,937],"text":"const b = (num & 0x0000FF) + amount;"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":3,"source":"import React, { createContext, useState, ReactNode, useContext, useEffect } from 'react';\r\n\r\nexport type ThemeType = 'dark' | 'light';\r\n\r\n// Define the structure for custom colors\r\nexport interface CustomColors {\r\n  primary: string;\r\n  accent: string;\r\n  background: string;\r\n  card: string;\r\n  text: string;\r\n  border: string; // Added border\r\n}\r\n\r\nexport const DEFAULT_COLORS: CustomColors = {\r\n  primary: '#8b5cf6', // violet-500\r\n  accent: '#8b5cf6',  // violet-500\r\n  background: '#000000', // pure black\r\n  card: '#000000', // pure black\r\n  text: '#fafafa', // white\r\n  border: '#27272a' // zinc-800\r\n};\r\n\r\nconst adjustColor = (color: string, amount: number) => {\r\n  const clamp = (val: number) => Math.min(Math.max(val, 0), 255);\r\n  const removeHash = color.replace('#', '');\r\n  const num = parseInt(removeHash, 16);\r\n  let r = (num >> 16) + amount;\r\n  let g = ((num >> 8) & 0x00FF) + amount;\r\n  let b = (num & 0x0000FF) + amount;\r\n  return `#${(1 << 24 | clamp(r) << 16 | clamp(g) << 8 | clamp(b)).toString(16).slice(1)}`;\r\n};\r\n\r\nconst hexToRgba = (hex: string, alpha: number) => {\r\n  let r = 0, g = 0, b = 0;\r\n  if (hex.length === 4) {\r\n    r = parseInt('0x' + hex[1] + hex[1]);\r\n    g = parseInt('0x' + hex[2] + hex[2]);\r\n    b = parseInt('0x' + hex[3] + hex[3]);\r\n  } else if (hex.length === 7) {\r\n    r = parseInt('0x' + hex[1] + hex[2]);\r\n    g = parseInt('0x' + hex[3] + hex[4]);\r\n    b = parseInt('0x' + hex[5] + hex[6]);\r\n  }\r\n  return `rgba(${r}, ${g}, ${b}, ${alpha})`;\r\n};\r\n\r\nexport interface ThemePreset {\r\n  id: string;\r\n  name: string;\r\n  css: string;\r\n  colors?: CustomColors;\r\n  isSystem?: boolean;\r\n  mode?: ThemeType;\r\n}\r\n\r\ninterface ThemeContextType {\r\n  theme: ThemeType;\r\n  setTheme: (theme: ThemeType) => void;\r\n  toggleTheme: () => void;\r\n\r\n  customCss: string;\r\n  setCustomCss: (css: string) => void;\r\n\r\n  customColors: CustomColors;\r\n  setCustomColors: (colors: CustomColors) => void;\r\n  resetColors: () => void; // Resets to default colors (but keeps current CSS? or reset all?)\r\n\r\n  savedPresets: ThemePreset[];\r\n  addPreset: (preset: ThemePreset) => void;\r\n  updatePreset: (id: string, updates: Partial<ThemePreset>) => void;\r\n  deletePreset: (id: string) => void;\r\n  activePresetId: string | null;\r\n  applyPreset: (id: string) => void;\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType>({\r\n  theme: 'dark',\r\n  setTheme: () => { },\r\n  toggleTheme: () => { },\r\n  customCss: '',\r\n  setCustomCss: () => { },\r\n  customColors: DEFAULT_COLORS,\r\n  setCustomColors: () => { },\r\n  resetColors: () => { },\r\n  savedPresets: [],\r\n  addPreset: () => { },\r\n  updatePreset: () => { },\r\n  deletePreset: () => { },\r\n  activePresetId: null,\r\n  applyPreset: () => { }\r\n});\r\n\r\nconst THEME_STORAGE_KEY = 'aiModelDB_theme';\r\nconst CSS_STORAGE_KEY = 'aiModelDB_customCss';\r\nconst COLORS_STORAGE_KEY = 'aiModelDB_customColors';\r\nconst PRESETS_STORAGE_KEY = 'aiModelDB_savedPresets';\r\nconst ACTIVE_PRESET_KEY = 'aiModelDB_activePresetId';\r\n\r\nexport const ThemeProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\r\n  // Theme State\r\n  const [theme, setThemeState] = useState<ThemeType>(() => {\r\n    try {\r\n      const saved = localStorage.getItem(THEME_STORAGE_KEY);\r\n      return (saved === 'light' || saved === 'dark') ? saved : 'dark';\r\n    } catch { return 'dark'; }\r\n  });\r\n\r\n  // Custom CSS State\r\n  const [customCss, setCustomCssState] = useState<string>(() => {\r\n    return localStorage.getItem(CSS_STORAGE_KEY) || '';\r\n  });\r\n\r\n  // Custom Colors State\r\n  const [customColors, setCustomColorsState] = useState<CustomColors>(() => {\r\n    try {\r\n      const saved = localStorage.getItem(COLORS_STORAGE_KEY);\r\n      return saved ? { ...DEFAULT_COLORS, ...JSON.parse(saved) } : DEFAULT_COLORS;\r\n    } catch { return DEFAULT_COLORS; }\r\n  });\r\n\r\n  // Saved Presets\r\n  const [savedPresets, setSavedPresets] = useState<ThemePreset[]>(() => {\r\n    try {\r\n      const saved = localStorage.getItem(PRESETS_STORAGE_KEY);\r\n      return saved ? JSON.parse(saved) : [];\r\n    } catch { return []; }\r\n  });\r\n\r\n  const [activePresetId, setActivePresetId] = useState<string | null>(() => {\r\n    return localStorage.getItem(ACTIVE_PRESET_KEY) || null;\r\n  });\r\n\r\n  // Apply basic theme class\r\n  useEffect(() => {\r\n    document.documentElement.setAttribute('data-theme', theme);\r\n  }, [theme]);\r\n\r\n  // Apply Custom CSS\r\n  useEffect(() => {\r\n    let styleTag = document.getElementById('custom-user-css');\r\n    if (!styleTag) {\r\n      styleTag = document.createElement('style');\r\n      styleTag.id = 'custom-user-css';\r\n      document.head.appendChild(styleTag);\r\n    }\r\n    styleTag.textContent = customCss;\r\n  }, [customCss]);\r\n\r\n  // Apply Custom Colors as CSS Variables\r\n  useEffect(() => {\r\n    const root = document.documentElement;\r\n    const { accent, background, card, text, border } = customColors;\r\n\r\n    // Main Variables\r\n    root.style.setProperty('--accent', accent);\r\n    root.style.setProperty('--bg', background);\r\n    root.style.setProperty('--bgCard', card);\r\n    root.style.setProperty('--text', text);\r\n    // Explicit Border Variable from user selection\r\n    root.style.setProperty('--border', border);\r\n    root.style.setProperty('--borderInput', border); // Make inputs match generic border\r\n\r\n    // Derived Accent Variations\r\n    try {\r\n      root.style.setProperty('--accentHover', adjustColor(accent, 20));\r\n      root.style.setProperty('--accentLight', adjustColor(accent, 40));\r\n      root.style.setProperty('--accentDark', adjustColor(accent, -20));\r\n      root.style.setProperty('--accentGlow', hexToRgba(accent, 0.3));\r\n\r\n      // Semi-transparent accent variations for subtle effects\r\n      root.style.setProperty('--accentFaint', hexToRgba(accent, 0.15));\r\n      root.style.setProperty('--accentMuted', hexToRgba(accent, 0.25));\r\n      root.style.setProperty('--accentSoft', hexToRgba(accent, 0.4));\r\n\r\n      // Derived UI Colors\r\n      root.style.setProperty('--bgInput', adjustColor(background, 10));\r\n      root.style.setProperty('--bgElevated', adjustColor(background, 15));\r\n\r\n      // Secondary text derived from main text\r\n      root.style.setProperty('--textSecondary', hexToRgba(text, 0.7));\r\n      root.style.setProperty('--textSubtle', hexToRgba(text, 0.45));\r\n      root.style.setProperty('--textMuted', hexToRgba(text, 0.5));\r\n\r\n      // Semi-transparent border variations\r\n      root.style.setProperty('--borderSubtle', hexToRgba(border, 0.5));\r\n      root.style.setProperty('--borderFaint', hexToRgba(border, 0.25));\r\n    } catch (e) {\r\n      console.warn('Invalid color string in theme context');\r\n    }\r\n  }, [customColors]);\r\n\r\n  // Sync to LocalStorage\r\n  const setCustomCss = (css: string) => {\r\n    setCustomCssState(css);\r\n    localStorage.setItem(CSS_STORAGE_KEY, css);\r\n    // If we manually change CSS, we might be diverging from preset, \r\n    // but for now we keep activePresetId unless explicitly cleared.\r\n  };\r\n\r\n  const setCustomColors = (colors: CustomColors) => {\r\n    setCustomColorsState(colors);\r\n    localStorage.setItem(COLORS_STORAGE_KEY, JSON.stringify(colors));\r\n  };\r\n\r\n  const addPreset = (preset: ThemePreset) => {\r\n    const newPresets = [...savedPresets, preset];\r\n    setSavedPresets(newPresets);\r\n    localStorage.setItem(PRESETS_STORAGE_KEY, JSON.stringify(newPresets));\r\n  };\r\n\r\n  const updatePreset = (id: string, updates: Partial<ThemePreset>) => {\r\n    const newPresets = savedPresets.map(p => p.id === id ? { ...p, ...updates } : p);\r\n    setSavedPresets(newPresets);\r\n    localStorage.setItem(PRESETS_STORAGE_KEY, JSON.stringify(newPresets));\r\n  };\r\n\r\n  const deletePreset = (id: string) => {\r\n    const newPresets = savedPresets.filter(p => p.id !== id);\r\n    setSavedPresets(newPresets);\r\n    localStorage.setItem(PRESETS_STORAGE_KEY, JSON.stringify(newPresets));\r\n    if (activePresetId === id) setActivePresetId(null);\r\n  };\r\n\r\n  const applyPreset = (id: string) => {\r\n    // Track the active preset ID\r\n    setActivePresetId(id);\r\n    localStorage.setItem(ACTIVE_PRESET_KEY, id);\r\n\r\n    // Check saved presets first\r\n    const preset = savedPresets.find(p => p.id === id);\r\n    if (preset) {\r\n      setCustomCss(preset.css);\r\n      if (preset.colors) setCustomColors(preset.colors);\r\n      if (preset.mode) setTheme(preset.mode);\r\n    }\r\n    // System presets are applied by the component that calls this\r\n    // since it has access to SYSTEM_PRESETS\r\n  };\r\n\r\n  const resetColors = () => {\r\n    setCustomColors(DEFAULT_COLORS);\r\n  };\r\n\r\n  const setTheme = (newTheme: ThemeType) => {\r\n    setThemeState(newTheme);\r\n    localStorage.setItem(THEME_STORAGE_KEY, newTheme);\r\n  };\r\n\r\n  const toggleTheme = () => setTheme(theme === 'dark' ? 'light' : 'dark');\r\n\r\n  return (\r\n    <ThemeContext.Provider value={{\r\n      theme, setTheme, toggleTheme,\r\n      customCss, setCustomCss,\r\n      customColors, setCustomColors, resetColors,\r\n      savedPresets, addPreset, updatePreset, deletePreset,\r\n      activePresetId, applyPreset\r\n    }}>\r\n      {children}\r\n    </ThemeContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useTheme = () => useContext(ThemeContext);\r\n\r\nexport default ThemeContext;\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\context\\UpdateContext.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":41,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":41,"endColumn":24,"suggestions":[{"fix":{"range":[1392,1434],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":76,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":76,"endColumn":24,"suggestions":[{"fix":{"range":[2813,2883],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":107,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":107,"endColumn":20,"suggestions":[{"fix":{"range":[3650,3711],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":136,"column":25,"nodeType":"MemberExpression","messageId":"limited","endLine":136,"endColumn":36,"suggestions":[{"fix":{"range":[4683,4760],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":181,"column":37,"nodeType":"MemberExpression","messageId":"limited","endLine":181,"endColumn":48,"suggestions":[{"fix":{"range":[6062,6138],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React, { createContext, useState, useEffect, useContext } from 'react';\r\n\r\ninterface UpdateInfo {\r\n    version: string;\r\n    releaseDate: string;\r\n    releaseNotes?: string;\r\n    path: string;\r\n}\r\n\r\ninterface UpdateContextType {\r\n    updateAvailable: boolean;\r\n    updateVersion: string;\r\n    updateDownloaded: boolean;\r\n    updateInfo: UpdateInfo | null;\r\n    downloadProgress: number | null;\r\n    checkForUpdates: () => void;\r\n    downloadUpdate: () => void;\r\n    installUpdate: () => void;\r\n    checking: boolean;\r\n    error: string | null;\r\n    // Dev simulation\r\n    simulateUpdate: () => void;\r\n}\r\n\r\nconst UpdateContext = createContext<UpdateContextType | undefined>(undefined);\r\n\r\nexport function UpdateProvider({ children }: { children: React.ReactNode }) {\r\n    const [updateAvailable, setUpdateAvailable] = useState(false);\r\n    const [updateVersion, setUpdateVersion] = useState('');\r\n    const [updateDownloaded, setUpdateDownloaded] = useState(false);\r\n    const [updateInfo, setUpdateInfo] = useState<UpdateInfo | null>(null);\r\n    const [downloadProgress, setDownloadProgress] = useState<number | null>(null);\r\n    const [checking, setChecking] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        if (!window.electronAPI) return;\r\n\r\n        window.electronAPI.onUpdateStatus((data: any) => {\r\n            console.log(\"Update status event:\", data);\r\n            switch (data.status) {\r\n                case 'checking-for-update':\r\n                    setChecking(true);\r\n                    setError(null);\r\n                    break;\r\n                case 'update-available':\r\n                    setChecking(false);\r\n                    setUpdateAvailable(true);\r\n                    setUpdateVersion(data.version);\r\n                    setUpdateInfo(data);\r\n                    setError(null);\r\n                    break;\r\n                case 'update-not-available':\r\n                    setChecking(false);\r\n                    // Optionally set state to explicitly show \"Up to date\"\r\n                    setError(null);\r\n                    break;\r\n                case 'download-progress':\r\n                    setDownloadProgress(data.percent);\r\n                    break;\r\n                case 'update-downloaded':\r\n                    setUpdateDownloaded(true);\r\n                    setDownloadProgress(null);\r\n                    setChecking(false);\r\n                    break;\r\n                case 'update-error':\r\n                    setChecking(false);\r\n                    setError(data.message);\r\n                    break;\r\n            }\r\n        });\r\n\r\n        // Auto-check for updates on app launch (with a small delay to let app initialize)\r\n        const autoCheckTimer = setTimeout(() => {\r\n            console.log('[UpdateContext] Auto-checking for updates on launch...');\r\n            window.electronAPI?.checkForUpdates();\r\n        }, 2000);\r\n\r\n        return () => {\r\n            clearTimeout(autoCheckTimer);\r\n        };\r\n    }, []);\r\n\r\n    const checkForUpdates = () => {\r\n        if (window.electronAPI) {\r\n            setChecking(true);\r\n            setError(null);\r\n            window.electronAPI.checkForUpdates();\r\n        }\r\n    };\r\n\r\n    const downloadUpdate = () => {\r\n        if (window.electronAPI) {\r\n            window.electronAPI.downloadUpdate();\r\n        }\r\n    };\r\n\r\n    const installUpdate = () => {\r\n        if (window.electronAPI) {\r\n            window.electronAPI.installUpdate();\r\n        }\r\n    };\r\n\r\n    // Dev simulation function - cycles through all update states\r\n    const simulateUpdate = () => {\r\n        console.log('[UpdateContext] Starting update simulation...');\r\n\r\n        // Reset state\r\n        setUpdateAvailable(false);\r\n        setUpdateDownloaded(false);\r\n        setDownloadProgress(null);\r\n        setError(null);\r\n\r\n        // Step 1: Checking\r\n        setChecking(true);\r\n\r\n        setTimeout(() => {\r\n            // Step 2: Update available\r\n            setChecking(false);\r\n            setUpdateAvailable(true);\r\n            setUpdateVersion('99.0.0-demo');\r\n\r\n            setTimeout(() => {\r\n                // Step 3: Downloading with progress\r\n                let progress = 0;\r\n                const progressInterval = setInterval(() => {\r\n                    progress += Math.random() * 15 + 5;\r\n                    if (progress >= 100) {\r\n                        progress = 100;\r\n                        clearInterval(progressInterval);\r\n                        setDownloadProgress(null);\r\n\r\n                        // Step 4: Downloaded\r\n                        setUpdateDownloaded(true);\r\n                        console.log('[UpdateContext] Simulation complete - update ready to install');\r\n                    } else {\r\n                        setDownloadProgress(progress);\r\n                    }\r\n                }, 500);\r\n            }, 2000);\r\n        }, 1500);\r\n    };\r\n\r\n    return (\r\n        <UpdateContext.Provider value={{\r\n            updateAvailable,\r\n            updateVersion,\r\n            updateDownloaded,\r\n            updateInfo,\r\n            downloadProgress,\r\n            checkForUpdates,\r\n            downloadUpdate,\r\n            installUpdate,\r\n            checking,\r\n            error,\r\n            simulateUpdate,\r\n        }}>\r\n            {children}\r\n        </UpdateContext.Provider>\r\n    );\r\n}\r\n\r\nexport const useUpdate = () => {\r\n    const context = useContext(UpdateContext);\r\n    if (!context) {\r\n        // Return dummy context if not wrapper (e.g. dev without provider)\r\n        // or just throw\r\n        // For fail-safety in non-electron environments:\r\n        return {\r\n            updateAvailable: false,\r\n            updateVersion: '',\r\n            updateDownloaded: false,\r\n            updateInfo: null,\r\n            downloadProgress: null,\r\n            checkForUpdates: () => { },\r\n            downloadUpdate: () => { },\r\n            installUpdate: () => { },\r\n            checking: false,\r\n            error: null,\r\n            simulateUpdate: () => { console.log('[UpdateContext] Simulate not available - no context provider'); },\r\n        };\r\n    }\r\n    return context;\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\context\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\data\\themePresets.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\data\\themes\\default.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\data\\themes\\retro.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\data\\themes\\sketch.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\data\\themes\\template.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useBodyScrollLock.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useConsoleLogging.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useDashboardController.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'consoleLogging'. Either include it or remove the dependency array.","line":245,"column":8,"nodeType":"ArrayExpression","endLine":245,"endColumn":81,"suggestions":[{"desc":"Update the dependencies array to be: [settings.apiConfig, models, setApiConfig, consoleLogging.addConsoleLog, consoleLogging]","fix":{"range":[9210,9283],"text":"[settings.apiConfig, models, setApiConfig, consoleLogging.addConsoleLog, consoleLogging]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'modalState'. Either include it or remove the dependency array.","line":252,"column":8,"nodeType":"ArrayExpression","endLine":252,"endColumn":59,"suggestions":[{"desc":"Update the dependencies array to be: [modalState, modalState.importToast, modalState.setImportToast]","fix":{"range":[9533,9584],"text":"[modalState, modalState.importToast, modalState.setImportToast]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'validationState'. Either include it or remove the dependency array.","line":259,"column":8,"nodeType":"ArrayExpression","endLine":259,"endColumn":77,"suggestions":[{"desc":"Update the dependencies array to be: [validationState.validationToast, validationState.setValidationToast, validationState]","fix":{"range":[9856,9925],"text":"[validationState.validationToast, validationState.setValidationToast, validationState]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'validationState'. Either include it or remove the dependency array.","line":270,"column":8,"nodeType":"ArrayExpression","endLine":270,"endColumn":60,"suggestions":[{"desc":"Update the dependencies array to be: [validationJobs, validationState, validationState.setValidationToast]","fix":{"range":[10485,10537],"text":"[validationJobs, validationState, validationState.setValidationToast]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'settings'. Either include it or remove the dependency array.","line":286,"column":8,"nodeType":"ArrayExpression","endLine":286,"endColumn":75,"suggestions":[{"desc":"Update the dependencies array to be: [settings.configVersion, models.length, consoleLogging, modalState, settings]","fix":{"range":[11232,11299],"text":"[settings.configVersion, models.length, consoleLogging, modalState, settings]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'consoleLogging', 'modalState', and 'syncState'. Either include them or remove the dependency array.","line":301,"column":8,"nodeType":"ArrayExpression","endLine":301,"endColumn":130,"suggestions":[{"desc":"Update the dependencies array to be: [lastMergeStats, syncState.syncSummary, syncState.setSyncSummary, modalState.setImportToast, consoleLogging.addConsoleLog, syncState, modalState, consoleLogging]","fix":{"range":[11971,12093],"text":"[lastMergeStats, syncState.syncSummary, syncState.setSyncSummary, modalState.setImportToast, consoleLogging.addConsoleLog, syncState, modalState, consoleLogging]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Model } from \"../types\";\r\nimport { useTheme } from \"../context/ThemeContext\";\r\nimport { useSettings, Settings } from \"../context/SettingsContext\";\r\nimport { useUpdate } from \"../context/UpdateContext\";\r\nimport { useModels, isModelIncomplete } from \"./useModels\";\r\nimport { useModelFiltering } from \"./useModelFiltering\";\r\nimport { useLazyLoad } from \"./useLazyLoad\";\r\nimport { ValidationSummary } from \"./useModelValidation\";\r\nimport { useSyncOperations } from \"./useSyncOperations\";\r\nimport { useNSFWScan } from \"./useNSFWScan\";\r\nimport { useModelSelection } from \"./useModelSelection\";\r\nimport { useUIState } from \"./useUIState\";\r\nimport { useSyncState } from \"./useSyncState\";\r\nimport { useValidationState } from \"./useValidationState\";\r\nimport { useModal } from \"../context/ModalContext\";\r\nimport { useKeyboardShortcuts } from \"./useKeyboardShortcuts\";\r\nimport { useWindowEvents } from \"./useWindowEvents\";\r\nimport { useConsoleLogging } from \"./useConsoleLogging\";\r\nimport { useOnlineStatus } from \"./useOnlineStatus\";\r\nimport { useSyncHistory } from \"./useSyncHistory\";\r\n\r\n/**\r\n * Main controller hook for the AI Model Database dashboard.\r\n * Extracts all business logic and state management from AIModelDB.tsx\r\n * to create a clean separation of concerns.\r\n */\r\nexport function useDashboardController() {\r\n    const { t } = useTranslation();\r\n    const { theme } = useTheme();\r\n    const { settings, saveSettings } = useSettings();\r\n    const updateState = useUpdate();\r\n\r\n    // UI state for update progress\r\n    const [showUpdateProgress, setShowUpdateProgress] = useState(false);\r\n    const [showShortcutsModal, setShowShortcutsModal] = useState(false);\r\n\r\n    // Show update progress when any update activity happens\r\n    useEffect(() => {\r\n        if (updateState.updateAvailable || updateState.checking || updateState.downloadProgress !== null || updateState.updateDownloaded || updateState.error) {\r\n            setShowUpdateProgress(true);\r\n        }\r\n    }, [updateState.updateAvailable, updateState.checking, updateState.downloadProgress, updateState.updateDownloaded, updateState.error]);\r\n\r\n    // Custom hooks for state management\r\n    const uiState = useUIState();\r\n    const syncState = useSyncState();\r\n    const validationState = useValidationState();\r\n\r\n    const [validationSummary, setValidationSummary] = useState<ValidationSummary | null>(null);\r\n    const [showComponentValidationResults, setShowComponentValidationResults] = useState(false);\r\n\r\n    const handleViewValidationDetails = useCallback(() => {\r\n        if (validationState.validationToast?.summary) {\r\n            setValidationSummary(validationState.validationToast.summary);\r\n            setShowComponentValidationResults(true);\r\n        }\r\n    }, [validationState.validationToast]);\r\n\r\n    const modalState = useModal();\r\n    const consoleLogging = useConsoleLogging();\r\n    const isOnline = useOnlineStatus();\r\n    const syncHistory = useSyncHistory();\r\n\r\n    // Track if API keys are available\r\n    const [hasApiProvider, setHasApiProvider] = useState(false);\r\n    const searchRef = useRef<HTMLInputElement | null>(null);\r\n    const [flagModalOpen, setFlagModalOpen] = useState(false);\r\n    const [modelToFlag, setModelToFlag] = useState<Model | null>(null);\r\n    // One-shot ref to prevent config version check from repeatedly triggering onboarding\r\n    const hasTriggeredConfigOnboarding = useRef(false);\r\n\r\n    // Model management from useModels hook\r\n    const modelsHook = useModels();\r\n    const {\r\n        models,\r\n        setModels,\r\n        lastMergeStats,\r\n        addModel,\r\n        importModels,\r\n        mergeInModels,\r\n        validateModels,\r\n        setApiConfig,\r\n        isValidating,\r\n        validationJobs,\r\n        pauseValidation,\r\n        resumeValidation,\r\n        stopValidation,\r\n        clearFinishedValidationJobs,\r\n        selectedModelForEdit,\r\n        showModelEditor,\r\n        openModelEditor,\r\n        closeModelEditor,\r\n        saveModelEdit,\r\n        showValidationModal,\r\n        closeValidationModal,\r\n        validateEntireDatabase,\r\n        isLoading,\r\n        loadingProgress,\r\n        validationProgress,\r\n        setLastMergeStats\r\n    } = modelsHook;\r\n\r\n    // Filtering and pagination\r\n    const filteringResult = useModelFiltering(models, {\r\n        query: uiState.query,\r\n        domainPick: uiState.domainPick,\r\n        sortKey: uiState.sortKey,\r\n        sortDirection: uiState.sortDirection,\r\n        minDownloads: uiState.minDownloads,\r\n        pageSize: uiState.pageSize,\r\n        licenseTypes: uiState.licenseTypes,\r\n        commercialAllowed: uiState.commercialAllowed,\r\n        includeTags: uiState.includeTags,\r\n        excludeTags: uiState.excludeTags,\r\n        favoritesOnly: uiState.favoritesOnly,\r\n        hideNSFW: uiState.hideNSFW\r\n    });\r\n\r\n    const { filtered, total, page, setPage, totalPages, pageItems } = filteringResult;\r\n\r\n    // Lazy loading for \"All\" mode\r\n    const lazyLoadResult = useLazyLoad({\r\n        items: pageItems,\r\n        initialCount: 50,\r\n        incrementCount: 25,\r\n        enabled: uiState.pageSize === null,\r\n    });\r\n\r\n    const { visibleItems, hasMore, displayCount, totalCount, sentinelRef } = lazyLoadResult;\r\n\r\n    // Sync operations hook\r\n    const { syncAll, handleLiveSync } = useSyncOperations({\r\n        models,\r\n        settings,\r\n        callbacks: {\r\n            setIsSyncing: syncState.setIsSyncing,\r\n            setSyncProgress: syncState.setSyncProgress,\r\n            setSyncSummary: syncState.setSyncSummary,\r\n            addConsoleLog: consoleLogging.addConsoleLog,\r\n            setModels,\r\n            mergeInModels,\r\n            setLastMergeStats,\r\n            setLastSync: syncState.setLastSync,\r\n            setPage,\r\n            setFlaggedModels: modalState.setFlaggedModels,\r\n            setShowFlaggedModal: modalState.setShowFlaggedModal,\r\n            saveSnapshot: syncHistory.saveSnapshot,\r\n            setShowSync: modalState.setShowSync\r\n        }\r\n    });\r\n\r\n    // Model selection hook\r\n    const selectionHook = useModelSelection({\r\n        models,\r\n        pageItems,\r\n        setModels,\r\n        setUndoToast: modalState.setUndoToast,\r\n        addConsoleLog: consoleLogging.addConsoleLog\r\n    });\r\n\r\n    const {\r\n        selectedIds,\r\n        handleSelect,\r\n        handleSelectAll,\r\n        handleUndoableDelete,\r\n        handleBulkDelete,\r\n        handleBulkExport,\r\n        clearSelection,\r\n        selectedCount\r\n    } = selectionHook;\r\n\r\n    // NSFW scanning\r\n    useNSFWScan({\r\n        models,\r\n        isLoading,\r\n        customNSFWKeywords: settings.customNSFWKeywords || [],\r\n        setModels,\r\n        addConsoleLog: consoleLogging.addConsoleLog,\r\n    });\r\n\r\n    // Wrapper for import to handle UI state\r\n    const handleImportWrapper = useCallback((importedModels: Model[]) => {\r\n        importModels(importedModels);\r\n        modalState.setShowImport(false);\r\n        const cnt = importedModels?.length || 0;\r\n        modalState.setImportToast({ found: cnt, added: cnt, updated: 0, flagged: 0 });\r\n    }, [importModels, modalState]);\r\n\r\n    /**\r\n     * Checks if API keys are available (local settings only)\r\n     */\r\n    const hasApiKeys = useCallback(async () => {\r\n        return settings && settings.apiConfig && Object.values(settings.apiConfig).some(cfg => cfg.enabled && cfg.apiKey);\r\n    }, [settings]);\r\n\r\n    /**\r\n     * Syncs models - shows wizard if DB is empty, otherwise just syncs\r\n     */\r\n    const handleSyncWithApiCheck = useCallback(async () => {\r\n        if (models.length === 0) {\r\n            modalState.setShowOnboarding(true);\r\n        } else {\r\n            await syncAll(true);\r\n        }\r\n    }, [models.length, modalState, syncAll]);\r\n\r\n    // Keyboard shortcuts\r\n    useKeyboardShortcuts(searchRef, () => syncAll(true), {\r\n        onShowShortcuts: () => setShowShortcutsModal(true),\r\n        onOpenSettings: () => modalState.setShowSync(true)\r\n    });\r\n\r\n    // Window events\r\n    useWindowEvents({\r\n        onEditModel: openModelEditor,\r\n        onShowConfirmation: modalState.setConfirmationToast,\r\n        onOpenSync: () => modalState.setShowSync(true)\r\n    });\r\n\r\n    // Check API keys on mount and when settings change\r\n    useEffect(() => {\r\n        const checkApiKeys = async () => {\r\n            const hasKeys = await hasApiKeys();\r\n            setHasApiProvider(hasKeys);\r\n        };\r\n        checkApiKeys();\r\n    }, [settings.apiConfig, hasApiKeys]);\r\n\r\n    // Update API config and log incomplete models\r\n    useEffect(() => {\r\n        if (settings?.apiConfig) {\r\n            const hasEnabledProvider = Object.entries(settings.apiConfig)\r\n                .some(([_, cfg]) => (cfg as any).enabled && (cfg as any).apiKey);\r\n\r\n            if (hasEnabledProvider) {\r\n                setApiConfig(settings.apiConfig);\r\n                const incompleteModels = models.filter(isModelIncomplete);\r\n                if (incompleteModels.length > 0) {\r\n                    consoleLogging.addConsoleLog(`Found ${incompleteModels.length} models with incomplete data.`);\r\n                }\r\n            }\r\n        }\r\n    }, [settings?.apiConfig, models, setApiConfig, consoleLogging.addConsoleLog]);\r\n\r\n    // Auto-hide import toast\r\n    useEffect(() => {\r\n        if (!modalState.importToast) return;\r\n        const timer = window.setTimeout(() => modalState.setImportToast(null), 6000);\r\n        return () => window.clearTimeout(timer);\r\n    }, [modalState.importToast, modalState.setImportToast]);\r\n\r\n    // Auto-hide validation toast\r\n    useEffect(() => {\r\n        if (!validationState.validationToast) return;\r\n        const timer = window.setTimeout(() => validationState.setValidationToast(null), 6000);\r\n        return () => window.clearTimeout(timer);\r\n    }, [validationState.validationToast, validationState.setValidationToast]);\r\n\r\n    // Show validation toast when all jobs complete\r\n    useEffect(() => {\r\n        if (validationJobs.length === 0) return;\r\n        const completedJobs = validationJobs.filter(j => j.status === 'completed').length;\r\n        const failedJobs = validationJobs.filter(j => j.status === 'failed').length;\r\n        const finishedJobs = completedJobs + failedJobs;\r\n        if (finishedJobs === validationJobs.length && finishedJobs > 0) {\r\n            validationState.setValidationToast({ completed: completedJobs, failed: failedJobs });\r\n        }\r\n    }, [validationJobs, validationState.setValidationToast]);\r\n\r\n    // Check config version and trigger onboarding update if needed (ONE-SHOT)\r\n    useEffect(() => {\r\n        if (hasTriggeredConfigOnboarding.current) return;\r\n\r\n        if (settings && typeof settings.configVersion === 'number') {\r\n            if (settings.configVersion < 2) {\r\n                if (models.length > 0) {\r\n                    hasTriggeredConfigOnboarding.current = true;\r\n                    consoleLogging.addConsoleLog(\"Detected old configuration version. Launching setup wizard for new features.\");\r\n                    modalState.setOnboardingStartStep(2);\r\n                    modalState.setShowOnboarding(true);\r\n                }\r\n            }\r\n        }\r\n    }, [settings.configVersion, models.length, consoleLogging, modalState]);\r\n\r\n    // Show import toast after sync\r\n    useEffect(() => {\r\n        if (!lastMergeStats) return;\r\n        const added = lastMergeStats.added || 0;\r\n        const updated = lastMergeStats.updated || 0;\r\n        const found = syncState.syncSummary?.found ?? (added + updated);\r\n        const flagged = syncState.syncSummary?.flagged ?? 0;\r\n        const duplicates = syncState.syncSummary?.duplicates ?? 0;\r\n        modalState.setImportToast({ found, added, updated, flagged, duplicates });\r\n        syncState.setSyncSummary(null);\r\n        if (updated > 0) {\r\n            consoleLogging.addConsoleLog(`Update complete: ${updated} models updated`);\r\n        }\r\n    }, [lastMergeStats, syncState.syncSummary, syncState.setSyncSummary, modalState.setImportToast, consoleLogging.addConsoleLog]);\r\n\r\n    // Toggle handlers for models\r\n    const handleToggleFavorite = useCallback((model: Model) => {\r\n        setModels(prev => prev.map(m => m.id === model.id ? { ...m, isFavorite: !m.isFavorite } : m));\r\n    }, [setModels]);\r\n\r\n    const handleToggleNSFWFlag = useCallback((model: Model) => {\r\n        if (model.isNSFWFlagged) {\r\n            setModels(prev => prev.map(m => m.id === model.id ? { ...m, isNSFWFlagged: false } : m));\r\n            consoleLogging.addConsoleLog(`Unflagged model: ${model.name}`);\r\n        } else {\r\n            setModelToFlag(model);\r\n            setFlagModalOpen(true);\r\n        }\r\n    }, [setModels, consoleLogging]);\r\n\r\n    const handleToggleImageNSFW = useCallback((model: Model, imageUrl: string) => {\r\n        setModels(prev => prev.map(m => {\r\n            if (m.id !== model.id) return m;\r\n            const currentFlagged = m.flaggedImageUrls || [];\r\n            const isFlagged = currentFlagged.includes(imageUrl);\r\n            const newFlagged = isFlagged\r\n                ? currentFlagged.filter(url => url !== imageUrl)\r\n                : [...currentFlagged, imageUrl];\r\n            return { ...m, flaggedImageUrls: newFlagged };\r\n        }));\r\n        const isFlagging = !(model.flaggedImageUrls?.includes(imageUrl));\r\n        consoleLogging.addConsoleLog(`${isFlagging ? 'Flagged' : 'Unflagged'} image as NSFW for model: ${model.name}`);\r\n    }, [setModels, consoleLogging]);\r\n\r\n    // Computed values\r\n    const bgRoot = theme === \"dark\" ? \"bg-black text-zinc-100\" : \"bg-white text-black\";\r\n\r\n    return {\r\n        // Translation\r\n        t,\r\n\r\n        // Theme\r\n        theme,\r\n        bgRoot,\r\n\r\n        // Settings\r\n        settings,\r\n        saveSettings,\r\n\r\n        // Update state\r\n        updateState,\r\n        showUpdateProgress,\r\n        setShowUpdateProgress,\r\n\r\n        // Shortcuts modal\r\n        showShortcutsModal,\r\n        setShowShortcutsModal,\r\n\r\n        // UI state\r\n        uiState,\r\n\r\n        // Sync state\r\n        syncState,\r\n\r\n        // Validation state\r\n        validationState,\r\n        validationSummary,\r\n        setValidationSummary,\r\n        showComponentValidationResults,\r\n        setShowComponentValidationResults,\r\n        handleViewValidationDetails,\r\n\r\n        // Modal state\r\n        modalState,\r\n\r\n        // Console\r\n        consoleLogging,\r\n\r\n        // Online status\r\n        isOnline,\r\n\r\n        // Sync history\r\n        syncHistory,\r\n\r\n        // API provider status\r\n        hasApiProvider,\r\n\r\n        // Search ref\r\n        searchRef,\r\n\r\n        // Flag modal state\r\n        flagModalOpen,\r\n        setFlagModalOpen,\r\n        modelToFlag,\r\n        setModelToFlag,\r\n\r\n        // Models hook results\r\n        models,\r\n        setModels,\r\n        lastMergeStats,\r\n        addModel,\r\n        importModels: handleImportWrapper,\r\n        mergeInModels,\r\n        validateModels,\r\n        setApiConfig,\r\n        isValidating,\r\n        validationJobs,\r\n        pauseValidation,\r\n        resumeValidation,\r\n        stopValidation,\r\n        clearFinishedValidationJobs,\r\n        selectedModelForEdit,\r\n        showModelEditor,\r\n        openModelEditor,\r\n        closeModelEditor,\r\n        saveModelEdit,\r\n        showValidationModal,\r\n        closeValidationModal,\r\n        validateEntireDatabase,\r\n        isLoading,\r\n        loadingProgress,\r\n        validationProgress,\r\n\r\n        // Filtering results\r\n        filtered,\r\n        total,\r\n        page,\r\n        setPage,\r\n        totalPages,\r\n        pageItems,\r\n\r\n        // Lazy load results\r\n        visibleItems,\r\n        hasMore,\r\n        displayCount,\r\n        totalCount,\r\n        sentinelRef,\r\n\r\n        // Sync operations\r\n        syncAll,\r\n        handleLiveSync,\r\n        handleSyncWithApiCheck,\r\n\r\n        // Selection\r\n        selectedIds,\r\n        handleSelect,\r\n        handleSelectAll,\r\n        handleUndoableDelete,\r\n        handleBulkDelete,\r\n        handleBulkExport,\r\n        clearSelection,\r\n        selectedCount,\r\n\r\n        // Toggle handlers\r\n        handleToggleFavorite,\r\n        handleToggleNSFWFlag,\r\n        handleToggleImageNSFW,\r\n    };\r\n}\r\n\r\nexport type DashboardController = ReturnType<typeof useDashboardController>;\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useImageContextMenu.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useKeyboardShortcuts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useLazyLoad.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useModalState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useModelCRUD.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useModelFiltering.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":14,"column":64,"nodeType":"CallExpression","endLine":14,"endColumn":86},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":14,"column":107,"nodeType":"CallExpression","endLine":14,"endColumn":128},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":14,"column":130,"nodeType":"CallExpression","endLine":14,"endColumn":151},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'options'. Either include it or remove the dependency array.","line":18,"column":6,"nodeType":"ArrayExpression","endLine":32,"endColumn":4,"suggestions":[{"desc":"Update the dependencies array to be: [models, options]","fix":{"range":[876,1135],"text":"[models, options]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":26,"column":5,"nodeType":"CallExpression","endLine":26,"endColumn":27},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":28,"column":5,"nodeType":"CallExpression","endLine":28,"endColumn":26},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":29,"column":5,"nodeType":"CallExpression","endLine":29,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo } from 'react';\r\nimport { Model } from '../types';\r\nimport { filterModels, FilterOptions } from '../utils/filterLogic';\r\n\r\nexport type { FilterOptions };\r\n\r\nexport function useModelFiltering(models: Model[], options: FilterOptions) {\r\n  const { query, domainPick, sortKey, sortDirection = 'asc', minDownloads, pageSize, licenseTypes = [], commercialAllowed = null, includeTags = [], excludeTags = [], favoritesOnly = false, hideNSFW = false } = options;\r\n  const [page, setPage] = useState(1);\r\n\r\n  // Reset page when filters change\r\n  useEffect(() => {\r\n    setPage(1);\r\n  }, [query, domainPick, sortKey, sortDirection, minDownloads, licenseTypes.join(','), commercialAllowed, includeTags.join(','), excludeTags.join(','), favoritesOnly, hideNSFW]);\r\n\r\n  const filtered = useMemo(() => {\r\n    return filterModels(models, options);\r\n  }, [\r\n    models,\r\n    query,\r\n    domainPick,\r\n    sortKey,\r\n    sortDirection,\r\n    minDownloads,\r\n    pageSize,\r\n    licenseTypes.join(','),\r\n    commercialAllowed,\r\n    includeTags.join(','),\r\n    excludeTags.join(','),\r\n    favoritesOnly,\r\n    hideNSFW\r\n  ]);\r\n\r\n  const total = filtered.length;\r\n  const perPage = pageSize ?? total;\r\n  const totalPages = perPage ? Math.max(1, Math.ceil(total / perPage)) : 1;\r\n  const pageSafe = Math.min(page, totalPages);\r\n  const start = perPage ? (pageSafe - 1) * perPage : 0;\r\n  const end = perPage ? start + perPage : total;\r\n  const pageItems = filtered.slice(start, end);\r\n\r\n  return {\r\n    filtered,\r\n    total,\r\n    page,\r\n    setPage,\r\n    totalPages,\r\n    pageItems,\r\n    pageSafe\r\n  };\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useModelMerge.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useModelPersistence.ts","messages":[{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":41,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":41,"endColumn":20,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1665,1666],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":111,"column":25,"nodeType":"MemberExpression","messageId":"limited","endLine":111,"endColumn":36,"suggestions":[{"fix":{"range":[4874,4974],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":122,"column":25,"nodeType":"MemberExpression","messageId":"limited","endLine":122,"endColumn":36,"suggestions":[{"fix":{"range":[5398,5479],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":131,"column":29,"nodeType":"MemberExpression","messageId":"limited","endLine":131,"endColumn":40,"suggestions":[{"fix":{"range":[6001,6104],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":182,"column":21,"nodeType":"MemberExpression","messageId":"limited","endLine":182,"endColumn":32,"suggestions":[{"fix":{"range":[8024,8096],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":194,"column":29,"nodeType":"MemberExpression","messageId":"limited","endLine":194,"endColumn":40,"suggestions":[{"fix":{"range":[8809,8894],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":263,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":263,"endColumn":20,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[11136,11137],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":276,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":276,"endColumn":20,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[11691,11692],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":284,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":284,"endColumn":20,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[11932,11933],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { Model, ApiDir } from '../types';\r\nimport { useSettings } from '../context/SettingsContext';\r\nimport { DEFAULT_API_DIR } from '../services/api';\r\nimport {\r\n    isIndexedDBAvailable,\r\n    saveModels as saveModelsToIDB,\r\n    loadModels as loadModelsFromIDB,\r\n    clearModels as clearModelsFromIDB,\r\n    saveMetadata,\r\n    loadMetadata,\r\n    deleteDatabase,\r\n    migrateFromLocalStorage\r\n} from '../services/storage';\r\n\r\n// Storage threshold - use IndexedDB if more than 500 models (to stay well under localStorage limits)\r\nconst INDEXEDDB_THRESHOLD = 500;\r\n\r\n/**\r\n * Hook for persisting models to IndexedDB (primary) with localStorage fallback\r\n * Handles migration from localStorage for existing users\r\n */\r\nexport function useModelPersistence() {\r\n    const { settings } = useSettings();\r\n    const [models, setModels] = useState<Model[]>([]);\r\n    const [lastSync, setLastSync] = useState<string | null>(null);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [loadingProgress, setLoadingProgress] = useState<{ current: number; total: number } | null>(null);\r\n    const [apiConfig, setApiConfig] = useState<ApiDir>(DEFAULT_API_DIR);\r\n    const [storageType, setStorageType] = useState<'indexeddb' | 'localstorage'>('indexeddb');\r\n\r\n    const initialized = useRef(false);\r\n    const pendingSave = useRef<ReturnType<typeof setTimeout> | null>(null);\r\n\r\n    // Synchronize internal apiConfig with SettingsContext\r\n    useEffect(() => {\r\n        try {\r\n            if (settings?.apiConfig) {\r\n                setApiConfig(settings.apiConfig);\r\n            }\r\n        } catch { }\r\n    }, [settings?.apiConfig]);\r\n\r\n    // Load API config from localStorage\r\n    useEffect(() => {\r\n        try {\r\n            const savedConfig = localStorage.getItem('aiModelDB_apiConfig');\r\n            if (savedConfig) {\r\n                setApiConfig(JSON.parse(savedConfig));\r\n            }\r\n        } catch (error) {\r\n            console.error('Error loading API config from localStorage:', error);\r\n        }\r\n    }, []);\r\n\r\n    // Sanitize pricing data for consistency\r\n    const sanitizePricing = useCallback((modelsIn: Model[]): Model[] => {\r\n        return modelsIn.map((m) => {\r\n            if (!m.pricing || !Array.isArray(m.pricing)) return m;\r\n            const sanitized = m.pricing.map((p: any) => {\r\n                const unit = (p.unit || '').toLowerCase();\r\n                const isApiUnit = unit.includes('token') || unit.includes('request') || unit.includes('call');\r\n                // If API-like unit and flat present, drop flat (avoid mislabel as subscription)\r\n                const flat = (isApiUnit ? null : (isFinite(Number(p.flat)) ? Number(p.flat) : null));\r\n                const input = isFinite(Number(p.input)) ? Number(p.input) : null;\r\n                const output = isFinite(Number(p.output)) ? Number(p.output) : null;\r\n                const currency = (p.currency && typeof p.currency === 'string') ? p.currency : 'USD';\r\n                return { ...p, unit: p.unit || (flat != null ? 'month' : p.unit), flat, input, output, currency };\r\n            });\r\n            return { ...m, pricing: sanitized };\r\n        });\r\n    }, []);\r\n\r\n    // Load from localStorage (fallback)\r\n    const loadFromLocalStorage = useCallback(async (): Promise<{ models: Model[]; lastSync: string | null }> => {\r\n        const savedModels = localStorage.getItem('aiModelDB_models');\r\n        const lastSyncTime = localStorage.getItem('aiModelDB_lastSync');\r\n\r\n        if (!savedModels) {\r\n            return { models: [], lastSync: lastSyncTime };\r\n        }\r\n\r\n        const parsed: Model[] = JSON.parse(savedModels);\r\n        return { models: sanitizePricing(parsed), lastSync: lastSyncTime };\r\n    }, [sanitizePricing]);\r\n\r\n    // Load from IndexedDB (primary)\r\n    const loadFromIndexedDB = useCallback(async (): Promise<{ models: Model[]; lastSync: string | null }> => {\r\n        const loadedModels = await loadModelsFromIDB();\r\n        const lastSyncTime = await loadMetadata('lastSync');\r\n        return { models: sanitizePricing(loadedModels), lastSync: lastSyncTime };\r\n    }, [sanitizePricing]);\r\n\r\n    // Load models on initial mount\r\n    useEffect(() => {\r\n        if (initialized.current) return;\r\n\r\n        const loadModels = async () => {\r\n            try {\r\n                setLoadingProgress({ current: 0, total: 100 });\r\n\r\n                // Check if IndexedDB is available\r\n                const idbAvailable = await isIndexedDBAvailable();\r\n\r\n                if (idbAvailable) {\r\n                    setStorageType('indexeddb');\r\n\r\n                    // Try to migrate from localStorage if needed\r\n                    const migration = await migrateFromLocalStorage();\r\n                    if (migration.success && migration.modelCount > 0) {\r\n                        console.log(`[Persistence] Migrated ${migration.modelCount} models from localStorage to IndexedDB`);\r\n                    }\r\n\r\n                    setLoadingProgress({ current: 50, total: 100 });\r\n\r\n                    // Load from IndexedDB\r\n                    const { models: loadedModels, lastSync: loadedSync } = await loadFromIndexedDB();\r\n\r\n                    if (loadedModels.length > 0) {\r\n                        setModels(loadedModels);\r\n                        setLastSync(loadedSync);\r\n                        console.log(`[Persistence] Loaded ${loadedModels.length} models from IndexedDB`);\r\n                    } else {\r\n                        // Fallback: try localStorage in case IndexedDB is empty\r\n                        const { models: lsModels, lastSync: lsSync } = await loadFromLocalStorage();\r\n                        if (lsModels.length > 0) {\r\n                            setModels(lsModels);\r\n                            setLastSync(lsSync);\r\n                            // Save to IndexedDB for next time\r\n                            await saveModelsToIDB(lsModels);\r\n                            console.log(`[Persistence] Loaded ${lsModels.length} models from localStorage, migrated to IndexedDB`);\r\n                        }\r\n                    }\r\n                } else {\r\n                    // Fall back to localStorage\r\n                    setStorageType('localstorage');\r\n                    console.warn('[Persistence] IndexedDB not available, using localStorage');\r\n\r\n                    const { models: loadedModels, lastSync: loadedSync } = await loadFromLocalStorage();\r\n                    setModels(loadedModels);\r\n                    setLastSync(loadedSync);\r\n                }\r\n\r\n                setLoadingProgress({ current: 100, total: 100 });\r\n                initialized.current = true;\r\n                setIsLoading(false);\r\n                setLoadingProgress(null);\r\n            } catch (error) {\r\n                console.error('Error loading models:', error);\r\n                // Last resort fallback to localStorage\r\n                try {\r\n                    const { models: lsModels, lastSync: lsSync } = await loadFromLocalStorage();\r\n                    setModels(lsModels);\r\n                    setLastSync(lsSync);\r\n                    setStorageType('localstorage');\r\n                } catch {\r\n                    setModels([]);\r\n                }\r\n                initialized.current = true;\r\n                setIsLoading(false);\r\n                setLoadingProgress(null);\r\n            }\r\n        };\r\n\r\n        loadModels();\r\n    }, [loadFromIndexedDB, loadFromLocalStorage]);\r\n\r\n    // Save models whenever they change (debounced)\r\n    useEffect(() => {\r\n        if (!initialized.current) return;\r\n\r\n        // Clear any pending save\r\n        if (pendingSave.current) {\r\n            clearTimeout(pendingSave.current);\r\n        }\r\n\r\n        // Debounce saves to avoid excessive writes\r\n        pendingSave.current = setTimeout(async () => {\r\n            try {\r\n                if (storageType === 'indexeddb') {\r\n                    await saveModelsToIDB(models);\r\n                    console.log(`[Persistence] Saved ${models.length} models to IndexedDB`);\r\n                } else {\r\n                    // Fall back to localStorage (will fail if data is too large)\r\n                    try {\r\n                        localStorage.setItem('aiModelDB_models', JSON.stringify(models));\r\n                    } catch (quotaError) {\r\n                        console.error('[Persistence] localStorage quota exceeded, attempting IndexedDB migration');\r\n                        // Try to upgrade to IndexedDB\r\n                        const idbAvailable = await isIndexedDBAvailable();\r\n                        if (idbAvailable) {\r\n                            await saveModelsToIDB(models);\r\n                            setStorageType('indexeddb');\r\n                            console.log('[Persistence] Migrated to IndexedDB after localStorage quota exceeded');\r\n                        } else {\r\n                            throw quotaError;\r\n                        }\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                console.error('Error saving models:', error);\r\n            }\r\n        }, 500);\r\n\r\n        return () => {\r\n            if (pendingSave.current) {\r\n                clearTimeout(pendingSave.current);\r\n            }\r\n        };\r\n    }, [models, storageType]);\r\n\r\n    // Save lastSync when it changes\r\n    useEffect(() => {\r\n        if (!initialized.current || !lastSync) return;\r\n\r\n        const saveLastSync = async () => {\r\n            try {\r\n                if (storageType === 'indexeddb') {\r\n                    await saveMetadata('lastSync', lastSync);\r\n                }\r\n                // Always save to localStorage as backup for quick access\r\n                localStorage.setItem('aiModelDB_lastSync', lastSync);\r\n            } catch (error) {\r\n                console.error('Error saving lastSync:', error);\r\n            }\r\n        };\r\n\r\n        saveLastSync();\r\n    }, [lastSync, storageType]);\r\n\r\n    const clearAllModels = useCallback(async () => {\r\n        try {\r\n            if (storageType === 'indexeddb') {\r\n                await clearModelsFromIDB();\r\n            }\r\n            localStorage.removeItem('aiModelDB_models');\r\n            setModels([]);\r\n        } catch (error) {\r\n            console.error('Error clearing models:', error);\r\n        }\r\n    }, [storageType]);\r\n\r\n    const resetToDefault = useCallback(async () => {\r\n        try {\r\n            if (storageType === 'indexeddb') {\r\n                await clearModelsFromIDB();\r\n            }\r\n            localStorage.removeItem('aiModelDB_models');\r\n            localStorage.removeItem('aiModelDB_lastSync');\r\n            localStorage.removeItem('aiModelDB_apiConfig');\r\n            setModels([]);\r\n            setLastSync(null);\r\n            setApiConfig(DEFAULT_API_DIR);\r\n        } catch (error) {\r\n            console.error('Error resetting to default:', error);\r\n        }\r\n    }, [storageType]);\r\n\r\n    const hardResetDatabase = useCallback(async () => {\r\n        try {\r\n            // Clear IndexedDB\r\n            await deleteDatabase();\r\n        } catch { }\r\n\r\n        try {\r\n            // Clear localStorage (except settings)\r\n            const toRemove: string[] = [];\r\n            for (let i = 0; i < localStorage.length; i++) {\r\n                const k = localStorage.key(i) as string;\r\n                // Wipe everything EXCEPT settings (to preserve keys/config)\r\n                if (k && k.startsWith('aiModelDB_') && k !== 'aiModelDB_settings') {\r\n                    toRemove.push(k);\r\n                }\r\n            }\r\n            toRemove.forEach(k => localStorage.removeItem(k));\r\n        } catch { }\r\n\r\n        try {\r\n            // Clear caches\r\n            if ('caches' in window) {\r\n                const keys = await caches.keys();\r\n                await Promise.all(keys.map(k => caches.delete(k)));\r\n            }\r\n        } catch { }\r\n\r\n        setModels([]);\r\n        setLastSync(null);\r\n        setApiConfig(DEFAULT_API_DIR);\r\n    }, []);\r\n\r\n    // Expose hard reset via custom event (cleaner than global window mutation)\r\n    useEffect(() => {\r\n        const onHardReset = async () => {\r\n            await hardResetDatabase();\r\n        };\r\n        window.addEventListener('hard-reset', onHardReset as EventListener);\r\n        return () => {\r\n            window.removeEventListener('hard-reset', onHardReset as EventListener);\r\n        };\r\n    }, [hardResetDatabase]);\r\n\r\n    return {\r\n        models,\r\n        setModels,\r\n        lastSync,\r\n        setLastSync,\r\n        isLoading,\r\n        loadingProgress,\r\n        apiConfig,\r\n        setApiConfig,\r\n        clearAllModels,\r\n        resetToDefault,\r\n        hardResetDatabase,\r\n        storageType // Expose for debugging/UI display\r\n    };\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useModelSelection.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useModelValidation.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":133,"column":21,"nodeType":"MemberExpression","messageId":"limited","endLine":133,"endColumn":32,"suggestions":[{"fix":{"range":[5263,5358],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'getValidationQueue'. Either include it or remove the dependency array.","line":258,"column":8,"nodeType":"ArrayExpression","endLine":258,"endColumn":56,"suggestions":[{"desc":"Update the dependencies array to be: [isValidating, validationJobs.length, apiConfig, getValidationQueue]","fix":{"range":[11213,11261],"text":"[isValidating, validationJobs.length, apiConfig, getValidationQueue]"}}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":321,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":321,"endColumn":20,"suggestions":[{"fix":{"range":[13550,13609],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":325,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":325,"endColumn":24,"suggestions":[{"fix":{"range":[13735,13789],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":326,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":326,"endColumn":20,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[13808,13809],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":331,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":331,"endColumn":20,"suggestions":[{"fix":{"range":[13942,13991],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":336,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":336,"endColumn":20,"suggestions":[{"fix":{"range":[14106,14149],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":357,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":357,"endColumn":24,"suggestions":[{"fix":{"range":[14956,15055],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":385,"column":25,"nodeType":"MemberExpression","messageId":"limited","endLine":385,"endColumn":36,"suggestions":[{"fix":{"range":[16416,16474],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":434,"column":21,"nodeType":"MemberExpression","messageId":"limited","endLine":434,"endColumn":32,"suggestions":[{"fix":{"range":[18979,19067],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":504,"column":29,"nodeType":"MemberExpression","messageId":"limited","endLine":504,"endColumn":40,"suggestions":[{"fix":{"range":[23152,23232],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":507,"column":29,"nodeType":"MemberExpression","messageId":"limited","endLine":507,"endColumn":40,"suggestions":[{"fix":{"range":[23395,23487],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":528,"column":25,"nodeType":"MemberExpression","messageId":"limited","endLine":528,"endColumn":36,"suggestions":[{"fix":{"range":[24479,24554],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":545,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":545,"endColumn":28,"suggestions":[{"fix":{"range":[25332,25416],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":556,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":556,"endColumn":28,"suggestions":[{"fix":{"range":[25780,25897],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":557,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":557,"endColumn":28,"suggestions":[{"fix":{"range":[25915,25998],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":558,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":558,"endColumn":28,"suggestions":[{"fix":{"range":[26016,26080],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":559,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":559,"endColumn":28,"suggestions":[{"fix":{"range":[26098,26144],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":576,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":576,"endColumn":28,"suggestions":[{"fix":{"range":[26785,26847],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":604,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":604,"endColumn":28,"suggestions":[{"fix":{"range":[27940,27981],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":620,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":620,"endColumn":28,"suggestions":[{"fix":{"range":[28598,28669],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":21,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useEffect } from 'react';\r\nimport { Model, ApiDir, ProviderCfg, ProviderKey } from '../types';\r\nimport { ValidationJob, ValidationQueue, ValidationSource } from '../services/validation';\r\nimport { callProviderLLM } from '../services/api';\r\n\r\n// ValidationUpdateEvent tracks specific changes for detailed reporting\r\nexport interface ValidationUpdateEvent {\r\n    modelId: string;\r\n    modelName: string;\r\n    field: string;\r\n    oldValue: any;\r\n    newValue: any;\r\n}\r\n\r\n// ValidationSummary tracks what fields were updated during validation\r\nexport interface ValidationSummary {\r\n    totalModels: number;\r\n    modelsUpdated: number;\r\n    fieldsUpdated: {\r\n        description: number;\r\n        parameters: number;\r\n        context_window: number;\r\n        license: number;\r\n        release_date: number;\r\n        tags: number;\r\n        pricing: number;\r\n        other: number;\r\n    };\r\n    updates: ValidationUpdateEvent[];\r\n    errors: number;\r\n    webSearchUsed: boolean;\r\n}\r\n\r\n// Helper to create an empty validation summary\r\nfunction createEmptySummary(): ValidationSummary {\r\n    return {\r\n        totalModels: 0,\r\n        modelsUpdated: 0,\r\n        fieldsUpdated: {\r\n            description: 0,\r\n            parameters: 0,\r\n            context_window: 0,\r\n            license: 0,\r\n            release_date: 0,\r\n            tags: 0,\r\n            pricing: 0,\r\n            other: 0\r\n        },\r\n        updates: [],\r\n        errors: 0,\r\n        webSearchUsed: false\r\n    };\r\n}\r\n\r\n// Helper to compare and track what fields were updated\r\nfunction trackFieldUpdates(original: Model, updated: Model, summary: ValidationSummary): void {\r\n    const pushUpdate = (field: string, oldV: any, newV: any) => {\r\n        summary.updates.push({\r\n            modelId: original.id,\r\n            modelName: original.name || 'Unknown',\r\n            field,\r\n            oldValue: oldV,\r\n            newValue: newV\r\n        });\r\n    };\r\n\r\n    if (updated.description && updated.description !== original.description) {\r\n        summary.fieldsUpdated.description++;\r\n        pushUpdate('description', original.description, updated.description);\r\n    }\r\n    if (updated.parameters && updated.parameters !== original.parameters) {\r\n        summary.fieldsUpdated.parameters++;\r\n        pushUpdate('parameters', original.parameters, updated.parameters);\r\n    }\r\n    if (updated.context_window && updated.context_window !== original.context_window) {\r\n        summary.fieldsUpdated.context_window++;\r\n        pushUpdate('context_window', original.context_window, updated.context_window);\r\n    }\r\n    if (updated.license?.name && updated.license.name !== original.license?.name) {\r\n        summary.fieldsUpdated.license++;\r\n        pushUpdate('license', original.license?.name, updated.license?.name);\r\n    }\r\n    if (updated.release_date && updated.release_date !== original.release_date) {\r\n        summary.fieldsUpdated.release_date++;\r\n        pushUpdate('release_date', original.release_date, updated.release_date);\r\n    }\r\n    if (updated.tags && JSON.stringify(updated.tags) !== JSON.stringify(original.tags)) {\r\n        summary.fieldsUpdated.tags++;\r\n        pushUpdate('tags', original.tags, updated.tags);\r\n    }\r\n    if (updated.pricing && JSON.stringify(updated.pricing) !== JSON.stringify(original.pricing)) {\r\n        summary.fieldsUpdated.pricing++;\r\n        pushUpdate('pricing', original.pricing, updated.pricing);\r\n    }\r\n}\r\n\r\n// Helper to create a generic validation/enrichment prompt with web search instructions\r\n// Replaced by centralized prompt helper\r\nimport { createEnrichmentPrompt, SYSTEM_PROMPT_ENRICHMENT, SYSTEM_PROMPT_VALIDATION, SYSTEM_PROMPT_VALIDATION_SHORT } from '../constants/prompts';\r\n\r\nexport function useModelValidation(\r\n    models: Model[],\r\n    setModels: React.Dispatch<React.SetStateAction<Model[]>>,\r\n    apiConfig: ApiDir,\r\n    setLastSync: React.Dispatch<React.SetStateAction<string | null>>\r\n) {\r\n    // Validation state\r\n    const [isValidating, setIsValidating] = useState(false);\r\n    const [validationJobs, setValidationJobs] = useState<ValidationJob[]>([]);\r\n    const [validationProgress, setValidationProgress] = useState<{ current: number, total: number } | null>(null);\r\n    const [showValidationModal, setShowValidationModal] = useState(false);\r\n\r\n    // Use a ref to access the latest apiConfig inside the validation callback without recreating the queue\r\n    const apiConfigRef = useRef(apiConfig);\r\n\r\n    useEffect(() => {\r\n        apiConfigRef.current = apiConfig;\r\n    }, [apiConfig]);\r\n\r\n    // Validation queue ref to persist between renders\r\n    const validationQueueRef = useRef<ValidationQueue | null>(null);\r\n    // Cancellation flag for database-wide validation (CSV batch mode)\r\n    const cancelDbValidationRef = useRef<boolean>(false);\r\n    // Abort controller for in-flight provider requests\r\n    const validationAbortRef = useRef<AbortController | null>(null);\r\n\r\n    // Initialize or get validation queue\r\n    const getValidationQueue = () => {\r\n        if (!validationQueueRef.current) {\r\n            validationQueueRef.current = new ValidationQueue(\r\n                // Validation function\r\n                async (model: Model, sources: ValidationSource[]) => {\r\n                    console.log(`Validating model: ${model.name || model.id} with sources: ${sources.join(', ')}`);\r\n\r\n                    // Find an enabled LLM provider\r\n                    const currentConfig = apiConfigRef.current;\r\n                    const enabledProviders = Object.entries(currentConfig)\r\n                        .filter(([key, cfg]) => (cfg as ProviderCfg).enabled && ((cfg as ProviderCfg).apiKey || (cfg as ProviderCfg).protocol === 'ollama' || key === 'ollama'))\r\n                        .map(([key]) => key as ProviderKey);\r\n\r\n                    if (!enabledProviders.length) {\r\n                        throw new Error('No enabled LLM providers available for validation');\r\n                    }\r\n\r\n                    // Use the first available provider\r\n                    let providerKey = enabledProviders[0];\r\n                    let providerConfig = currentConfig[providerKey] as ProviderCfg;\r\n\r\n                    // Try each provider until we find one that works\r\n                    let enrichedModelsResult = null;\r\n                    let lastError = null;\r\n\r\n                    for (const key of enabledProviders) {\r\n                        providerKey = key;\r\n                        providerConfig = currentConfig[providerKey] as ProviderCfg;\r\n\r\n                        try {\r\n                            const systemPrompt = SYSTEM_PROMPT_ENRICHMENT;\r\n                            const userPrompt = createEnrichmentPrompt(model);\r\n\r\n                            enrichedModelsResult = await callProviderLLM(\r\n                                providerKey,\r\n                                providerConfig,\r\n                                systemPrompt,\r\n                                userPrompt\r\n                            );\r\n\r\n                            if (enrichedModelsResult && enrichedModelsResult.length > 0) {\r\n                                break; // Success! Break the loop\r\n                            }\r\n                        } catch (error) {\r\n                            lastError = error;\r\n                            console.error(`Provider ${providerKey} failed:`, error);\r\n                            // Continue to try the next provider\r\n                        }\r\n                    }\r\n\r\n                    // If we tried all providers and none worked, throw the last error\r\n                    if (!enrichedModelsResult || !enrichedModelsResult.length) {\r\n                        throw new Error(lastError instanceof Error ? lastError.message : 'Failed to get valid enriched model data from any provider');\r\n                    }\r\n\r\n                    // Find the first valid model\r\n                    const enrichedModel = enrichedModelsResult[0];\r\n\r\n                    // Merge the enriched data with the original model\r\n                    return {\r\n                        ...model,\r\n                        ...enrichedModel,\r\n                        // Ensure these fields are properly merged\r\n                        license: { ...model.license, ...enrichedModel.license },\r\n                        hosting: { ...model.hosting, ...enrichedModel.hosting },\r\n                        // Add tags without duplicates\r\n                        tags: Array.from(new Set([\r\n                            ...(model.tags || []),\r\n                            ...(enrichedModel.tags || [])\r\n                        ])),\r\n                        // PRESERVE user flags - these should NEVER be overwritten by enrichment\r\n                        isFavorite: model.isFavorite,\r\n                        isNSFWFlagged: model.isNSFWFlagged,\r\n                        flaggedImageUrls: model.flaggedImageUrls\r\n                    };\r\n                },\r\n                {\r\n                    // Options\r\n                    concurrency: 2,\r\n                    onProgress: (current, total) => {\r\n                        setValidationProgress({ current, total });\r\n                    },\r\n                    onComplete: (job) => {\r\n                        if (job.result) {\r\n                            // Update the model in the models list\r\n                            setModels(prevModels =>\r\n                                prevModels.map(m => m.id === job.result!.id ? job.result! : m)\r\n                            );\r\n\r\n                            // Update job in our local state\r\n                            setValidationJobs(prev =>\r\n                                prev.map(j => j.id === job.id ? job : j)\r\n                            );\r\n\r\n                            // Update last sync time\r\n                            const syncTime = new Date().toISOString();\r\n                            setLastSync(syncTime);\r\n                            localStorage.setItem('aiModelDB_lastSync', syncTime);\r\n                        }\r\n                    },\r\n                    onError: (job) => {\r\n                        console.error(`Validation failed for ${job.model.name || job.model.id}:`, job.error);\r\n                        // Update job in our local state\r\n                        setValidationJobs(prev =>\r\n                            prev.map(j => j.id === job.id ? job : j)\r\n                        );\r\n                    }\r\n                }\r\n            );\r\n        }\r\n\r\n        return validationQueueRef.current;\r\n    };\r\n\r\n    // Update validation jobs when the queue changes\r\n    useEffect(() => {\r\n        const queue = getValidationQueue();\r\n        const intervalId = setInterval(() => {\r\n            setValidationJobs([...queue.getJobs()]);\r\n\r\n            // Auto-stop validation tracking when all jobs are done\r\n            const pendingCount = queue.getPendingCount();\r\n            const processingCount = queue.getProcessingCount();\r\n\r\n            if (pendingCount === 0 && processingCount === 0 && isValidating && validationJobs.length > 0) {\r\n                setIsValidating(false);\r\n            }\r\n        }, 1000);\r\n\r\n        return () => clearInterval(intervalId);\r\n    }, [isValidating, validationJobs.length, apiConfig]); // Added apiConfig dependency as getValidationQueue depends on it\r\n\r\n    // Function to check if API providers are configured\r\n    const hasConfiguredProviders = (): boolean => {\r\n        return Object.entries(apiConfig)\r\n            .some(([key, cfg]) => (cfg as ProviderCfg).enabled && ((cfg as ProviderCfg).apiKey || (cfg as ProviderCfg).protocol === 'ollama' || key === 'ollama'));\r\n    };\r\n\r\n    // Function to get list of enabled providers\r\n    const getEnabledProviders = (): ProviderKey[] => {\r\n        return Object.entries(apiConfig)\r\n            .filter(([key, cfg]) => (cfg as ProviderCfg).enabled && ((cfg as ProviderCfg).apiKey || (cfg as ProviderCfg).protocol === 'ollama' || key === 'ollama'))\r\n            .map(([key]) => key as ProviderKey);\r\n    };\r\n\r\n    // Function to start validation of selected models\r\n    const startValidation = (modelsToValidate: Model[], sources: ValidationSource[]) => {\r\n        const enabledProviders = getEnabledProviders();\r\n\r\n        if (enabledProviders.length === 0) {\r\n            alert('No enabled LLM providers available for validation. Please set up API keys in the sync settings.');\r\n            return;\r\n        }\r\n\r\n        if (modelsToValidate.length === 0) {\r\n            alert('No models selected for validation.');\r\n            return;\r\n        }\r\n\r\n        if (sources.length === 0) {\r\n            alert('No validation sources selected.');\r\n            return;\r\n        }\r\n\r\n        const queue = getValidationQueue();\r\n        queue.addJobs(modelsToValidate, sources);\r\n\r\n        setIsValidating(true);\r\n        setValidationJobs([...queue.getJobs()]);\r\n    };\r\n\r\n    const pauseValidation = () => {\r\n        const queue = getValidationQueue();\r\n        queue.pause();\r\n    };\r\n\r\n    const resumeValidation = () => {\r\n        const queue = getValidationQueue();\r\n        queue.resume();\r\n    };\r\n\r\n    const clearFinishedValidationJobs = () => {\r\n        const queue = getValidationQueue();\r\n        queue.clearFinishedJobs();\r\n        setValidationJobs([...queue.getJobs()]);\r\n        const total = queue.getTotalCount();\r\n        const completed = queue.getCompletedCount();\r\n        if (completed >= total) {\r\n            setValidationProgress(null);\r\n        }\r\n    };\r\n\r\n    const stopValidation = () => {\r\n        console.log('[CANCEL] Stopping validation immediately...');\r\n        cancelDbValidationRef.current = true;\r\n        try {\r\n            validationAbortRef.current?.abort();\r\n            console.log('[CANCEL] Aborted in-flight API request');\r\n        } catch { }\r\n        validationAbortRef.current = null;\r\n\r\n        const queue = getValidationQueue();\r\n        queue.clearAllJobs();\r\n        console.log('[CANCEL] Cleared validation queue');\r\n\r\n        setIsValidating(false);\r\n        setValidationJobs([]);\r\n        setValidationProgress(null);\r\n        console.log('[CANCEL] Validation stopped');\r\n    };\r\n\r\n    // Modal handlers\r\n    const openValidationModal = (selectedModels: string[] = []) => {\r\n        setShowValidationModal(true);\r\n    };\r\n\r\n    const closeValidationModal = () => {\r\n        setShowValidationModal(false);\r\n    };\r\n\r\n    // Database-wide validation with GPT\r\n    const validateEntireDatabase = async (\r\n        opts?: { batchSize?: number; pauseMs?: number; maxBatches?: number; apiConfig?: ApiDir; preferredModelProvider?: string | null; modelsOverride?: Model[] }\r\n    ): Promise<{ success: boolean; updatedModels?: Model[]; error?: string; summary?: ValidationSummary }> => {\r\n        const summary = createEmptySummary();\r\n        const modelsToValidate = opts?.modelsOverride || models;\r\n        summary.totalModels = modelsToValidate.length;\r\n\r\n        try {\r\n            console.log(`Starting database validation (subset: ${!!opts?.modelsOverride}) with web search...`);\r\n            setIsValidating(true);\r\n            cancelDbValidationRef.current = false;\r\n            validationAbortRef.current = new AbortController();\r\n\r\n            const configToUse = opts?.apiConfig || apiConfig;\r\n            if (!configToUse) {\r\n                throw new Error('No API configuration available');\r\n            }\r\n\r\n            const hasValidKey = async (key: string, cfg: any): Promise<boolean> => {\r\n                if (cfg.protocol === 'ollama' || key === 'ollama') return true;\r\n                if (cfg.apiKey && cfg.apiKey.trim() !== '') return true;\r\n                return false;\r\n            };\r\n\r\n            let enabledProvider: [string, any] | undefined;\r\n\r\n            // Priority order: prefer Perplexity (has built-in web search), then preferred, then others\r\n            const providerPriority = ['perplexity', opts?.preferredModelProvider, 'anthropic', 'openai', 'google', 'deepseek', 'cohere', 'openrouter'];\r\n\r\n            for (const key of providerPriority) {\r\n                if (!key) continue;\r\n                const cfg = configToUse[key as keyof typeof configToUse];\r\n                if (cfg?.enabled && await hasValidKey(key, cfg)) {\r\n                    enabledProvider = [key, cfg];\r\n                    if (key === 'perplexity') {\r\n                        summary.webSearchUsed = true;\r\n                        console.log('Using Perplexity for web search capability');\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (!enabledProvider) {\r\n                throw new Error('No enabled API provider found. Please configure an API provider in Sync settings.');\r\n            }\r\n\r\n            const [providerKey, providerConfig] = enabledProvider;\r\n\r\n            // Import validation functions\r\n            const { createDatabaseValidationPrompt, parseCSVToModels } = await import('../services/validation');\r\n            const { callProviderText } = await import('../services/api');\r\n\r\n            const batchSize = Math.max(1, opts?.batchSize ?? 50);\r\n            const pauseMs = Math.max(0, opts?.pauseMs ?? 0);\r\n            const maxBatches = opts?.maxBatches && opts.maxBatches > 0 ? opts.maxBatches : Infinity;\r\n            let allValidatedModels: Model[] = [];\r\n\r\n            const { convertModelsToCSV } = await import('../services/validation');\r\n            const fullCsv = convertModelsToCSV(modelsToValidate);\r\n            const estimatedTokensFull = Math.ceil(fullCsv.length / 4);\r\n            const tokenSoftLimit = 180000;\r\n            const modelCountSoftLimit = 250;\r\n            const shouldBatch = estimatedTokensFull > tokenSoftLimit || modelsToValidate.length > modelCountSoftLimit;\r\n\r\n            if (shouldBatch) {\r\n                console.warn(`Hybrid: switching to batch mode ÔÇó ${modelsToValidate.length} models ÔÇó est ~${estimatedTokensFull} tokens. Batch size ${batchSize}.`);\r\n\r\n                let batchIndex = 0;\r\n                let processed = 0;\r\n                setValidationProgress({ current: 0, total: modelsToValidate.length });\r\n                for (let i = 0; i < modelsToValidate.length; i += batchSize) {\r\n                    batchIndex++;\r\n                    if (cancelDbValidationRef.current) {\r\n                        console.warn('Validation cancelled by user');\r\n                        break;\r\n                    }\r\n                    if (batchIndex > maxBatches) {\r\n                        console.warn(`Max batches (${maxBatches}) reached. Stopping early.`);\r\n                        allValidatedModels = allValidatedModels.concat(modelsToValidate.slice(i));\r\n                        break;\r\n                    }\r\n                    const batch = modelsToValidate.slice(i, i + batchSize);\r\n                    const batchNum = Math.floor(i / batchSize) + 1;\r\n                    const totalBatches = Math.ceil(modelsToValidate.length / batchSize);\r\n\r\n                    console.log(`Processing batch ${batchNum}/${totalBatches} (${batch.length} models)...`);\r\n\r\n                    try {\r\n                        const validationPrompt = createDatabaseValidationPrompt(batch);\r\n                        const systemPrompt = SYSTEM_PROMPT_VALIDATION;\r\n\r\n                        let csvData = await callProviderText(\r\n                            providerKey as any,\r\n                            providerConfig,\r\n                            systemPrompt,\r\n                            validationPrompt,\r\n                            { signal: validationAbortRef.current?.signal }\r\n                        );\r\n\r\n                        if (!csvData) {\r\n                            console.warn(`No response for batch ${batchNum}, keeping original models...`);\r\n                            allValidatedModels = allValidatedModels.concat(batch);\r\n                            continue;\r\n                        }\r\n\r\n                        const csvStartMarkers = ['id,name,provider', 'id,\"name\",\"provider'];\r\n                        let csvStart = -1;\r\n\r\n                        for (const marker of csvStartMarkers) {\r\n                            csvStart = csvData.indexOf(marker);\r\n                            if (csvStart !== -1) break;\r\n                        }\r\n\r\n                        if (csvStart !== -1) {\r\n                            csvData = csvData.substring(csvStart);\r\n                        }\r\n\r\n                        const batchValidatedModels = parseCSVToModels(csvData);\r\n\r\n                        if (batchValidatedModels.length === 0) {\r\n                            console.warn(`Batch ${batchNum} returned 0 models - keeping original ${batch.length} models`);\r\n                            allValidatedModels = allValidatedModels.concat(batch);\r\n                        } else if (batchValidatedModels.length < batch.length) {\r\n                            console.warn(`Batch ${batchNum} lost models! Expected ${batch.length}, got ${batchValidatedModels.length}`);\r\n                            console.warn(`Merging validated models with originals to prevent data loss...`);\r\n\r\n                            const validatedMap = new Map(batchValidatedModels.map(m => [m.id, m]));\r\n\r\n                            const mergedBatch = batch.map(original => {\r\n                                const validated = validatedMap.get(original.id);\r\n                                if (validated) {\r\n                                    // Track changes\r\n                                    trackFieldUpdates(original, validated, summary);\r\n\r\n                                    return {\r\n                                        ...original,\r\n                                        ...validated,\r\n                                        name: validated.name || original.name,\r\n                                        provider: validated.provider || original.provider,\r\n                                        description: validated.description || original.description,\r\n                                        parameters: validated.parameters || original.parameters,\r\n                                        context_window: validated.context_window || original.context_window,\r\n                                        release_date: validated.release_date || original.release_date,\r\n                                        updated_at: validated.updated_at || original.updated_at,\r\n                                        tags: (validated.tags && validated.tags.length > 0) ? validated.tags : original.tags,\r\n                                        // PRESERVE user flags - these should NEVER be overwritten by validation\r\n                                        isFavorite: original.isFavorite,\r\n                                        isNSFWFlagged: original.isNSFWFlagged,\r\n                                        flaggedImageUrls: original.flaggedImageUrls,\r\n                                    };\r\n                                }\r\n                                return original;\r\n                            });\r\n\r\n                            allValidatedModels = allValidatedModels.concat(mergedBatch);\r\n                            console.log(`Batch ${batchNum} merged: ${mergedBatch.length} models preserved`);\r\n                        } else {\r\n                            allValidatedModels = allValidatedModels.concat(batchValidatedModels);\r\n                            console.log(`Batch ${batchNum} processed: ${batchValidatedModels.length} models validated`);\r\n                        }\r\n\r\n                    } catch (batchError: any) {\r\n                        console.error(`Error processing batch ${batchNum}:`, batchError);\r\n                        if (batchError?.name === 'AbortError') {\r\n                            console.warn('Batch processing aborted by user');\r\n                            break;\r\n                        }\r\n                        allValidatedModels = allValidatedModels.concat(batch);\r\n                    }\r\n\r\n                    processed = Math.min(modelsToValidate.length, i + batch.length);\r\n                    setValidationProgress({ current: processed, total: modelsToValidate.length });\r\n\r\n                    if (cancelDbValidationRef.current) {\r\n                        console.warn('[CANCEL] Validation cancelled during batch processing');\r\n                        break;\r\n                    }\r\n\r\n                    if (pauseMs > 0 && (i + batchSize) < modelsToValidate.length) {\r\n                        console.log(`Waiting ${Math.round(pauseMs / 1000)}s before next batch...`);\r\n                        const until = Date.now() + pauseMs;\r\n                        const checkInterval = 100;\r\n                        while (Date.now() < until) {\r\n                            if (cancelDbValidationRef.current) {\r\n                                console.warn('[CANCEL] Validation cancelled during pause');\r\n                                break;\r\n                            }\r\n                            await new Promise(r => setTimeout(r, checkInterval));\r\n                        }\r\n                        if (cancelDbValidationRef.current) {\r\n                            console.warn('[CANCEL] Validation cancelled by user');\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                console.log(`Batch processing complete: ${allValidatedModels.length} total models`);\r\n                summary.modelsUpdated = allValidatedModels.length;\r\n                setValidationProgress(null);\r\n                setIsValidating(false);\r\n                return {\r\n                    success: true,\r\n                    updatedModels: allValidatedModels,\r\n                    summary\r\n                };\r\n\r\n            } else {\r\n                console.log(`Hybrid: single-request mode ÔÇó ${modelsToValidate.length} models ÔÇó est ~${estimatedTokensFull} tokens.`);\r\n                console.log('Sending full database CSV to GPT for validation (single request)...');\r\n                console.log(`Database size: ${modelsToValidate.length} models`);\r\n                console.log(`Using provider: ${providerKey}`);\r\n                setValidationProgress({ current: 0, total: modelsToValidate.length });\r\n\r\n                const validationPrompt = createDatabaseValidationPrompt(modelsToValidate);\r\n\r\n                let csvData = await callProviderText(\r\n                    providerKey as any,\r\n                    providerConfig,\r\n                    SYSTEM_PROMPT_VALIDATION_SHORT,\r\n                    validationPrompt,\r\n                    { signal: validationAbortRef.current?.signal }\r\n                );\r\n\r\n                if (!csvData) {\r\n                    throw new Error('No response from AI provider');\r\n                }\r\n\r\n                console.log('Received CSV response, length:', csvData.length);\r\n\r\n                const csvStartMarkers = ['id,name,provider', 'id,\"name\",\"provider'];\r\n                let csvStart = -1;\r\n\r\n                for (const marker of csvStartMarkers) {\r\n                    csvStart = csvData.indexOf(marker);\r\n                    if (csvStart !== -1) break;\r\n                }\r\n\r\n                if (csvStart === -1) {\r\n                    console.error('Raw AI response:', csvData);\r\n                    throw new Error('Could not find CSV data in AI response. The AI may not have followed the format.');\r\n                }\r\n\r\n                csvData = csvData.substring(csvStart);\r\n\r\n                const lines = csvData.split('\\n');\r\n                const validLines = [];\r\n                for (const line of lines) {\r\n                    if (line.trim() && (line.includes(',') || validLines.length === 0)) {\r\n                        validLines.push(line);\r\n                    } else if (validLines.length > 0) {\r\n                        break;\r\n                    }\r\n                }\r\n                csvData = validLines.join('\\n');\r\n\r\n                console.log('Parsing validated data...');\r\n\r\n                const validatedModels = parseCSVToModels(csvData);\r\n\r\n                if (validatedModels.length === 0) {\r\n                    throw new Error('No valid models found in AI response. The validation may have failed.');\r\n                }\r\n\r\n                // Track changes for summary\r\n                validatedModels.forEach(updated => {\r\n                    const original = modelsToValidate.find(m => m.id === updated.id);\r\n                    if (original) {\r\n                        trackFieldUpdates(original, updated, summary);\r\n                    }\r\n                });\r\n\r\n                console.log(`Successfully validated ${validatedModels.length} models`);\r\n                summary.modelsUpdated = validatedModels.length;\r\n                setValidationProgress(null);\r\n                setIsValidating(false);\r\n                return {\r\n                    success: true,\r\n                    updatedModels: validatedModels,\r\n                    summary\r\n                };\r\n            }\r\n\r\n        } catch (error: any) {\r\n            console.error('Database validation error:', error);\r\n            summary.errors++;\r\n            setValidationProgress(null);\r\n            setIsValidating(false);\r\n            return {\r\n                success: false,\r\n                error: error?.name === 'AbortError' ? 'Validation cancelled by user' : (error instanceof Error ? error.message : String(error)),\r\n                summary\r\n            };\r\n        } finally {\r\n            validationAbortRef.current = null;\r\n        }\r\n    };\r\n\r\n    return {\r\n        isValidating,\r\n        validationJobs,\r\n        validationProgress,\r\n        startValidation,\r\n        pauseValidation,\r\n        resumeValidation,\r\n        stopValidation,\r\n        clearFinishedValidationJobs,\r\n        hasConfiguredProviders,\r\n        getEnabledProviders,\r\n        showValidationModal,\r\n        openValidationModal,\r\n        closeValidationModal,\r\n        validateEntireDatabase\r\n    };\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useModels.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useNSFWScan.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'models'. Either include it or remove the dependency array.","line":108,"column":8,"nodeType":"ArrayExpression","endLine":108,"endColumn":80,"suggestions":[{"desc":"Update the dependencies array to be: [models.length, isLoading, customNSFWKeywords, setModels, addConsoleLog, models]","fix":{"range":[4172,4244],"text":"[models.length, isLoading, customNSFWKeywords, setModels, addConsoleLog, models]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * NSFW Scan Hook\r\n * \r\n * Handles retroactive NSFW tagging of models on initial load.\r\n * Uses the detectNSFW utility to identify and tag/untag models.\r\n */\r\n\r\nimport { useEffect, useRef } from 'react';\r\nimport { Model } from '../types';\r\nimport { detectNSFW } from '../utils/nsfw';\r\n\r\ninterface UseNSFWScanOptions {\r\n    /** Current models in the database */\r\n    models: Model[];\r\n    /** Whether the app is still loading */\r\n    isLoading: boolean;\r\n    /** Custom NSFW keywords from settings */\r\n    customNSFWKeywords: string[];\r\n    /** Function to update models */\r\n    setModels: React.Dispatch<React.SetStateAction<Model[]>>;\r\n    /** Logging function */\r\n    addConsoleLog: (message: string) => void;\r\n}\r\n\r\n/**\r\n * Retroactively scan models for NSFW content on initial load.\r\n * This runs once when models are loaded to ensure old models get tagged\r\n * and fixes false positives by re-evaluating all models.\r\n */\r\nexport function useNSFWScan({\r\n    models,\r\n    isLoading,\r\n    customNSFWKeywords,\r\n    setModels,\r\n    addConsoleLog,\r\n}: UseNSFWScanOptions) {\r\n    const hasRunNSFWScan = useRef(false);\r\n\r\n    useEffect(() => {\r\n        // Only run once after initial load\r\n        if (hasRunNSFWScan.current || models.length === 0 || isLoading) return;\r\n        hasRunNSFWScan.current = true;\r\n\r\n        // Re-evaluate ALL models to catch new ones and fix false positives\r\n        const modelsToFlag: Model[] = [];\r\n        const modelsToUnflag: Model[] = [];\r\n\r\n        for (const model of models) {\r\n            // Run NSFW detection\r\n            const nsfwCheck = detectNSFW(model, customNSFWKeywords || []);\r\n\r\n            if (nsfwCheck.isNSFW) {\r\n                // Should be flagged - check if it already is\r\n                if (!model.isNSFWFlagged && !model.tags?.includes('nsfw')) {\r\n                    modelsToFlag.push({\r\n                        ...model,\r\n                        isNSFWFlagged: true,\r\n                        tags: [...new Set([...(model.tags || []), 'nsfw'])]\r\n                    });\r\n                }\r\n            } else {\r\n                // Should NOT be flagged - unflag if it was a false positive\r\n                if (model.isNSFWFlagged || model.tags?.includes('nsfw')) {\r\n                    modelsToUnflag.push({\r\n                        ...model,\r\n                        isNSFWFlagged: false,\r\n                        tags: (model.tags || []).filter(t => t !== 'nsfw')\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        if (modelsToFlag.length > 0 || modelsToUnflag.length > 0) {\r\n            if (modelsToFlag.length > 0) {\r\n                addConsoleLog(`[NSFW Scan] Tagged ${modelsToFlag.length} models as NSFW`);\r\n            }\r\n            if (modelsToUnflag.length > 0) {\r\n                addConsoleLog(`[NSFW Scan] Untagged ${modelsToUnflag.length} false positives`);\r\n            }\r\n\r\n            setModels(prev => {\r\n                const flaggedIds = new Set(modelsToFlag.map(m => m.id));\r\n                const unflaggedIds = new Set(modelsToUnflag.map(m => m.id));\r\n\r\n                return prev.map(m => {\r\n                    if (flaggedIds.has(m.id)) {\r\n                        const flaggedModel = modelsToFlag.find(u => u.id === m.id)!;\r\n                        // Preserve existing user flags while updating with flagged model data\r\n                        return {\r\n                            ...flaggedModel,\r\n                            isFavorite: m.isFavorite,\r\n                            flaggedImageUrls: m.flaggedImageUrls\r\n                        };\r\n                    }\r\n                    if (unflaggedIds.has(m.id)) {\r\n                        const unflaggedModel = modelsToUnflag.find(u => u.id === m.id)!;\r\n                        // Preserve existing user flags while updating with unflagged model data\r\n                        return {\r\n                            ...unflaggedModel,\r\n                            isFavorite: m.isFavorite,\r\n                            flaggedImageUrls: m.flaggedImageUrls\r\n                        };\r\n                    }\r\n                    return m;\r\n                });\r\n            });\r\n        }\r\n    }, [models.length, isLoading, customNSFWKeywords, setModels, addConsoleLog]);\r\n\r\n    /**\r\n     * Reset the scan flag to allow re-scanning (useful for testing or manual trigger)\r\n     */\r\n    const resetScan = () => {\r\n        hasRunNSFWScan.current = false;\r\n    };\r\n\r\n    return { resetScan };\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useOnlineStatus.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useSyncHistory.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useSyncOperations.ts","messages":[{"ruleId":"no-unsafe-finally","severity":2,"message":"Unsafe usage of ReturnStatement.","line":166,"column":17,"nodeType":"ReturnStatement","messageId":"unsafeUsage","endLine":166,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback } from 'react';\r\nimport { Model, ApiDir } from '../types';\r\nimport { syncAllSources, syncWithLiveOptions } from '../services/syncService';\r\nimport { dedupe } from '../utils/format';\r\nimport { Settings } from '../context/SettingsContext';\r\n\r\ninterface SyncCallbacks {\r\n    setIsSyncing: (syncing: boolean) => void;\r\n    setSyncProgress: (progress: any) => void;\r\n    setSyncSummary: (summary: any) => void;\r\n    addConsoleLog: (msg: string) => void;\r\n    setModels: React.Dispatch<React.SetStateAction<Model[]>>;\r\n    mergeInModels: (models: Model[]) => void;\r\n    setLastMergeStats: (stats: any) => void;\r\n    setLastSync: (date: string) => void;\r\n    setPage: (page: number) => void;\r\n    setFlaggedModels: (models: Model[]) => void;\r\n    setShowFlaggedModal: (show: boolean) => void;\r\n    saveSnapshot: (models: Model[], description: string) => void;\r\n    setShowSync?: (show: boolean) => void;\r\n}\r\n\r\ninterface UseSyncOperationsOptions {\r\n    models: Model[];\r\n    settings: Settings;\r\n    callbacks: SyncCallbacks;\r\n}\r\n\r\n/**\r\n * Hook for handling all sync-related operations\r\n * Extracts sync logic from AIModelDB for better modularity\r\n */\r\nexport function useSyncOperations({ models, settings, callbacks }: UseSyncOperationsOptions) {\r\n    const {\r\n        setIsSyncing,\r\n        setSyncProgress,\r\n        setSyncSummary,\r\n        addConsoleLog,\r\n        setModels,\r\n        mergeInModels,\r\n        setLastMergeStats,\r\n        setLastSync,\r\n        setPage,\r\n        setFlaggedModels,\r\n        setShowFlaggedModal,\r\n        saveSnapshot,\r\n        setShowSync\r\n    } = callbacks;\r\n\r\n    /**\r\n     * Syncs model data from all configured sources\r\n     */\r\n    const syncAll = useCallback(async (showSpinner = true) => {\r\n        try {\r\n            if (showSpinner) setIsSyncing(true);\r\n            setLastMergeStats(null);\r\n\r\n            // Save a snapshot before sync (for rollback)\r\n            if (models.length > 0) {\r\n                saveSnapshot(models, `Pre-sync backup (${models.length} models)`);\r\n                addConsoleLog(\"Created pre-sync snapshot for rollback\");\r\n            }\r\n\r\n            const result = await syncAllSources(\r\n                {\r\n                    dataSources: settings.dataSources || {},\r\n                    artificialAnalysisApiKey: settings.artificialAnalysisApiKey,\r\n                    enableNSFWFiltering: settings.enableNSFWFiltering,\r\n                    logNSFWAttempts: settings.logNSFWAttempts,\r\n                    apiConfig: settings.apiConfig,\r\n                    preferredModelProvider: settings.preferredModelProvider,\r\n                    systemPrompt: settings.systemPrompt\r\n                },\r\n                {\r\n                    onProgress: setSyncProgress,\r\n                    onLog: addConsoleLog,\r\n                    onModelsUpdate: (newModels) => {\r\n                        setModels(prev => dedupe([...(prev || []), ...newModels]));\r\n                    }\r\n                }\r\n            );\r\n\r\n            const uniqueCount = dedupe(result.complete).length;\r\n            const dups = Math.max(0, result.complete.length - uniqueCount);\r\n            setSyncSummary({ found: result.complete.length, flagged: result.flagged.length, duplicates: dups });\r\n            mergeInModels(result.complete);\r\n            setLastSync(new Date().toISOString());\r\n            setPage(1);\r\n\r\n            if (result.flagged.length > 0) {\r\n                setFlaggedModels(result.flagged);\r\n                setShowFlaggedModal(true);\r\n            }\r\n\r\n            setTimeout(() => {\r\n                if (showSpinner) {\r\n                    setSyncProgress(null);\r\n                    setIsSyncing(false);\r\n                }\r\n            }, 1500);\r\n        } catch (error) {\r\n            console.error(\"Error syncing models:\", error);\r\n            addConsoleLog(`Error syncing models: ${error instanceof Error ? error.message : String(error)}`);\r\n            if (showSpinner) {\r\n                setSyncProgress(null);\r\n                setIsSyncing(false);\r\n            }\r\n        }\r\n    }, [\r\n        models, settings, setIsSyncing, setLastMergeStats, saveSnapshot, addConsoleLog,\r\n        setSyncProgress, setModels, mergeInModels, setSyncSummary, setLastSync, setPage,\r\n        setFlaggedModels, setShowFlaggedModal\r\n    ]);\r\n\r\n    /**\r\n     * Handles live sync with AI services and custom options\r\n     */\r\n    const handleLiveSync = useCallback(async (options?: {\r\n        autoRefresh?: { enabled: boolean, interval: number, unit: string },\r\n        minDownloadsBypass?: number,\r\n        systemPrompt?: string,\r\n        apiConfig?: ApiDir\r\n    }) => {\r\n        if (options?.systemPrompt && options?.apiConfig) {\r\n            setIsSyncing(true);\r\n            setLastMergeStats(null);\r\n            try {\r\n                const result = await syncWithLiveOptions(\r\n                    {\r\n                        dataSources: settings.dataSources || {},\r\n                        artificialAnalysisApiKey: settings.artificialAnalysisApiKey,\r\n                        enableNSFWFiltering: settings.enableNSFWFiltering,\r\n                        logNSFWAttempts: settings.logNSFWAttempts,\r\n                        apiConfig: options.apiConfig,\r\n                        preferredModelProvider: settings.preferredModelProvider,\r\n                        systemPrompt: options.systemPrompt,\r\n                        autoRefresh: options.autoRefresh,\r\n                        minDownloadsBypass: options.minDownloadsBypass\r\n                    },\r\n                    {\r\n                        onProgress: setSyncProgress,\r\n                        onLog: addConsoleLog\r\n                    }\r\n                );\r\n\r\n                const uniqueCount = dedupe(result.complete).length;\r\n                const dups = Math.max(0, result.complete.length - uniqueCount);\r\n                setSyncSummary({ found: result.complete.length, flagged: result.flagged.length, duplicates: dups });\r\n                mergeInModels(result.complete);\r\n                setLastSync(new Date().toISOString());\r\n                setPage(1);\r\n\r\n                if (result.flagged.length > 0) {\r\n                    setFlaggedModels(result.flagged);\r\n                    setShowFlaggedModal(true);\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Error syncing models:\", err);\r\n                addConsoleLog(`Error syncing models: ${err instanceof Error ? err.message : String(err)}`);\r\n            } finally {\r\n                setTimeout(() => {\r\n                    setSyncProgress(null);\r\n                    setIsSyncing(false);\r\n                    setShowSync?.(false);\r\n                }, 1500);\r\n                return;\r\n            }\r\n        } else {\r\n            await syncAll(true);\r\n        }\r\n        setShowSync?.(false);\r\n    }, [\r\n        settings, setIsSyncing, setLastMergeStats, setSyncProgress, addConsoleLog,\r\n        mergeInModels, setSyncSummary, setLastSync, setPage, setFlaggedModels,\r\n        setShowFlaggedModal, setShowSync, syncAll\r\n    ]);\r\n\r\n    return {\r\n        syncAll,\r\n        handleLiveSync\r\n    };\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useSyncState.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":76,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":76,"endColumn":20,"suggestions":[{"fix":{"range":[2728,2772],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Sync State Hook\r\n * \r\n * Manages synchronization state including sync status, progress tracking,\r\n * last sync timestamp, and sync summary for toast notifications.\r\n * \r\n * @module useSyncState\r\n */\r\n\r\nimport { useState, useRef, useCallback, MutableRefObject } from 'react';\r\n\r\n/**\r\n * Sync state interface containing all sync-related state and setters\r\n */\r\nexport interface SyncState {\r\n    // Sync status\r\n    isSyncing: boolean;\r\n    setIsSyncing: (syncing: boolean) => void;\r\n\r\n    // Sync progress\r\n    syncProgress: { current: number; total: number; source?: string; found?: number; statusMessage?: string } | null;\r\n    setSyncProgress: (progress: { current: number; total: number; source?: string; found?: number; statusMessage?: string } | null) => void;\r\n\r\n    // Last sync timestamp\r\n    lastSync: string | null;\r\n    setLastSync: (timestamp: string | null) => void;\r\n\r\n    // Sync summary (for toast display)\r\n    syncSummary: { found: number; flagged: number; duplicates?: number } | null;\r\n    setSyncSummary: (summary: { found: number; flagged: number; duplicates?: number } | null) => void;\r\n}\r\n\r\n/**\r\n * Custom hook for managing sync state.\r\n * \r\n * Provides centralized state management for synchronization operations including:\r\n * - Sync status (is syncing)\r\n * - Progress tracking (current/total sources)\r\n * - Last sync timestamp\r\n * - Sync summary for toast display\r\n * \r\n * @returns SyncState object with all state values and setter functions\r\n * \r\n * @example\r\n * ```tsx\r\n * const syncState = useSyncState();\r\n * \r\n * // Start sync\r\n * syncState.setIsSyncing(true);\r\n * syncState.setSyncProgress({ current: 1, total: 5 });\r\n * \r\n * // Complete sync\r\n * syncState.setIsSyncing(false);\r\n * syncState.setLastSync(new Date().toISOString());\r\n * syncState.setSyncSummary({ found: 100, flagged: 5 });\r\n * ```\r\n */\r\nexport function useSyncState(): SyncState & { skipSignal: MutableRefObject<boolean>; triggerSkip: () => void } {\r\n    // Sync status state\r\n    const [isSyncing, setIsSyncing] = useState(false);\r\n\r\n    // Sync progress state\r\n    const [syncProgress, setSyncProgress] = useState<{ current: number; total: number; source?: string; found?: number; statusMessage?: string } | null>(null);\r\n\r\n    // Last sync timestamp state\r\n    const [lastSync, setLastSync] = useState<string | null>(null);\r\n\r\n    // Sync summary state (for displaying toast after sync)\r\n    const [syncSummary, setSyncSummary] = useState<{ found: number; flagged: number; duplicates?: number } | null>(null);\r\n\r\n    // Skip signal ref - can be checked by async operations to abort early\r\n    const skipSignal = useRef(false);\r\n\r\n    const triggerSkip = useCallback(() => {\r\n        skipSignal.current = true;\r\n        console.log('[Sync] Skip signal triggered');\r\n    }, []);\r\n\r\n    return {\r\n        isSyncing,\r\n        setIsSyncing,\r\n        syncProgress,\r\n        setSyncProgress,\r\n        lastSync,\r\n        setLastSync,\r\n        syncSummary,\r\n        setSyncSummary,\r\n        skipSignal,\r\n        triggerSkip,\r\n    };\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useUIState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useValidationState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\hooks\\useWindowEvents.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\i18n\\index.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":79,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":79,"endColumn":16,"suggestions":[{"fix":{"range":[2772,2837],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * i18n Configuration\r\n * \r\n * Uses local JSON translation files for best performance and reliability.\r\n * Supports 10 languages with auto-detection.\r\n */\r\n\r\nimport i18n from 'i18next';\r\nimport { initReactI18next } from 'react-i18next';\r\nimport LanguageDetector from 'i18next-browser-languagedetector';\r\n\r\n// Import local translation files\r\nimport en from './locales/en.json';\r\nimport zh from './locales/zh.json';\r\nimport ja from './locales/ja.json';\r\nimport ko from './locales/ko.json';\r\nimport es from './locales/es.json';\r\nimport fr from './locales/fr.json';\r\nimport de from './locales/de.json';\r\nimport pt from './locales/pt.json';\r\nimport ru from './locales/ru.json';\r\nimport ar from './locales/ar.json';\r\n\r\n// Available languages\r\nexport const SUPPORTED_LANGUAGES = [\r\n    { code: 'en', name: 'English', nativeName: 'English' },\r\n    { code: 'zh', name: 'Chinese', nativeName: 'õ©¡µûç' },\r\n    { code: 'ja', name: 'Japanese', nativeName: 'µùÑµ£¼Þ¬×' },\r\n    { code: 'ko', name: 'Korean', nativeName: 'Ýò£ÛÁ¡ýû┤' },\r\n    { code: 'es', name: 'Spanish', nativeName: 'Espa├▒ol' },\r\n    { code: 'fr', name: 'French', nativeName: 'Fran├ºais' },\r\n    { code: 'de', name: 'German', nativeName: 'Deutsch' },\r\n    { code: 'pt', name: 'Portuguese', nativeName: 'Portugu├¬s' },\r\n    { code: 'ru', name: 'Russian', nativeName: 'ðáÐâÐüÐüð║ð©ð╣' },\r\n    { code: 'ar', name: 'Arabic', nativeName: 'Ïº┘äÏ╣Ï▒Ï¿┘èÏ®', rtl: true },\r\n] as const;\r\n\r\nexport type LanguageCode = typeof SUPPORTED_LANGUAGES[number]['code'];\r\n\r\n// Initialize i18n\r\ni18n\r\n    .use(LanguageDetector)\r\n    .use(initReactI18next)\r\n    .init({\r\n        resources: {\r\n            en: { translation: en },\r\n            zh: { translation: zh },\r\n            ja: { translation: ja },\r\n            ko: { translation: ko },\r\n            es: { translation: es },\r\n            fr: { translation: fr },\r\n            de: { translation: de },\r\n            pt: { translation: pt },\r\n            ru: { translation: ru },\r\n            ar: { translation: ar },\r\n        },\r\n        fallbackLng: 'en',\r\n        debug: process.env.NODE_ENV === 'development',\r\n\r\n        interpolation: {\r\n            escapeValue: false, // React already escapes values\r\n        },\r\n\r\n        detection: {\r\n            order: ['localStorage', 'navigator'],\r\n            lookupLocalStorage: 'aiModelDB_language',\r\n            caches: ['localStorage'],\r\n        }\r\n    });\r\n\r\n// Placeholder for compatibility with previous dynamic implementation\r\n// This allows us to keep the interface consistent even if we switch back to static files\r\nexport async function translateToLanguage(targetLang: LanguageCode): Promise<void> {\r\n    await i18n.changeLanguage(targetLang);\r\n}\r\n\r\nexport function clearTranslationCache() {\r\n    // No-op for static files, but kept for compatibility\r\n    console.log('[i18n] Cache clear requested (using static files)');\r\n}\r\n\r\nexport default i18n;\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\main.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":21,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":21,"endColumn":12,"suggestions":[{"fix":{"range":[543,605],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport App from './App'\nimport './index.css'\nimport './i18n'; // Initialize i18n\nimport { migrateLocalStorageKeys } from './utils/migration';\n\n// Run one-time migration from old key prefix (aiModelDBPro_) to new (aiModelDB_)\nmigrateLocalStorageKeys();\n\n// Create and mount the React application\nconst rootElement = document.getElementById('root')!;\nconst root = ReactDOM.createRoot(rootElement);\n\nroot.render(\n    <React.StrictMode>\n        <App />\n    </React.StrictMode>\n);\n\nconsole.log('[AI Model DB] Application mounted successfully');\n\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\enrichment\\enrichment-orchestrator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\enrichment\\github-enricher.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\enrichment\\huggingface-enricher.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\enrichment\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\enrichment\\web-scraper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\fetchers\\artificial-analysis.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":15,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":15,"endColumn":24,"suggestions":[{"fix":{"range":[650,722],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":22,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":22,"endColumn":20,"suggestions":[{"fix":{"range":[897,975],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":29,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":29,"endColumn":20,"suggestions":[{"fix":{"range":[1136,1191],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":48,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":48,"endColumn":28,"suggestions":[{"fix":{"range":[2200,2291],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":61,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":61,"endColumn":28,"suggestions":[{"fix":{"range":[2827,2902],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":65,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":65,"endColumn":28,"suggestions":[{"fix":{"range":[3029,3116],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":187,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":187,"endColumn":20,"suggestions":[{"fix":{"range":[9787,9885],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Model } from '../../../types';\r\nimport { normalizeDate } from '../utils';\r\nimport { isModelComplete } from '../filtering';\r\nimport { fetchWrapper } from '../../../utils/fetch-wrapper';\r\n\r\n/**\r\n * Fetch models from ArtificialAnalysis API - all endpoints\r\n * @param apiKey Optional API key for ArtificialAnalysis\r\n * @returns Object containing complete and flagged models\r\n */\r\nexport async function fetchArtificialAnalysisIndex(apiKey?: string): Promise<{ complete: Model[], flagged: Model[] }> {\r\n    try {\r\n        // If apiKey is not provided, skip entirely to avoid 401 errors\r\n        if (!apiKey || apiKey.trim() === '') {\r\n            console.log('[ArtificialAnalysis] Skipping fetch: No API key provided');\r\n            return { complete: [], flagged: [] };\r\n        }\r\n\r\n        // Clean the key to remove accidental whitespace\r\n        const cleanKey = apiKey.trim();\r\n\r\n        console.log('[ArtificialAnalysis] Fetching models from all API endpoints...');\r\n\r\n        const headers: Record<string, string> = {\r\n            'Content-Type': 'application/json',\r\n            'x-api-key': cleanKey\r\n        };\r\n\r\n        console.log(`[ArtificialAnalysis] Using API key: Yes`);\r\n\r\n        // Fetch from all available endpoints\r\n        // Based on Artificial Analysis API documentation: https://artificialanalysis.ai/documentation\r\n        // API requires authentication via x-api-key header\r\n        const baseUrl = 'https://artificialanalysis.ai/api/v2/data';\r\n        const endpoints = [\r\n            { url: `${baseUrl}/llms/models`, domain: 'LLM' as const, type: 'Text LLM' },\r\n            { url: `${baseUrl}/media/image-editing`, domain: 'ImageGen' as const, type: 'Image Editing' },\r\n            { url: `${baseUrl}/media/text-to-speech`, domain: 'TTS' as const, type: 'Text-to-Speech' },\r\n            { url: `${baseUrl}/media/text-to-video`, domain: 'VideoGen' as const, type: 'Text-to-Video' },\r\n            { url: `${baseUrl}/media/image-to-video`, domain: 'VideoGen' as const, type: 'Image-to-Video' },\r\n        ];\r\n\r\n        const allModels: Model[] = [];\r\n\r\n        // Fetch from each endpoint\r\n        for (const endpoint of endpoints) {\r\n            try {\r\n                console.log(`[ArtificialAnalysis] Fetching ${endpoint.type} models from: ${endpoint.url}`);\r\n                // Use direct fetch instead of fetchWrapper for static deployment\r\n                const response = await fetch(endpoint.url, {\r\n                    headers,\r\n                    mode: 'cors' // Enable CORS\r\n                });\r\n\r\n                if (!response.ok) {\r\n                    console.error(`[ArtificialAnalysis] ${endpoint.type} error: ${response.status} ${response.statusText}`);\r\n                    continue;\r\n                }\r\n\r\n                const apiData = await response.json();\r\n                console.log(`[ArtificialAnalysis] ${endpoint.type} API response received`);\r\n\r\n                // Parse models from API response\r\n                const modelsData = apiData.data || [];\r\n                console.log(`[ArtificialAnalysis] Found ${modelsData.length} ${endpoint.type} models`);\r\n\r\n                for (const item of modelsData) {\r\n                    if (!item.name) continue;\r\n\r\n                    // Extract pricing information\r\n                    const pricing = [];\r\n                    if (item.pricing) {\r\n                        const pricingEntry: any = {\r\n                            model: item.name,\r\n                            unit: '1M tokens',\r\n                            currency: 'USD',\r\n                            url: null\r\n                        };\r\n\r\n                        // Only add input/output if they have valid non-zero values\r\n                        if (item.pricing.price_1m_input_tokens && item.pricing.price_1m_input_tokens > 0) {\r\n                            pricingEntry.input = item.pricing.price_1m_input_tokens;\r\n                        }\r\n                        if (item.pricing.price_1m_output_tokens && item.pricing.price_1m_output_tokens > 0) {\r\n                            pricingEntry.output = item.pricing.price_1m_output_tokens;\r\n                        }\r\n                        if (item.pricing.price_1m_blended_3_to_1 && item.pricing.price_1m_blended_3_to_1 > 0) {\r\n                            pricingEntry.notes = `Blended 3:1 ~ ${item.pricing.price_1m_blended_3_to_1}/1M`;\r\n                        }\r\n\r\n                        // Only add pricing entry if it has at least one valid price field\r\n                        if (pricingEntry.input || pricingEntry.output || pricingEntry.notes) {\r\n                            pricing.push(pricingEntry);\r\n                        }\r\n                    }\r\n\r\n                    // Try to infer/normalize release date from AA fields\r\n                    const aaReleaseRaw = item.release_date || item.first_seen || item.published_at || item.created_at || item.date;\r\n                    const normalizedRelease = normalizeDate(aaReleaseRaw) || null;\r\n\r\n                    // Extract benchmarks from AA data\r\n                    const benchmarks = [];\r\n                    if (item.elo) {\r\n                        benchmarks.push({ name: 'ELO Rating', score: item.elo, unit: 'elo', source: 'ArtificialAnalysis' });\r\n                    }\r\n                    if (item.rank) {\r\n                        benchmarks.push({ name: 'Rank', score: item.rank, unit: 'rank', source: 'ArtificialAnalysis' });\r\n                    }\r\n                    if (item.quality_index) {\r\n                        benchmarks.push({ name: 'Quality Index', score: item.quality_index, unit: 'score', source: 'ArtificialAnalysis' });\r\n                    }\r\n                    if (item.speed) {\r\n                        benchmarks.push({ name: 'Speed', score: item.speed, unit: 'tokens/s', source: 'ArtificialAnalysis' });\r\n                    }\r\n                    if (item.price_index) {\r\n                        benchmarks.push({ name: 'Price Index', score: item.price_index, unit: 'index', source: 'ArtificialAnalysis' });\r\n                    }\r\n\r\n                    // Check for future/unreleased dates\r\n                    const tags: string[] = ['commercial', endpoint.type.toLowerCase(), 'benchmarked', item.model_creator?.slug].filter(Boolean) as string[];\r\n                    let isFutureRelease = false;\r\n\r\n                    if (normalizedRelease) {\r\n                        const releaseDate = new Date(normalizedRelease);\r\n                        // Check if release date is in the future (compared to now)\r\n                        if (releaseDate > new Date()) {\r\n                            isFutureRelease = true;\r\n                            tags.push('unreleased', 'leaked', 'future-release');\r\n                        }\r\n                    }\r\n\r\n                    // Extract images from API response\r\n                    const images: string[] = [];\r\n                    // Try various possible image fields from AA API\r\n                    if (item.logo) images.push(item.logo);\r\n                    if (item.image) images.push(item.image);\r\n                    if (item.thumbnail) images.push(item.thumbnail);\r\n                    if (item.icon) images.push(item.icon);\r\n                    if (item.model_creator?.logo) images.push(item.model_creator.logo);\r\n                    if (item.model_creator?.icon) images.push(item.model_creator.icon);\r\n                    // Deduplicate\r\n                    const uniqueImages = [...new Set(images)];\r\n\r\n                    const model: Model = {\r\n                        id: `aa-${item.id || item.slug}`,\r\n                        name: item.name,\r\n                        description: `${item.name} - Artificial Analysis benchmarked ${endpoint.type} model (Rank #${item.rank}, ELO: ${item.elo})${isFutureRelease ? ' [UNRELEASED/SPECULATIVE]' : ''}`,\r\n                        provider: item.model_creator?.name || 'Unknown',\r\n                        domain: endpoint.domain,\r\n                        source: 'ArtificialAnalysis',\r\n                        url: item.slug ? `https://artificialanalysis.ai/models/${item.slug}` : 'https://artificialanalysis.ai/models',\r\n                        repo: null,\r\n                        license: {\r\n                            name: 'Commercial',\r\n                            type: 'Proprietary',\r\n                            commercial_use: true,\r\n                            attribution_required: true, // API requires attribution\r\n                            share_alike: false,\r\n                            copyleft: false\r\n                        },\r\n                        pricing,\r\n                        updated_at: normalizeDate(item.updated_at) || new Date().toISOString(),\r\n                        release_date: normalizedRelease,\r\n                        tags,\r\n                        parameters: null,\r\n                        context_window: null,\r\n                        indemnity: 'VendorProgram',\r\n                        data_provenance: 'Commercial',\r\n                        usage_restrictions: [],\r\n                        hosting: {\r\n                            weights_available: false,\r\n                            api_available: true,\r\n                            on_premise_friendly: false\r\n                        },\r\n                        downloads: undefined,\r\n                        benchmarks: benchmarks.length > 0 ? benchmarks : undefined,\r\n                        images: uniqueImages.length > 0 ? uniqueImages : undefined\r\n                    };\r\n\r\n                    allModels.push(model);\r\n                }\r\n            } catch (endpointError: any) {\r\n                console.error(`[ArtificialAnalysis] ${endpoint.type} error:`, endpointError?.message || endpointError);\r\n            }\r\n        }\r\n\r\n        console.log(`[ArtificialAnalysis] Processed ${allModels.length} total models from all endpoints`);\r\n\r\n        // Enrich missing data minimally: try to infer release date from name/slug if still missing\r\n        for (const m of allModels) {\r\n            if (!m.release_date) {\r\n                const nameYear = String(m.name || '').match(/(20\\d{2})/);\r\n                if (nameYear) m.release_date = `${nameYear[1]}-01-01`;\r\n            }\r\n        }\r\n\r\n        // Separate complete vs flagged models\r\n        const complete = allModels.filter(isModelComplete);\r\n        const flagged = allModels.filter(m => !isModelComplete(m));\r\n\r\n        return { complete, flagged };\r\n\r\n    } catch (err: any) {\r\n        console.error('[ArtificialAnalysis] API error:', err?.message || err);\r\n        return { complete: [], flagged: [] };\r\n    }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\fetchers\\chinese-platforms\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\fetchers\\creative-platforms\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\fetchers\\github.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":48,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":48,"endColumn":16,"suggestions":[{"fix":{"range":[2412,2491],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"prefer-const","severity":1,"message":"'complete' is never reassigned. Use 'const' instead.","line":50,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":50,"endColumn":26,"fix":{"range":[2499,2526],"text":"const complete: Model[] = [];"}},{"ruleId":"prefer-const","severity":1,"message":"'flagged' is never reassigned. Use 'const' instead.","line":51,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":51,"endColumn":25,"fix":{"range":[2532,2558],"text":"const flagged: Model[] = [];"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":2,"source":"import { Domain, Model } from '../../../types';\r\nimport { cleanId } from '../../../utils/format';\r\nimport { proxyUrl } from '../config';\r\nimport { determineType, determineCommercialUse } from '../utils';\r\nimport { isModelComplete } from '../filtering';\r\n\r\n/**\r\n * Helper function to determine domain from GitHub repository topics\r\n */\r\nfunction determineDomainFromTopics(topics: string[]): Domain {\r\n    const topicsStr = topics.join(' ').toLowerCase();\r\n\r\n    if (topicsStr.includes('text-to-image') || topicsStr.includes('diffusion') || topicsStr.includes('image-generation')) {\r\n        return 'ImageGen';\r\n    } else if (topicsStr.includes('llm') || topicsStr.includes('language-model') || topicsStr.includes('gpt') ||\r\n        topicsStr.includes('chatbot') || topicsStr.includes('transformers')) {\r\n        return 'LLM';\r\n    } else if (topicsStr.includes('computer-vision') || topicsStr.includes('object-detection') ||\r\n        topicsStr.includes('image-recognition') || topicsStr.includes('multimodal') || topicsStr.includes('vlm')) {\r\n        return 'VLM';\r\n    } else if (topicsStr.includes('lora') || topicsStr.includes('peft') || topicsStr.includes('adapter')) {\r\n        return 'LoRA';\r\n    } else if (topicsStr.includes('fine-tune') || topicsStr.includes('finetune') || topicsStr.includes('fine-tuned') || topicsStr.includes('sft')) {\r\n        return 'FineTune';\r\n    } else if (topicsStr.includes('text-to-speech')) {\r\n        return 'TTS';\r\n    } else if (topicsStr.includes('text-to-video') || topicsStr.includes('video-generation')) {\r\n        return 'VideoGen';\r\n    } else if (topicsStr.includes('audio') || topicsStr.includes('music-generation')) {\r\n        return 'Audio';\r\n    } else if (topicsStr.includes('speech-recognition') || topicsStr.includes('asr')) {\r\n        return 'ASR';\r\n    } else if (topicsStr.includes('3d') || topicsStr.includes('3d-generation')) {\r\n        return '3D';\r\n    } else if (topicsStr.includes('world-model') || topicsStr.includes('simulation')) {\r\n        return 'World/Sim';\r\n    }\r\n\r\n    return 'Other';\r\n}\r\n\r\n/**\r\n * Fetches popular generative AI repositories from GitHub API\r\n * @param limit Number of repositories to fetch\r\n * @param gitHubToken Optional GitHub personal access token for higher rate limits\r\n */\r\nexport async function fetchPopularGenerativeRepos(limit = 30, gitHubToken?: string): Promise<{ complete: Model[], flagged: Model[] }> {\r\n    console.log(`[GitHub] Fetching popular generative repos (limit: ${limit})...`);\r\n\r\n    let complete: Model[] = [];\r\n    let flagged: Model[] = [];\r\n\r\n    try {\r\n        const query = encodeURIComponent(\r\n            \"machine-learning OR deep-learning OR AI OR llm OR stable-diffusion OR text-generation\"\r\n        );\r\n        const url = proxyUrl(\r\n            `/github-api/search/repositories?q=${query}+stars:>50+language:python&sort=stars&order=desc&per_page=${limit}`,\r\n            `https://api.github.com/search/repositories?q=${query}+stars:>50+language:python&sort=stars&order=desc&per_page=${limit}`\r\n        );\r\n        // Use provided token or empty string (no token = lower rate limits)\r\n        const token = gitHubToken || '';\r\n        const response = await fetch(url, {\r\n            headers: {\r\n                'Accept': 'application/vnd.github+json',\r\n                'X-GitHub-Api-Version': '2022-11-28',\r\n                'User-Agent': 'ai-model-db-pro',\r\n                ...(token ? { 'Authorization': `Bearer ${token}` } : {})\r\n            }\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const text = await response.text();\r\n            console.error(`[GitHub] ERROR: Status ${response.status} ${response.statusText}. Response: ${text}`);\r\n            return { complete: [], flagged: [] };\r\n        }\r\n\r\n        const data = await response.json();\r\n        const repos = data.items || [];\r\n\r\n        if (!repos.length) {\r\n            console.error('[GitHub] API did not return any repositories:', data);\r\n            return { complete: [], flagged: [] };\r\n        }\r\n\r\n        // Map GitHub API response to Model[]\r\n        repos.forEach((repo: any) => {\r\n            // Extract topics to help determine domain\r\n            const topics = repo.topics || [];\r\n            const topicsStr = topics.join(' ').toLowerCase();\r\n            const description = (repo.description || \"\").toLowerCase();\r\n\r\n            // Skip repositories that are likely not actual models but tools, libraries, or inference engines\r\n            if (\r\n                topicsStr.includes('inference-engine') ||\r\n                topicsStr.includes('inference-server') ||\r\n                description.includes('inference server') ||\r\n                description.includes('inference engine') ||\r\n                description.includes('deployment') ||\r\n                (description.includes('framework') && !description.includes('model')) ||\r\n                repo.name.toLowerCase().includes('inference')\r\n            ) {\r\n                return;\r\n            }\r\n\r\n            const model: Model = {\r\n                id: cleanId(repo.name),\r\n                name: repo.name,\r\n                provider: repo.owner?.login || \"GitHub\",\r\n                domain: determineDomainFromTopics(topics),\r\n                source: \"GitHub\",\r\n                url: repo.html_url,\r\n                repo: repo.html_url,\r\n                license: {\r\n                    name: repo.license?.name || \"Unknown\",\r\n                    type: determineType(repo.license?.name),\r\n                    commercial_use: determineCommercialUse(repo.license?.name),\r\n                    attribution_required: repo.license?.name?.toLowerCase().includes(\"attribution\"),\r\n                    share_alike: repo.license?.name?.toLowerCase().includes(\"share-alike\"),\r\n                    copyleft: repo.license?.name?.toLowerCase().includes(\"gpl\")\r\n                },\r\n                downloads: repo.stargazers_count,\r\n                updated_at: repo.updated_at,\r\n                release_date: repo.created_at,\r\n                tags: topics,\r\n                hosting: {\r\n                    weights_available: true,\r\n                    api_available: false,\r\n                    on_premise_friendly: true\r\n                }\r\n            };\r\n\r\n            if (isModelComplete(model)) {\r\n                complete.push(model);\r\n            } else {\r\n                flagged.push(model);\r\n            }\r\n        });\r\n\r\n        return { complete, flagged };\r\n    } catch (err: any) {\r\n        console.error('[GitHub] Fetch error:', err?.message || err);\r\n        return { complete: [], flagged: [] };\r\n    }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\fetchers\\huggingface-details.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":18,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":18,"endColumn":20,"suggestions":[{"fix":{"range":[533,591],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":82,"column":21,"nodeType":"MemberExpression","messageId":"limited","endLine":82,"endColumn":32,"suggestions":[{"fix":{"range":[3272,3352],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { proxyUrl } from '../config';\r\nimport { fetchWrapper } from '../../../utils/fetch-wrapper';\r\n\r\nexport interface ModelGalleryDetails {\r\n    images?: string[];\r\n    description?: string;\r\n}\r\n\r\n/**\r\n * Fetch detailed information (images) from HuggingFace API\r\n * \r\n * @param modelId - The HuggingFace model ID (e.g. \"meta-llama/Llama-2-7b\")\r\n * @returns Detailed model information including images\r\n */\r\nexport async function fetchHuggingFaceDetails(modelId: string): Promise<ModelGalleryDetails | null> {\r\n    try {\r\n        console.log(`[HuggingFace Details] Fetching: ${modelId}`);\r\n\r\n        const prodUrl = `https://huggingface.co/api/models/${modelId}`;\r\n        let data: any;\r\n\r\n        // Use Electron proxy if available to bypass CORS\r\n        if (window.electronAPI?.proxyRequest) {\r\n            // Use the Electron proxy for production\r\n            const result = await window.electronAPI.proxyRequest({\r\n                url: prodUrl,\r\n                method: 'GET'\r\n            });\r\n\r\n            if (!result.success) {\r\n                console.error(`[HuggingFace Details] Proxy error: ${result.error}`);\r\n                return null;\r\n            }\r\n\r\n            data = typeof result.data === 'string' ? JSON.parse(result.data) : result.data;\r\n        } else {\r\n            // Fallback for dev environment or browser\r\n            const url = proxyUrl(\r\n                `/huggingface-api/models/${modelId}`,\r\n                prodUrl\r\n            );\r\n\r\n            const response = await fetchWrapper(url);\r\n            if (!response.ok) {\r\n                console.error(`[HuggingFace Details] ERROR: Status ${response.status}`);\r\n                return null;\r\n            }\r\n\r\n            data = await response.json();\r\n        }\r\n        const images: string[] = [];\r\n\r\n        // Check siblings for image files (including in subdirectories)\r\n        if (data.siblings && Array.isArray(data.siblings)) {\r\n            data.siblings.forEach((file: any) => {\r\n                const filename = file.rfilename;\r\n                if (filename) {\r\n                    // Match images anywhere in the path (e.g., assets/image.png, samples/test.jpg)\r\n                    if (/\\.(png|jpg|jpeg|webp|gif)$/i.test(filename)) {\r\n                        // Skip common non-preview images\r\n                        const lowerName = filename.toLowerCase();\r\n                        if (lowerName.includes('thumbnail') ||\r\n                            lowerName.includes('logo') ||\r\n                            lowerName.includes('icon') ||\r\n                            lowerName.includes('badge')) {\r\n                            return;\r\n                        }\r\n                        // Construct raw URL using SHA if available for stability\r\n                        const ref = data.sha || 'main';\r\n                        images.push(`https://huggingface.co/${modelId}/resolve/${ref}/${filename}`);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // If no images found in file list, try parsing README.md\r\n        if (images.length === 0) {\r\n            try {\r\n                const readmeFile = data.siblings?.find((f: any) => f.rfilename.toLowerCase() === 'readme.md');\r\n                if (readmeFile) {\r\n                    console.log('[HuggingFace Details] No images in file list, fetching README...');\r\n                    const ref = data.sha || 'main';\r\n                    const readmeUrl = `https://huggingface.co/${modelId}/raw/${ref}/${readmeFile.rfilename}`;\r\n\r\n                    let readmeContent = '';\r\n\r\n                    if (window.electronAPI?.proxyRequest) {\r\n                        const result = await window.electronAPI.proxyRequest({ url: readmeUrl, method: 'GET' });\r\n                        if (result.success && typeof result.data === 'string') {\r\n                            readmeContent = result.data;\r\n                        }\r\n                    } else {\r\n                        const url = proxyUrl(`/huggingface-readme/${modelId}`, readmeUrl);\r\n                        const res = await fetchWrapper(url);\r\n                        if (res.ok) readmeContent = await res.text();\r\n                    }\r\n\r\n                    if (readmeContent) {\r\n                        // Extract Markdown images: ![alt](url)\r\n                        const mdRegex = /!\\[.*?\\]\\((.*?)\\)/g;\r\n                        let match;\r\n                        while ((match = mdRegex.exec(readmeContent)) !== null) {\r\n                            let imgUrl = match[1];\r\n                            if (imgUrl && !imgUrl.startsWith('http')) {\r\n                                // Resolve relative URL\r\n                                imgUrl = `https://huggingface.co/${modelId}/resolve/${ref}/${imgUrl}`;\r\n                            }\r\n                            if (imgUrl && /\\.(png|jpg|jpeg|webp|gif)$/i.test(imgUrl)) {\r\n                                images.push(imgUrl);\r\n                            }\r\n                        }\r\n\r\n                        // Extract HTML images: <img src=\"url\">\r\n                        const htmlRegex = /<img[^>]+src=[\"']([^\"']+)[\"'][^>]*>/g;\r\n                        while ((match = htmlRegex.exec(readmeContent)) !== null) {\r\n                            let imgUrl = match[1];\r\n                            if (imgUrl && !imgUrl.startsWith('http')) {\r\n                                // Resolve relative URL\r\n                                imgUrl = `https://huggingface.co/${modelId}/resolve/${ref}/${imgUrl}`;\r\n                            }\r\n                            if (imgUrl && /\\.(png|jpg|jpeg|webp|gif)$/i.test(imgUrl)) {\r\n                                images.push(imgUrl);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                console.warn('[HuggingFace Details] Failed to parse README for images:', e);\r\n            }\r\n        }\r\n\r\n        // Limit to reasonable amount\r\n        const limitedImages = images.slice(0, 10);\r\n\r\n        return {\r\n            images: limitedImages,\r\n            description: data.cardData?.description // Sometimes present in cardData\r\n        };\r\n\r\n    } catch (err: any) {\r\n        console.error('[HuggingFace Details] Fetch error:', err?.message || err);\r\n        return null;\r\n    }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\fetchers\\huggingface.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\fetchers\\image-platforms\\civitai.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":16,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":16,"endColumn":20,"suggestions":[{"fix":{"range":[608,679],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":23,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":23,"endColumn":20,"suggestions":[{"fix":{"range":[863,933],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":106,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":106,"endColumn":24,"suggestions":[{"fix":{"range":[4423,4511],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":198,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":198,"endColumn":20,"suggestions":[{"fix":{"range":[8870,8956],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":199,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":199,"endColumn":20,"suggestions":[{"fix":{"range":[8966,9018],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":200,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":200,"endColumn":20,"suggestions":[{"fix":{"range":[9028,9119],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":201,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":201,"endColumn":20,"suggestions":[{"fix":{"range":[9129,9204],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":202,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":202,"endColumn":20,"suggestions":[{"fix":{"range":[9214,9297],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":210,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":210,"endColumn":20,"suggestions":[{"fix":{"range":[9631,9721],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Model } from '../../../../types';\r\nimport { isModelComplete } from '../../filtering';\r\nimport { safeFetch } from '../../utils/http-utils';\r\n\r\n/**\r\n * Fetch generative AI models from Civitai by scraping\r\n * \r\n * WARNING: Civitai is blocked in the UK due to the Online Safety Act (OSA).\r\n * This fetcher is disabled by default in syncService.ts\r\n * \r\n * @param limit Maximum number of models to fetch (default: 500)\r\n * @returns Object containing complete and flagged models\r\n */\r\nexport async function fetchCivitai(limit = 500): Promise<{ complete: Model[], flagged: Model[] }> {\r\n    try {\r\n        console.log('[Civitai] Fetching generative AI models via scraping...');\r\n\r\n        const models: Model[] = [];\r\n        let html = '';\r\n\r\n        // Always try to fetch directly from the website\r\n        const url = 'https://civitai.com/models';\r\n        console.log(`[Civitai] Scraping from generative AI platform: ${url}`);\r\n\r\n        try {\r\n            const resp = await safeFetch(url);\r\n            if (resp && resp.ok) {\r\n                html = await resp.text();\r\n            } else {\r\n                console.warn(`[Civitai] Scraping unavailable, using fallback models`);\r\n            }\r\n        } catch (fetchError: any) {\r\n            console.warn(`[Civitai] Fetch failed, using fallback models:`, fetchError?.message);\r\n        }\r\n\r\n        // Parse HTML to extract model information\r\n        const modelPattern = /<div[^>]*class=\"[^\"]*model[^\"]*card[^\"]*\"[^>]*>(.*?)<\\/div>/gs;\r\n        const titlePattern = /<h[1-6][^>]*>(.*?)<\\/h[1-6]>/i;\r\n        const descPattern = /<p[^>]*class=\"[^\"]*description[^\"]*\"[^>]*>(.*?)<\\/p>/i;\r\n        const typePattern = /<span[^>]*class=\"[^\"]*type[^\"]*\"[^>]*>(.*?)<\\/span>/i;\r\n        const downloadsPattern = /(\\d+(?:,\\d+)*)\\s*downloads?/i;\r\n\r\n        let match;\r\n        let modelCount = 0;\r\n\r\n        while ((match = modelPattern.exec(html)) !== null && modelCount < Math.min(limit, 100)) {\r\n            const modelHtml = match[1];\r\n\r\n            const titleMatch = titlePattern.exec(modelHtml);\r\n            const title = titleMatch ? titleMatch[1].replace(/<[^>]*>/g, '').trim() : null;\r\n\r\n            if (!title || title.length < 3) continue;\r\n\r\n            const descMatch = descPattern.exec(modelHtml);\r\n            const description = descMatch ? descMatch[1].replace(/<[^>]*>/g, '').trim() : `${title} - Community-shared generative AI model`;\r\n\r\n            const typeMatch = typePattern.exec(modelHtml);\r\n            const type = typeMatch ? typeMatch[1].replace(/<[^>]*>/g, '').trim() : 'Checkpoint';\r\n\r\n            const downloadsMatch = downloadsPattern.exec(modelHtml);\r\n            const downloads = downloadsMatch ? parseInt(downloadsMatch[1].replace(/,/g, '')) : undefined;\r\n\r\n            // Determine domain from model type\r\n            let domain: any = 'ImageGen';\r\n            if (type === 'LORA' || type === 'LoCon') domain = 'LoRA';\r\n            else if (type === 'Upscaler') domain = 'Upscaler';\r\n\r\n            models.push({\r\n                id: `civitai-${modelCount + 1}`,\r\n                name: title,\r\n                description: description,\r\n                provider: 'Civitai Community',\r\n                domain,\r\n                source: 'Civitai',\r\n                url: `https://civitai.com/models/${modelCount + 1}`,\r\n                repo: null,\r\n                license: {\r\n                    name: 'CreativeML Open RAIL++-M',\r\n                    type: 'Custom',\r\n                    commercial_use: true,\r\n                    attribution_required: true,\r\n                    share_alike: false,\r\n                    copyleft: false\r\n                },\r\n                tags: [type.toLowerCase(), 'community', 'generative'],\r\n                hosting: {\r\n                    weights_available: true,\r\n                    api_available: false,\r\n                    on_premise_friendly: true\r\n                },\r\n                updated_at: new Date().toISOString(),\r\n                release_date: null,\r\n                parameters: null,\r\n                context_window: null,\r\n                indemnity: 'None',\r\n                data_provenance: 'Community',\r\n                usage_restrictions: ['Attribution required'],\r\n                downloads: downloads\r\n            });\r\n\r\n            modelCount++;\r\n        }\r\n\r\n        // If scraping didn't work, add known Civitai models\r\n        if (models.length === 0) {\r\n            console.log('[Civitai] Scraping found no models, adding known generative AI models...');\r\n\r\n            const knownModels = [\r\n                {\r\n                    id: 'civitai-realistic-vision',\r\n                    name: 'Realistic Vision v6.0',\r\n                    description: 'Photorealistic image generation model with exceptional detail and accuracy',\r\n                    provider: 'Civitai Community',\r\n                    domain: 'ImageGen' as const,\r\n                    source: 'Civitai',\r\n                    url: 'https://civitai.com/models/4201',\r\n                    repo: null,\r\n                    license: {\r\n                        name: 'CreativeML Open RAIL++-M',\r\n                        type: 'Custom' as const,\r\n                        commercial_use: true,\r\n                        attribution_required: true,\r\n                        share_alike: false,\r\n                        copyleft: false\r\n                    },\r\n                    tags: ['photorealistic', 'checkpoint', 'community', 'high-quality'],\r\n                    hosting: { weights_available: true, api_available: false, on_premise_friendly: true },\r\n                    updated_at: new Date().toISOString(),\r\n                    release_date: null,\r\n                    parameters: '2.3B',\r\n                    context_window: null,\r\n                    indemnity: 'None' as const,\r\n                    data_provenance: 'Community',\r\n                    usage_restrictions: ['Attribution required'],\r\n                    downloads: 5000000\r\n                },\r\n                {\r\n                    id: 'civitai-dreamshaper',\r\n                    name: 'DreamShaper v8',\r\n                    description: 'Versatile artistic model for creative image generation with vibrant colors',\r\n                    provider: 'Civitai Community',\r\n                    domain: 'ImageGen' as const,\r\n                    source: 'Civitai',\r\n                    url: 'https://civitai.com/models/4384',\r\n                    repo: null,\r\n                    license: {\r\n                        name: 'CreativeML Open RAIL++-M',\r\n                        type: 'Custom' as const,\r\n                        commercial_use: true,\r\n                        attribution_required: true,\r\n                        share_alike: false,\r\n                        copyleft: false\r\n                    },\r\n                    tags: ['artistic', 'checkpoint', 'versatile', 'community'],\r\n                    hosting: { weights_available: true, api_available: false, on_premise_friendly: true },\r\n                    updated_at: new Date().toISOString(),\r\n                    release_date: null,\r\n                    parameters: '2.1B',\r\n                    context_window: null,\r\n                    indemnity: 'None' as const,\r\n                    data_provenance: 'Community',\r\n                    usage_restrictions: ['Attribution required'],\r\n                    downloads: 3500000\r\n                },\r\n                {\r\n                    id: 'civitai-detail-tweaker',\r\n                    name: 'Detail Tweaker LoRA',\r\n                    description: 'LoRA for enhancing fine details and textures in generated images',\r\n                    provider: 'Civitai Community',\r\n                    domain: 'LoRA' as const,\r\n                    source: 'Civitai',\r\n                    url: 'https://civitai.com/models/58390',\r\n                    repo: null,\r\n                    license: {\r\n                        name: 'CreativeML Open RAIL++-M',\r\n                        type: 'Custom' as const,\r\n                        commercial_use: true,\r\n                        attribution_required: true,\r\n                        share_alike: false,\r\n                        copyleft: false\r\n                    },\r\n                    tags: ['lora', 'detail-enhancement', 'community'],\r\n                    hosting: { weights_available: true, api_available: false, on_premise_friendly: true },\r\n                    updated_at: new Date().toISOString(),\r\n                    release_date: null,\r\n                    parameters: '144M',\r\n                    context_window: null,\r\n                    indemnity: 'None' as const,\r\n                    data_provenance: 'Community',\r\n                    usage_restrictions: ['Attribution required'],\r\n                    downloads: 1200000\r\n                }\r\n            ];\r\n\r\n            models.push(...knownModels);\r\n        }\r\n\r\n        console.log(`[Civitai] Successfully processed ${models.length} generative AI models`);\r\n        console.log(`[Civitai] Model breakdown by domain:`);\r\n        console.log(`  - Image Generation: ${models.filter(m => m.domain === 'ImageGen').length}`);\r\n        console.log(`  - LoRA: ${models.filter(m => m.domain === 'LoRA').length}`);\r\n        console.log(`  - Upscaler: ${models.filter(m => m.domain === 'Upscaler').length}`);\r\n\r\n        // Note: NSFW filtering is now handled by the global sync service based on user settings\r\n        // This fetcher returns all models, and filtering happens in syncService.ts if enabled\r\n\r\n        const complete = models.filter(isModelComplete);\r\n        const flagged = models.filter(m => !isModelComplete(m));\r\n\r\n        console.log(`[Civitai] Final - Complete: ${complete.length}, Flagged: ${flagged.length}`);\r\n\r\n        return { complete, flagged };\r\n\r\n    } catch (err: any) {\r\n        console.error('[Civitai] Fetch error:', err?.message || err);\r\n        return { complete: [], flagged: [] };\r\n    }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\fetchers\\image-platforms\\civitas-bay-details.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":47,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":47,"endColumn":20,"suggestions":[{"fix":{"range":[1324,1388],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":59,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":59,"endColumn":20,"suggestions":[{"fix":{"range":[1763,1820],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":114,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":114,"endColumn":20,"suggestions":[{"fix":{"range":[3769,3863],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":115,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":115,"endColumn":20,"suggestions":[{"fix":{"range":[3873,3929],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { proxyUrl } from '../../config';\r\nimport { fetchWrapper } from '../../../../utils/fetch-wrapper';\r\n\r\nexport interface CivitasBayDetails {\r\n    civitaiUrl?: string;\r\n    imageUrl?: string;\r\n    fullDescription?: string;\r\n    creator?: string;\r\n    version?: string;\r\n    baseModel?: string;\r\n    fileSize?: string;\r\n    hash?: string;\r\n    images?: string[];\r\n}\r\n\r\n/**\r\n * CivitasBay API response structure (partial)\r\n */\r\ninterface CivitasBayApiResponse {\r\n    name?: string;\r\n    description?: string;\r\n    civitai_url?: string;\r\n    civitai_model_id?: number;\r\n    civitai_version_id?: number;\r\n    base_model?: string;\r\n    creator?: string;\r\n    media?: Array<{\r\n        url: string;\r\n        type?: string;\r\n        width?: number;\r\n        height?: number;\r\n    }>;\r\n}\r\n\r\n/**\r\n * Fetch detailed information from CivitasBay's JSON API\r\n * \r\n * CivitasBay has a hidden JSON API at /api/torrents/{BTIH_HASH}\r\n * This returns full model details including image URLs from imagecache.civitai.com\r\n * which is accessible even in regions where CivitAI is blocked.\r\n * \r\n * @param torrentPageUrl - The CivitasBay torrent page URL\r\n * @returns Detailed model information including images\r\n */\r\nexport async function fetchCivitasBayDetails(torrentPageUrl: string): Promise<CivitasBayDetails | null> {\r\n    try {\r\n        console.log(`[CivitasBay Details] Fetching: ${torrentPageUrl}`);\r\n\r\n        // Extract the hash from the URL\r\n        const hashMatch = torrentPageUrl.match(/torrents\\/([A-F0-9]+)/i);\r\n        if (!hashMatch) {\r\n            console.error('[CivitasBay Details] Invalid URL format');\r\n            return null;\r\n        }\r\n\r\n        const hash = hashMatch[1];\r\n        const apiUrl = `https://civitasbay.org/api/torrents/${hash}`;\r\n\r\n        console.log(`[CivitasBay Details] Using API: ${apiUrl}`);\r\n\r\n        let data: CivitasBayApiResponse;\r\n\r\n        // Use Electron proxy if available to bypass CORS\r\n        if (window.electronAPI?.proxyRequest) {\r\n            const result = await window.electronAPI.proxyRequest({\r\n                url: apiUrl,\r\n                method: 'GET'\r\n            });\r\n\r\n            if (!result.success) {\r\n                console.error(`[CivitasBay Details] Proxy error: ${result.error}`);\r\n                return null;\r\n            }\r\n\r\n            data = typeof result.data === 'string' ? JSON.parse(result.data) : result.data;\r\n        } else {\r\n            // Fallback for dev environment or browser\r\n            const url = proxyUrl(`/civitasbay-api/api/torrents/${hash}`, apiUrl);\r\n            const response = await fetchWrapper(url);\r\n            if (!response.ok) {\r\n                console.error(`[CivitasBay Details] ERROR: Status ${response.status}`);\r\n                return null;\r\n            }\r\n            data = await response.json();\r\n        }\r\n\r\n        // Extract details from API response\r\n        const details: CivitasBayDetails = {\r\n            hash,\r\n            civitaiUrl: data.civitai_url || undefined,\r\n            fullDescription: data.description || undefined,\r\n            creator: data.creator || undefined,\r\n            baseModel: data.base_model || undefined,\r\n        };\r\n\r\n        // Extract all media from API (images and videos)\r\n        const images: string[] = [];\r\n        if (data.media && Array.isArray(data.media)) {\r\n            data.media.forEach((item) => {\r\n                if (item.url && !images.includes(item.url)) {\r\n                    images.push(item.url);\r\n                }\r\n            });\r\n        }\r\n\r\n        // Limit to 10 items to avoid memory issues\r\n        details.images = images.slice(0, 10);\r\n\r\n        // Use first item as main\r\n        if (details.images.length > 0) {\r\n            details.imageUrl = details.images[0];\r\n        }\r\n\r\n        console.log(`[CivitasBay Details] Found ${details.images?.length || 0} media items from API`);\r\n        console.log(`[CivitasBay Details] Extracted:`, details);\r\n        return details;\r\n\r\n    } catch (err: any) {\r\n        console.error('[CivitasBay Details] Fetch error:', err?.message || err);\r\n        return null;\r\n    }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\fetchers\\image-platforms\\civitas-bay.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":28,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":28,"endColumn":20,"suggestions":[{"fix":{"range":[1354,1371],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Model, ApiDir } from '../../../../types';\r\nimport { proxyUrl } from '../../config';\r\nimport { isModelComplete } from '../../filtering';\r\nimport { normalizeDate, normalizeLicenseName, determineType, determineCommercialUse } from '../../utils';\r\nimport { fetchWrapper } from '../../../../utils/fetch-wrapper';\r\n\r\n// Note: NSFW filtering is now handled by the global sync service based on user settings\r\n// Individual fetchers return all models, and filtering happens in syncService.ts if enabled\r\n\r\n/**\r\n * Fetch preserved AI models from CivitasBay torrent platform\r\n * \r\n * CivitasBay is a preservation platform for AI models via torrents.\r\n * Uses RSS feed for discovery with STRICT NSFW filtering.\r\n * Fetches multiple pages to get comprehensive model list.\r\n * \r\n * @param apiConfig - Optional API configuration for filtering\r\n * @param onLog - Optional callback to receive progress updates for UI display\r\n * @param onConfirmLLMCheck - Optional callback to confirm large LLM checks\r\n * @returns Object containing complete and flagged models\r\n */\r\nexport async function fetchCivitasBay(\r\n    apiConfig?: ApiDir,\r\n    onLog?: (message: string) => void,\r\n    onConfirmLLMCheck?: (modelCount: number, estimatedTimeMs: number) => Promise<boolean>\r\n): Promise<{ complete: Model[], flagged: Model[] }> {\r\n    const log = (msg: string) => {\r\n        console.log(msg);\r\n        if (onLog) onLog(msg);\r\n    };\r\n\r\n    try {\r\n        log('[CivitasBay] Fetching models from RSS feed...');\r\n\r\n        const models: Model[] = [];\r\n        const seenIds = new Set<string>();\r\n\r\n        // Fetch all pages until we reach the end\r\n        // Fetch pages concurrently in batches\r\n        let page = 1;\r\n        const CONCURRENT_BATCH = 5;\r\n        let keepFetching = true;\r\n\r\n        while (keepFetching) {\r\n            const pagePromises = [];\r\n            for (let i = 0; i < CONCURRENT_BATCH; i++) {\r\n                pagePromises.push((async (p) => {\r\n                    log(`[CivitasBay] Fetching page ${p}...`);\r\n                    const prodUrl = `https://civitasbay.org/rss/torrents?sort_by=recent&page=${p}`;\r\n                    const url = proxyUrl(`/civitasbay-api/rss/page${p}`, prodUrl);\r\n\r\n                    try {\r\n                        let xmlText: string;\r\n\r\n                        // Use Electron proxy if available to bypass CORS\r\n                        if (window.electronAPI?.proxyRequest) {\r\n                            const result = await window.electronAPI.proxyRequest({\r\n                                url: prodUrl,\r\n                                method: 'GET'\r\n                            });\r\n\r\n                            if (!result.success) {\r\n                                console.error(`[CivitasBay] Proxy error on page ${p}: ${result.error}`);\r\n                                return { page: p, items: [] };\r\n                            }\r\n                            xmlText = typeof result.data === 'string' ? result.data : JSON.stringify(result.data);\r\n                        } else {\r\n                            const response = await fetchWrapper(url);\r\n                            if (!response.ok) return { page: p, items: [] };\r\n                            xmlText = await response.text();\r\n                        }\r\n\r\n                        const parser = new DOMParser();\r\n                        const xmlDoc = parser.parseFromString(xmlText, 'text/xml');\r\n                        const xmlItems = xmlDoc.querySelectorAll('item');\r\n\r\n                        return { page: p, items: Array.from(xmlItems) };\r\n                    } catch (e) {\r\n                        console.error(`[CivitasBay] Error on page ${p}:`, e);\r\n                        return { page: p, items: [] };\r\n                    }\r\n                })(page + i));\r\n            }\r\n\r\n            const results = await Promise.all(pagePromises);\r\n\r\n            // Process results in order\r\n            for (const result of results.sort((a, b) => a.page - b.page)) {\r\n                if (result.items.length === 0) {\r\n                    keepFetching = false;\r\n                    log(`[CivitasBay] Reached end at page ${result.page}`);\r\n                    // Don't break immediately, process earlier pages in batch, but stop future batches\r\n                } else {\r\n                    log(`[CivitasBay] Found ${result.items.length} items on page ${result.page}`);\r\n\r\n                    // Process items (logic extracted)\r\n                    result.items.forEach((item, index) => {\r\n                        // ... item processing logic ...\r\n                        // RE-INSERT EXISTING ITEM PROCESSING LOGIC HERE\r\n                        // Since replace_file_content replaces a block, I need to include the processing logic \r\n                        // or extract it to a helper function. \r\n                        // To keep it simple in one tool call, I will paste the logic.\r\n\r\n                        try {\r\n                            const title = item.querySelector('title')?.textContent || '';\r\n                            const link = item.querySelector('link')?.textContent || '';\r\n                            const description = item.querySelector('description')?.textContent || '';\r\n                            const pubDate = item.querySelector('pubDate')?.textContent || '';\r\n                            const guid = item.querySelector('guid')?.textContent || '';\r\n\r\n                            let seeds = 0;\r\n                            const seedsField = item.querySelector('torrent\\\\:seeds');\r\n                            if (seedsField?.textContent) seeds = parseInt(seedsField.textContent, 10) || 0;\r\n\r\n                            if (!title || !link) return;\r\n\r\n                            // Note: NSFW filtering is now handled by the global sync service based on user settings\r\n\r\n                            const modelId = guid || link.split('/').pop() || `civitasbay-${result.page}-${index}`;\r\n                            if (seenIds.has(modelId)) return;\r\n                            seenIds.add(modelId);\r\n\r\n                            let modelName = title;\r\n                            let version = '';\r\n                            const versionMatch = title.match(/\\bv(\\d+(?:\\.\\d+)*)\\b/i);\r\n                            if (versionMatch) {\r\n                                version = versionMatch[1];\r\n                                modelName = title.replace(/\\s*v\\d+(?:\\.\\d+)*\\b/i, '').trim();\r\n                            }\r\n                            modelName = modelName.replace(/\\s*-\\s*[^-]+$/, '').trim();\r\n\r\n                            let licenseName = 'Unknown';\r\n                            const licenseMatch = description.match(/license[:\\s]+([^\\n,]+)/i);\r\n                            if (licenseMatch) licenseName = licenseMatch[1].trim();\r\n\r\n                            const tags = new Set<string>(['preserved', 'torrent', 'community-archive']);\r\n                            if (version) tags.add(`v${version}`);\r\n\r\n                            const combinedText = `${title} ${description}`.toLowerCase();\r\n                            const modelTypes = [\r\n                                'checkpoint', 'lora', 'lycoris', 'embedding', 'textual-inversion',\r\n                                'hypernetwork', 'aesthetic-gradient', 'controlnet', 'vae', 'upscaler'\r\n                            ];\r\n                            modelTypes.forEach(type => {\r\n                                if (combinedText.includes(type) || combinedText.includes(type.replace('-', ' '))) {\r\n                                    tags.add(type);\r\n                                }\r\n                            });\r\n                            const styles = [\r\n                                'realistic', 'anime', 'cartoon', 'semi-realistic', '2.5d', '3d',\r\n                                'photorealistic', 'illustration', 'artistic', 'fantasy', 'sci-fi'\r\n                            ];\r\n                            styles.forEach(style => {\r\n                                if (combinedText.includes(style) || combinedText.includes(style.replace('-', ' '))) {\r\n                                    tags.add(style);\r\n                                }\r\n                            });\r\n                            const baseModels = [\r\n                                'sd1.5', 'sd2.1', 'sdxl', 'sd3', 'flux', 'pony', 'illustrious'\r\n                            ];\r\n                            baseModels.forEach(base => {\r\n                                if (combinedText.includes(base) || combinedText.includes(base.replace('.', ' '))) {\r\n                                    tags.add(base);\r\n                                }\r\n                            });\r\n                            const contentTypes = [\r\n                                'character', 'style', 'concept', 'clothing', 'pose', 'background',\r\n                                'object', 'effect', 'lighting', 'tool'\r\n                            ];\r\n                            contentTypes.forEach(content => {\r\n                                if (combinedText.includes(content)) {\r\n                                    tags.add(content);\r\n                                }\r\n                            });\r\n\r\n                            let domain: Model['domain'] = 'ImageGen';\r\n                            if (description.toLowerCase().includes('lora') || title.toLowerCase().includes('lora')) domain = 'LoRA';\r\n                            else if (description.toLowerCase().includes('video') || title.toLowerCase().includes('video')) domain = 'VideoGen';\r\n\r\n                            if (seeds > 0) tags.add('seeded');\r\n                            if (seeds >= 5) tags.add('well-seeded');\r\n\r\n                            models.push({\r\n                                id: `civitasbay-${modelId}`,\r\n                                name: modelName,\r\n                                description: description || `${modelName} - Preserved AI model via torrent`,\r\n                                provider: 'CivitasBay Community',\r\n                                domain: domain,\r\n                                source: 'CivitasBay',\r\n                                url: link,\r\n                                repo: null,\r\n                                license: {\r\n                                    name: normalizeLicenseName(licenseName) || 'Unknown',\r\n                                    type: determineType(licenseName),\r\n                                    commercial_use: determineCommercialUse(licenseName),\r\n                                    attribution_required: licenseName.toLowerCase().includes('attribution'),\r\n                                    share_alike: licenseName.toLowerCase().includes('share-alike'),\r\n                                    copyleft: licenseName.toLowerCase().includes('gpl')\r\n                                },\r\n                                tags: Array.from(tags),\r\n                                hosting: {\r\n                                    weights_available: true,\r\n                                    api_available: false,\r\n                                    on_premise_friendly: true\r\n                                },\r\n                                updated_at: normalizeDate(pubDate) || new Date().toISOString(),\r\n                                release_date: normalizeDate(pubDate) || null,\r\n                                parameters: null,\r\n                                context_window: null,\r\n                                indemnity: 'None',\r\n                                data_provenance: 'Community Preserved',\r\n                                usage_restrictions: ['Torrent download only', 'Archival purpose'],\r\n                                downloads: undefined\r\n                            });\r\n                        } catch (e) {\r\n                            // ignore item error\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n\r\n            if (!keepFetching) break;\r\n\r\n            page += CONCURRENT_BATCH;\r\n            // Short delay between batches\r\n            await new Promise(r => setTimeout(r, 1000));\r\n        }\r\n\r\n        log(`[CivitasBay] Processed ${models.length} total models from RSS feed`);\r\n\r\n        // Skip internal corporate filtering - let the global sync service handle it once at the end\r\n        // This prevents double LLM checks and popups\r\n\r\n        const complete = models.filter(isModelComplete);\r\n        const flagged = models.filter(m => !isModelComplete(m));\r\n\r\n        log(`[CivitasBay] Final - Complete: ${complete.length}, Flagged: ${flagged.length}`);\r\n\r\n        return { complete, flagged };\r\n    } catch (err: any) {\r\n        console.error('[CivitasBay] Fetch error:', err?.message || err);\r\n        return { complete: [], flagged: [] };\r\n    }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\fetchers\\image-platforms\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\fetchers\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\fetchers\\registries\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\fetchers\\registries\\modelscope.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\fetchers\\registries\\ollama-library.ts","messages":[{"ruleId":"prefer-const","severity":1,"message":"'updatedAt' is never reassigned. Use 'const' instead.","line":78,"column":21,"nodeType":"Identifier","messageId":"useConst","endLine":78,"endColumn":30,"fix":{"range":[3180,3221],"text":"const updatedAt = new Date().toISOString();"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import * as cheerio from 'cheerio';\r\nimport { Model, ApiDir } from '../../../../types';\r\nimport { fetchWrapper } from '../../../../utils/fetch-wrapper';\r\nimport { loggers } from '../../../../utils/logger';\r\nimport { normalizeDate } from '../../utils';\r\nimport { Fetcher, SyncOptions, SyncCallbacks, SyncResult } from '../../../sync/SyncTypes';\r\n\r\nconst logger = loggers.sync;\r\n\r\n/**\r\n * Ollama Library Fetcher Implementation\r\n */\r\nexport const ollamaLibraryFetcher: Fetcher = {\r\n    id: 'ollamaLibrary',\r\n    name: 'Ollama Library',\r\n    isEnabled: (options: SyncOptions) => !!options.dataSources?.ollamaLibrary,\r\n\r\n    async fetch(options: SyncOptions, callbacks?: SyncCallbacks): Promise<SyncResult> {\r\n        try {\r\n            logger.debug('[Ollama] Fetching popular models...');\r\n\r\n            // Use Electron proxy to bypass CORS\r\n            let html: string;\r\n            // Check for window.electronAPI availability safely\r\n            if ((window as any).electronAPI?.proxyRequest) {\r\n                const result = await (window as any).electronAPI.proxyRequest({\r\n                    url: 'https://ollama.com/library',\r\n                    method: 'GET'\r\n                });\r\n                if (!result?.success) {\r\n                    throw new Error(`Failed to fetch Ollama library: ${result?.error || 'Unknown error'}`);\r\n                }\r\n                html = typeof result.data === 'string' ? result.data : JSON.stringify(result.data);\r\n            } else {\r\n                // Fallback to regular fetch (won't work due to CORS in browser)\r\n                const response = await fetchWrapper('https://ollama.com/library');\r\n                if (!response.ok) {\r\n                    throw new Error(`Failed to fetch Ollama library: ${response.status}`);\r\n                }\r\n                html = await response.text();\r\n            }\r\n\r\n            const $ = cheerio.load(html);\r\n\r\n            const models: Model[] = [];\r\n\r\n            const listItems = $('li');\r\n\r\n            listItems.each((_, el) => {\r\n                const $el = $(el);\r\n                const $link = $el.find('a[href^=\"/library/\"]');\r\n\r\n                if ($link.length === 0) return;\r\n\r\n                const href = $link.attr('href') || '';\r\n                const id = href.replace('/library/', '');\r\n                if (!id) return;\r\n\r\n                let name = $link.find('h2').text().trim();\r\n                if (!name) name = id;\r\n\r\n                const description = $link.find('p').first().text().trim();\r\n\r\n                const textContent = $el.text();\r\n\r\n                let downloads = 0;\r\n                const pullsMatch = textContent.match(/([\\d.]+[KMB])\\s+Pulls/i);\r\n                if (pullsMatch) {\r\n                    const numStr = pullsMatch[1].toUpperCase();\r\n                    let multiplier = 1;\r\n                    if (numStr.endsWith('K')) multiplier = 1000;\r\n                    if (numStr.endsWith('M')) multiplier = 1000000;\r\n                    if (numStr.endsWith('B')) multiplier = 1000000000;\r\n                    downloads = parseFloat(numStr) * multiplier;\r\n                }\r\n\r\n                // Extract date (Updated ...)\r\n                let updatedAt = new Date().toISOString();\r\n\r\n                const model: Model = {\r\n                    id: `ollama-${id}`,\r\n                    name: name,\r\n                    description: description,\r\n                    provider: 'Ollama Library',\r\n                    source: 'Ollama Library',\r\n                    url: `https://ollama.com${href}`,\r\n                    tags: ['ollama', 'gguf'],\r\n                    downloads: Math.floor(downloads),\r\n                    domain: 'LLM',\r\n                    context_window: '0',\r\n                    parameters: '',\r\n                    license: {\r\n                        name: 'Unknown',\r\n                        type: 'Custom',\r\n                        commercial_use: false,\r\n                        attribution_required: false,\r\n                        share_alike: false,\r\n                        copyleft: false,\r\n                        notes: 'Check Ollama model page for details'\r\n                    },\r\n                    hosting: {\r\n                        weights_available: true,\r\n                        api_available: false,\r\n                        on_premise_friendly: true,\r\n                        providers: ['Ollama']\r\n                    },\r\n                    updated_at: updatedAt,\r\n                };\r\n\r\n                // Naive domain detection\r\n                const lowerDesc = description.toLowerCase();\r\n                if (lowerDesc.includes('vision') || lowerDesc.includes('image')) {\r\n                    model.domain = 'VLM';\r\n                } else if (lowerDesc.includes('code') || lowerDesc.includes('coding')) {\r\n                    model.domain = 'LLM';\r\n                    model.tags?.push('coding');\r\n                } else if (lowerDesc.includes('embedding')) {\r\n                    model.domain = 'Other';\r\n                    model.tags?.push('embedding');\r\n                }\r\n\r\n                models.push(model);\r\n            });\r\n\r\n            logger.info(`[Ollama] Found ${models.length} models`);\r\n\r\n            return {\r\n                complete: models,\r\n                flagged: []\r\n            };\r\n\r\n        } catch (error: any) {\r\n            logger.error('[Ollama] Error fetching models:', error);\r\n            return { complete: [], flagged: [] };\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Backward compatibility export\r\n */\r\nexport async function fetchOllamaLibrary(): Promise<{ complete: Model[], flagged: Model[] }> {\r\n    return ollamaLibraryFetcher.fetch({ dataSources: { ollamaLibrary: true } } as any);\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\fetchers\\registries\\openmodeldb.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":28,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":28,"endColumn":24,"suggestions":[{"fix":{"range":[1006,1070],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":46,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":46,"endColumn":24,"suggestions":[{"fix":{"range":[1884,1952],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":142,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":142,"endColumn":28,"suggestions":[{"fix":{"range":[6988,7071],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":150,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":150,"endColumn":24,"suggestions":[{"fix":{"range":[7331,7407],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":155,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":155,"endColumn":24,"suggestions":[{"fix":{"range":[7557,7643],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Model } from '../../../../types';\r\nimport { proxyUrl } from '../../config';\r\nimport { normalizeDate, normalizeLicenseName, determineType, determineCommercialUse } from '../../utils';\r\nimport { isModelComplete } from '../../filtering';\r\nimport { fetchWrapper } from '../../../../utils/fetch-wrapper';\r\n\r\n/**\r\n * Fetch models from OpenModelDB\r\n * \r\n * OpenModelDB is a database of AI upscaling and image restoration models.\r\n * Data is fetched from their GitHub repository.\r\n * \r\n * @returns Object containing complete and flagged models\r\n */\r\n// ... imports ...\r\nimport { Fetcher, SyncOptions, SyncCallbacks, SyncResult } from '../../../sync/SyncTypes';\r\n\r\n/**\r\n * OpenModelDB Fetcher Implementation\r\n */\r\nexport const openModelDBFetcher: Fetcher = {\r\n    id: 'openmodeldb',\r\n    name: 'OpenModelDB',\r\n    isEnabled: (options: SyncOptions) => !!options.dataSources?.openmodeldb,\r\n\r\n    async fetch(options: SyncOptions, callbacks?: SyncCallbacks): Promise<SyncResult> {\r\n        try {\r\n            console.log('[OpenModelDB] Fetching model list from GitHub...');\r\n\r\n            // Get the tree of files from the GitHub repo\r\n            const treeUrl = 'https://api.github.com/repos/OpenModelDB/open-model-database/git/trees/main?recursive=1';\r\n            const treeResponse = await fetchWrapper(treeUrl);\r\n\r\n            if (!treeResponse.ok) {\r\n                console.error(`[OpenModelDB] ERROR fetching tree: ${treeResponse.status} ${treeResponse.statusText}`);\r\n                return { complete: [], flagged: [] };\r\n            }\r\n\r\n            const treeData = await treeResponse.json();\r\n\r\n            // Filter for model JSON files in data/models/\r\n            const modelFiles = treeData.tree\r\n                .filter((item: any) => item.path.startsWith('data/models/') && item.path.endsWith('.json'))\r\n                .map((item: any) => item.path);\r\n\r\n            console.log(`[OpenModelDB] Found ${modelFiles.length} model files`);\r\n\r\n            const models: Model[] = [];\r\n            let processed = 0;\r\n            const batchSize = 50;\r\n\r\n            // Process models in batches\r\n            for (let i = 0; i < modelFiles.length; i += batchSize) {\r\n                const batch = modelFiles.slice(i, i + batchSize);\r\n\r\n                const batchPromises = batch.map(async (filePath: string) => {\r\n                    try {\r\n                        const modelId = filePath.replace('data/models/', '').replace('.json', '');\r\n                        const rawUrl = `https://raw.githubusercontent.com/OpenModelDB/open-model-database/main/${filePath}`;\r\n\r\n                        // Bypass global rate limiter for raw content\r\n                        const response = await fetch(rawUrl);\r\n                        if (!response.ok) {\r\n                            console.warn(`[OpenModelDB] Failed to fetch ${modelId}: ${response.status}`);\r\n                            return null;\r\n                        }\r\n\r\n                        const item = await response.json();\r\n\r\n                        const modelName = item.name || modelId;\r\n\r\n                        // Determine license information\r\n                        const licenseName = item.license || 'Unknown';\r\n                        const licenseType = determineType(licenseName);\r\n                        const commercialUse = determineCommercialUse(licenseName);\r\n                        const licenseNameLower = (licenseName || '').toLowerCase();\r\n\r\n                        // Build tags from available metadata\r\n                        const tags: string[] = [];\r\n                        if (item.architecture) tags.push(item.architecture);\r\n                        if (item.scale) tags.push(`${item.scale}x`);\r\n                        if (item.tags && Array.isArray(item.tags)) {\r\n                            tags.push(...item.tags);\r\n                        }\r\n\r\n                        // Determine domain based on model type and tags\r\n                        let domain: Model['domain'] = 'Upscaler';\r\n                        if (item.tags && Array.isArray(item.tags)) {\r\n                            const tagStr = item.tags.join(' ').toLowerCase();\r\n                            if (tagStr.includes('background')) {\r\n                                domain = 'BackgroundRemoval';\r\n                            } else if (tagStr.includes('restoration') || tagStr.includes('denoise') || tagStr.includes('compression')) {\r\n                                domain = 'Other';\r\n                            }\r\n                        }\r\n\r\n                        const model: Model = {\r\n                            id: `openmodeldb-${modelId}`,\r\n                            name: modelName,\r\n                            description: item.description || `${modelName} - AI upscaling model`,\r\n                            provider: String(item.author || 'OpenModelDB Community'),\r\n                            domain: domain,\r\n                            source: 'OpenModelDB',\r\n                            url: `https://openmodeldb.info/models/${modelId}`,\r\n                            repo: item.repo || null,\r\n                            license: {\r\n                                name: normalizeLicenseName(licenseName) || 'Unknown',\r\n                                type: licenseType,\r\n                                commercial_use: commercialUse,\r\n                                attribution_required: licenseNameLower.includes('attribution'),\r\n                                share_alike: licenseNameLower.includes('share-alike'),\r\n                                copyleft: licenseNameLower.includes('gpl')\r\n                            },\r\n                            tags: tags,\r\n                            hosting: {\r\n                                weights_available: true,\r\n                                api_available: false,\r\n                                on_premise_friendly: true\r\n                            },\r\n                            updated_at: normalizeDate(item.date) || null,\r\n                            release_date: normalizeDate(item.date) || null,\r\n                            parameters: item.parameters || null,\r\n                            context_window: null,\r\n                            indemnity: 'None',\r\n                            data_provenance: 'Open Source',\r\n                            usage_restrictions: [],\r\n                            downloads: undefined\r\n                        };\r\n\r\n                        return model;\r\n                    } catch (itemError: any) {\r\n                        console.error(`[OpenModelDB] Error processing ${filePath}:`, itemError?.message || itemError);\r\n                        return null;\r\n                    }\r\n                });\r\n\r\n                const batchResults = await Promise.all(batchPromises);\r\n                const validModels = batchResults.filter((m): m is Model => m !== null);\r\n                models.push(...validModels);\r\n\r\n                processed += batch.length;\r\n                console.log(`[OpenModelDB] Processed ${processed}/${modelFiles.length} models...`);\r\n\r\n                // Small delay between batches to be nice to GitHub API\r\n                if (i + batchSize < modelFiles.length) {\r\n                    await new Promise(resolve => setTimeout(resolve, 100));\r\n                }\r\n            }\r\n\r\n            console.log(`[OpenModelDB] Successfully processed ${models.length} models`);\r\n\r\n            const complete = models.filter(isModelComplete);\r\n            const flagged = models.filter(m => !isModelComplete(m));\r\n\r\n            console.log(`[OpenModelDB] Complete: ${complete.length}, Flagged: ${flagged.length}`);\r\n\r\n            return { complete, flagged };\r\n        } catch (err: any) {\r\n            console.error('[OpenModelDB] Fetch error:', err?.message || err);\r\n            return { complete: [], flagged: [] };\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Backward compatibility export\r\n */\r\nexport async function fetchOpenModelDB(): Promise<{ complete: Model[], flagged: Model[] }> {\r\n    return openModelDBFetcher.fetch({ dataSources: { openmodeldb: true } } as any);\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\filtering\\completeness-checker.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\filtering\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\filtering\\nsfw-filter.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":33,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":33,"endColumn":24,"suggestions":[{"fix":{"range":[1588,1634],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":36,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":36,"endColumn":24,"suggestions":[{"fix":{"range":[1780,1860],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":42,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":42,"endColumn":20,"suggestions":[{"fix":{"range":[2010,2079],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":57,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":57,"endColumn":24,"suggestions":[{"fix":{"range":[2585,2670],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":108,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":108,"endColumn":20,"suggestions":[{"fix":{"range":[4536,4647],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":121,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":121,"endColumn":24,"suggestions":[{"fix":{"range":[5147,5209],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":126,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":126,"endColumn":16,"suggestions":[{"fix":{"range":[5267,5397],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":138,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":138,"endColumn":24,"suggestions":[{"fix":{"range":[5752,5860],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":204,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":204,"endColumn":20,"suggestions":[{"fix":{"range":[8741,8861],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Model, ApiDir } from \"../../../types\";\r\nimport { filterNSFWModels, getSafetyReport } from \"../../../utils/nsfw\";\r\nimport { callProviderText } from \"../../api/providers/provider-calls\";\r\nimport { safeJsonFromText } from \"../../../utils/format\";\r\n\r\n/**\r\n * Apply NSFW filtering to model results for corporate safety\r\n * \r\n * Two modes:\r\n * - enableNSFWFiltering = true: Block NSFW models (return in flagged array)\r\n * - enableNSFWFiltering = false: Tag NSFW models with 'nsfw' tag and isNSFWFlagged=true\r\n *   but still include them in complete array (for later UI hiding)\r\n * \r\n * @param models - Array of models to filter\r\n * @param enableNSFWFiltering - Whether to BLOCK NSFW models or just TAG them\r\n * @param logAttempts - Whether to log filtered models (default: true)\r\n * @returns Object containing complete (safe/tagged) and flagged (blocked) models\r\n */\r\nexport function applyCorporateFiltering(\r\n    models: Model[],\r\n    enableNSFWFiltering: boolean = true,\r\n    logAttempts: boolean = true,\r\n    customKeywords: string[] = []\r\n): { complete: Model[], flagged: Model[] } {\r\n    // Always run the NSFW detection to identify NSFW models\r\n    const { safeModels, flaggedModels, filteredCount } = filterNSFWModels(models, true, customKeywords); // Always detect\r\n\r\n    if (filteredCount > 0 && logAttempts) {\r\n        // Compressed summary log\r\n        console.warn(`[Safety Filter] Detected ${filteredCount} NSFW models`);\r\n        if (filteredCount <= 10) {\r\n            const names = flaggedModels.map(m => m.name?.substring(0, 40) || 'Unknown').join(', ');\r\n            console.log(`[Safety Filter] NSFW: ${names}`);\r\n        } else {\r\n            const first5 = flaggedModels.slice(0, 5).map(m => m.name?.substring(0, 30) || 'Unknown').join(', ');\r\n            console.log(`[Safety Filter] NSFW: ${first5}... and ${filteredCount - 5} more`);\r\n        }\r\n    }\r\n\r\n    if (enableNSFWFiltering) {\r\n        // BLOCKING MODE: Return NSFW models in flagged array (they won't be imported)\r\n        console.log(`[Safety Filter] Blocking ${filteredCount} NSFW models`);\r\n        return {\r\n            complete: safeModels,\r\n            flagged: flaggedModels\r\n        };\r\n    } else {\r\n        // TAGGING MODE: Tag NSFW models and include them in complete array\r\n        // They can be hidden later in the UI using the \"Hide NSFW\" toggle\r\n        const taggedNSFWModels = flaggedModels.map(m => ({\r\n            ...m,\r\n            isNSFWFlagged: true,\r\n            tags: [...new Set([...(m.tags || []), 'nsfw'])]\r\n        }));\r\n\r\n        if (filteredCount > 0) {\r\n            console.log(`[Safety Filter] Tagged ${filteredCount} models as NSFW (not blocking)`);\r\n        }\r\n\r\n        return {\r\n            complete: [...safeModels, ...taggedNSFWModels],\r\n            flagged: [] // Nothing blocked, just tagged\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Async version of corporate filtering that uses LLM for deeper inspection if configured\r\n */\r\nexport async function applyCorporateFilteringAsync(\r\n    models: Model[],\r\n    enableNSFWFiltering: boolean = true,\r\n    logAttempts: boolean = true,\r\n    apiConfig?: ApiDir,\r\n    skipSignal?: { current: boolean },\r\n    onConfirmLLMCheck?: (modelCount: number, estimatedTimeMs: number) => Promise<boolean>,\r\n    onProgress?: (current: number, total: number) => void,\r\n    customKeywords: string[] = []\r\n): Promise<{ complete: Model[], flagged: Model[] }> {\r\n    // 1. Run standard synchronous/regex filtering first (fast)\r\n    const syncResult = applyCorporateFiltering(models, enableNSFWFiltering, logAttempts, customKeywords);\r\n\r\n    // If filtering is disabled or no apiConfig, return sync result\r\n    if (!enableNSFWFiltering || !apiConfig) {\r\n        return syncResult;\r\n    }\r\n\r\n    // 2. Run LLM-based filtering on the \"safe\" models to catch subtle NSFW content\r\n    // Check if we have a capable provider enabled (Ollama preferred for local/privacy)\r\n    let providerKey: string | null = null;\r\n    let providerCfg: any = null;\r\n\r\n    // Prefer Ollama for privacy/cost\r\n    if (apiConfig.ollama?.enabled) {\r\n        providerKey = 'ollama';\r\n        providerCfg = apiConfig.ollama;\r\n    } else {\r\n        // Fallback to other providers if enabled\r\n        const entry = Object.entries(apiConfig).find(([k, c]) => c.enabled && (c.apiKey || k === 'ollama'));\r\n        if (entry) {\r\n            providerKey = entry[0];\r\n            providerCfg = entry[1];\r\n        }\r\n    }\r\n\r\n    if (!providerKey || !providerCfg) {\r\n        // No LLM provider available - auto-skip LLM check\r\n        console.log(`[Corporate Filter] Skipping LLM NSFW check - no LLM API configured (Ollama or API key required)`);\r\n        return syncResult;\r\n    }\r\n\r\n    // Estimate time: ~2 seconds per batch of 10 models\r\n    const BATCH_SIZE = 10;\r\n    const totalBatches = Math.ceil(syncResult.complete.length / BATCH_SIZE);\r\n    const estimatedTimeMs = totalBatches * 2000; // ~2s per batch\r\n\r\n    // Ask user for confirmation if callback provided\r\n    if (onConfirmLLMCheck) {\r\n        const shouldProceed = await onConfirmLLMCheck(syncResult.complete.length, estimatedTimeMs);\r\n        if (!shouldProceed) {\r\n            console.log(`[Corporate Filter] User skipped LLM NSFW check`);\r\n            return syncResult;\r\n        }\r\n    }\r\n\r\n    console.log(`[Corporate Filter] Running deep LLM inspection on ${syncResult.complete.length} candidates using ${providerKey}...`);\r\n\r\n    const finalSafe: Model[] = [];\r\n    const finalFlagged: Model[] = [...syncResult.flagged];\r\n\r\n    // Process in batches\r\n    const candidates = syncResult.complete;\r\n    let parseFailures = 0;\r\n\r\n    for (let i = 0; i < candidates.length; i += BATCH_SIZE) {\r\n        // Check if skip was requested\r\n        if (skipSignal?.current) {\r\n            console.log(`[Corporate Filter] Skip requested - adding remaining ${candidates.length - i} models as safe`);\r\n            finalSafe.push(...candidates.slice(i));\r\n            break;\r\n        }\r\n\r\n        const batchNum = Math.floor(i / BATCH_SIZE) + 1;\r\n        const batch = candidates.slice(i, i + BATCH_SIZE);\r\n\r\n        // Prepare minimal metadata for the LLM to analyze\r\n        const batchMeta = batch.map(m => ({\r\n            id: m.id,\r\n            name: m.name,\r\n            description: (m.description || '').slice(0, 300), // Truncate description\r\n            tags: m.tags || []\r\n        }));\r\n\r\n        const systemPrompt = `You are a Content Safety Validator. \r\nAnalyze the provided AI model metadata for Not-Safe-For-Work (NSFW) content.\r\nNSFW includes: Nudity, Pornography, Sexual Acts, Fetishes, and sexually explicit Lora/Checkpoints.\r\nPay attention to terms like \"Labia\", \"Breasts\", \"Nude\", \"Hentai\", \"Ecchi\", \"Pussy\", \"Dick\", \"Penis\" or slang that implies explicit content.\r\nBe strict. If a model seems designed for generating nude or pornographic content, flag it.\r\nReturn valid JSON ONLY: A map where keys are model IDs and values are objects: { \"isNSFW\": boolean, \"reason\": \"string\" }.\r\nExample: { \"model-1\": { \"isNSFW\": true, \"reason\": \"Explicit tag detected\" }, \"model-2\": { \"isNSFW\": false, \"reason\": \"Safe\" } }`;\r\n\r\n        try {\r\n            const responseText = await callProviderText(\r\n                providerKey as any,\r\n                providerCfg,\r\n                systemPrompt,\r\n                JSON.stringify(batchMeta)\r\n            );\r\n\r\n            const analysis = safeJsonFromText(responseText);\r\n\r\n            if (analysis) {\r\n                batch.forEach(model => {\r\n                    const result = analysis[model.id];\r\n                    if (result && result.isNSFW) {\r\n                        console.warn(`[Corporate Filter] LLM Flagged: ${model.name} - ${result.reason}`);\r\n                        finalFlagged.push({\r\n                            ...model,\r\n                            isNSFWFlagged: true,\r\n                            // Add internal note if possible, or just rely on the flag\r\n                        });\r\n                    } else {\r\n                        finalSafe.push(model);\r\n                    }\r\n                });\r\n            } else {\r\n                // If JSON parsing fails, assume safe to avoid blocking valid content due to error\r\n                parseFailures++;\r\n                finalSafe.push(...batch);\r\n            }\r\n        } catch (err) {\r\n            // On error, fall back to safe (don't log each one to reduce spam)\r\n            parseFailures++;\r\n            finalSafe.push(...batch);\r\n        }\r\n    }\r\n\r\n    // Log summary of issues only once at the end\r\n    if (parseFailures > 0) {\r\n        console.warn(`[Corporate Filter] ${parseFailures}/${totalBatches} batches had parse failures (models assumed safe)`);\r\n    }\r\n\r\n    if (finalFlagged.length > syncResult.flagged.length) {\r\n        console.log(`[Corporate Filter] LLM caught ${finalFlagged.length - syncResult.flagged.length} additional NSFW models.`);\r\n    }\r\n\r\n    return {\r\n        complete: finalSafe,\r\n        flagged: finalFlagged\r\n    };\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\providers\\api-key-manager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\providers\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\providers\\provider-calls.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":194,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":194,"endColumn":24,"suggestions":[{"fix":{"range":[8115,8204],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":205,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":205,"endColumn":20,"suggestions":[{"fix":{"range":[8672,8727],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":316,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":316,"endColumn":20,"suggestions":[{"fix":{"range":[13582,13640],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":529,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":529,"endColumn":24,"suggestions":[{"fix":{"range":[23570,23614],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Provider Calls Module\r\n * Handles API calls to various LLM providers (OpenAI, Anthropic, Google, etc.)\r\n */\r\n\r\nimport { Model, ProviderCfg, ProviderKey } from \"../../../types\";\r\nimport { safeJsonFromText } from \"../../../utils/format\";\r\nimport { globalRateLimiter } from '../../rateLimiter';\r\nimport { getEffectiveApiKey } from './api-key-manager';\r\nimport { proxyUrl, useProxy, bypassOpenAIProxy } from '../config';\r\n\r\n/**\r\n * Helper to make API calls through Electron's proxy to bypass CORS\r\n * Falls back to direct fetch in browser/non-Electron environments\r\n */\r\nasync function electronProxyFetch(\r\n    url: string,\r\n    options: { method: string; headers: Record<string, string>; body?: any; signal?: AbortSignal }\r\n): Promise<{ ok: boolean; status: number; data?: any; error?: string }> {\r\n    // Check if running in Electron with proxy available\r\n    if (typeof window !== 'undefined' && (window as any).electronAPI?.proxyRequest) {\r\n        try {\r\n            const result = await (window as any).electronAPI.proxyRequest({\r\n                url,\r\n                method: options.method,\r\n                headers: options.headers,\r\n                body: options.body\r\n            });\r\n            if (result?.success) {\r\n                return { ok: true, status: 200, data: result.data };\r\n            } else {\r\n                return { ok: false, status: 500, error: result?.error || 'Proxy request failed' };\r\n            }\r\n        } catch (err: any) {\r\n            return { ok: false, status: 500, error: err?.message || 'Proxy request error' };\r\n        }\r\n    }\r\n\r\n    // Fallback to direct fetch (will hit CORS in browser, but works in Node/SSR)\r\n    const response = await fetch(url, {\r\n        method: options.method,\r\n        headers: options.headers,\r\n        body: options.body ? JSON.stringify(options.body) : undefined,\r\n        signal: options.signal\r\n    });\r\n\r\n    if (!response.ok) {\r\n        const text = await response.text().catch(() => '');\r\n        return { ok: false, status: response.status, error: text || response.statusText };\r\n    }\r\n\r\n    const data = await response.json();\r\n    return { ok: true, status: response.status, data };\r\n}\r\n\r\n/**\r\n * Returns known Anthropic Claude models since they don't have a public /models API\r\n */\r\nfunction getAnthropicModels(): Model[] {\r\n    const models = [\r\n        { id: 'claude-opus-4-20250514', name: 'Claude Opus 4', context: '200K', released: '2025-05-14' },\r\n        { id: 'claude-sonnet-4-20250514', name: 'Claude Sonnet 4', context: '200K', released: '2025-05-14' },\r\n        { id: 'claude-3-7-sonnet-20250219', name: 'Claude 3.7 Sonnet', context: '200K', released: '2025-02-19' },\r\n        { id: 'claude-3-5-sonnet-20241022', name: 'Claude 3.5 Sonnet (Oct 2024)', context: '200K', released: '2024-10-22' },\r\n        { id: 'claude-3-5-sonnet-20240620', name: 'Claude 3.5 Sonnet', context: '200K', released: '2024-06-20' },\r\n        { id: 'claude-3-5-haiku-20241022', name: 'Claude 3.5 Haiku', context: '200K', released: '2024-10-22' },\r\n        { id: 'claude-3-opus-20240229', name: 'Claude 3 Opus', context: '200K', released: '2024-02-29' },\r\n        { id: 'claude-3-sonnet-20240229', name: 'Claude 3 Sonnet', context: '200K', released: '2024-02-29' },\r\n        { id: 'claude-3-haiku-20240307', name: 'Claude 3 Haiku', context: '200K', released: '2024-03-07' },\r\n    ];\r\n\r\n    return models.map(m => ({\r\n        id: m.id,\r\n        name: m.name,\r\n        provider: 'Anthropic',\r\n        domain: 'LLM' as const,\r\n        source: 'anthropic',\r\n        url: 'https://www.anthropic.com/claude',\r\n        license: {\r\n            name: 'Proprietary',\r\n            type: 'Proprietary' as const,\r\n            commercial_use: true,\r\n            attribution_required: false,\r\n            share_alike: false,\r\n            copyleft: false\r\n        },\r\n        pricing: [],\r\n        updated_at: m.released,\r\n        release_date: m.released,\r\n        tags: ['claude', 'conversational', 'reasoning'],\r\n        parameters: '',\r\n        context_window: m.context,\r\n        hosting: {\r\n            weights_available: false,\r\n            api_available: true,\r\n            on_premise_friendly: false\r\n        }\r\n    }));\r\n}\r\n\r\n/**\r\n * Returns known Perplexity models since they don't have a public /models API\r\n */\r\nfunction getPerplexityModels(): Model[] {\r\n    const models = [\r\n        { id: 'sonar-pro', name: 'Sonar Pro', context: '200K', released: '2024-11-01' },\r\n        { id: 'sonar', name: 'Sonar', context: '128K', released: '2024-11-01' },\r\n        { id: 'sonar-reasoning-pro', name: 'Sonar Reasoning Pro', context: '128K', released: '2024-12-01' },\r\n        { id: 'sonar-reasoning', name: 'Sonar Reasoning', context: '128K', released: '2024-12-01' },\r\n        { id: 'sonar-deep-research', name: 'Sonar Deep Research', context: '128K', released: '2024-12-01' },\r\n    ];\r\n\r\n    return models.map(m => ({\r\n        id: m.id,\r\n        name: m.name,\r\n        provider: 'Perplexity',\r\n        domain: 'LLM' as const,\r\n        source: 'perplexity',\r\n        url: 'https://www.perplexity.ai/',\r\n        license: {\r\n            name: 'Proprietary',\r\n            type: 'Proprietary' as const,\r\n            commercial_use: true,\r\n            attribution_required: false,\r\n            share_alike: false,\r\n            copyleft: false\r\n        },\r\n        pricing: [],\r\n        updated_at: m.released,\r\n        release_date: m.released,\r\n        tags: ['search', 'reasoning', 'web'],\r\n        parameters: '',\r\n        context_window: m.context,\r\n        hosting: {\r\n            weights_available: false,\r\n            api_available: true,\r\n            on_premise_friendly: false\r\n        }\r\n    }));\r\n}\r\n\r\n/**\r\n * Call a provider's models endpoint to fetch available models\r\n * @param key - The provider key (e.g., 'openai', 'anthropic')\r\n * @param cfg - Provider configuration including API key and model\r\n * @param systemPrompt - System prompt (unused for model listing)\r\n * @param userPrompt - User prompt (unused for model listing)\r\n * @returns Array of models from the provider\r\n */\r\nexport async function callProvider(key: ProviderKey, cfg: ProviderCfg, systemPrompt: string, userPrompt: string): Promise<Model[]> {\r\n    // Get effective API key (local or global)\r\n    const effectiveKey = await getEffectiveApiKey(key, cfg.apiKey);\r\n    if (!effectiveKey) throw new Error('no key');\r\n\r\n    // Apply rate limiting before making the request\r\n    await globalRateLimiter.waitForSlot();\r\n\r\n    let url = '';\r\n    let headers: Record<string, string> = {};\r\n\r\n    // Define provider-specific endpoints and headers\r\n    switch (key) {\r\n        case \"openai\":\r\n            // OpenAI API: GET /v1/models with Bearer auth\r\n            url = \"https://api.openai.com/v1/models\";\r\n            headers = { \"Authorization\": `Bearer ${effectiveKey}` };\r\n            break;\r\n        case \"anthropic\":\r\n            // Anthropic API: GET /v1/models with x-api-key and anthropic-version headers\r\n            url = \"https://api.anthropic.com/v1/models\";\r\n            headers = {\r\n                \"x-api-key\": effectiveKey!,\r\n                \"anthropic-version\": \"2023-06-01\",\r\n                \"Content-Type\": \"application/json\"\r\n            };\r\n            break;\r\n        case \"cohere\":\r\n            // Cohere API: GET /v1/models with Bearer auth (note: api.cohere.com, not .ai)\r\n            url = \"https://api.cohere.com/v1/models\";\r\n            headers = { \"Authorization\": `Bearer ${effectiveKey}` };\r\n            break;\r\n        case \"google\":\r\n            // Google Gemini API: GET /v1beta/models with x-goog-api-key header\r\n            url = \"https://generativelanguage.googleapis.com/v1beta/models\";\r\n            headers = { \"x-goog-api-key\": effectiveKey! };\r\n            break;\r\n        case \"deepseek\":\r\n            // DeepSeek API: GET /v1/models with Bearer auth (OpenAI-compatible)\r\n            url = \"https://api.deepseek.com/v1/models\";\r\n            headers = { \"Authorization\": `Bearer ${effectiveKey}` };\r\n            break;\r\n        case \"perplexity\":\r\n            // Perplexity has no /models endpoint - return known models\r\n            console.log('[perplexity] Returning known Perplexity models (no /models API available)');\r\n            return getPerplexityModels();\r\n        case \"openrouter\":\r\n            // OpenRouter API: GET /api/v1/models with Bearer auth\r\n            url = \"https://openrouter.ai/api/v1/models\";\r\n            headers = { \"Authorization\": `Bearer ${effectiveKey}`, \"HTTP-Referer\": typeof window !== 'undefined' ? window.location.origin : '' };\r\n            break;\r\n        default:\r\n            throw new Error(`Unknown provider: ${key}`);\r\n    }\r\n    try {\r\n        console.log(`[${key}] Fetching models from ${url}...`);\r\n\r\n        // Use Electron proxy to bypass CORS\r\n        const result = await electronProxyFetch(url, { method: 'GET', headers });\r\n\r\n        if (!result.ok) {\r\n            const text = result.error || '';\r\n            console.error(`[${key}] ERROR: Status ${result.status}. Response: ${text}`);\r\n\r\n            // Parse error response if possible\r\n            let errorMessage = `${key} API error: ${result.status}`;\r\n            let errorJson;\r\n\r\n            try {\r\n                // Try to parse the error response as JSON (if text looks like JSON)\r\n                if (text.trim().startsWith('{')) {\r\n                    errorJson = safeJsonFromText(text);\r\n                    if (errorJson && (errorJson.error || errorJson.message)) {\r\n                        // Add the specific error message from the API if available\r\n                        errorMessage += ` - ${errorJson.error?.message || errorJson.message || ''}`;\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                // Ignore parse errors\r\n            }\r\n\r\n            // If parsing fails or no message, use the status code to provide more context\r\n            if (result.status === 401) {\r\n                errorMessage = `${key} API unauthorized (401): API key may be invalid or expired`;\r\n            } else if (result.status === 403) {\r\n                errorMessage = `${key} API forbidden (403): Your account may not have access to this resource`;\r\n            } else if (result.status === 404) {\r\n                errorMessage = `${key} API endpoint not found (404): The API endpoint may have changed`;\r\n            } else if (result.status === 429) {\r\n                errorMessage = `${key} API rate limited (429): Too many requests, please try again later`;\r\n            } else if (result.status >= 500) {\r\n                errorMessage = `${key} API server error (${result.status}): The provider's service may be experiencing issues`;\r\n            }\r\n\r\n            throw new Error(errorMessage);\r\n        }\r\n\r\n        const data = result.data;\r\n\r\n        // Different providers have different response structures\r\n        let modelsRaw: any[] = [];\r\n\r\n        if (key === 'openai') {\r\n            modelsRaw = data.data || [];\r\n        } else if (key === 'anthropic') {\r\n            modelsRaw = data.data || [];\r\n        } else if (key === 'cohere') {\r\n            modelsRaw = data.models || [];\r\n        } else if (key === 'google') {\r\n            modelsRaw = data.models || [];\r\n        } else if (key === 'deepseek') {\r\n            modelsRaw = data.data || [];\r\n        } else if (key === 'openrouter') {\r\n            modelsRaw = data.data || [];\r\n        } else {\r\n            modelsRaw = data.data || data.models || [];\r\n        }\r\n\r\n        if (!Array.isArray(modelsRaw)) {\r\n            console.error(`[${key}] API response didn't contain models array:`, data);\r\n            return [];\r\n        }\r\n\r\n        const models: Model[] = modelsRaw.map((item: any) => {\r\n            // Extract model ID based on provider-specific structure\r\n            const modelId = item.id || item.modelId || item.slug || item.name;\r\n\r\n            // Format provider name with first letter capitalized\r\n            const providerName = key.charAt(0).toUpperCase() + key.slice(1);\r\n\r\n            // Create standardized model object\r\n            return {\r\n                id: modelId,\r\n                name: item.name || modelId,\r\n                provider: providerName,\r\n                domain: item.capabilities?.includes(\"vision\") ? \"Vision\" : \"LLM\",\r\n                source: key,\r\n                url: item.url || \"\",\r\n                license: {\r\n                    name: item.license || \"Proprietary\",\r\n                    type: \"Proprietary\",\r\n                    commercial_use: true,\r\n                    attribution_required: false,\r\n                    share_alike: false,\r\n                    copyleft: false\r\n                },\r\n                pricing: item.pricing && (item.pricing.input || item.pricing.output || item.pricing.flat) ? [{\r\n                    unit: \"tokens\",\r\n                    input: item.pricing.input || null,\r\n                    output: item.pricing.output || null,\r\n                    flat: item.pricing.flat || null,\r\n                    currency: \"USD\"\r\n                }] : [],\r\n                updated_at: item.updated_at || \"\",\r\n                release_date: item.created_at || item.release_date || \"\",\r\n                tags: item.tags || [],\r\n                parameters: item.parameters || item.param_count || \"\",\r\n                context_window: item.context_window || item.context_length || \"\",\r\n                hosting: {\r\n                    weights_available: false,\r\n                    api_available: true,\r\n                    on_premise_friendly: false\r\n                }\r\n            };\r\n        });\r\n\r\n        console.log(`[${key}] Imported ${models.length} models.`);\r\n        return models;\r\n    } catch (err: any) {\r\n        console.error(`[${key}] Fetch error: ${err.message || err}`);\r\n        return []; // Return empty array instead of throwing to prevent app from crashing\r\n    }\r\n}\r\n\r\n/**\r\n * Call provider for text response (not JSON)\r\n * @param key - The provider key\r\n * @param cfg - Provider configuration\r\n * @param systemPrompt - System prompt for the LLM\r\n * @param userPrompt - User prompt for the LLM\r\n * @param options - Optional parameters including abort signal\r\n * @returns Text response from the LLM\r\n */\r\nexport async function callProviderText(\r\n    key: ProviderKey,\r\n    cfg: ProviderCfg,\r\n    systemPrompt: string,\r\n    userPrompt: string,\r\n    options?: { signal?: AbortSignal }\r\n): Promise<string> {\r\n    // Get effective API key (local or global)\r\n    const effectiveKey = await getEffectiveApiKey(key, cfg.apiKey);\r\n    const isOllama = cfg.protocol === 'ollama' || key === 'ollama';\r\n    if (!effectiveKey && !isOllama) throw new Error('no key');\r\n\r\n    // Apply rate limiting before making the request\r\n    await globalRateLimiter.waitForSlot();\r\n\r\n    // For OpenAI, try direct connection if proxy fails or if bypass is enabled\r\n    const useDirectForOpenAI = key === 'openai' && (!useProxy || bypassOpenAIProxy);\r\n\r\n    // Retry logic for connection issues\r\n    let lastError: Error | null = null;\r\n    const maxRetries = useDirectForOpenAI ? 1 : 3;\r\n\r\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\r\n        try {\r\n            let body: any = {};\r\n            let url = '';\r\n            let headers: Record<string, string> = { 'Accept': 'application/json' };\r\n\r\n            if (cfg.isCustom || (cfg.baseUrl && cfg.baseUrl.trim() !== '')) {\r\n                const baseUrl = cfg.baseUrl?.replace(/\\/$/, '') || '';\r\n                const protocol = cfg.protocol || (key === 'ollama' ? 'ollama' : (['anthropic', 'google'].includes(key) ? key : 'openai'));\r\n\r\n                headers = { ...headers, 'Content-Type': 'application/json', ...(cfg.headers || {}) };\r\n                if (effectiveKey && protocol !== 'anthropic') headers['Authorization'] = `Bearer ${effectiveKey}`;\r\n\r\n                if (protocol === 'anthropic') {\r\n                    url = `${baseUrl}/messages`;\r\n                    if (effectiveKey) headers['x-api-key'] = effectiveKey;\r\n                    headers['anthropic-version'] = '2023-06-01';\r\n                    body = {\r\n                        model: cfg.model,\r\n                        max_tokens: 4000,\r\n                        messages: [{ role: 'user', content: `${systemPrompt}\\n\\n${userPrompt}` }]\r\n                    };\r\n                } else if (protocol === 'ollama') {\r\n                    url = `${baseUrl}/api/chat`;\r\n                    body = {\r\n                        model: cfg.model,\r\n                        messages: [\r\n                            { role: 'system', content: systemPrompt },\r\n                            { role: 'user', content: userPrompt }\r\n                        ],\r\n                        stream: false\r\n                    };\r\n                } else {\r\n                    // OpenAI Compatible (default)\r\n                    url = `${baseUrl}/chat/completions`;\r\n                    body = {\r\n                        model: cfg.model,\r\n                        messages: [\r\n                            { role: 'system', content: systemPrompt },\r\n                            { role: 'user', content: userPrompt }\r\n                        ]\r\n                    };\r\n                }\r\n            } else if (key === 'openai' || key === 'openrouter' || key === 'deepseek' || key === 'perplexity') {\r\n                // OpenAI-compatible chat - use direct URLs since electronProxyFetch handles CORS\r\n                if (key === 'openai') {\r\n                    url = 'https://api.openai.com/v1/chat/completions';\r\n                } else if (key === 'openrouter') {\r\n                    url = 'https://openrouter.ai/api/v1/chat/completions';\r\n                } else if (key === 'deepseek') {\r\n                    url = 'https://api.deepseek.com/v1/chat/completions';\r\n                } else {\r\n                    url = 'https://api.perplexity.ai/chat/completions';\r\n                }\r\n                headers = {\r\n                    ...headers,\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${effectiveKey}`,\r\n                    ...(key === 'openrouter' ? { 'HTTP-Referer': typeof window !== 'undefined' ? window.location.origin : '' } : {})\r\n                };\r\n                body = {\r\n                    model: cfg.model,\r\n                    messages: [\r\n                        { role: 'system', content: systemPrompt },\r\n                        { role: 'user', content: userPrompt }\r\n                    ]\r\n                    // Note: omit temperature to avoid provider-specific constraints (defaults to 1 on OpenAI)\r\n                    // Note: No response_format for text responses\r\n                };\r\n            } else if (key === 'anthropic') {\r\n                // Anthropic API - use direct URL since electronProxyFetch handles CORS\r\n                url = 'https://api.anthropic.com/v1/messages';\r\n                headers = {\r\n                    ...headers,\r\n                    'Content-Type': 'application/json',\r\n                    'x-api-key': effectiveKey!,\r\n                    'anthropic-version': '2023-06-01'\r\n                };\r\n                body = {\r\n                    model: cfg.model || 'claude-3-sonnet-20240229',\r\n                    max_tokens: 4000,\r\n                    messages: [{ role: 'user', content: `${systemPrompt}\\n\\n${userPrompt}` }]\r\n                };\r\n            } else if (key === 'cohere') {\r\n                // Cohere API - use V2 chat endpoint\r\n                url = 'https://api.cohere.com/v2/chat';\r\n                headers = {\r\n                    ...headers,\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${effectiveKey}`\r\n                };\r\n                body = {\r\n                    model: cfg.model || 'command-r',\r\n                    messages: [\r\n                        { role: 'system', content: systemPrompt },\r\n                        { role: 'user', content: userPrompt }\r\n                    ]\r\n                };\r\n            } else if (key === 'google') {\r\n                // Google Gemini API\r\n                url = `https://generativelanguage.googleapis.com/v1beta/models/${cfg.model || 'gemini-1.5-flash'}:generateContent`;\r\n                headers = {\r\n                    ...headers,\r\n                    'Content-Type': 'application/json',\r\n                    'x-goog-api-key': effectiveKey!\r\n                };\r\n                body = {\r\n                    contents: [{ parts: [{ text: `${systemPrompt}\\n\\n${userPrompt}` }] }]\r\n                };\r\n            } else {\r\n                throw new Error(`Text response not supported for provider: ${key}`);\r\n            }\r\n\r\n            // Use Electron proxy to bypass CORS\r\n            const result = await electronProxyFetch(url, {\r\n                method: 'POST',\r\n                headers,\r\n                body,\r\n                signal: options?.signal\r\n            });\r\n\r\n            if (!result.ok) {\r\n                const errorText = result.error || 'Unknown error';\r\n                if (result.status === 429) {\r\n                    throw new Error(`Rate limit exceeded. Please wait before trying again. Your API plan may have reached its limit.`);\r\n                } else if (result.status === 401) {\r\n                    throw new Error(`API authentication failed. Please check your API key.`);\r\n                } else if (result.status === 403) {\r\n                    throw new Error(`API access forbidden. Your API key may not have the required permissions.`);\r\n                } else if (result.status === 402) {\r\n                    throw new Error(`Payment required. Please check your API billing and usage limits.`);\r\n                } else {\r\n                    throw new Error(`HTTP ${result.status}: ${errorText}`);\r\n                }\r\n            }\r\n\r\n            const data = result.data;\r\n\r\n            // Extract text content from response based on provider\r\n            if (key === 'anthropic') {\r\n                return data.content?.[0]?.text || '';\r\n            } else if (key === 'google') {\r\n                // Google Gemini response format\r\n                return data.candidates?.[0]?.content?.parts?.[0]?.text || '';\r\n            } else if (key === 'cohere') {\r\n                // Cohere V2 response format\r\n                return data.message?.content?.[0]?.text || data.text || '';\r\n            } else {\r\n                // OpenAI-compatible (OpenAI, OpenRouter, DeepSeek, Perplexity)\r\n                return data.choices?.[0]?.message?.content || '';\r\n            }\r\n        }\r\n        catch (error: any) {\r\n            lastError = error;\r\n            console.error(`Provider ${key} attempt ${attempt}/${maxRetries} error:`, error);\r\n            if (error?.name === 'AbortError') {\r\n                throw error; // do not retry on cancellation\r\n            }\r\n\r\n            // Check if it's a connection error that's worth retrying\r\n            const isRetryableError = error?.code === 'ECONNRESET' ||\r\n                error?.message?.includes('ECONNRESET') ||\r\n                error?.message?.includes('network') ||\r\n                error?.message?.includes('timeout') ||\r\n                error?.message?.includes('502') ||\r\n                error?.message?.includes('503') ||\r\n                error?.message?.includes('504');\r\n\r\n            if (!isRetryableError || attempt === maxRetries) {\r\n                throw error;\r\n            }\r\n\r\n            // Wait before retry (exponential backoff)\r\n            const waitTime = Math.min(1000 * Math.pow(2, attempt - 1), 10000);\r\n            console.log(`Retrying in ${waitTime}ms...`);\r\n            await new Promise(resolve => setTimeout(resolve, waitTime));\r\n        }\r\n    }\r\n\r\n    throw lastError || new Error('All retry attempts failed');\r\n}\r\n\r\n/**\r\n * Call provider for JSON response (LLM validation/enrichment)\r\n * @param key - The provider key\r\n * @param cfg - Provider configuration\r\n * @param systemPrompt - System prompt for the LLM\r\n * @param userPrompt - User prompt for the LLM\r\n * @returns Array of models parsed from JSON response\r\n */\r\nexport async function callProviderLLM(key: ProviderKey, cfg: ProviderCfg, systemPrompt: string, userPrompt: string): Promise<Model[]> {\r\n    // Get effective API key (local or global)\r\n    const effectiveKey = await getEffectiveApiKey(key, cfg.apiKey);\r\n    const isOllama = cfg.protocol === 'ollama' || key === 'ollama';\r\n    if (!effectiveKey && !isOllama) throw new Error('no key');\r\n    try {\r\n        let body: any = {};\r\n        let url = '';\r\n        let headers: Record<string, string> = { 'Accept': 'application/json' };\r\n\r\n        if (cfg.isCustom || (cfg.baseUrl && cfg.baseUrl.trim() !== '')) {\r\n            const baseUrl = cfg.baseUrl?.replace(/\\/$/, '') || '';\r\n            const protocol = cfg.protocol || (['anthropic', 'google'].includes(key) ? key : 'openai');\r\n\r\n            headers = { ...headers, 'Content-Type': 'application/json', ...(cfg.headers || {}) };\r\n            if (effectiveKey && protocol !== 'anthropic') headers['Authorization'] = `Bearer ${effectiveKey}`;\r\n\r\n            if (protocol === 'anthropic') {\r\n                url = `${baseUrl}/messages`;\r\n                if (effectiveKey) headers['x-api-key'] = effectiveKey;\r\n                headers['anthropic-version'] = '2023-06-01';\r\n                body = {\r\n                    model: cfg.model,\r\n                    max_tokens: 4000,\r\n                    system: systemPrompt,\r\n                    messages: [{ role: 'user', content: userPrompt }],\r\n                    temperature: 0\r\n                };\r\n            } else if (protocol === 'ollama') {\r\n                url = `${baseUrl}/api/chat`;\r\n                body = {\r\n                    model: cfg.model,\r\n                    messages: [\r\n                        { role: 'system', content: systemPrompt },\r\n                        { role: 'user', content: userPrompt }\r\n                    ],\r\n                    stream: false,\r\n                    format: \"json\"\r\n                };\r\n            } else {\r\n                // OpenAI Compatible (default)\r\n                url = `${baseUrl}/chat/completions`;\r\n                body = {\r\n                    model: cfg.model,\r\n                    messages: [\r\n                        { role: 'system', content: systemPrompt },\r\n                        { role: 'user', content: userPrompt }\r\n                    ],\r\n                    response_format: { type: 'json_object' }\r\n                };\r\n            }\r\n        } else if (key === 'openai' || key === 'openrouter' || key === 'deepseek' || key === 'perplexity') {\r\n            // OpenAI-compatible chat\r\n            if (key === 'openai') {\r\n                url = 'https://api.openai.com/v1/chat/completions';\r\n            } else if (key === 'openrouter') {\r\n                url = 'https://openrouter.ai/api/v1/chat/completions';\r\n            } else if (key === 'deepseek') {\r\n                url = 'https://api.deepseek.com/v1/chat/completions';\r\n            } else {\r\n                url = 'https://api.perplexity.ai/chat/completions';\r\n            }\r\n\r\n            headers = {\r\n                ...headers,\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${effectiveKey}`,\r\n                ...(key === 'openrouter' ? { 'HTTP-Referer': typeof window !== 'undefined' ? window.location.origin : '' } : {})\r\n            };\r\n            body = {\r\n                model: cfg.model,\r\n                messages: [\r\n                    { role: 'system', content: systemPrompt },\r\n                    { role: 'user', content: userPrompt }\r\n                ],\r\n                // omit temperature to satisfy models that only support default=1\r\n                response_format: { type: 'json_object' }\r\n            };\r\n        } else if (key === 'anthropic') {\r\n            url = 'https://api.anthropic.com/v1/messages';\r\n            headers = {\r\n                ...headers,\r\n                'Content-Type': 'application/json',\r\n                'x-api-key': effectiveKey!,\r\n                'anthropic-version': '2023-06-01'\r\n            };\r\n            body = {\r\n                model: cfg.model,\r\n                system: systemPrompt,\r\n                messages: [{ role: 'user', content: userPrompt }],\r\n                max_tokens: 2000,\r\n                temperature: 0\r\n            };\r\n        } else if (key === 'cohere') {\r\n            // Cohere V2 API: /v2/chat with messages array format\r\n            url = 'https://api.cohere.com/v2/chat';\r\n            headers = { ...headers, 'Content-Type': 'application/json', 'Authorization': `Bearer ${effectiveKey}` };\r\n            body = {\r\n                model: cfg.model,\r\n                messages: [\r\n                    { role: 'system', content: systemPrompt },\r\n                    { role: 'user', content: userPrompt }\r\n                ]\r\n            } as any;\r\n        } else if (key === 'google') {\r\n            // Gemini via REST\r\n            url = `https://generativelanguage.googleapis.com/v1beta/models/${cfg.model || 'gemini-1.5-flash'}:generateContent`;\r\n            headers = {\r\n                ...headers,\r\n                'Content-Type': 'application/json',\r\n                'x-goog-api-key': effectiveKey!\r\n            };\r\n            body = {\r\n                contents: [{ role: 'user', parts: [{ text: `${systemPrompt}\\n\\n${userPrompt}` }] }],\r\n                generationConfig: { temperature: 0, responseMimeType: 'application/json' }\r\n            };\r\n        } else {\r\n            throw new Error(`LLM validation not implemented for provider: ${key}`);\r\n        }\r\n\r\n        // Use Electron proxy to bypass CORS\r\n        const result = await electronProxyFetch(url, {\r\n            method: 'POST',\r\n            headers,\r\n            body\r\n        });\r\n\r\n        if (!result.ok) {\r\n            throw new Error(`LLM call failed: ${result.status} ${result.error || 'Unknown error'}`);\r\n        }\r\n\r\n        const data = result.data;\r\n        // Parse provider-specific responses\r\n        if (key === 'anthropic') {\r\n            const text = data?.content?.[0]?.text || '';\r\n            const json = safeJsonFromText(text) || {};\r\n            return Array.isArray(json) ? json : [json];\r\n        } else if (key === 'google') {\r\n            const text = data?.candidates?.[0]?.content?.parts?.[0]?.text || '';\r\n            const json = safeJsonFromText(text) || {};\r\n            return Array.isArray(json) ? json : [json];\r\n        } else if (key === 'cohere') {\r\n            const text = data?.message?.content?.[0]?.text || data?.text || data?.response || '';\r\n            const json = safeJsonFromText(text) || {};\r\n            return Array.isArray(json) ? json : [json];\r\n        } else {\r\n            const content = data?.choices?.[0]?.message?.content || data?.choices?.[0]?.message || data?.choices?.[0]?.text || '';\r\n            const json = safeJsonFromText(typeof content === 'string' ? content : String(content)) || {};\r\n            return Array.isArray(json) ? json : [json];\r\n        }\r\n    } catch (err: any) {\r\n        console.error('[LLM Validation] Error:', err?.message || err);\r\n        throw err;\r\n    }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\schemas.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\schemas.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\translation\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\translation\\language-detection.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\translation\\translator.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":51,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":51,"endColumn":24,"suggestions":[{"fix":{"range":[2099,2166],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":55,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":55,"endColumn":20,"suggestions":[{"fix":{"range":[2217,2316],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":125,"column":25,"nodeType":"MemberExpression","messageId":"limited","endLine":125,"endColumn":36,"suggestions":[{"fix":{"range":[5874,6004],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"prefer-const","severity":1,"message":"'translated' is never reassigned. Use 'const' instead.","line":136,"column":21,"nodeType":"Identifier","messageId":"useConst","endLine":136,"endColumn":36,"fix":{"range":[6482,6509],"text":"const translated: any = null;"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":166,"column":33,"nodeType":"MemberExpression","messageId":"limited","endLine":166,"endColumn":44,"suggestions":[{"fix":{"range":[8228,8319],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":171,"column":21,"nodeType":"MemberExpression","messageId":"limited","endLine":171,"endColumn":32,"suggestions":[{"fix":{"range":[8424,8587],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":207,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":207,"endColumn":20,"suggestions":[{"fix":{"range":[10285,10375],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\r\n * Translation Module\r\n *\r\n * Handles translation of Chinese, Japanese, and Korean text to English\r\n * for AI model names and descriptions. Uses LLM providers for translation\r\n * with fallback strategies for when translation APIs are unavailable.\r\n */\r\n\r\nimport { Model, ApiDir, ProviderKey, ProviderCfg } from '../../../types';\r\nimport { containsChinese, containsOtherAsianLanguages } from './language-detection';\r\nimport { callProviderText } from '../providers/provider-calls';\r\nimport { safeJsonFromText } from '../../../utils/format';\r\n\r\n/**\r\n * Translates Chinese, Japanese, and Korean text in model names and descriptions to English.\r\n *\r\n * @param models - Array of models to translate\r\n * @param apiConfig - API configuration directory containing provider settings\r\n * @returns Promise resolving to array of models with translated text\r\n *\r\n * @remarks\r\n * This function:\r\n * - Identifies models with Chinese/CJK text in name or description\r\n * - Uses the first enabled LLM provider with an API key for translation\r\n * - Processes models in batches of 25 for better API success rate\r\n * - Falls back to ASCII extraction and contextual English labels if translation fails\r\n * - Adds 'translated' tag to successfully translated models\r\n * - Preserves original models if no translation is needed or possible\r\n */\r\n\r\nexport async function translateChineseModels(\r\n    models: Model[],\r\n    apiConfig: ApiDir,\r\n    onProgress?: (progress: string) => void\r\n): Promise<Model[]> {\r\n    try {\r\n        // LLM Translation removed per user request. \r\n        // We now rely solely on Google Translate with \"Keep Original Name\" fallback.\r\n        const providerKey = null;\r\n        const providerCfg = null;\r\n\r\n        // Find models that need translation (Chinese, Japanese, or Korean)\r\n        const toTranslate = models.filter(m =>\r\n            containsChinese(m.name) ||\r\n            containsChinese(m.description) ||\r\n            containsOtherAsianLanguages(m.name) ||\r\n            containsOtherAsianLanguages(m.description)\r\n        );\r\n\r\n        if (toTranslate.length === 0) {\r\n            console.log('[Translation] No models with Chinese/CJK text found');\r\n            return models;\r\n        }\r\n\r\n        console.log(`[Translation] Found ${toTranslate.length} models with Chinese/CJK text to translate`);\r\n\r\n        // Process in smaller batches for better API success rate\r\n        const batchSize = 25;\r\n        const translatedModels = [...models];\r\n        let fallbackBatchCount = 0;\r\n        let fallbackReason: string | null = null;\r\n\r\n        // Check upfront if we have a provider\r\n        if (!providerKey || !providerCfg) {\r\n            fallbackReason = 'No LLM provider configured';\r\n        }\r\n\r\n        for (let i = 0; i < toTranslate.length; i += batchSize) {\r\n            const batch = toTranslate.slice(i, i + batchSize).map(m => ({\r\n                id: m.id,\r\n                name: m.name || '',\r\n                description: m.description || '',\r\n                provider: m.provider || ''\r\n            }));\r\n\r\n            // Prompts removed as LLM is disabled\r\n\r\n            try {\r\n                let googleTranslated = false;\r\n\r\n                // 1. Try Google Translate first (Faster, Free)\r\n                try {\r\n                    // Process in parallel with limit to avoid rate limits\r\n                    const googleResults = await Promise.all(batch.map(async (item) => {\r\n                        try {\r\n                            // Translate name\r\n                            let nameEn = item.name;\r\n                            if (containsChinese(item.name) || containsOtherAsianLanguages(item.name)) {\r\n                                const res = await (window as any).electronAPI.translateText(item.name);\r\n                                if (res.error) throw new Error(res.error);\r\n                                nameEn = res.text;\r\n                            }\r\n\r\n                            // Translate description\r\n                            let descEn = item.description;\r\n                            if (item.description && (containsChinese(item.description) || containsOtherAsianLanguages(item.description))) {\r\n                                // Truncate very long descriptions to avoid 5000 char limit\r\n                                const textToTranslate = item.description.slice(0, 4500);\r\n                                const res = await (window as any).electronAPI.translateText(textToTranslate);\r\n                                if (res.error) throw new Error(res.error);\r\n                                descEn = res.text;\r\n                            }\r\n\r\n                            return { ...item, name_en: nameEn, description_en: descEn };\r\n                        } catch (e) {\r\n                            return null; // Should fall back to LLM for this item or batch\r\n                        }\r\n                    }));\r\n\r\n                    // Check if we got valid results\r\n                    if (googleResults.every(r => r !== null)) {\r\n                        // Apply Google Translations\r\n                        for (let j = 0; j < translatedModels.length; j++) {\r\n                            const t = googleResults.find(r => r && r.id === translatedModels[j].id);\r\n                            if (t) {\r\n                                translatedModels[j] = {\r\n                                    ...translatedModels[j],\r\n                                    name: t.name_en || translatedModels[j].name,\r\n                                    description: t.description_en || translatedModels[j].description,\r\n                                    tags: [...new Set([...(translatedModels[j].tags || []), 'translated'])]\r\n                                };\r\n                            }\r\n                        }\r\n                        googleTranslated = true;\r\n                        console.log(`[Translation] Batch ${Math.floor(i / batchSize) + 1\r\n                            } translated via Google Translate`);\r\n                        // Keep delay for rate limiting\r\n                        if (i + batchSize < toTranslate.length) await new Promise(r => setTimeout(r, 1000));\r\n                        continue; // Skip LLM logic\r\n                    }\r\n                } catch (googleError) {\r\n                    console.warn('[Translation] Google Translate failed, falling back to LLM:', googleError);\r\n                    // Fall through to LLM\r\n                }\r\n\r\n                let translated: any = null;\r\n                // 2. Fallback to LLM - REMOVED per user request\r\n                // We now strictly use Google Translate -> Fallback (Original Name)\r\n\r\n                if (Array.isArray(translated)) {\r\n                    const byId = new Map<string, { name_en?: string; description_en?: string }>();\r\n                    translated.forEach((r: any) => {\r\n                        if (r && r.id) {\r\n                            byId.set(String(r.id), {\r\n                                name_en: r.name_en,\r\n                                description_en: r.description_en\r\n                            });\r\n                        }\r\n                    });\r\n\r\n                    // Apply translations to the models\r\n                    for (let j = 0; j < translatedModels.length; j++) {\r\n                        const t = byId.get(translatedModels[j].id);\r\n                        if (t) {\r\n                            const originalName = translatedModels[j].name;\r\n                            const originalDesc = translatedModels[j].description;\r\n\r\n                            translatedModels[j] = {\r\n                                ...translatedModels[j],\r\n                                name: t.name_en && t.name_en.trim() ? t.name_en : translatedModels[j].name,\r\n                                description: t.description_en && t.description_en.trim() ? t.description_en : translatedModels[j].description,\r\n                                tags: [...new Set([...(translatedModels[j].tags || []), 'translated'])]\r\n                            };\r\n\r\n                            if (originalName !== translatedModels[j].name || originalDesc !== translatedModels[j].description) {\r\n                                console.log(`[Translation] Translated: \"${originalName}\" ÔåÆ \"${translatedModels[j].name}\"`);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    console.log(`[Translation] Successfully processed batch ${Math.floor(i / batchSize) + 1} /${Math.ceil(toTranslate.length / batchSize)\r\n                        }`);\r\n                    if (onProgress) {\r\n                        onProgress(`Translating... (${i + batch.length}/${toTranslate.length})`);\r\n                    }\r\n                } else {\r\n                    // Track fallback usage with reason\r\n                    fallbackBatchCount++;\r\n                    if (!fallbackReason) {\r\n                        fallbackReason = 'LLM returned invalid JSON (not an array)';\r\n                    }\r\n                    applyFallbackTranslation(translatedModels);\r\n                }\r\n            } catch (error: any) {\r\n                console.error(`[Translation] Error in batch ${Math.floor(i / batchSize) + 1}: `, error?.message || error);\r\n                fallbackBatchCount++;\r\n                if (!fallbackReason) {\r\n                    fallbackReason = `API error: ${error?.message || 'Unknown error'} `;\r\n                }\r\n                // Continue with next batch even if one fails\r\n                // Apply ASCII/context fallback for this batch as well\r\n                applyFallbackTranslation(translatedModels);\r\n            }\r\n\r\n            // Small delay between batches to avoid rate limiting\r\n            if (i + batchSize < toTranslate.length) {\r\n                await new Promise(resolve => setTimeout(resolve, 500));\r\n            }\r\n        }\r\n\r\n        const translatedCount = translatedModels.filter(m => m.tags?.includes('translated')).length;\r\n        const totalBatches = Math.ceil(toTranslate.length / batchSize);\r\n\r\n        if (fallbackBatchCount > 0) {\r\n            console.warn(`[Translation] Used ASCII / context fallback for ${fallbackBatchCount} / ${totalBatches} batches.Reason: ${fallbackReason} `);\r\n        }\r\n        console.log(`[Translation] Completed: ${translatedCount} models translated successfully`);\r\n\r\n        return translatedModels;\r\n    } catch (error: any) {\r\n        console.error('[Translation] Unexpected error:', error?.message || error);\r\n        return models;\r\n    }\r\n}\r\n\r\n/**\r\n * Applies fallback translation strategy when LLM translation fails.\r\n * Extracts ASCII characters and uses contextual English labels based on model domain.\r\n *\r\n * @param models - Array of models to apply fallback translation to\r\n *\r\n * @remarks\r\n * This function modifies the models array in place, applying:\r\n * - ASCII-only extraction from names\r\n * - Domain-based contextual English labels when ASCII extraction fails\r\n * - Generic descriptions based on model domain and provider\r\n */\r\nfunction applyFallbackTranslation(models: Model[]): void {\r\n    const englishFromContext = (m: Model): string => {\r\n        switch (m.domain) {\r\n            case 'LLM': return 'Chinese Language Model';\r\n            case 'ImageGen': return 'Chinese Image Generation Model';\r\n            case 'VLM': return 'Chinese Multimodal Model';\r\n            case 'Vision': return 'Chinese Vision Model';\r\n            case 'Audio': return 'Chinese Audio Model';\r\n            case 'ASR': return 'Chinese Speech Recognition Model';\r\n            case 'TTS': return 'Chinese Text-to-Speech Model';\r\n            case 'VideoGen': return 'Chinese Video Generation Model';\r\n            default: return 'Chinese AI Model';\r\n        }\r\n    };\r\n\r\n    for (let j = 0; j < models.length; j++) {\r\n        const m = models[j];\r\n        if (containsChinese(m.name) || containsOtherAsianLanguages(m.name)) {\r\n            // Per user request: Keep original name if translation fails\r\n            // prevent \"random names\" from aggressive ASCII stripping (e.g. \"Ú½ÿµ©à.safetensors\" -> \"safetensors\")\r\n            const newName = m.name;\r\n\r\n            // Only add a generic description if the current one is also unreadable/missing\r\n            const newDesc = m.description && (containsChinese(m.description) || containsOtherAsianLanguages(m.description))\r\n                ? `${englishFromContext(m)} from ${m.provider || m.source || 'Chinese platform'} \\n\\n(Original Description: ${m.description})`\r\n                : m.description;\r\n\r\n            models[j] = {\r\n                ...m,\r\n                name: newName,\r\n                description: newDesc,\r\n                // Mark as translated so we don't retry endlessly, even though we kept original\r\n                tags: [...new Set([...(m.tags || []), 'translated'])]\r\n            };\r\n        }\r\n    }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\utils\\date-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\utils\\domain-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\utils\\github-utils.ts","messages":[{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":15,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":15,"endColumn":16,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[522,523],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * GitHub-specific utility functions for parsing repositories and SPDX licenses\r\n */\r\n\r\n/**\r\n * Parse GitHub repository URL to extract owner and name\r\n */\r\nexport function parseGitHubRepo(url?: string | null): { owner: string; name: string } | null {\r\n    if (!url) return null;\r\n    try {\r\n        const u = new URL(url);\r\n        if (u.hostname !== 'github.com') return null;\r\n        const [owner, name] = u.pathname.replace(/^\\//, '').split('/');\r\n        if (owner && name) return { owner, name };\r\n    } catch { }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Map SPDX license identifier to license type\r\n */\r\nexport function mapSpdxToType(spdx?: string | null): 'Proprietary' | 'OSI' | 'Copyleft' | 'Non-Commercial' | 'Custom' {\r\n    if (!spdx) return 'Custom';\r\n    const s = spdx.toLowerCase();\r\n    if (s.includes('gpl') || s.includes('agpl') || s.includes('lgpl')) return 'Copyleft';\r\n    if (s.includes('apache') || s.includes('mit') || s.includes('bsd') || s.includes('mpl')) return 'OSI';\r\n    if (s.includes('cc-by-nc') || s.includes('non-commercial') || s.includes('nc')) return 'Non-Commercial';\r\n    if (s.includes('proprietary')) return 'Proprietary';\r\n    return 'Custom';\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\utils\\http-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\utils\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\utils\\license-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\api\\utils\\parameter-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\consoleService.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":119,"column":18,"nodeType":"MemberExpression","messageId":"limited","endLine":119,"endColumn":29},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":120,"column":19,"nodeType":"MemberExpression","messageId":"limited","endLine":120,"endColumn":31},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":125,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":125,"endColumn":20},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":128,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":128,"endColumn":24,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4099,4100],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":132,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":132,"endColumn":21},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":135,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":135,"endColumn":24,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4293,4294],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":142,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":142,"endColumn":24,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4488,4489],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":149,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":149,"endColumn":24,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4685,4686],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":156,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":156,"endColumn":24},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":157,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":157,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Console Service\r\n * \r\n * Provides console logging interception and webhook streaming functionality.\r\n * This service captures fetch requests, console logs, and webhook events for debugging.\r\n */\r\n\r\nexport interface ConsoleInterceptor {\r\n    install: () => void;\r\n    uninstall: () => void;\r\n}\r\n\r\nexport interface WebhookStream {\r\n    start: () => void;\r\n    stop: () => void;\r\n}\r\n\r\n/**\r\n * Create a fetch interceptor that logs all HTTP requests and responses\r\n * \r\n * @param onLog - Callback function to handle log messages\r\n * @param enabled - Whether the interceptor should be active\r\n * @returns ConsoleInterceptor with install/uninstall methods\r\n */\r\nexport function createFetchInterceptor(\r\n    onLog: (message: string) => void,\r\n    enabled: boolean\r\n): ConsoleInterceptor {\r\n    let originalFetch: typeof window.fetch | null = null;\r\n\r\n    const install = () => {\r\n        if (!enabled || originalFetch) return;\r\n\r\n        originalFetch = window.fetch;\r\n        window.fetch = async (input: RequestInfo | URL, init?: RequestInit) => {\r\n            const id = Math.random().toString(36).slice(2, 8);\r\n            const url = typeof input === 'string' ? input : (input as URL).toString();\r\n            const method = init?.method || 'GET';\r\n\r\n            try {\r\n                // Log request\r\n                const headers = JSON.stringify(init?.headers || {});\r\n                const body = init?.body\r\n                    ? (typeof init.body === 'string' ? init.body : '[binary]')\r\n                    : '';\r\n\r\n                onLog(\r\n                    `[REQ ${id}] ${url} ${method}\\n` +\r\n                    `Headers: ${headers}` +\r\n                    (body ? `\\nBody: ${body}` : '')\r\n                );\r\n\r\n                // Execute request\r\n                const resp = await originalFetch!(input as any, init);\r\n\r\n                // Log response\r\n                const cloned = resp.clone();\r\n                const text = await cloned.text().catch(() => '[non-text body]');\r\n                onLog(\r\n                    `[RES ${id}] ${resp.status} ${resp.statusText} ${url}\\n` +\r\n                    `${text?.slice(0, 2000)}`\r\n                );\r\n\r\n                return resp;\r\n            } catch (err: any) {\r\n                // Log error\r\n                onLog(`[ERR ${id}] ${url}\\n${err?.message || err}`);\r\n                throw err;\r\n            }\r\n        };\r\n    };\r\n\r\n    const uninstall = () => {\r\n        if (originalFetch) {\r\n            window.fetch = originalFetch;\r\n            originalFetch = null;\r\n        }\r\n    };\r\n\r\n    return { install, uninstall };\r\n}\r\n\r\n/**\r\n * Create a console interceptor that captures console.log/info/warn/error calls\r\n * \r\n * @param onLog - Callback function to handle log messages\r\n * @param enabled - Whether the interceptor should be active\r\n * @returns ConsoleInterceptor with install/uninstall methods\r\n */\r\nexport function createConsoleInterceptor(\r\n    onLog: (message: string) => void,\r\n    enabled: boolean\r\n): ConsoleInterceptor {\r\n    let originalConsole: {\r\n        log: typeof console.log;\r\n        info: typeof console.info;\r\n        warn: typeof console.warn;\r\n        error: typeof console.error;\r\n    } | null = null;\r\n\r\n    const toLine = (level: 'LOG' | 'INFO' | 'WARN' | 'ERROR', args: any[]): string => {\r\n        const ts = new Date().toISOString();\r\n        const msg = args.map(a => {\r\n            try {\r\n                if (typeof a === 'string') return a;\r\n                if (a instanceof Error) return a.stack || a.message;\r\n                return JSON.stringify(a);\r\n            } catch {\r\n                return String(a);\r\n            }\r\n        }).join(' ');\r\n        return `[${level} ${ts}] ${msg}`;\r\n    };\r\n\r\n    const install = () => {\r\n        if (!enabled || originalConsole) return;\r\n\r\n        originalConsole = {\r\n            log: console.log,\r\n            info: console.info,\r\n            warn: console.warn,\r\n            error: console.error\r\n        };\r\n\r\n        console.log = (...args: any[]) => {\r\n            try {\r\n                onLog(toLine('LOG', args));\r\n            } catch { }\r\n            originalConsole!.log(...args);\r\n        };\r\n\r\n        console.info = (...args: any[]) => {\r\n            try {\r\n                onLog(toLine('INFO', args));\r\n            } catch { }\r\n            originalConsole!.info(...args);\r\n        };\r\n\r\n        console.warn = (...args: any[]) => {\r\n            try {\r\n                onLog(toLine('WARN', args));\r\n            } catch { }\r\n            originalConsole!.warn(...args);\r\n        };\r\n\r\n        console.error = (...args: any[]) => {\r\n            try {\r\n                onLog(toLine('ERROR', args));\r\n            } catch { }\r\n            originalConsole!.error(...args);\r\n        };\r\n    };\r\n\r\n    const uninstall = () => {\r\n        if (originalConsole) {\r\n            console.log = originalConsole.log;\r\n            console.info = originalConsole.info;\r\n            console.warn = originalConsole.warn;\r\n            console.error = originalConsole.error;\r\n            originalConsole = null;\r\n        }\r\n    };\r\n\r\n    return { install, uninstall };\r\n}\r\n\r\n/**\r\n * Create a webhook stream that listens for webhook events via SSE or polling\r\n * \r\n * @param onLog - Callback function to handle log messages\r\n * @returns WebhookStream with start/stop methods\r\n */\r\nexport function createWebhookStream(\r\n    onLog: (message: string) => void\r\n): WebhookStream {\r\n    let isMounted = true;\r\n    let eventSource: EventSource | null = null;\r\n    let pollIntervalId: number | null = null;\r\n    let lastWebhookId: string | null = null;\r\n\r\n    const canUseWebhooks = (import.meta.env.PROD || import.meta.env.VITE_USE_PROXY === 'true') &&\r\n        (window.location.protocol === 'http:' || window.location.protocol === 'https:');\r\n\r\n    /**\r\n     * Poll for webhook logs via HTTP endpoint\r\n     */\r\n    const poll = async () => {\r\n        if (!canUseWebhooks) return;\r\n\r\n        try {\r\n            const resp = await fetch('/webhooks/openai/logs', {\r\n                signal: AbortSignal.timeout(1000)\r\n            });\r\n\r\n            if (!resp.ok) return;\r\n\r\n            const logs = await resp.json();\r\n            if (!Array.isArray(logs) || logs.length === 0) return;\r\n\r\n            const newestId = logs[0]?.id || null;\r\n            if (!newestId) return;\r\n\r\n            // Determine new events since last seen\r\n            let newEvents = logs;\r\n            if (lastWebhookId) {\r\n                const idx = logs.findIndex((e: any) => e.id === lastWebhookId);\r\n                newEvents = idx > 0 ? logs.slice(0, idx) : idx === 0 ? [] : logs;\r\n            }\r\n\r\n            // Append oldest-first for readable order\r\n            newEvents.slice().reverse().forEach((evt: any) => {\r\n                const header = `[WEBHOOK] ${evt.ts || ''} verified=${evt.verified ? 'yes' : 'no'}`;\r\n                const body = typeof evt.body === 'string'\r\n                    ? evt.body\r\n                    : JSON.stringify(evt.body || {}, null, 2);\r\n                onLog(`${header}\\n${body}`);\r\n            });\r\n\r\n            lastWebhookId = newestId;\r\n        } catch {\r\n            // Silently fail - polling errors are expected\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Initialize SSE connection with fallback to polling\r\n     */\r\n    const init = async () => {\r\n        if (!canUseWebhooks) {\r\n            return; // dev without proxy/server: skip to avoid 404 noise\r\n        }\r\n\r\n        // Probe availability before wiring SSE\r\n        try {\r\n            const head = await fetch('/webhooks/openai/logs', {\r\n                signal: AbortSignal.timeout(1000)\r\n            });\r\n            if (!head.ok) return; // not available; skip\r\n        } catch {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Try to establish SSE connection\r\n            eventSource = new EventSource('/webhooks/openai/stream');\r\n\r\n            eventSource.onmessage = (e) => {\r\n                if (!isMounted) return;\r\n\r\n                try {\r\n                    const evt = JSON.parse(e.data);\r\n                    const header = `[WEBHOOK] ${evt.ts || ''} verified=${evt.verified ? 'yes' : 'no'}`;\r\n                    const body = typeof evt.body === 'string'\r\n                        ? evt.body\r\n                        : JSON.stringify(evt.body || {}, null, 2);\r\n                    onLog(`${header}\\n${body}`);\r\n                    lastWebhookId = evt.id || lastWebhookId;\r\n                } catch {\r\n                    // Silently fail on parse errors\r\n                }\r\n            };\r\n\r\n            eventSource.onerror = () => {\r\n                // SSE failed, fall back to polling\r\n                if (eventSource) {\r\n                    eventSource.close();\r\n                    eventSource = null;\r\n                }\r\n                pollIntervalId = window.setInterval(() => {\r\n                    if (isMounted) void poll();\r\n                }, 5000);\r\n            };\r\n\r\n            // Initial backfill via one poll\r\n            await poll();\r\n        } catch {\r\n            // SSE not available, use polling\r\n            pollIntervalId = window.setInterval(() => {\r\n                if (isMounted) void poll();\r\n            }, 5000);\r\n        }\r\n    };\r\n\r\n    const start = () => {\r\n        isMounted = true;\r\n        void init();\r\n    };\r\n\r\n    const stop = () => {\r\n        isMounted = false;\r\n\r\n        if (eventSource) {\r\n            eventSource.close();\r\n            eventSource = null;\r\n        }\r\n\r\n        if (pollIntervalId !== null) {\r\n            window.clearInterval(pollIntervalId);\r\n            pollIntervalId = null;\r\n        }\r\n    };\r\n\r\n    return { start, stop };\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\enrichment.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\exportService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\rateLimiter.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\rateLimiter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\storage\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\storage\\indexedDBStorage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\storage\\storage.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\syncService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\syncService.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":39,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":39,"endColumn":20,"suggestions":[{"fix":{"range":[1192,1259],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Sync Service (Facade)\r\n * \r\n * Orchestrates the synchronization process by delegating to specific micro-services.\r\n * \r\n * @module syncService\r\n */\r\n\r\nimport { SyncOptions, SyncCallbacks, SyncResult } from \"./sync/SyncTypes\";\r\nimport { orchestrateSync } from \"./sync/SyncOrchestrator\";\r\n\r\nexport type { SyncOptions, SyncCallbacks, SyncResult, SyncProgress } from \"./sync/SyncTypes\";\r\n\r\n/**\r\n * Synchronize all enabled data sources and return combined results.\r\n */\r\nexport async function syncAllSources(\r\n    options: SyncOptions,\r\n    callbacks?: SyncCallbacks\r\n): Promise<SyncResult> {\r\n    return orchestrateSync(options, callbacks);\r\n}\r\n\r\n/**\r\n * Synchronize with live options including auto-refresh and custom prompts.\r\n */\r\nexport async function syncWithLiveOptions(\r\n    options: SyncOptions & {\r\n        autoRefresh?: { enabled: boolean; interval: number; unit: string };\r\n        minDownloadsBypass?: number;\r\n    },\r\n    callbacks?: SyncCallbacks\r\n): Promise<SyncResult> {\r\n    const { onLog } = callbacks || {};\r\n\r\n    if (options.autoRefresh?.enabled) {\r\n        const intervalValue = options.autoRefresh.interval;\r\n        const unit = options.autoRefresh.unit;\r\n        console.log(`Auto-refresh set for every ${intervalValue} ${unit}`);\r\n        if (onLog) {\r\n            onLog(`Auto-refresh set for every ${intervalValue} ${unit}`);\r\n        }\r\n    }\r\n\r\n    // Use the main orchestrator\r\n    return orchestrateSync(options, callbacks);\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\sync\\DiscoveryService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\sync\\FetcherRegistry.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\sync\\SafetyService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\sync\\SyncOrchestrator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\sync\\SyncTypes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\sync\\TranslationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\validation.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":435,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":435,"endColumn":16,"suggestions":[{"fix":{"range":[15660,15755],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":518,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":518,"endColumn":16,"suggestions":[{"fix":{"range":[19105,19177],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Model } from \"../types\";\r\n\r\n// Define the sources to check for model information\r\nexport enum ValidationSource {\r\n  API = \"api\",\r\n  WEBSEARCH = \"websearch\",\r\n  SCRAPING = \"scraping\"\r\n}\r\n\r\n// Define validation job status\r\nexport type ValidationJobStatus =\r\n  | \"pending\"\r\n  | \"processing\"\r\n  | \"completed\"\r\n  | \"failed\";\r\n\r\n// Define a validation job\r\nexport interface ValidationJob {\r\n  id: string;\r\n  model: Model;\r\n  sources: ValidationSource[];\r\n  status: ValidationJobStatus;\r\n  attempts: number;\r\n  maxAttempts: number;\r\n  error?: string;\r\n  result?: Model;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\n// ValidationQueue class for managing model validation\r\nexport class ValidationQueue {\r\n  private jobs: ValidationJob[] = [];\r\n  private concurrency: number;\r\n  private processingCount: number = 0;\r\n  private onValidate: (model: Model, sources: ValidationSource[]) => Promise<Model>;\r\n  private onProgress?: (current: number, total: number) => void;\r\n  private onComplete?: (job: ValidationJob) => void;\r\n  private onError?: (job: ValidationJob) => void;\r\n  private paused: boolean = false;\r\n\r\n  constructor(\r\n    onValidate: (model: Model, sources: ValidationSource[]) => Promise<Model>,\r\n    options: {\r\n      concurrency?: number;\r\n      onProgress?: (current: number, total: number) => void;\r\n      onComplete?: (job: ValidationJob) => void;\r\n      onError?: (job: ValidationJob) => void;\r\n    } = {}\r\n  ) {\r\n    this.concurrency = options.concurrency || 2;\r\n    this.onValidate = onValidate;\r\n    this.onProgress = options.onProgress;\r\n    this.onComplete = options.onComplete;\r\n    this.onError = options.onError;\r\n  }\r\n\r\n  // Add a model to the validation queue\r\n  public addJob(\r\n    model: Model,\r\n    sources: ValidationSource[] = [ValidationSource.API],\r\n    maxAttempts: number = 3\r\n  ): string {\r\n    const jobId = `job_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n\r\n    const job: ValidationJob = {\r\n      id: jobId,\r\n      model,\r\n      sources,\r\n      status: \"pending\",\r\n      attempts: 0,\r\n      maxAttempts,\r\n      createdAt: new Date(),\r\n      updatedAt: new Date()\r\n    };\r\n\r\n    this.jobs.push(job);\r\n\r\n    // Start processing if not paused\r\n    if (!this.paused) {\r\n      this.processNext();\r\n    }\r\n\r\n    return jobId;\r\n  }\r\n\r\n  // Add multiple models to the validation queue\r\n  public addJobs(\r\n    models: Model[],\r\n    sources: ValidationSource[] = [ValidationSource.API],\r\n    maxAttempts: number = 3\r\n  ): string[] {\r\n    return models.map(model => this.addJob(model, sources, maxAttempts));\r\n  }\r\n\r\n  // Pause the queue processing\r\n  public pause(): void {\r\n    this.paused = true;\r\n  }\r\n\r\n  // Resume queue processing\r\n  public resume(): void {\r\n    this.paused = false;\r\n    this.processNext();\r\n  }\r\n\r\n  // Get paused status\r\n  public isPaused(): boolean {\r\n    return this.paused;\r\n  }\r\n\r\n  // Process next jobs in queue\r\n  private processNext(): void {\r\n    if (this.paused) return;\r\n\r\n    // Check how many jobs we can process now\r\n    const availableSlots = this.concurrency - this.processingCount;\r\n    if (availableSlots <= 0) return;\r\n\r\n    // Get pending jobs\r\n    const pendingJobs = this.jobs.filter(job => job.status === \"pending\");\r\n\r\n    // Process up to availableSlots jobs\r\n    const jobsToProcess = pendingJobs.slice(0, availableSlots);\r\n\r\n    // Update progress if needed\r\n    if (this.onProgress && this.jobs.length > 0) {\r\n      const completed = this.jobs.filter(j => j.status === \"completed\" || j.status === \"failed\").length;\r\n      this.onProgress(completed, this.jobs.length);\r\n    }\r\n\r\n    // If no more jobs to process, we're done\r\n    if (jobsToProcess.length === 0) return;\r\n\r\n    // Process each job\r\n    jobsToProcess.forEach(job => this.processJob(job));\r\n  }\r\n\r\n  // Process a single job\r\n  private async processJob(job: ValidationJob): Promise<void> {\r\n    if (job.status !== \"pending\") return;\r\n\r\n    // Mark job as processing and increment counter\r\n    job.status = \"processing\";\r\n    job.attempts++;\r\n    job.updatedAt = new Date();\r\n    this.processingCount++;\r\n\r\n    try {\r\n      // Call validation function\r\n      const result = await this.onValidate(job.model, job.sources);\r\n\r\n      // Update job with result\r\n      job.status = \"completed\";\r\n      job.result = result;\r\n      job.updatedAt = new Date();\r\n\r\n      // Notify completion if callback exists\r\n      if (this.onComplete) {\r\n        this.onComplete(job);\r\n      }\r\n    } catch (error) {\r\n      // Handle error\r\n      const errorMessage = error instanceof Error ? error.message : String(error);\r\n\r\n      // Check if we should retry\r\n      if (job.attempts < job.maxAttempts) {\r\n        job.status = \"pending\"; // Mark for retry\r\n        job.error = `${errorMessage} (Retrying ${job.attempts}/${job.maxAttempts})`;\r\n      } else {\r\n        job.status = \"failed\"; // Give up after max attempts\r\n        job.error = `${errorMessage} (Failed after ${job.maxAttempts} attempts)`;\r\n\r\n        // Add more context for common errors\r\n        if (errorMessage.includes(\"No enabled LLM providers\")) {\r\n          job.error = \"No API providers configured. Please set up an API provider in Sync settings.\";\r\n        } else if (errorMessage.includes(\"401\")) {\r\n          job.error = \"API authentication failed (401). Check your API key.\";\r\n        } else if (errorMessage.includes(\"403\")) {\r\n          job.error = \"API access forbidden (403). Check your account permissions.\";\r\n        } else if (errorMessage.includes(\"404\")) {\r\n          job.error = \"API endpoint not found (404). The provider may have changed their API.\";\r\n        } else if (errorMessage.includes(\"429\")) {\r\n          job.error = \"API rate limit exceeded (429). Try again later or use a different provider.\";\r\n        } else if (errorMessage.includes(\"500\")) {\r\n          job.error = \"API server error (500). The provider's service may be experiencing issues.\";\r\n        }\r\n\r\n        // Notify error if callback exists\r\n        if (this.onError) {\r\n          this.onError(job);\r\n        }\r\n      }\r\n    } finally {\r\n      // Decrement processing counter\r\n      this.processingCount--;\r\n\r\n      // Update progress if needed\r\n      if (this.onProgress && this.jobs.length > 0) {\r\n        const completed = this.jobs.filter(j => j.status === \"completed\" || j.status === \"failed\").length;\r\n        this.onProgress(completed, this.jobs.length);\r\n      }\r\n\r\n      // Process next job\r\n      this.processNext();\r\n    }\r\n  }\r\n\r\n  // Get all jobs\r\n  public getJobs(): ValidationJob[] {\r\n    return [...this.jobs];\r\n  }\r\n\r\n  // Get pending job count\r\n  public getPendingCount(): number {\r\n    return this.jobs.filter(j => j.status === \"pending\").length;\r\n  }\r\n\r\n  // Get completed job count\r\n  public getCompletedCount(): number {\r\n    return this.jobs.filter(j => j.status === \"completed\").length;\r\n  }\r\n\r\n  // Get failed job count\r\n  public getFailedCount(): number {\r\n    return this.jobs.filter(j => j.status === \"failed\").length;\r\n  }\r\n\r\n  // Get processing job count\r\n  public getProcessingCount(): number {\r\n    return this.jobs.filter(j => j.status === \"processing\").length;\r\n  }\r\n\r\n  // Get total job count\r\n  public getTotalCount(): number {\r\n    return this.jobs.length;\r\n  }\r\n\r\n  // Clear completed and failed jobs\r\n  public clearFinishedJobs(): void {\r\n    this.jobs = this.jobs.filter(j => j.status !== \"completed\" && j.status !== \"failed\");\r\n  }\r\n\r\n  // Clear all jobs\r\n  public clearAllJobs(): void {\r\n    this.pause();\r\n    this.jobs = [];\r\n    this.processingCount = 0;\r\n  }\r\n}\r\n\r\n// Helper functions for common validation tasks\r\n\r\n// Create a validation prompt for LLM-based validation\r\nexport function createValidationPrompt(model: Model, sources: ValidationSource[]): string {\r\n  const sourceDescription = sources.includes(ValidationSource.WEBSEARCH)\r\n    ? \"Use web search to find the most accurate and up-to-date information.\"\r\n    : \"Use your knowledge to fill in missing information.\";\r\n\r\n  return `\r\nI need complete and accurate metadata for this AI model:\r\n${JSON.stringify(model, null, 2)}\r\n\r\n${sourceDescription}\r\n\r\nFor each missing or incomplete field, provide the most accurate information available.\r\nPay special attention to:\r\n1. Provider/Author: The actual person or organization who created/published the model (NOT the platform like \"HuggingFace\" or \"Replicate\")\r\n2. Parameters (model size like \"7B\", \"70B\", \"1.3B\")\r\n3. Context window (for LLMs like \"4k\", \"8k\", \"32k\", \"128k\")\r\n4. License details (exact name, type, commercial use permissions)\r\n5. Release date: CRITICAL - Find the official announcement/launch date when this model was first released. Look for:\r\n   - Official company blog posts announcing the model\r\n   - Technical reports and research papers\r\n   - Press releases and news articles\r\n   - GitHub repository creation dates and release tags\r\n   - Model card publication dates\r\n   Format as YYYY-MM-DD, prefer the earliest official announcement\r\n6. Description (brief explanation of what the model does)\r\n7. Tags (relevant technical tags and categories)\r\n 8. Links: include authoritative url (model card, official page) and repo (GitHub or equivalent) if available\r\n\r\nIMPORTANT: If a reliable date or source cannot be found, search again with different queries and cross-check at least two sources before returning \"Unknown\".\r\n\r\nReturn the complete model information as a valid JSON object with all fields filled.\r\nDo not include explanations outside the JSON structure.\r\n`;\r\n}\r\n\r\n// Helper to check if a model is missing critical information\r\nexport function getMissingFields(model: Model): string[] {\r\n  const missingFields: string[] = [];\r\n\r\n  if (!model.name) missingFields.push('name');\r\n  if (!model.provider) missingFields.push('provider');\r\n  if (!model.domain) missingFields.push('domain');\r\n  if (!model.description) missingFields.push('description');\r\n  if (!model.parameters && (model.domain === 'LLM' || model.domain === 'VLM' || model.domain === 'ImageGen')) missingFields.push('parameters');\r\n  if (!model.context_window && (model.domain === 'LLM' || model.domain === 'VLM')) missingFields.push('context_window');\r\n  if (!model.license) {\r\n    missingFields.push('license');\r\n  } else {\r\n    if (!model.license.name || model.license.name === 'Unknown') missingFields.push('license.name');\r\n    if (!model.license.type) missingFields.push('license.type');\r\n    if (model.license.commercial_use === undefined) missingFields.push('license.commercial_use');\r\n  }\r\n  if (!model.updated_at && !model.release_date) missingFields.push('release_date');\r\n  if (!model.tags || model.tags.length === 0) missingFields.push('tags');\r\n\r\n  return missingFields;\r\n}\r\n\r\n// Database-wide validation functions\r\n\r\n// Create validation prompt for entire database\r\nexport function createDatabaseValidationPrompt(models: Model[]): string {\r\n  // If too many models, suggest chunking\r\n  if (models.length > 100) {\r\n    console.warn(`Large database (${models.length} models) may hit API limits. Consider processing in batches.`);\r\n  }\r\n\r\n  const csvData = convertModelsToCSV(models);\r\n\r\n  // Calculate approximate token count (rough estimate: 1 token Ôëê 4 characters)\r\n  const estimatedTokens = Math.ceil(csvData.length / 4);\r\n\r\n  if (estimatedTokens > 100000) {\r\n    throw new Error(`Database too large (est. ${estimatedTokens} tokens). Please validate in smaller batches or contact support for enterprise processing.`);\r\n  }\r\n\r\n  return `You are an AI model database expert. I'm providing you with my AI model database in CSV format for enrichment and validation.\r\n\r\nÔÜá´©Å CRITICAL RULES:\r\n1. **PRESERVE ALL MODELS** - You MUST return ALL ${models.length} models in your response\r\n2. **ONLY FILL BLANKS** - Only update fields that are empty or contain \"Unknown\"\r\n3. **DO NOT REMOVE MODELS** - Every model in the input MUST appear in the output\r\n4. **DO NOT GUESS** - If you don't know accurate information, leave the field as is or mark \"Unknown\"\r\n5. **USE WEB SEARCH** - For missing dates, parameters, or other facts, search for official sources\r\n\r\nTASK: Enrich this database by filling in ONLY the missing information:\r\n\r\n**PRIORITY FIELDS TO FILL:**\r\n- **release_date**: Find official announcement/launch date (YYYY-MM-DD format)\r\n  * Search for: \"[model name] release date\", \"[model name] announcement\", \"[model name] launch\"\r\n  * Verify with official blog posts, research papers, press releases\r\n  * Cross-check at least 2 sources before adding\r\n- **parameters**: Model size (e.g., \"7B\", \"70B\", \"1.3B\", \"405B\")\r\n- **context_window**: For LLMs (e.g., \"4k\", \"8k\", \"32k\", \"128k\", \"200k\")\r\n- **provider**: ACTUAL creator/publisher (NOT \"HuggingFace\" or \"Replicate\")\r\n- **description**: Brief, accurate description of capabilities\r\n- **license_name**: Exact license name (e.g., \"Apache-2.0\", \"MIT\", \"Llama 3 Community License\")\r\n- **commercial_use**: true/false based on actual license terms\r\n\r\n**VALIDATION APPROACH:**\r\n1. Scan each row for empty fields\r\n2. For each empty field, search for accurate information\r\n3. Only update if you find reliable, verifiable data\r\n4. Keep existing data unless it's clearly wrong\r\n5. Return ALL ${models.length} models with enriched data\r\n\r\nDATABASE (${models.length} models):\r\n${csvData}\r\n\r\n**OUTPUT FORMAT:**\r\nReturn ONLY the complete CSV with ALL ${models.length} models.\r\n- Same column structure as input\r\n- Same row count as input (${models.length} rows + header)\r\n- Only empty fields should be filled\r\n- No explanations, just the CSV data\r\n\r\nBegin CSV output now:`;\r\n}\r\n\r\n// Convert models array to CSV for GPT processing\r\nexport function convertModelsToCSV(models: Model[]): string {\r\n  const headers = [\r\n    'id', 'name', 'provider', 'domain', 'source', 'url', 'repo',\r\n    'license_name', 'license_type', 'commercial_use', 'attribution_required',\r\n    'share_alike', 'copyleft', 'parameters', 'context_window', 'description',\r\n    'pricing_flat', 'pricing_input', 'pricing_output', 'pricing_currency',\r\n    'pricing_unit', 'pricing_notes', 'release_date', 'updated_at',\r\n    'downloads', 'tags', 'indemnity', 'data_provenance'\r\n  ];\r\n\r\n  const rows = models.map(model => [\r\n    model.id || '',\r\n    model.name || '',\r\n    model.provider || '',\r\n    model.domain || '',\r\n    model.source || '',\r\n    model.url || '',\r\n    model.repo || '',\r\n    model.license?.name || '',\r\n    model.license?.type || '',\r\n    model.license?.commercial_use ? 'true' : 'false',\r\n    model.license?.attribution_required ? 'true' : 'false',\r\n    model.license?.share_alike ? 'true' : 'false',\r\n    model.license?.copyleft ? 'true' : 'false',\r\n    model.parameters || '',\r\n    model.context_window || '',\r\n    model.description || '',\r\n    model.pricing?.[0]?.flat?.toString() || '',\r\n    model.pricing?.[0]?.input?.toString() || '',\r\n    model.pricing?.[0]?.output?.toString() || '',\r\n    model.pricing?.[0]?.currency || '',\r\n    model.pricing?.[0]?.unit || '',\r\n    model.pricing?.[0]?.notes || '',\r\n    model.release_date || '',\r\n    model.updated_at || '',\r\n    model.downloads?.toString() || '',\r\n    model.tags?.join(';') || '',\r\n    model.indemnity || '',\r\n    model.data_provenance || ''\r\n  ]);\r\n\r\n  const csvContent = [headers.join(','), ...rows.map(row =>\r\n    row.map(cell => `\"${cell.toString().replace(/\"/g, '\"\"')}\"`).join(',')\r\n  )].join('\\n');\r\n\r\n  return csvContent;\r\n}\r\n\r\n// Parse CSV response from GPT back to models\r\nexport function parseCSVToModels(csvData: string): Model[] {\r\n  try {\r\n    const lines = csvData.trim().split('\\n');\r\n    if (lines.length < 2) {\r\n      console.warn('CSV parsing: Less than 2 lines found');\r\n      return [];\r\n    }\r\n\r\n    const headers = lines[0].split(',').map(h => h.replace(/\"/g, '').trim());\r\n    const models: Model[] = [];\r\n\r\n    console.log(`CSV parsing: Found ${lines.length - 1} data rows with ${headers.length} columns`);\r\n\r\n    for (let i = 1; i < lines.length; i++) {\r\n      try {\r\n        const values = parseCSVLine(lines[i]);\r\n\r\n        // More lenient: allow slight column mismatch\r\n        if (values.length === 0) {\r\n          console.warn(`CSV parsing: Row ${i} is empty, skipping`);\r\n          continue;\r\n        }\r\n\r\n        if (Math.abs(values.length - headers.length) > 3) {\r\n          console.warn(`CSV parsing: Row ${i} has ${values.length} columns, expected ${headers.length}, skipping`);\r\n          continue;\r\n        }\r\n\r\n        const modelData: any = {};\r\n        headers.forEach((header, index) => {\r\n          modelData[header] = values[index]?.replace(/\"/g, '').trim() || '';\r\n        });\r\n\r\n        // Skip rows without essential fields\r\n        if (!modelData.id && !modelData.name) {\r\n          console.warn(`CSV parsing: Row ${i} missing both id and name, skipping`);\r\n          continue;\r\n        }\r\n\r\n        // Convert back to Model structure\r\n        const model: Model = {\r\n          id: modelData.id || modelData.name || `model_${i}`,\r\n          name: modelData.name || modelData.id || 'Unknown',\r\n          provider: modelData.provider || null,\r\n          domain: modelData.domain as any || 'Other',\r\n          source: modelData.source || '',\r\n          url: modelData.url || null,\r\n          repo: modelData.repo || null,\r\n          license: {\r\n            name: modelData.license_name || 'Unknown',\r\n            type: modelData.license_type as any || 'Custom',\r\n            commercial_use: modelData.commercial_use === 'true',\r\n            attribution_required: modelData.attribution_required === 'true',\r\n            share_alike: modelData.share_alike === 'true',\r\n            copyleft: modelData.copyleft === 'true'\r\n          },\r\n          pricing: [],\r\n          parameters: modelData.parameters || null,\r\n          context_window: modelData.context_window || null,\r\n          description: modelData.description || null,\r\n          release_date: modelData.release_date || null,\r\n          updated_at: modelData.updated_at || null,\r\n          downloads: modelData.downloads ? parseInt(modelData.downloads) : null,\r\n          tags: modelData.tags ? modelData.tags.split(';').filter(Boolean) : [],\r\n          indemnity: modelData.indemnity as any || 'None',\r\n          data_provenance: modelData.data_provenance || null,\r\n          hosting: {\r\n            weights_available: true,\r\n            api_available: false,\r\n            on_premise_friendly: true\r\n          }\r\n        };\r\n\r\n        // Reconstruct pricing if available\r\n        if (modelData.pricing_flat || modelData.pricing_input || modelData.pricing_output) {\r\n          model.pricing = [{\r\n            flat: modelData.pricing_flat ? parseFloat(modelData.pricing_flat) : null,\r\n            input: modelData.pricing_input ? parseFloat(modelData.pricing_input) : null,\r\n            output: modelData.pricing_output ? parseFloat(modelData.pricing_output) : null,\r\n            currency: modelData.pricing_currency || null,\r\n            unit: modelData.pricing_unit || null,\r\n            notes: modelData.pricing_notes || null,\r\n            model: null,\r\n            url: null\r\n          }];\r\n        }\r\n\r\n        models.push(model);\r\n      } catch (rowError) {\r\n        console.error(`CSV parsing: Error parsing row ${i}:`, rowError);\r\n        continue;\r\n      }\r\n    }\r\n\r\n    console.log(`CSV parsing: Successfully parsed ${models.length} models`);\r\n    return models;\r\n  } catch (error) {\r\n    console.error('CSV parsing: Fatal error:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n// Helper function to parse CSV line properly handling quoted fields\r\nfunction parseCSVLine(line: string): string[] {\r\n  const result = [];\r\n  let current = '';\r\n  let inQuotes = false;\r\n  let i = 0;\r\n\r\n  while (i < line.length) {\r\n    const char = line[i];\r\n\r\n    if (char === '\"') {\r\n      if (inQuotes && line[i + 1] === '\"') {\r\n        current += '\"';\r\n        i += 2;\r\n      } else {\r\n        inQuotes = !inQuotes;\r\n        i++;\r\n      }\r\n    } else if (char === ',' && !inQuotes) {\r\n      result.push(current);\r\n      current = '';\r\n      i++;\r\n    } else {\r\n      current += char;\r\n      i++;\r\n    }\r\n  }\r\n\r\n  result.push(current);\r\n  return result;\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\services\\validationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\test\\setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\types\\electron.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\currency.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\currency.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\debounce.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\electron.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\external-links.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\fetch-wrapper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\filterLogic.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\filterLogic.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\format.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\format.ts","messages":[{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":206,"column":11,"nodeType":"BlockStatement","messageId":"unexpected","endLine":206,"endColumn":14,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[6944,6945],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":212,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":212,"endColumn":16,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[7112,7113],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":219,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":219,"endColumn":16,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[7293,7294],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Domain, LicenseInfo, Model, RiskScore } from \"../types\";\r\n\r\n// Formatting utilities\r\nexport const fmtDate = (iso?: string | null) => {\r\n  if (!iso) return \"ÔÇö\";\r\n  const d = new Date(iso);\r\n  return Number.isNaN(d.getTime()) ? iso : d.toLocaleDateString();\r\n};\r\n\r\nexport const kfmt = (n?: number | null) =>\r\n  n == null ? \"ÔÇö\" :\r\n    n >= 1_000_000 ? (n / 1_000_000).toFixed(n % 1_000_000 ? 1 : 0) + \"m\" :\r\n      n >= 1_000 ? (n / 1_000).toFixed(n % 1_000 ? 1 : 0) + \"k\" :\r\n        String(n);\r\n\r\nexport const cleanId = (s: string) => s.replace(/[^a-zA-Z0-9._-]/g, '_');\r\n\r\n// Normalize model names for matching across small formatting differences\r\nexport function normalizeNameForMatch(name?: string | null): string {\r\n  if (!name) return '';\r\n  let s = String(name).toLowerCase();\r\n  // Unwrap bracket qualifiers: \"FLUX.1 [pro]\" -> \"flux.1 pro\"\r\n  s = s.replace(/\\[([^\\]]+)\\]/g, ' $1 ');\r\n  // Collapse punctuation and dots/hyphens/underscores into spaces\r\n  s = s.replace(/[^a-z0-9]+/g, ' ');\r\n  // Trim and collapse spaces\r\n  s = s.trim().replace(/\\s+/g, ' ');\r\n  return s;\r\n}\r\n\r\n// Collection utilities\r\nexport const dedupe = (items: Model[]) => {\r\n  const map = new Map<string, Model>();\r\n  for (const m of items) {\r\n    if (!m) continue; // Skip null/undefined items\r\n    const nameKeyRaw = m?.name ? String(m.name) : (m.id ? String(m.id) : \"\");\r\n    const nameKey = normalizeNameForMatch(nameKeyRaw) || nameKeyRaw.toLowerCase();\r\n    const providerKey = (m.provider ? String(m.provider) : '').toLowerCase().replace(/[^a-z0-9]/g, '');\r\n    const key = `${providerKey}::${nameKey}`;\r\n    if (!map.has(key)) map.set(key, m);\r\n  }\r\n  return Array.from(map.values());\r\n};\r\n\r\n// CSV/TSV conversion\r\nexport function toCSV(rows: Record<string, unknown>[]): string {\r\n  if (!rows.length) return \"\";\r\n  const headers = Object.keys(rows[0]);\r\n  const esc = (v: unknown): string => {\r\n    if (v == null) return \"\";\r\n    const s = String(Array.isArray(v) ? v.join(\";\") : v);\r\n    return /[\",\\n]/.test(s) ? '\"' + s.replace(/\"/g, '\"\"') + '\"' : s;\r\n  };\r\n  const out = [headers.join(\",\")];\r\n  for (const r of rows) {\r\n    out.push(headers.map(h => esc(r[h])).join(\",\"));\r\n  }\r\n  return out.join(\"\\n\");\r\n}\r\n\r\nexport function parseCSV(text: string): Record<string, string>[] {\r\n  const out: Record<string, string>[] = [];\r\n  const rows: string[][] = [];\r\n  let cur = \"\", row: string[] = [];\r\n  let q = false;\r\n\r\n  for (let i = 0; i < text.length; i++) {\r\n    const c = text[i];\r\n    if (q) {\r\n      if (c === '\"') {\r\n        if (text[i + 1] === '\"') {\r\n          cur += '\"';\r\n          i++;\r\n        } else q = false;\r\n      } else cur += c;\r\n    } else {\r\n      if (c === '\"') q = true;\r\n      else if (c === ',') {\r\n        row.push(cur);\r\n        cur = '';\r\n      } else if (c === '\\n') {\r\n        row.push(cur);\r\n        rows.push(row);\r\n        row = [];\r\n        cur = '';\r\n      } else if (c === '\\r') {\r\n        // ignore\r\n      } else cur += c;\r\n    }\r\n  }\r\n\r\n  row.push(cur);\r\n  rows.push(row);\r\n\r\n  if (!rows.length) return out;\r\n\r\n  const head = rows[0];\r\n  for (const r of rows.slice(1)) {\r\n    if (!r.some(x => x && x.trim().length)) continue;\r\n    const obj: Record<string, string> = {};\r\n    head.forEach((h, i) => obj[h.trim()] = r[i] ?? \"\");\r\n    out.push(obj);\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nexport function parseTSV(text: string): Record<string, string>[] {\r\n  const out: Record<string, string>[] = [];\r\n  const rows: string[][] = [];\r\n  let cur = \"\", row: string[] = [];\r\n  let q = false;\r\n\r\n  for (let i = 0; i < text.length; i++) {\r\n    const c = text[i];\r\n    if (q) {\r\n      if (c === '\"') {\r\n        if (text[i + 1] === '\"') {\r\n          cur += '\"';\r\n          i++;\r\n        } else q = false;\r\n      } else cur += c;\r\n    } else {\r\n      if (c === '\"') q = true;\r\n      else if (c === '\\t') {\r\n        row.push(cur);\r\n        cur = '';\r\n      } else if (c === '\\n') {\r\n        row.push(cur);\r\n        rows.push(row);\r\n        row = [];\r\n        cur = '';\r\n      } else if (c === '\\r') {\r\n        // ignore\r\n      } else cur += c;\r\n    }\r\n  }\r\n\r\n  row.push(cur);\r\n  rows.push(row);\r\n\r\n  if (!rows.length) return out;\r\n\r\n  const head = rows[0];\r\n  for (const r of rows.slice(1)) {\r\n    if (!r.some(x => x && x.trim().length)) continue;\r\n    const obj: Record<string, string> = {};\r\n    head.forEach((h, i) => obj[h.trim()] = r[i] ?? \"\");\r\n    out.push(obj);\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n// Data normalization for imports\r\nexport function pick(obj: Record<string, unknown>, keys: string[]): unknown {\r\n  for (const k of keys) {\r\n    const v = obj[k];\r\n    if (v != null && String(v).trim() !== '') return v;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nexport function mapDomain(v?: unknown, sheetName?: string): Domain {\r\n  const s = String(v || sheetName || '').toLowerCase();\r\n  if (s.includes('vlm') || s.includes('vision') || s.includes('multimodal')) return 'VLM';\r\n  if (s.includes('llm') || s.includes('language') || s.includes('chat')) return 'LLM';\r\n  if (s.includes('text-to-image') || s.includes('image')) return 'ImageGen';\r\n  if (s.includes('video')) return 'VideoGen';\r\n  if (s.includes('audio') || s.includes('asr') || s.includes('speech') || s.includes('tts')) return s.includes('tts') ? 'TTS' : 'ASR';\r\n  if (s.includes('detect') || s.includes('segment')) return 'VLM';\r\n  if (s.includes('3d') || s.includes('mesh') || s.includes('nerf')) return '3D';\r\n  if (s.includes('world') || s.includes('sim')) return 'World/Sim';\r\n  return 'Other';\r\n}\r\n\r\nexport function normalizeRows(rows: any[], sheetName?: string) {\r\n  return rows.map(r => {\r\n    const o: any = { ...r };\r\n    if (!o.name) o.name = pick(r, [\"Model Name\", \"name\", \"Model\"]);\r\n    if (!o.provider) o.provider = pick(r, [\"Company/Developer\", \"Company\", \"Developer\", \"Author\", \"Provider\", \"Org\"]);\r\n    if (!o.domain) o.domain = pick(r, [\"Model Type\", \"Type\", \"Domain\"]);\r\n    const sheet = (r.__sheetName || sheetName || '') as string;\r\n    o.domain = o.domain || mapDomain(o.domain, sheet);\r\n    if (!o.url) o.url = pick(r, [\"Repository/URL\", \"URL\", \"Homepage\", \"Website\", \"Link\"]);\r\n    if (!o.repo) o.repo = pick(r, [\"Repository\", \"Repo\", \"GitHub\", \"Git\"]);\r\n    if (!o.license_name) o.license_name = pick(r, [\"License\", \"License Name\"]);\r\n    if (o.commercial == null) {\r\n      const cu = String(pick(r, [\"Commercial Use\", \"Commercial\"]) || '').toLowerCase();\r\n      if (cu) o.commercial = cu.includes('yes') || cu.includes('allowed');\r\n    }\r\n    if (!o.release_date) o.release_date = pick(r, [\"Release Date\", \"Released\", \"Date\"]);\r\n    if (!o.parameters) o.parameters = pick(r, [\"Parameters\", \"Params\", \"Size\"]);\r\n    if (!o.tags) {\r\n      const kf = pick(r, [\"Key Features\", \"Features\", \"Notes\"]);\r\n      if (kf != null) o.tags = String(kf).split(/[,;]|\\s┬À\\s/).map((x: any) => String(x).trim()).filter(Boolean);\r\n    }\r\n    return o;\r\n  });\r\n}\r\n\r\n// JSON parsing\r\nexport function safeJsonFromText(s: string) {\r\n  try {\r\n    return JSON.parse(s);\r\n  } catch { }\r\n\r\n  const a = s.indexOf('{'), b = s.lastIndexOf('}');\r\n  if (a !== -1 && b !== -1 && b > a) {\r\n    try {\r\n      return JSON.parse(s.slice(a, b + 1));\r\n    } catch { }\r\n  }\r\n\r\n  const aa = s.indexOf('['), bb = s.lastIndexOf(']');\r\n  if (aa !== -1 && bb !== -1 && bb > aa) {\r\n    try {\r\n      return JSON.parse(s.slice(aa, bb + 1));\r\n    } catch { }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n// Risk analysis utilities\r\nexport function riskScore(m: Model): RiskScore {\r\n  const L = m.license;\r\n  if (!L) return { level: \"Amber\", reason: \"No license info\" };\r\n  if (L.type === \"Non-Commercial\") return { level: \"Red\", reason: \"NonÔÇæcommercial license\" };\r\n  if (L.copyleft) return { level: \"Amber\", reason: \"Copyleft obligations (distribution triggers)\" };\r\n  if (L.type === \"Proprietary\" || L.type === \"Custom\") return L.commercial_use ?\r\n    { level: \"Amber\", reason: \"Proprietary/custom terms ÔÇö review T&Cs\" } :\r\n    { level: \"Red\", reason: \"No commercial rights\" };\r\n  return { level: \"Green\", reason: L.attribution_required ? \"Commercial OK + attribution\" : \"Commercial OK\" };\r\n}\r\n\r\nexport function riskExplainer(m: Model): string[] {\r\n  const L = m.license, out: string[] = [];\r\n  const r = riskScore(m);\r\n  out.push(`Risk level: ${r.level} ÔÇö ${r.reason}`);\r\n\r\n  if (!L) return out;\r\n\r\n  if (L.type === \"OSI\") {\r\n    if (L.attribution_required) out.push(\"Attribution required where practical.\");\r\n    out.push(\"No copyleft ÔÇö private deployments unaffected.\");\r\n  }\r\n\r\n  if (L.copyleft) out.push(\"Copyleft: modify+distribute ÔçÆ share source (AGPL covers network use).\");\r\n  if (L.type === \"Custom\") out.push(\"Custom terms: check vendor restrictions (biometric/competitive/etc).\");\r\n  if (L.type === \"Proprietary\") out.push(\"Proprietary/API terms: review indemnity & training provenance.\");\r\n  if (m.indemnity && m.indemnity !== \"None\") out.push(`Indemnity: ${m.indemnity} ÔÇö vendor IP shield may apply.`);\r\n  if (m.usage_restrictions?.length) out.push(`Usage restrictions: ${m.usage_restrictions.join(\", \")}.`);\r\n  if (L.url) out.push(\"License ÔåÆ \" + L.url);\r\n\r\n  return out;\r\n}\r\n\r\nexport function cleanModelDescription(desc?: string | null): string {\r\n  if (!desc) return '';\r\n  let s = desc;\r\n\r\n  // 1. Remove Markdown images\r\n  s = s.replace(/!\\[([^\\]]*)\\]\\([^)]+\\)/g, '');\r\n\r\n  // 2. Replace Markdown links with text: [text](url) -> text\r\n  // Handle cases where link text is empty or missing\r\n  s = s.replace(/\\[([^\\]]+)\\]\\([^)]+\\)/g, '$1');\r\n\r\n  // 3. Remove header markers (start of line or after newline)\r\n  s = s.replace(/(^|\\n)#+\\s+/g, '$1');\r\n\r\n  // 4. Remove bold/italic\r\n  s = s.replace(/(\\*\\*|__)(.*?)\\1/g, '$2');\r\n  s = s.replace(/(\\*|_)(.*?)\\1/g, '$2');\r\n\r\n  // 5. Remove code blocks\r\n  s = s.replace(/```[\\s\\S]*?```/g, '');\r\n  s = s.replace(/`([^`]+)`/g, '$1');\r\n\r\n  // 6. Fix \"Key: Value\" formatting if it's run-on\r\n  // Often seen: \"Subject: Photography Input Type: Images\" -> \"Subject: Photography\\nInput Type: Images\"\r\n  // Heuristic: Look for \" Key: \" preceded by a word character but not a newline\r\n  s = s.replace(/([a-zA-Z0-9])\\s+([A-Z][a-zA-Z\\s]+:)/g, '$1\\n$2');\r\n\r\n  // 7. Clean up multiple spaces/newlines\r\n  s = s.replace(/\\n{3,}/g, '\\n\\n');\r\n\r\n  return s.trim();\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\importNormalization.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\importNormalization.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\logger.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":89,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":89,"endColumn":28,"suggestions":[{"fix":{"range":[2609,2654],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":98,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":98,"endColumn":28,"suggestions":[{"fix":{"range":[2876,2920],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":133,"column":45,"nodeType":"MemberExpression","messageId":"limited","endLine":133,"endColumn":56},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":136,"column":44,"nodeType":"MemberExpression","messageId":"limited","endLine":136,"endColumn":55},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":155,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":155,"endColumn":26,"suggestions":[{"fix":{"range":[4663,4699],"text":""},"messageId":"removeConsole","data":{"propertyName":"group"},"desc":"Remove the console.group()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":159,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":159,"endColumn":33,"suggestions":[{"fix":{"range":[4784,4803],"text":""},"messageId":"removeConsole","data":{"propertyName":"groupEnd"},"desc":"Remove the console.groupEnd()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":174,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":174,"endColumn":28,"suggestions":[{"fix":{"range":[5253,5302],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Logging Utility\r\n * \r\n * Provides a centralized logging system with different log levels.\r\n * In production, debug logs are suppressed to reduce console noise.\r\n * \r\n * Features:\r\n * - Level-based logging (debug, info, warn, error)\r\n * - Automatic timestamp prefixing\r\n * - Production-aware (debug logs suppressed when not in dev)\r\n * - Namespace support for tracing log sources\r\n */\r\n\r\ntype LogLevel = 'debug' | 'info' | 'warn' | 'error';\r\n\r\ninterface LoggerConfig {\r\n    /** Minimum log level to display */\r\n    minLevel: LogLevel;\r\n    /** Whether to include timestamps */\r\n    timestamps: boolean;\r\n    /** Whether to include log level prefix */\r\n    showLevel: boolean;\r\n}\r\n\r\n// Log level priority for filtering\r\nconst LOG_LEVELS: Record<LogLevel, number> = {\r\n    debug: 0,\r\n    info: 1,\r\n    warn: 2,\r\n    error: 3\r\n};\r\n\r\n// Default configuration based on environment\r\nconst isDev = import.meta.env?.DEV ?? (typeof process !== 'undefined' && process.env?.NODE_ENV !== 'production');\r\n\r\nconst defaultConfig: LoggerConfig = {\r\n    minLevel: isDev ? 'debug' : 'info',\r\n    timestamps: false,\r\n    showLevel: true\r\n};\r\n\r\n// Track logged messages to prevent spam (only log each unique message once per session in production)\r\nconst loggedOnce = new Set<string>();\r\n\r\n/**\r\n * Creates a logger instance with an optional namespace\r\n */\r\nexport function createLogger(namespace?: string) {\r\n    const prefix = namespace ? `[${namespace}]` : '';\r\n\r\n    const shouldLog = (level: LogLevel): boolean => {\r\n        return LOG_LEVELS[level] >= LOG_LEVELS[defaultConfig.minLevel];\r\n    };\r\n\r\n    const formatMessage = (level: LogLevel, ...args: unknown[]): string => {\r\n        const parts: string[] = [];\r\n\r\n        if (defaultConfig.timestamps) {\r\n            parts.push(`[${new Date().toISOString()}]`);\r\n        }\r\n\r\n        if (defaultConfig.showLevel) {\r\n            parts.push(`[${level.toUpperCase()}]`);\r\n        }\r\n\r\n        if (prefix) {\r\n            parts.push(prefix);\r\n        }\r\n\r\n        const message = args.map(arg => {\r\n            if (typeof arg === 'string') return arg;\r\n            if (arg instanceof Error) return arg.stack || arg.message;\r\n            try {\r\n                return JSON.stringify(arg);\r\n            } catch {\r\n                return String(arg);\r\n            }\r\n        }).join(' ');\r\n\r\n        return parts.length > 0 ? `${parts.join(' ')} ${message}` : message;\r\n    };\r\n\r\n    return {\r\n        /**\r\n         * Debug log - only shown in development\r\n         */\r\n        debug: (...args: unknown[]): void => {\r\n            if (shouldLog('debug')) {\r\n                console.log(formatMessage('debug', ...args));\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Info log - general information, shown in production\r\n         */\r\n        info: (...args: unknown[]): void => {\r\n            if (shouldLog('info')) {\r\n                console.log(formatMessage('info', ...args));\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Warning log - potential issues, shown in production\r\n         */\r\n        warn: (...args: unknown[]): void => {\r\n            if (shouldLog('warn')) {\r\n                console.warn(formatMessage('warn', ...args));\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Error log - always shown\r\n         */\r\n        error: (...args: unknown[]): void => {\r\n            if (shouldLog('error')) {\r\n                console.error(formatMessage('error', ...args));\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Log once - only logs the first occurrence of each unique message\r\n         * Useful for preventing spam from recurring issues\r\n         */\r\n        once: (level: LogLevel, ...args: unknown[]): void => {\r\n            const message = formatMessage(level, ...args);\r\n            if (loggedOnce.has(message)) {\r\n                return;\r\n            }\r\n            loggedOnce.add(message);\r\n\r\n            switch (level) {\r\n                case 'debug':\r\n                    if (shouldLog('debug')) console.log(message);\r\n                    break;\r\n                case 'info':\r\n                    if (shouldLog('info')) console.log(message);\r\n                    break;\r\n                case 'warn':\r\n                    if (shouldLog('warn')) console.warn(message);\r\n                    break;\r\n                case 'error':\r\n                    if (shouldLog('error')) console.error(message);\r\n                    break;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Group related logs together\r\n         */\r\n        group: (label: string, fn: () => void): void => {\r\n            if (!isDev) {\r\n                fn();\r\n                return;\r\n            }\r\n            console.group(`${prefix} ${label}`);\r\n            try {\r\n                fn();\r\n            } finally {\r\n                console.groupEnd();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Measure and log execution time\r\n         */\r\n        time: async <T>(label: string, fn: () => Promise<T>): Promise<T> => {\r\n            if (!isDev) {\r\n                return fn();\r\n            }\r\n            const start = performance.now();\r\n            try {\r\n                const result = await fn();\r\n                const duration = (performance.now() - start).toFixed(2);\r\n                console.log(`${prefix} ${label}: ${duration}ms`);\r\n                return result;\r\n            } catch (error) {\r\n                const duration = (performance.now() - start).toFixed(2);\r\n                console.error(`${prefix} ${label}: FAILED after ${duration}ms`);\r\n                throw error;\r\n            }\r\n        }\r\n    };\r\n}\r\n\r\n// Default logger instance\r\nexport const logger = createLogger();\r\n\r\n// Pre-created namespaced loggers for common modules\r\nexport const loggers = {\r\n    sync: createLogger('Sync'),\r\n    api: createLogger('API'),\r\n    storage: createLogger('Storage'),\r\n    validation: createLogger('Validation'),\r\n    nsfw: createLogger('NSFW'),\r\n    ui: createLogger('UI'),\r\n};\r\n\r\n/**\r\n * Configure logging behavior\r\n */\r\nexport function configureLogging(config: Partial<LoggerConfig>): void {\r\n    Object.assign(defaultConfig, config);\r\n}\r\n\r\n/**\r\n * Clear the \"logged once\" cache - useful for testing\r\n */\r\nexport function resetLoggedOnce(): void {\r\n    loggedOnce.clear();\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\mergeLogic.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\mergeLogic.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\migration.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":22,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":22,"endColumn":16,"suggestions":[{"fix":{"range":[654,720],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":74,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":74,"endColumn":20,"suggestions":[{"fix":{"range":[2702,2803],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":76,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":76,"endColumn":20,"suggestions":[{"fix":{"range":[2827,2909],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Migration Utility\r\n * \r\n * Handles one-time migration from old localStorage key prefix (aiModelDBPro_)\r\n * to new prefix (aiModelDB_) to preserve user data during rebranding.\r\n */\r\n\r\nconst OLD_PREFIX = 'aiModelDBPro_';\r\nconst NEW_PREFIX = 'aiModelDB_';\r\nconst MIGRATION_FLAG = 'aiModelDB_migrated';\r\n\r\n/**\r\n * One-time migration from aiModelDBPro_* to aiModelDB_* keys\r\n * Preserves all user data during the rebranding from \"AI Model DB Pro\" to \"AI Model DB\"\r\n */\r\nexport function migrateLocalStorageKeys(): void {\r\n    // Check if migration already done\r\n    if (localStorage.getItem(MIGRATION_FLAG) === 'true') {\r\n        return;\r\n    }\r\n\r\n    console.log('[Migration] Starting localStorage key migration...');\r\n\r\n    // Static key mappings for known keys\r\n    const keyMappings = [\r\n        ['aiModelDBPro_models', 'aiModelDB_models'],\r\n        ['aiModelDBPro_settings', 'aiModelDB_settings'],\r\n        ['aiModelDBPro_lastSync', 'aiModelDB_lastSync'],\r\n        ['aiModelDBPro_apiConfig', 'aiModelDB_apiConfig'],\r\n        ['aiModelDBPro_theme', 'aiModelDB_theme'],\r\n        ['aiModelDBPro_customCss', 'aiModelDB_customCss'],\r\n        ['aiModelDBPro_customColors', 'aiModelDB_customColors'],\r\n        ['aiModelDBPro_savedPresets', 'aiModelDB_savedPresets'],\r\n        ['aiModelDBPro_activePresetId', 'aiModelDB_activePresetId'],\r\n        ['aiModelDBPro_language', 'aiModelDB_language'],\r\n        ['aiModelDBPro_history_index', 'aiModelDB_history_index'],\r\n    ];\r\n\r\n    let migratedCount = 0;\r\n\r\n    // Migrate static keys\r\n    for (const [oldKey, newKey] of keyMappings) {\r\n        const value = localStorage.getItem(oldKey);\r\n        if (value && !localStorage.getItem(newKey)) {\r\n            localStorage.setItem(newKey, value);\r\n            localStorage.removeItem(oldKey);\r\n            migratedCount++;\r\n        }\r\n    }\r\n\r\n    // Migrate dynamic history keys (aiModelDBPro_history_*)\r\n    const keysToMigrate: [string, string][] = [];\r\n    for (let i = 0; i < localStorage.length; i++) {\r\n        const key = localStorage.key(i);\r\n        if (key && key.startsWith(OLD_PREFIX) && !keyMappings.some(([k]) => k === key)) {\r\n            const newKey = key.replace(OLD_PREFIX, NEW_PREFIX);\r\n            keysToMigrate.push([key, newKey]);\r\n        }\r\n    }\r\n\r\n    for (const [oldKey, newKey] of keysToMigrate) {\r\n        const value = localStorage.getItem(oldKey);\r\n        if (value && !localStorage.getItem(newKey)) {\r\n            localStorage.setItem(newKey, value);\r\n            localStorage.removeItem(oldKey);\r\n            migratedCount++;\r\n        }\r\n    }\r\n\r\n    // Mark migration as complete\r\n    localStorage.setItem(MIGRATION_FLAG, 'true');\r\n\r\n    if (migratedCount > 0) {\r\n        console.log(`[Migration] Successfully migrated ${migratedCount} keys from old prefix to new prefix`);\r\n    } else {\r\n        console.log('[Migration] No keys to migrate (fresh install or already migrated)');\r\n    }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\nsfw-keywords.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\nsfw.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\nsfw.ts","messages":[{"ruleId":"prefer-const","severity":1,"message":"'normalized' is never reassigned. Use 'const' instead.","line":108,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":108,"endColumn":17,"fix":{"range":[3353,3836],"text":"const normalized = text\r\n    // Insert space before uppercase letters (CamelCase -> Camel Case)\r\n    .replace(/([a-z])([A-Z])/g, '$1 $2')\r\n    // Insert space between letter and number transitions\r\n    .replace(/([a-zA-Z])(\\d)/g, '$1 $2')\r\n    .replace(/(\\d)([a-zA-Z])/g, '$1 $2')\r\n    // Replace dashes, underscores, dots with spaces\r\n    .replace(/[-_.]+/g, ' ')\r\n    // Collapse multiple spaces\r\n    .replace(/\\s+/g, ' ')\r\n    // Trim and lowercase\r\n    .trim()\r\n    .toLowerCase();"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"// NSFW Detection and Filtering Utilities for Corporate Environment\r\n\r\nexport interface NSFWCheckResult {\r\n  isNSFW: boolean;\r\n  confidence: number;\r\n  reasons: string[];\r\n  flaggedTerms: string[];\r\n}\r\n\r\nimport { EXPLICIT_NAME_TERMS, EXPLICIT_TAGS } from './nsfw-keywords';\r\n\r\n// Re-export for use in other files if necessary, or just use them here.\r\nexport { EXPLICIT_NAME_TERMS, EXPLICIT_TAGS };\r\n\r\n\r\n\r\n// Safe model categories that are definitely work-appropriate\r\nconst SAFE_CATEGORIES = [\r\n  'text-generation', 'language-model', 'nlp', 'llm',\r\n  'computer-vision', 'object-detection', 'classification',\r\n  'segmentation', 'medical', 'scientific', 'research',\r\n  'business', 'education', 'academic', 'productivity',\r\n  'code-generation', 'programming', 'development',\r\n  'data-analysis', 'machine-learning', 'ai-assistant'\r\n];\r\n\r\n// Trusted providers - models from these sources are always considered safe\r\nconst TRUSTED_PROVIDERS = [\r\n  'google', 'google-bert', 'google-t5', 'facebook', 'facebookai', 'meta-llama', 'meta',\r\n  'microsoft', 'openai', 'anthropic', 'huggingface', 'sentence-transformers',\r\n  'distilbert', 'bert-base', 'transformers', 'pytorch', 'tensorflow',\r\n  'nvidia', 'amd', 'intel', 'ibm', 'amazon', 'aws', 'apple', 'alibaba', 'baidu', 'tencent',\r\n  'deepmind', 'stability', 'stabilityai', 'mistral', 'mistralai', 'cohere', 'ai21',\r\n  'lmstudio', 'lmstudio-community', 'thebloke', 'unsloth', 'teknium', 'nous', 'nousresearch'\r\n];\r\n\r\n// Known safe model patterns - models matching these patterns are always safe\r\n// This includes general-purpose models that CAN generate NSFW but aren't inherently NSFW\r\nconst SAFE_MODEL_PATTERNS = [\r\n  // LLM base models\r\n  /^(bert|distilbert|roberta|albert|electra)-/i,\r\n  /^(gpt|llama|t5|gemma|mistral|qwen|phi|deepseek)-/i,\r\n  /^sentence-transformers\\//i,\r\n  /^google-(bert|t5)\\//i,\r\n  /^facebook(ai)?\\/(roberta|bart|contriever)/i,\r\n  /^meta-llama\\//i,\r\n  /\\/bert-/i,\r\n  /\\/roberta-/i,\r\n  /\\/t5-/i,\r\n\r\n  // General-purpose image generation models (can do NSFW but not inherently NSFW)\r\n  /stable[-\\s]?diffusion/i,\r\n  /\\bsdxl\\b/i,\r\n  /\\bsd[-\\s]?(1\\.5|2\\.0|2\\.1|3\\.0|3\\.5)\\b/i,\r\n  /\\bflux\\b/i,\r\n  /\\bdalle?\\b/i,\r\n  /\\bmidjourney\\b/i,\r\n  /dream[-\\s]?diffusion/i,\r\n  /kandinsky/i,\r\n  /playground[-\\s]?v/i,\r\n  /pixart/i,\r\n  /\\bwuerstchen\\b/i,\r\n  /\\bif[-\\s]?model\\b/i,\r\n  /controlnet/i,\r\n  /ip[-\\s]?adapter/i,\r\n  /lora[-\\s]?training/i,  // LoRA training tools, not NSFW content\r\n\r\n  // Video generation models\r\n  /\\bsora\\b/i,\r\n  /\\bpika\\b/i,\r\n  /\\brunway\\b/i,\r\n  /cogvideo/i,\r\n  /animatediff/i,\r\n\r\n  // Audio models\r\n  /whisper/i,\r\n  /musicgen/i,\r\n  /audioldm/i,\r\n  /bark/i,\r\n  /tortoise[-\\s]?tts/i,\r\n\r\n  // Utility/safety models\r\n  /detection$/i,\r\n  /classifier$/i,\r\n  /classification$/i,\r\n  /embedding/i,\r\n  /encoder/i,\r\n  /vae/i,\r\n  /upscaler/i,\r\n  /super[-\\s]?resolution/i\r\n];\r\n\r\n// Suspicious model names/providers that often host NSFW content\r\nconst NSFW_PROVIDERS = [\r\n  'civitai', 'civitaiarchive', 'civitasbay'\r\n];\r\n\r\n/**\r\n * Normalizes text to catch various formatting patterns:\r\n * - CamelCase: \"ProneBone\" -> \"prone bone\"\r\n * - Dashes/underscores: \"prone-bone\" or \"prone_bone\" -> \"prone bone\"\r\n * - Dots: \"prone.bone\" -> \"prone bone\"\r\n * - Numbers mixed in: \"pr0n\" stays as is (handled by keyword list)\r\n */\r\nfunction normalizeText(text: string): string {\r\n  if (!text) return '';\r\n\r\n  let normalized = text\r\n    // Insert space before uppercase letters (CamelCase -> Camel Case)\r\n    .replace(/([a-z])([A-Z])/g, '$1 $2')\r\n    // Insert space between letter and number transitions\r\n    .replace(/([a-zA-Z])(\\d)/g, '$1 $2')\r\n    .replace(/(\\d)([a-zA-Z])/g, '$1 $2')\r\n    // Replace dashes, underscores, dots with spaces\r\n    .replace(/[-_.]+/g, ' ')\r\n    // Collapse multiple spaces\r\n    .replace(/\\s+/g, ' ')\r\n    // Trim and lowercase\r\n    .trim()\r\n    .toLowerCase();\r\n\r\n  return normalized;\r\n}\r\n\r\n/**\r\n * Generates variations of a term for matching (no-space versions)\r\n */\r\nfunction getTermVariations(term: string): string[] {\r\n  const variations = [term];\r\n  // Add no-space version if term has spaces\r\n  if (term.includes(' ')) {\r\n    variations.push(term.replace(/\\s+/g, ''));\r\n  }\r\n  return variations;\r\n}\r\n\r\n/**\r\n * Analyzes text content for NSFW indicators\r\n */\r\nfunction analyzeTextForExplicitName(text: string, customKeywords: string[] = []): { score: number; flaggedTerms: string[] } {\r\n  if (!text) return { score: 0, flaggedTerms: [] };\r\n\r\n  // Normalize the input text to catch CamelCase, dashes, underscores, etc.\r\n  const normalizedText = normalizeText(text);\r\n  // Also keep original lowercase for direct matches (e.g., \"pronebone\" without spaces)\r\n  const originalLower = text.toLowerCase();\r\n\r\n  const flaggedTerms: string[] = [];\r\n  let score = 0;\r\n\r\n  // Combine default explicit terms with custom keywords\r\n  const allTerms = [...EXPLICIT_NAME_TERMS, ...customKeywords];\r\n\r\n  for (const term of allTerms) {\r\n    if (term === '18+') {\r\n      if (text.includes('18+')) {\r\n        flaggedTerms.push(term);\r\n        score = 100;\r\n      }\r\n      continue;\r\n    }\r\n\r\n    // Get variations of the term (with and without spaces)\r\n    const variations = getTermVariations(term);\r\n\r\n    for (const variant of variations) {\r\n      // Escape special regex chars\r\n      const escaped = variant.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n      // Use word boundaries to avoid false positives (e.g., 'sex' in 'essex')\r\n      const regex = new RegExp(`\\\\b${escaped}\\\\b`, 'i');\r\n\r\n      // Check both normalized and original text\r\n      if (regex.test(normalizedText) || regex.test(originalLower)) {\r\n        if (!flaggedTerms.includes(term)) {\r\n          flaggedTerms.push(term);\r\n          score = 100;\r\n        }\r\n        break; // Found a match for this term, no need to check other variations\r\n      }\r\n    }\r\n  }\r\n\r\n  return { score, flaggedTerms };\r\n}\r\n\r\n/**\r\n * Checks tags array for NSFW content\r\n */\r\nfunction checkTagsForNSFW(tags: string[], customKeywords: string[] = []): { score: number; flaggedTags: string[] } {\r\n  if (!tags || !Array.isArray(tags)) return { score: 0, flaggedTags: [] };\r\n\r\n  const flaggedTags: string[] = [];\r\n  let score = 0;\r\n\r\n  const allNsfwTags = [...EXPLICIT_TAGS, ...customKeywords];\r\n\r\n  // Common safe tags that should never be flagged\r\n  const safeTags = [\r\n    'text2text', 'textgeneration', 'textclassification', 'language', 'multilingual', 'code',\r\n    'diffusers', 'transformers', 'safetensors', 'lora', 'controlnet', 'comfyui', 'stable-diffusion',\r\n    'text-to-image', 'image-to-image', 'image-generation', 'text-generation', 'text2image',\r\n    'base-model', 'checkpoint', 'finetune', 'fine-tune', 'distillation', 'quantized', 'gguf',\r\n    'community-archive', 'model', 'weights', 'pretrained', 'experimental', 'research'\r\n  ];\r\n\r\n  for (const tag of tags) {\r\n    const normalizedTag = tag.toLowerCase().replace(/[^a-z0-9]/g, '');\r\n\r\n    // Skip known safe tags\r\n    if (safeTags.some(safe => normalizedTag === safe.replace(/[^a-z0-9]/g, '') ||\r\n      normalizedTag.includes(safe.replace(/[^a-z0-9]/g, '')))) {\r\n      continue;\r\n    }\r\n\r\n    for (const nsfwTag of allNsfwTags) {\r\n      const normalizedNsfwTag = nsfwTag.toLowerCase().replace(/[^a-z0-9]/g, '');\r\n\r\n      // Skip very short NSFW terms to avoid false positives (e.g., 'dp', 'bj' matching random tags)\r\n      if (normalizedNsfwTag.length < 4) continue;\r\n\r\n      // Require EXACT match for tags - no substring matching\r\n      // Tags are short and specific, so partial matching causes too many false positives\r\n      if (normalizedTag === normalizedNsfwTag) {\r\n        flaggedTags.push(tag);\r\n        score += 100;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return { score, flaggedTags };\r\n}\r\n\r\n/**\r\n * Checks if provider/source is known to host NSFW content\r\n */\r\nfunction checkProviderRisk(provider: string, source: string): number {\r\n  return 0; // Don't auto-flag based on provider alone, let content analysis decide\r\n}\r\n\r\n/**\r\n * Main NSFW detection function\r\n */\r\nexport function detectNSFW(model: any, customKeywords: string[] = []): NSFWCheckResult {\r\n  const reasons: string[] = [];\r\n  const flaggedTerms: string[] = [];\r\n  let totalScore = 0;\r\n\r\n  const modelName = model.name || '';\r\n  const provider = (model.provider || '').toLowerCase();\r\n  const source = (model.source || '').toLowerCase();\r\n  const nameLower = modelName.toLowerCase();\r\n\r\n  // FIRST: Check for NSFW detection/safety models BEFORE explicit term check\r\n  // These are safety tools, not NSFW content generators\r\n  if (nameLower.includes('nsfw') &&\r\n    (nameLower.includes('detection') ||\r\n      nameLower.includes('detector') ||\r\n      nameLower.includes('classifier') ||\r\n      nameLower.includes('classification') ||\r\n      nameLower.includes('filter') ||\r\n      nameLower.includes('filtering') ||\r\n      nameLower.includes('safety') ||\r\n      nameLower.includes('moderation'))) {\r\n    return {\r\n      isNSFW: false,\r\n      confidence: 0,\r\n      reasons: ['NSFW detection/safety model'],\r\n      flaggedTerms: []\r\n    };\r\n  }\r\n\r\n  // SECOND: Check for explicit terms in name - this takes priority over other patterns\r\n  const nameCheck = analyzeTextForExplicitName(modelName, customKeywords);\r\n  if (nameCheck.score > 0) {\r\n    // Found explicit content - flag immediately, don't apply safe patterns\r\n    return {\r\n      isNSFW: true,\r\n      confidence: 1,\r\n      reasons: ['Flagged terms in model name'],\r\n      flaggedTerms: nameCheck.flaggedTerms\r\n    };\r\n  }\r\n\r\n  // THIRD: Check trusted providers (only if no explicit terms found)\r\n  if (TRUSTED_PROVIDERS.some(trusted => provider.includes(trusted.toLowerCase()))) {\r\n    return {\r\n      isNSFW: false,\r\n      confidence: 0,\r\n      reasons: ['Trusted provider'],\r\n      flaggedTerms: []\r\n    };\r\n  }\r\n\r\n  // FOURTH: Check safe model patterns (only if no explicit terms found)\r\n  if (SAFE_MODEL_PATTERNS.some(pattern => pattern.test(modelName))) {\r\n    return {\r\n      isNSFW: false,\r\n      confidence: 0,\r\n      reasons: ['Known safe model pattern'],\r\n      flaggedTerms: []\r\n    };\r\n  }\r\n\r\n  // Continue checking other fields (description, tags) for high-risk sources\r\n  // Smart Description Check: Only check description for high-risk providers\r\n  const isHighRiskSource = NSFW_PROVIDERS.some(risk => provider.includes(risk) || source.includes(risk));\r\n\r\n  if (isHighRiskSource) {\r\n    // Use the same regex analysis on description\r\n    const descCheck = analyzeTextForExplicitName(model.description || '', customKeywords);\r\n    if (descCheck.score > 0) {\r\n      totalScore += descCheck.score;\r\n      flaggedTerms.push(...descCheck.flaggedTerms);\r\n      reasons.push('Flagged terms in description (High Risk Source)');\r\n    }\r\n  }\r\n\r\n  // Check tags\r\n  const tagsCheck = checkTagsForNSFW(model.tags || [], customKeywords);\r\n  totalScore += tagsCheck.score;\r\n  flaggedTerms.push(...tagsCheck.flaggedTags);\r\n  if (tagsCheck.score > 0) {\r\n    reasons.push('NSFW tags detected');\r\n  }\r\n\r\n  // Check provider risk\r\n  const providerRisk = checkProviderRisk(model.provider || '', model.source || '');\r\n  totalScore += providerRisk;\r\n  if (providerRisk > 0) {\r\n    reasons.push('High-risk content provider');\r\n  }\r\n\r\n  // Ignore URL patterns\r\n\r\n  // Determine if content is NSFW based on total score\r\n  // Much higher threshold to avoid false positives on legitimate AI models\r\n  const isNSFW = totalScore >= 100; // require explicit term\r\n  const confidence = isNSFW ? 1 : 0;\r\n\r\n  return {\r\n    isNSFW,\r\n    confidence,\r\n    reasons: [...new Set(reasons)], // Remove duplicates\r\n    flaggedTerms: [...new Set(flaggedTerms)] // Remove duplicates\r\n  };\r\n}\r\n\r\n/**\r\n * Filters out NSFW models from a list\r\n */\r\nexport function filterNSFWModels(models: any[], enableFiltering: boolean = true, customKeywords: string[] = []): {\r\n  safeModels: any[];\r\n  flaggedModels: any[];\r\n  filteredCount: number;\r\n} {\r\n  if (!enableFiltering) {\r\n    return {\r\n      safeModels: models,\r\n      flaggedModels: [],\r\n      filteredCount: 0\r\n    };\r\n  }\r\n\r\n  const safeModels: any[] = [];\r\n  const flaggedModels: any[] = [];\r\n\r\n  for (const model of models) {\r\n    const nsfwCheck = detectNSFW(model, customKeywords);\r\n\r\n    if (nsfwCheck.isNSFW) {\r\n      // Add NSFW metadata for logging/debugging\r\n      const flaggedModel = {\r\n        ...model,\r\n        _nsfwCheck: nsfwCheck,\r\n        _filteredReason: 'NSFW content detected'\r\n      };\r\n      flaggedModels.push(flaggedModel);\r\n    } else {\r\n      safeModels.push(model);\r\n    }\r\n  }\r\n\r\n  return {\r\n    safeModels,\r\n    flaggedModels,\r\n    filteredCount: flaggedModels.length\r\n  };\r\n}\r\n\r\n/**\r\n * Validates that a model is safe for corporate use\r\n */\r\nexport function isCorporateSafe(model: any): boolean {\r\n  const nsfwCheck = detectNSFW(model);\r\n  return !nsfwCheck.isNSFW;\r\n}\r\n\r\n/**\r\n * Gets a human-readable safety report for a model\r\n */\r\nexport function getSafetyReport(model: any): string {\r\n  const nsfwCheck = detectNSFW(model);\r\n\r\n  if (!nsfwCheck.isNSFW) {\r\n    return 'Model appears safe for corporate use';\r\n  }\r\n\r\n  const reasons = nsfwCheck.reasons.join(', ');\r\n  const confidence = Math.round(nsfwCheck.confidence * 100);\r\n\r\n  return `NSFW detected (${confidence}% confidence): ${reasons}`;\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\typeGuards.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\typeGuards.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\utils\\validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"E:\\DataCert\\model-db\\src\\workers\\modelProcessor.worker.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'no-restricted-globals').","line":4,"column":1,"severity":1,"nodeType":null,"fix":{"range":[95,137],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import { performMergeBatch } from '../utils/mergeLogic';\r\nimport { Model } from '../types';\r\n\r\n/* eslint-disable no-restricted-globals */\r\nconst ctx: Worker = self as any;\r\n\r\ntype WorkerMessage =\r\n    | { type: 'MERGE_MODELS'; payload: { currentModels: Model[]; newModels: Model[]; autoMergeDuplicates: boolean } }\r\n    | { type: 'PING' };\r\n\r\nctx.addEventListener('message', (event) => {\r\n    const msg = event.data as WorkerMessage;\r\n\r\n    try {\r\n        if (msg.type === 'MERGE_MODELS') {\r\n            const { currentModels, newModels, autoMergeDuplicates } = msg.payload;\r\n            const result = performMergeBatch(currentModels, newModels, autoMergeDuplicates);\r\n            ctx.postMessage({ type: 'MERGE_COMPLETE', payload: result });\r\n        } else if (msg.type === 'PING') {\r\n            ctx.postMessage({ type: 'PONG' });\r\n        }\r\n    } catch (error) {\r\n        ctx.postMessage({ type: 'ERROR', error: error instanceof Error ? error.message : String(error) });\r\n    }\r\n});\r\n\r\nexport { };\r\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]}]
